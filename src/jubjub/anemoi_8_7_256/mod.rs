use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 8 field elements or 256 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 8;
/// 7 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 7;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 4;

/// 2 elements (64-bytes) are returned as digest.
pub const DIGEST_SIZE: usize = 2;

/// The number of rounds is set to 14 to provide 256-bit security level.
pub const NUM_HASH_ROUNDS: usize = 14;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        let beta_y2 = y2 + (y2 + y2.double()).double();
        *t -= beta_y2;
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        let beta_y2 = y2 + (y2 + y2.double()).double();
        *t += beta_y2 + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3]];
    let y: [Felt; NUM_COLUMNS] = [state[5], state[6], state[7], state[4]];

    let g_x0 = mul_by_generator(&x[0]);
    let g_x1 = mul_by_generator(&x[1]);
    let g_x2 = mul_by_generator(&x[2]);
    let g_x3 = mul_by_generator(&x[3]);
    let g_squared_x0 = mul_by_generator(&g_x0);
    let g_squared_x1 = mul_by_generator(&g_x1);

    state[0] = x[0] + x[1] + g_x1 + g_x2 + g_x3;
    state[2] = g_squared_x0 + g_squared_x1 + x[2] + x[3] + g_x3;
    state[1] = state[2] + g_x1 + g_x2 + g_x3;
    state[3] = state[0] + g_x0 + g_x1 + x[3];

    let g_y0 = mul_by_generator(&y[0]);
    let g_y1 = mul_by_generator(&y[1]);
    let g_y2 = mul_by_generator(&y[2]);
    let g_y3 = mul_by_generator(&y[3]);
    let g_squared_y0 = mul_by_generator(&g_y0);
    let g_squared_y1 = mul_by_generator(&g_y1);

    state[4] = y[0] + y[1] + g_y1 + g_y2 + g_y3;
    state[6] = g_squared_y0 + g_squared_y1 + y[2] + y[3] + g_y3;
    state[5] = state[6] + g_y1 + g_y2 + g_y3;
    state[7] = state[4] + g_y0 + g_y1 + y[3];
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies Anemoi permutation to the provided state.
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Anemoi round function;
/// implementation based on algorithm 3 of <https://eprint.iacr.org/2020/1143.pdf>
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x68e74a169b229f7f,
                    0x117c6e9a2649b36c,
                    0x27b3d9352c8681fc,
                    0x6525253da77fbfbb,
                ])),
                Felt::new(BigInteger256([
                    0x98940e041e37e670,
                    0xacd6a32fc6258594,
                    0xcf31b25d036f9b39,
                    0x2cfb6a3b05aa0a91,
                ])),
                Felt::new(BigInteger256([
                    0x88c7fc137f5bd68b,
                    0x6dbd1710ee4e45eb,
                    0xf83f8480e452e623,
                    0x3738fedbf772d0d9,
                ])),
                Felt::new(BigInteger256([
                    0x659872e1bdf2f660,
                    0xc686001766f429b0,
                    0x4ad67bf14f79495f,
                    0x4d8ec7549a4a23ce,
                ])),
                Felt::new(BigInteger256([
                    0x71fdadd1093da442,
                    0x2c765d387bac32d0,
                    0x3f212c90f2b2d46b,
                    0x0b5004d191122fbb,
                ])),
                Felt::new(BigInteger256([
                    0x7da580d79371d834,
                    0xb7d80f57c44d5ca1,
                    0x03cef82f678d513f,
                    0x0abbafee223fbb35,
                ])),
                Felt::new(BigInteger256([
                    0x8b7d3c400289eab0,
                    0xadff2d1adaaa8394,
                    0xaa30a2a6edbcde35,
                    0x22c2fd84843ee5c5,
                ])),
                Felt::new(BigInteger256([
                    0x427a78f626a2de2e,
                    0xd0319a20628e9803,
                    0x993fbf1c328c4787,
                    0x07b4c4219a28163d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd7b64915636866c5,
                    0x06e1feee74705719,
                    0x04b047d0c393afa2,
                    0x7235e470c9fb3336,
                ])),
                Felt::new(BigInteger256([
                    0x7a171a77c1a07ed1,
                    0xd65645efdf8d9158,
                    0x81efc5fc87404216,
                    0x24799b041203de16,
                ])),
                Felt::new(BigInteger256([
                    0x364140a790bf9b7d,
                    0x1d8b01bc4b7002b9,
                    0xaab6746d8c0bce32,
                    0x70dccebe341f6c94,
                ])),
                Felt::new(BigInteger256([
                    0x2b863b794f7cf3c2,
                    0x416180d6671e5af0,
                    0xf2d748b6a1fd182e,
                    0x42b3178d81478670,
                ])),
                Felt::new(BigInteger256([
                    0x2977dd14abd1e551,
                    0x13222038e3de0b0a,
                    0x97c4c841e7ff25a3,
                    0x32c3acd0bf34c192,
                ])),
                Felt::new(BigInteger256([
                    0xc55afafd51215240,
                    0x767dab43a4aa71bc,
                    0x340d5a7468f4d5f8,
                    0x12f240877179ef72,
                ])),
                Felt::new(BigInteger256([
                    0x6e5a16a120109626,
                    0x90305552795bafe9,
                    0xbd7ed0480016f4bb,
                    0x43716031e0212535,
                ])),
                Felt::new(BigInteger256([
                    0x213f96cdc1717709,
                    0x29412c0f9b9ef24d,
                    0xa9ceea02a7329572,
                    0x3ae73ab3ca2acb64,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3d28cb39f7b0c9b7,
                    0xcfd329282a11c3e4,
                    0xb911055307ccb0e7,
                    0x481795964d13103b,
                ])),
                Felt::new(BigInteger256([
                    0x52c841519efdf6f8,
                    0x8c9887be90febf08,
                    0xa5827d905b31f8c7,
                    0x443ad19409814a17,
                ])),
                Felt::new(BigInteger256([
                    0xb5aaf9d45224b9d4,
                    0xe6e43e9e2241834f,
                    0xe33fc9dd86625703,
                    0x1e45f042b3a020de,
                ])),
                Felt::new(BigInteger256([
                    0x7b25f4c43e2e2451,
                    0x9990834816962edb,
                    0x89ad7bcba23c4f36,
                    0x4be3e51228480477,
                ])),
                Felt::new(BigInteger256([
                    0xfed354fec3add233,
                    0x85dd293fb4afb22c,
                    0x4aa243694838f5f4,
                    0x0538e3b95448c234,
                ])),
                Felt::new(BigInteger256([
                    0x5f7ecb5370409287,
                    0x61d67a11608a25c9,
                    0xfe34b0d4ee7b8793,
                    0x289cdbc63b93d46c,
                ])),
                Felt::new(BigInteger256([
                    0x26730dcb3f59d913,
                    0x567b4a11a26c464d,
                    0xb69d5525a92df741,
                    0x5c0a851e7eb3fe64,
                ])),
                Felt::new(BigInteger256([
                    0x09a20733ec445478,
                    0x264f6df2734507fe,
                    0x6097a826b394bff6,
                    0x19ebad90fa6249d8,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc18be1779b5f4d9c,
                    0x5671edeecc9dd12f,
                    0x93f7edec1d5d2cd9,
                    0x4ecd509222afb942,
                ])),
                Felt::new(BigInteger256([
                    0x0fff30d81e0cc995,
                    0x24f9b30296c0018e,
                    0x8c638ef088eeb4d8,
                    0x55bcee4dfbb5e544,
                ])),
                Felt::new(BigInteger256([
                    0xdba95682a2e1558d,
                    0x54c3d0ca3ceed4a4,
                    0xbadc53b84fdcf419,
                    0x2cc1bc47685ded22,
                ])),
                Felt::new(BigInteger256([
                    0x1799d5e6b67a3766,
                    0xf11cfffb63290ac9,
                    0xbbe7483fa54f8c40,
                    0x1430341caf4d09ec,
                ])),
                Felt::new(BigInteger256([
                    0xf86ed99f5722a44f,
                    0x0d4d7e353bc94327,
                    0x4699f7800c37e4b2,
                    0x297fd99be73988ea,
                ])),
                Felt::new(BigInteger256([
                    0x4725ff963aa9ca44,
                    0x0d81e36e2dafa54f,
                    0xbebdbf413a0846a0,
                    0x12ee867fe24c8159,
                ])),
                Felt::new(BigInteger256([
                    0x2a7f9427d663b9d6,
                    0x4af3d55bdfc27ce0,
                    0x360c6bdcc79f123d,
                    0x675d1161856ecb23,
                ])),
                Felt::new(BigInteger256([
                    0xaa3e4a2818472802,
                    0x19474c01ff468773,
                    0xf23f4c5a696dc24f,
                    0x72ab890ed6c90797,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbe3c4d25ef61633e,
                    0xd412ff70c3aec4f6,
                    0xcf059f3366ece0a2,
                    0x193f45577fee91f3,
                ])),
                Felt::new(BigInteger256([
                    0x5721e29d30a54ea8,
                    0xb2ea4ce1c8eb5beb,
                    0x7e90456440b17025,
                    0x2b8b5f4cf222a004,
                ])),
                Felt::new(BigInteger256([
                    0xc23e1d1708f8d47d,
                    0x9d1c6d82913071ec,
                    0x1d0c06537390e78c,
                    0x1290fa6a1236f89d,
                ])),
                Felt::new(BigInteger256([
                    0x91504b0c58e78db3,
                    0x4dacebdc592d89eb,
                    0x0627d6f543c5eb84,
                    0x102acf8f6b4fe79b,
                ])),
                Felt::new(BigInteger256([
                    0xb4e46b640a9a3c46,
                    0xc28f1838ef9e7dc3,
                    0x3359f24ef96cf576,
                    0x5b421558b8530134,
                ])),
                Felt::new(BigInteger256([
                    0x1438025e48138834,
                    0x80baf0e3afdf0dc0,
                    0x9acaf351d0ecef0a,
                    0x14bd7e2503ab4267,
                ])),
                Felt::new(BigInteger256([
                    0xa0c57a17e3d8750b,
                    0xb3032795f88fa195,
                    0x0c3c24c51a8343de,
                    0x1dc153a3cc0a5d0f,
                ])),
                Felt::new(BigInteger256([
                    0xda4272dd687febc6,
                    0x405bcd4b4ec65c23,
                    0xd2e29e729c82f8e5,
                    0x0f8b37cf117f51ae,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa180ca56482da656,
                    0x950651ef1603ef91,
                    0x7dc5cae16745c150,
                    0x034e628e4b320305,
                ])),
                Felt::new(BigInteger256([
                    0xcde958706d538889,
                    0x212483e1a3e310e6,
                    0x51c8d5be143a8501,
                    0x3e26c850df42f750,
                ])),
                Felt::new(BigInteger256([
                    0x7f828c4fe329827e,
                    0x4e429ba92bbaf3fc,
                    0xc015e36b02993693,
                    0x31a3647d65a71d3c,
                ])),
                Felt::new(BigInteger256([
                    0xcd828c502d05ccdb,
                    0x0770b503af38ce50,
                    0xec8a1c14c5cfa1eb,
                    0x183ca6b46a28a5e0,
                ])),
                Felt::new(BigInteger256([
                    0xa83084c08670486c,
                    0xdb6c513bdbdb9833,
                    0x83b4fc2002bbaebb,
                    0x719cf5c0a92cfa1f,
                ])),
                Felt::new(BigInteger256([
                    0x16b9185dab6ce4ad,
                    0xe7ab1616798bbf77,
                    0x060c2f915d7c473d,
                    0x3e230eaacfd0eb4a,
                ])),
                Felt::new(BigInteger256([
                    0x5212b13b49b73317,
                    0xe4e8e3c9dba561bd,
                    0xd721810084ffcdc1,
                    0x6451f441c7ea282d,
                ])),
                Felt::new(BigInteger256([
                    0xf9870c62c7018108,
                    0x87931d20bccc6148,
                    0xf01bedc61aa7a008,
                    0x647efaec44ef1cd3,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x9989ceed61b5016d,
                    0xf4eb6bee33c60956,
                    0x59980468a3d00698,
                    0x031eef5d953c8ef2,
                ])),
                Felt::new(BigInteger256([
                    0x92268afe86c0fdd8,
                    0x54a914936fc99bc7,
                    0xc58e179f9ef03c25,
                    0x580efdc2de845cbc,
                ])),
                Felt::new(BigInteger256([
                    0x5b9688f39e70a70f,
                    0xbd85c0524867fa1c,
                    0x266c215b4f7529cc,
                    0x2d297e25468f1c59,
                ])),
                Felt::new(BigInteger256([
                    0x1e4cd66e6023219b,
                    0x5e24ee8adb333bbf,
                    0xed7801d719be8eac,
                    0x6ea1bc576dc6ad10,
                ])),
                Felt::new(BigInteger256([
                    0x00148452cd31352b,
                    0x5f16365097f4b863,
                    0xf41d3b2634045d44,
                    0x478e1836ea7dfdfa,
                ])),
                Felt::new(BigInteger256([
                    0xad7d3f3bad8cbcf9,
                    0x39c909ec1b46b77b,
                    0x61b8667a6f7b258b,
                    0x2e790ff1948deb24,
                ])),
                Felt::new(BigInteger256([
                    0x8361ac6a55f0a6f7,
                    0xce91184f7c1e2fe3,
                    0x98c8c5911d267f82,
                    0x41983b9ffc5ac152,
                ])),
                Felt::new(BigInteger256([
                    0xa697a239ca93fbf2,
                    0xf5eaa0c5f45cfc6c,
                    0x349b7060a5a79d82,
                    0x59ea151afe8313d8,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xcddca5157c42e184,
                    0x6a2c0eca10df23bc,
                    0x378c4dc7b84c0294,
                    0x3c19288bc4c61bc7,
                ])),
                Felt::new(BigInteger256([
                    0x7abd20179d069bb9,
                    0xaf9a046a0f96bfec,
                    0x83c9c774d6f10ffe,
                    0x480b64788ed5ace5,
                ])),
                Felt::new(BigInteger256([
                    0x2f608bb8945ae10a,
                    0x3b30807d26bbdbf6,
                    0xf4e39bffcd61ff50,
                    0x518c2023c3a809bb,
                ])),
                Felt::new(BigInteger256([
                    0xd69bd879557041a1,
                    0x2372100f10c19f8d,
                    0x49839c3fc326c17e,
                    0x6ff5b03da44db86a,
                ])),
                Felt::new(BigInteger256([
                    0xe50ed5a5d4c78199,
                    0xa7977b58adb29570,
                    0x55d14f247095b21c,
                    0x6aa3dd14e05debc9,
                ])),
                Felt::new(BigInteger256([
                    0xd66ccf708b593333,
                    0xa93ba02e7dedb913,
                    0xacbbd2ae9303096e,
                    0x47dff87973fc96bb,
                ])),
                Felt::new(BigInteger256([
                    0x5646f7f63c57a1d8,
                    0x324b6275f1e4780f,
                    0xe44c122b4aab27eb,
                    0x533696ceebbbadc5,
                ])),
                Felt::new(BigInteger256([
                    0x145a9aba2a40f76b,
                    0xea49b51270ef0965,
                    0xd5306b533b33a5fe,
                    0x3580a81cde2f6824,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0f471551a1263b97,
                    0x4e3d72730da7e7b6,
                    0x968826917743e350,
                    0x4e9bd8ec8b476449,
                ])),
                Felt::new(BigInteger256([
                    0xc5eeb39d40f6499e,
                    0x0e3c94605350c5bd,
                    0xe9e0d46406f854cd,
                    0x598a00eb102314ec,
                ])),
                Felt::new(BigInteger256([
                    0x54158ec394fa7556,
                    0x2e7cd4ff0e63c1ba,
                    0xeee55b403d483ed4,
                    0x048ef6e5d1ae8098,
                ])),
                Felt::new(BigInteger256([
                    0x8528450d51db284b,
                    0xb7ce3d382b33ebbd,
                    0xeaefb557f00a7325,
                    0x0a0e0a51f094009e,
                ])),
                Felt::new(BigInteger256([
                    0x12e012245eb6fbcb,
                    0x1af075736d9480c2,
                    0x4f8dd773419d43e5,
                    0x46c8e6a9608eb2a8,
                ])),
                Felt::new(BigInteger256([
                    0x56953e2b27fa310b,
                    0x8c11e3e62867778f,
                    0x62f8bc19cc086c52,
                    0x5596f99e4035b365,
                ])),
                Felt::new(BigInteger256([
                    0xc8984055010d3953,
                    0x5159d4eee6d471c0,
                    0xb5b5471b2678ea8f,
                    0x3725f725bf149171,
                ])),
                Felt::new(BigInteger256([
                    0xa728ac8e963722fa,
                    0x18be188f6150621a,
                    0x7dbf06606df8f0f1,
                    0x3f5cda618cc7ce14,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x8e748215c9702b46,
                    0x48f3f42607b84f82,
                    0x35e322576cc82a22,
                    0x08944570f5e18ea3,
                ])),
                Felt::new(BigInteger256([
                    0x434bb1be84bca636,
                    0x5b5f7315416cdd6e,
                    0xc61849ba07382f81,
                    0x2a5c064be12cfaca,
                ])),
                Felt::new(BigInteger256([
                    0xe7d57462b3e0af23,
                    0xe97d7d51d970e18c,
                    0x169caafea4c99b88,
                    0x47a8be6a43b2a052,
                ])),
                Felt::new(BigInteger256([
                    0xe703965a38ff56a4,
                    0x86c79bc7969da8e7,
                    0x2758c7479bbcd98b,
                    0x5da13ed53fc88e5c,
                ])),
                Felt::new(BigInteger256([
                    0x8a0f4aa42919464d,
                    0x18490940596e27dd,
                    0xfbc57dc72d4bf387,
                    0x45928ef72adaa567,
                ])),
                Felt::new(BigInteger256([
                    0x1e5210d62e0acde9,
                    0xfdcd471d661eab6d,
                    0x94c4e138d201ac26,
                    0x643fd0ddf7a72314,
                ])),
                Felt::new(BigInteger256([
                    0xf14b8e26eefbf333,
                    0xddf3915c11f1cefe,
                    0x2a7edaea2ecfa5c0,
                    0x3d8f560f6b450c27,
                ])),
                Felt::new(BigInteger256([
                    0xcf23f07a26261854,
                    0xd9db14b9e899a996,
                    0x7d6fac8296edaebd,
                    0x6d36ac24c0109185,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xee7220a73c2b2255,
                    0x13bf7acbfbea0645,
                    0xd1165edcf6c5a837,
                    0x6ec5547399d1074e,
                ])),
                Felt::new(BigInteger256([
                    0xb64177b4cb0b1fdb,
                    0xf6c811aaa3b5b825,
                    0x137ff362be5c7cc9,
                    0x285eda0e3ebf965d,
                ])),
                Felt::new(BigInteger256([
                    0x0f09a868b7ab74ae,
                    0x3503c334bdd519c4,
                    0x7dd94451bbb577fe,
                    0x4a20ecb630a29f5c,
                ])),
                Felt::new(BigInteger256([
                    0x4ebf7c5cef591dd2,
                    0xa3746055a78027ec,
                    0xed3458645af5e598,
                    0x61a506c81d4b522a,
                ])),
                Felt::new(BigInteger256([
                    0xd7f5f3ad5dd1aabd,
                    0x3a3972d5fa13d27d,
                    0xb85bfe880796cb6d,
                    0x0afa70d8c845a466,
                ])),
                Felt::new(BigInteger256([
                    0xdaae45b79e624d09,
                    0x25115587499a454a,
                    0xfd5cfc6e1faf29ec,
                    0x5a56f0daf1b38cff,
                ])),
                Felt::new(BigInteger256([
                    0xbb86339ae959020c,
                    0x1764bb2230276de4,
                    0xb0eccdb0df9ad4c1,
                    0x3792762c1d78a405,
                ])),
                Felt::new(BigInteger256([
                    0x5dca0ad68e85934d,
                    0xc28b411b092b62b0,
                    0x32fa78922420d0c9,
                    0x511e2482fb016e9a,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5442573d471886bd,
                    0x5412e700badfd060,
                    0x0c1a71bb81d3e0b6,
                    0x42750683d31f9156,
                ])),
                Felt::new(BigInteger256([
                    0x577ef802f7dbbb9c,
                    0x115de1a0f23a5d14,
                    0xa1a38d5dbff3a5b4,
                    0x2d31b362c175aa1b,
                ])),
                Felt::new(BigInteger256([
                    0x0bef3fe77ff83985,
                    0x403092eb8297b2bb,
                    0xa111bde9008ba42f,
                    0x4708021fb760246c,
                ])),
                Felt::new(BigInteger256([
                    0x8b0ade716d73aeba,
                    0xe64564753a6db3f0,
                    0x6d29dbba5e38c4f3,
                    0x6d19757f9f086130,
                ])),
                Felt::new(BigInteger256([
                    0x82787a90b26aaaf4,
                    0x01ca436b330d4010,
                    0xd3a5361098864bea,
                    0x709832f300c5a830,
                ])),
                Felt::new(BigInteger256([
                    0x57a301c033d10cff,
                    0x8859dc827a3949bb,
                    0x426a19c53b5e97bc,
                    0x1364b9a2f68346ef,
                ])),
                Felt::new(BigInteger256([
                    0x853b198020928577,
                    0xe896f5c54f9bca51,
                    0x1da5661ca1a7ed09,
                    0x65d23e24eee5498d,
                ])),
                Felt::new(BigInteger256([
                    0x26cb1fde84334879,
                    0xcac9fb413ceea717,
                    0x04d898e87bca75eb,
                    0x4e04ae3c86e701e6,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xd1d1c194d2a9ff05,
                    0x2e933bb6e92a5725,
                    0x01367b3cc40cd2f6,
                    0x25d7ea019733900e,
                ])),
                Felt::new(BigInteger256([
                    0x3c4a6697702d6aa3,
                    0xa8c8cc2f8322be28,
                    0x36f9959ed307a169,
                    0x439fd07eca4405aa,
                ])),
                Felt::new(BigInteger256([
                    0x5710b5f2f303f0eb,
                    0x517c17cf7e6181a7,
                    0x68ba429cd28faed7,
                    0x5391282b1c77cf5e,
                ])),
                Felt::new(BigInteger256([
                    0x76cacbd26bb9ed15,
                    0xd3b0fd87a117f57f,
                    0x9b8f3c1c5d751cda,
                    0x6a5e727317670c02,
                ])),
                Felt::new(BigInteger256([
                    0x4cafebd129e600ca,
                    0xdab898b6e6eac09e,
                    0x78672b7a9ec38834,
                    0x0c5a2376f04ed0d8,
                ])),
                Felt::new(BigInteger256([
                    0x60e95350aee9ea96,
                    0x8790c93098923545,
                    0x9179b79888cce176,
                    0x5ea3e45b6df8b7b3,
                ])),
                Felt::new(BigInteger256([
                    0xf90ff59464a95670,
                    0x737c1de6ecc51bf5,
                    0x77d028bd7f36bbd9,
                    0x5339fa025b0eb2ae,
                ])),
                Felt::new(BigInteger256([
                    0x879628173bfcbe88,
                    0x6dc8140e39e63827,
                    0x407872714dc44c3b,
                    0x35ca34a69b2cec2e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd8a7503a2161c704,
                    0xbbf602d7e981d64c,
                    0x4f77eb5d44caf49f,
                    0x6766e526b5e3270a,
                ])),
                Felt::new(BigInteger256([
                    0x30668bf3a06fe6d9,
                    0xa2f04ca3e7baf083,
                    0x7f74e174d74a70c7,
                    0x542e9cffb618ceec,
                ])),
                Felt::new(BigInteger256([
                    0x72c14a83aa2cb747,
                    0x1b4bf3b8304aa865,
                    0x70ebb6f4d5308e09,
                    0x2d219ee5f5c5dc1d,
                ])),
                Felt::new(BigInteger256([
                    0x611278fbc90daf80,
                    0x5b12f709f7c78a38,
                    0x6c9c893527d4c019,
                    0x38b6202ee6e70eab,
                ])),
                Felt::new(BigInteger256([
                    0x39ca8af74d8b4ef9,
                    0xc56d29939b950334,
                    0x007303e5dea5c109,
                    0x0432653786248259,
                ])),
                Felt::new(BigInteger256([
                    0xb85624a23f8209b6,
                    0xa3cbf264a9da6ddc,
                    0xcb58029919b3db89,
                    0x5f25f3445623e410,
                ])),
                Felt::new(BigInteger256([
                    0x329fe6ed8b9c9335,
                    0x81f98351e42fffe0,
                    0x5bd352c415a9da8f,
                    0x13afdc8066b77587,
                ])),
                Felt::new(BigInteger256([
                    0x2efc943a15c593b2,
                    0x83081a8f09d0a6f9,
                    0xd9bedf06c1f390f2,
                    0x0b5226619cc24fb6,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x9b284c5543fa000a,
                    0x9fc7f54d3f1a481b,
                    0xcd94b8f4c22969f5,
                    0x559f40571e32e3f5,
                ])),
                Felt::new(BigInteger256([
                    0xd33bc61287822111,
                    0x60e026f6ed74dd03,
                    0xdb6b7c53ab416218,
                    0x04f29100733a86ac,
                ])),
                Felt::new(BigInteger256([
                    0xe0789fd528d83056,
                    0xf3b76734261e8b98,
                    0xb900353377e61330,
                    0x5d0eeb8a6cf88b31,
                ])),
                Felt::new(BigInteger256([
                    0x1f445973fe9db5ed,
                    0x9c6fca33ca46791a,
                    0xfd90ed38c4acca2f,
                    0x2c69b25191239a42,
                ])),
                Felt::new(BigInteger256([
                    0x39cc829247e7676b,
                    0xde4bbe382b29cde8,
                    0x667ab99561696cab,
                    0x58b102de39a8e998,
                ])),
                Felt::new(BigInteger256([
                    0x8b8881aab31aff6c,
                    0x057e31cdf416c0c5,
                    0xc1bca80f92b2158b,
                    0x215d77ed571e9aea,
                ])),
                Felt::new(BigInteger256([
                    0xbbaeebc6937f8809,
                    0x387a11a422a532f6,
                    0xf758795bcf52e2b2,
                    0x412ee0c72400be52,
                ])),
                Felt::new(BigInteger256([
                    0x6a8cf34cd8bb1218,
                    0xac2f57aa54d6c138,
                    0x485e9a9a8eb2b279,
                    0x4be46d7781dd27d6,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x258f0d6922c353dd,
                    0x01cd2dc8462e6330,
                    0xf76c83e0e101e0ab,
                    0x0069a8dfcb105556,
                ])),
                Felt::new(BigInteger256([
                    0x1bd69143039a6df8,
                    0x3631e6a85049654c,
                    0x1472cd47bf4c7383,
                    0x4189c1fd531adadd,
                ])),
                Felt::new(BigInteger256([
                    0xbf215169202f869d,
                    0x929319e183b2e0bf,
                    0x6e7fd6639ae9120b,
                    0x44d0d09a100349e0,
                ])),
                Felt::new(BigInteger256([
                    0x5cb63e9be953cfbf,
                    0xada9a386035668ae,
                    0xfc6220b3387b7808,
                    0x0abf6a7df35c30b4,
                ])),
                Felt::new(BigInteger256([
                    0xab89546b8b90eb97,
                    0xf1598613e7771db7,
                    0x17a09115b715704d,
                    0x51a9ad7984dd2fb5,
                ])),
                Felt::new(BigInteger256([
                    0xf93cd1666cd000b1,
                    0xb02518ba6861a8ae,
                    0x6efc96b06e3fef13,
                    0x3993b786d898a740,
                ])),
                Felt::new(BigInteger256([
                    0xb901e0621bdd6ec1,
                    0x5d092aed0a4e3296,
                    0xa520f0637f01865c,
                    0x26615513566c9652,
                ])),
                Felt::new(BigInteger256([
                    0x1ff2039d922ee09f,
                    0x0f53d6e60fd846b8,
                    0xc513cb0638c1db8a,
                    0x61da0eb1cfc1f76b,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x98250a7a4bc59c38,
                    0x6b8149c1051af4ef,
                    0x079563bcc4f0d3f3,
                    0x059fc052428dc661,
                ])),
                Felt::new(BigInteger256([
                    0x867fce838e7fde65,
                    0x5a916734584eeeb2,
                    0x809bb023d208d20f,
                    0x4a452826479cbc99,
                ])),
                Felt::new(BigInteger256([
                    0x38fe62400b0ddc6e,
                    0x3c8841175b78c2d5,
                    0xda647c07d4f645ef,
                    0x280c694fc9cc85bd,
                ])),
                Felt::new(BigInteger256([
                    0xec2976dd8ac0e66d,
                    0x3cc244823b91289a,
                    0x151673166c570e9e,
                    0x2485d6f722315325,
                ])),
                Felt::new(BigInteger256([
                    0xa9a95245ae0645e9,
                    0x1b8dbfa230904dbb,
                    0x4fa8d2c0782ee97d,
                    0x1d45f97334df7548,
                ])),
                Felt::new(BigInteger256([
                    0xba5993d78e24d7fd,
                    0x8ac70fd3d5569881,
                    0x065c141842a5fb84,
                    0x3025bade83babfbf,
                ])),
                Felt::new(BigInteger256([
                    0x8d13c6c063b0afc0,
                    0x6a00c0625fa36e2e,
                    0xc6235d84941becc7,
                    0x2ab583165604986a,
                ])),
                Felt::new(BigInteger256([
                    0x7bfe58400ffe94e1,
                    0xa1f93e32a2989c89,
                    0xd3945452f9d49a0e,
                    0x142d27f7ed3deaac,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb9c262fb9e93910e,
                    0xba61216eb9cf28ef,
                    0x30bfbee36f6a1574,
                    0x420827f2010163e3,
                ])),
                Felt::new(BigInteger256([
                    0xcf1235d0c2e90e66,
                    0xb89279f948989fbf,
                    0x2d2c3ed64566e67a,
                    0x2642ff632a777a81,
                ])),
                Felt::new(BigInteger256([
                    0x75105a47e28f702b,
                    0x62be23ae936590d5,
                    0xd3a274ce56d98700,
                    0x44a25a2a79797e39,
                ])),
                Felt::new(BigInteger256([
                    0xec0259405ef05df2,
                    0xc64c6cd97d135ea1,
                    0x55af93382fed6a26,
                    0x3bbe1ddd167f9639,
                ])),
                Felt::new(BigInteger256([
                    0x824ab8a9299f7d74,
                    0x7a041ae882473302,
                    0x27bdce944464f124,
                    0x5a5e4ea4b363e23d,
                ])),
                Felt::new(BigInteger256([
                    0x99ca513c1afab332,
                    0xb6ad09d97b98b9a6,
                    0xf886e78306675a70,
                    0x0286fe24693f2d45,
                ])),
                Felt::new(BigInteger256([
                    0xc3e85f680f9b93d7,
                    0xa5c4afe51da849ca,
                    0x99c40b1351d47a55,
                    0x0c8ee23017008e24,
                ])),
                Felt::new(BigInteger256([
                    0x94e4e87b515437f3,
                    0xd979e765aed1eafa,
                    0x6e96b0afa0efd20f,
                    0x73739a565f41f167,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 8],
            [
                Felt::new(BigInteger256([
                    0x00000031ffffffce,
                    0xa4f5f76a00520832,
                    0xfeb3ce6e1e63cef5,
                    0x5b9551c1df3d87e5,
                ])),
                Felt::new(BigInteger256([
                    0x00000119fffffee6,
                    0xc11954b201cea91a,
                    0x9248072563b80a21,
                    0x4c35ae642883fe77,
                ])),
                Felt::new(BigInteger256([
                    0x000000ebffffff14,
                    0xcd2ccd3c018330ec,
                    0xc6acd8971eccdb16,
                    0x20e9bf55a2d08170,
                ])),
                Felt::new(BigInteger256([
                    0x00000052ffffffad,
                    0xd983d30700882c53,
                    0x643ef564e086f645,
                    0x69f2c00981f06197,
                ])),
                Felt::new(BigInteger256([
                    0x00000031ffffffce,
                    0xa4f5f76a00520832,
                    0xfeb3ce6e1e63cef5,
                    0x5b9551c1df3d87e5,
                ])),
                Felt::new(BigInteger256([
                    0x00000119fffffee6,
                    0xc11954b201cea91a,
                    0x9248072563b80a21,
                    0x4c35ae642883fe77,
                ])),
                Felt::new(BigInteger256([
                    0x000000ebffffff14,
                    0xcd2ccd3c018330ec,
                    0xc6acd8971eccdb16,
                    0x20e9bf55a2d08170,
                ])),
                Felt::new(BigInteger256([
                    0x00000052ffffffad,
                    0xd983d30700882c53,
                    0x643ef564e086f645,
                    0x69f2c00981f06197,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0x00000031ffffffce,
                    0xa4f5f76a00520832,
                    0xfeb3ce6e1e63cef5,
                    0x5b9551c1df3d87e5,
                ])),
                Felt::new(BigInteger256([
                    0x00000119fffffee6,
                    0xc11954b201cea91a,
                    0x9248072563b80a21,
                    0x4c35ae642883fe77,
                ])),
                Felt::new(BigInteger256([
                    0x000000ebffffff14,
                    0xcd2ccd3c018330ec,
                    0xc6acd8971eccdb16,
                    0x20e9bf55a2d08170,
                ])),
                Felt::new(BigInteger256([
                    0x00000052ffffffad,
                    0xd983d30700882c53,
                    0x643ef564e086f645,
                    0x69f2c00981f06197,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x00000031ffffffce,
                    0xa4f5f76a00520832,
                    0xfeb3ce6e1e63cef5,
                    0x5b9551c1df3d87e5,
                ])),
                Felt::new(BigInteger256([
                    0x00000119fffffee6,
                    0xc11954b201cea91a,
                    0x9248072563b80a21,
                    0x4c35ae642883fe77,
                ])),
                Felt::new(BigInteger256([
                    0x000000ebffffff14,
                    0xcd2ccd3c018330ec,
                    0xc6acd8971eccdb16,
                    0x20e9bf55a2d08170,
                ])),
                Felt::new(BigInteger256([
                    0x00000052ffffffad,
                    0xd983d30700882c53,
                    0x643ef564e086f645,
                    0x69f2c00981f06197,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x552582c5eb46660d,
                    0x3d3af264deacca87,
                    0xa3681ec3124defcd,
                    0x35893318ba93e883,
                ])),
                Felt::new(BigInteger256([
                    0x07d41fccc47d8eec,
                    0x8afb2109b4974701,
                    0x09df89cd2f7c765e,
                    0x163aea0a64b2b7d7,
                ])),
                Felt::new(BigInteger256([
                    0xc0cac5331c0e9287,
                    0x251c368b423791c7,
                    0x9ea77be5b442faf1,
                    0x4a2971720b96650b,
                ])),
                Felt::new(BigInteger256([
                    0x2eb567d52ae436b3,
                    0xaa40ab2475ebd130,
                    0x61b2e8a84de55321,
                    0x56ae2bc858f19f96,
                ])),
                Felt::new(BigInteger256([
                    0xf7538b589d67d94a,
                    0xd98e09ade4824a67,
                    0x5dd5dea799e71f1e,
                    0x402993fd76a99384,
                ])),
                Felt::new(BigInteger256([
                    0xc326bd37d430cef7,
                    0xa6f72afb5698ceed,
                    0x1d6f72b48c0ae270,
                    0x3bbe9094148d44b1,
                ])),
                Felt::new(BigInteger256([
                    0x25cc7ac54a5c36b2,
                    0x74b86461f76f79c2,
                    0x95a99c5af085889c,
                    0x398533a13d4d9e46,
                ])),
                Felt::new(BigInteger256([
                    0xb9d475785054a133,
                    0xf87ae7e870e24fb0,
                    0xe3c5e42406cfac48,
                    0x2e5e9b721c67eaf0,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x26a6085f4b79cd31,
                    0x232d23223fec6cc3,
                    0xf32297c976ad7d8e,
                    0x629e2ed07c022a89,
                ])),
                Felt::new(BigInteger256([
                    0x549463a795649996,
                    0x0f812d6b6a5f363f,
                    0x2cd1cd39b8afde0f,
                    0x5f599dbe93cc7929,
                ])),
                Felt::new(BigInteger256([
                    0x36fc37770bbc7a41,
                    0xf77cb5c1fbb1344d,
                    0xd5622a3a5475ede2,
                    0x446349c15a28c74d,
                ])),
                Felt::new(BigInteger256([
                    0xc71986a761433db0,
                    0x29a8966af07116b7,
                    0xa1829a5cef81e33b,
                    0x4d470626636b1392,
                ])),
                Felt::new(BigInteger256([
                    0x2ac7366b539cd608,
                    0xb393fddd5127001f,
                    0x07a2451a0e4e65db,
                    0x0d7bb27e0356d6e2,
                ])),
                Felt::new(BigInteger256([
                    0x363a4d85eb7a4d62,
                    0xc37cb6b3d9e31456,
                    0xa240c346d8a9a2d3,
                    0x05e897e76cd6885e,
                ])),
                Felt::new(BigInteger256([
                    0xf66922aa62fc1445,
                    0x35ae2e8d16c681f3,
                    0xc1c9d389f9b8f311,
                    0x6b42b52e265b0b14,
                ])),
                Felt::new(BigInteger256([
                    0xd14c12582efe6f67,
                    0x3737e359cf107f84,
                    0xb3afb653f5173970,
                    0x0a0732d0902c5f6a,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x33314df29444545e,
                    0xa630c2c13d931528,
                    0xd9dff43f6d87f02c,
                    0x2c2537723442b803,
                ])),
                Felt::new(BigInteger256([
                    0xc0902d06d9506903,
                    0x338c83e110ffa39f,
                    0xfb2df78403eefea0,
                    0x56c929a2c4a3033c,
                ])),
                Felt::new(BigInteger256([
                    0xfbc2f17d108835bf,
                    0x3a463960fffd5797,
                    0x97146084fa30027c,
                    0x11481c34f8303893,
                ])),
                Felt::new(BigInteger256([
                    0x573228432346f202,
                    0x50c77ac03fcd6a24,
                    0x43174642f6553e9e,
                    0x1af9b735c5b34d08,
                ])),
                Felt::new(BigInteger256([
                    0xe77219073388923b,
                    0xfe4d5ff6895b3a6d,
                    0x7747efcd173434d8,
                    0x53eb69f251322d96,
                ])),
                Felt::new(BigInteger256([
                    0x7ac7a6538878456b,
                    0x87d88e367b0cde65,
                    0x0c9a19b343c8572d,
                    0x2319309ae8afe039,
                ])),
                Felt::new(BigInteger256([
                    0xda8cfabd9b8a3aa5,
                    0xc78371b2086d97b3,
                    0x4e674b518e991a91,
                    0x31ba1f5d129d0be0,
                ])),
                Felt::new(BigInteger256([
                    0x13c299b969a9add2,
                    0x44337a3853b42e83,
                    0x86c1ab19e353830c,
                    0x32f34679c5681ae5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc72887ad822e2018,
                    0x835accc479c9539c,
                    0xba2817764c74ab22,
                    0x264e748604fa1ecb,
                ])),
                Felt::new(BigInteger256([
                    0xaf098e591e907c81,
                    0xda50e79e4ed30137,
                    0xab448a30ac35a588,
                    0x70c0556ccabe4430,
                ])),
                Felt::new(BigInteger256([
                    0x2946a558c2c01e3d,
                    0x3b378b476b831a18,
                    0xc9c1ebdaf66d768f,
                    0x1877a470ba51d850,
                ])),
                Felt::new(BigInteger256([
                    0xeda61d0278123ca6,
                    0x6a076f529a6cc7b4,
                    0x3cbe1025c08d1059,
                    0x2eff2dc3250eabcc,
                ])),
                Felt::new(BigInteger256([
                    0x51ab3cc41bfa0c26,
                    0x5c8aa6d17e145080,
                    0x0702a62777f73c99,
                    0x72270617bf580f11,
                ])),
                Felt::new(BigInteger256([
                    0x39a93986ab352eae,
                    0x0f86412f4aebbe36,
                    0xe705a41e20f3f69b,
                    0x169f2539e3150f77,
                ])),
                Felt::new(BigInteger256([
                    0x9a3cae8b17e891fa,
                    0xc029de053f8748fb,
                    0xf420850a963e2f71,
                    0x046d2bbc52c23df9,
                ])),
                Felt::new(BigInteger256([
                    0xdceb6db2644903d4,
                    0x5ff88a648865e926,
                    0x44dd00906869fad2,
                    0x380478826a0b80d2,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd03a6e6ed86be354,
                    0x9f6b667be8e69e9d,
                    0xcbc6d666c7a41c1c,
                    0x5c6de1887cdb31d7,
                ])),
                Felt::new(BigInteger256([
                    0x296d37582687f076,
                    0x1edbe93aa4fe64d4,
                    0xa3f0441cf35f96c3,
                    0x5629117966054190,
                ])),
                Felt::new(BigInteger256([
                    0x77d7a1e7286187bf,
                    0x458333b41981a9d8,
                    0x605a8196c2b520a9,
                    0x49a01869735492b3,
                ])),
                Felt::new(BigInteger256([
                    0x92e5d4425b132407,
                    0xa3fc4da4b26534ac,
                    0x9a139c7924a57cb3,
                    0x6c91cf2b9622a76d,
                ])),
                Felt::new(BigInteger256([
                    0x2a8d7388ddcc517d,
                    0x130c2ba6989a49e0,
                    0xfac80194c7d2ea72,
                    0x2865d18c28fc3317,
                ])),
                Felt::new(BigInteger256([
                    0x58575a9bb60688ee,
                    0x6148d09caed8357c,
                    0xa27e781246309dd2,
                    0x12bc3e08107abc95,
                ])),
                Felt::new(BigInteger256([
                    0x753741aaca0fbf2e,
                    0x4304752c4b37f24c,
                    0x7435e81a551f9bac,
                    0x4531aa70c13de1a7,
                ])),
                Felt::new(BigInteger256([
                    0xc8343ffc28a94d8b,
                    0xe99ec4b23c0a9e73,
                    0xae91df6ee5841de2,
                    0x0a1890be586621d3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd9d6fa45805aa6ff,
                    0x58d67cd371f31b3b,
                    0xbb1d7d72e9bf7127,
                    0x6f7ae200a465e240,
                ])),
                Felt::new(BigInteger256([
                    0x56d6c512a1caec4a,
                    0xc8166a3e61b8023a,
                    0x3da39d52d8db0543,
                    0x63962b742afe478d,
                ])),
                Felt::new(BigInteger256([
                    0x05d4639982ece4bf,
                    0xe23388d2f22cafae,
                    0xe0721d99a3ec900b,
                    0x5c6670c8b21143b0,
                ])),
                Felt::new(BigInteger256([
                    0x83a9812389b36116,
                    0xf99cad6fffe872b1,
                    0x3bac1886c7f6d6b4,
                    0x59c77febc7e5203f,
                ])),
                Felt::new(BigInteger256([
                    0x5b5ab488f48147ae,
                    0xeca344fec0a02df5,
                    0x4906c2905d248b46,
                    0x24a9ef4986cd0b40,
                ])),
                Felt::new(BigInteger256([
                    0x941681228efebce4,
                    0xaaef833e3df1aa52,
                    0xc9a96baa2f3bd366,
                    0x5c188f647021d5e1,
                ])),
                Felt::new(BigInteger256([
                    0x966e7d3dc513bc3f,
                    0x1abdf7fe16927fce,
                    0x12ed9bb02a531ce6,
                    0x4684806f6994860c,
                ])),
                Felt::new(BigInteger256([
                    0x6d8841b1483cb65f,
                    0x46482c1773b1c113,
                    0x0a5d8330f7e89dcd,
                    0x00c6119768b412d7,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
