//! Implementation of the Anemoi permutation

use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 10 field elements or 320 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 10;
/// 9 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 9;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 5;

/// 1 element (32-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t -= mul_by_generator(&y2);
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t += mul_by_generator(&y2) + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3], state[4]];
    let y: [Felt; NUM_COLUMNS] = [state[6], state[7], state[8], state[9], state[5]];

    let sum_coeffs = x[0] + x[1] + x[2] + x[3] + x[4];
    state[0] = sum_coeffs + x[3] + (x[2] + x[3] + x[4].double()).double();
    state[1] = sum_coeffs + x[4] + (x[3] + x[4] + x[0].double()).double();
    state[2] = sum_coeffs + x[0] + (x[4] + x[0] + x[1].double()).double();
    state[3] = sum_coeffs + x[1] + (x[0] + x[1] + x[2].double()).double();
    state[4] = sum_coeffs + x[2] + (x[1] + x[2] + x[3].double()).double();

    let sum_coeffs = y[0] + y[1] + y[2] + y[3] + y[4];
    state[5] = sum_coeffs + y[3] + (y[2] + y[3] + y[4].double()).double();
    state[6] = sum_coeffs + y[4] + (y[3] + y[4] + y[0].double()).double();
    state[7] = sum_coeffs + y[0] + (y[4] + y[0] + y[1].double()).double();
    state[8] = sum_coeffs + y[1] + (y[0] + y[1] + y[2].double()).double();
    state[9] = sum_coeffs + y[2] + (y[1] + y[2] + y[3].double()).double();
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies an Anemoi permutation to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Applies an Anemoi round to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/vesselinux/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x79c273469f2682b7,
                    0x5984d2be1bc70cd2,
                    0xd73019103fb0bc33,
                    0x44d60d1341d4d92f,
                ])),
                Felt::new(BigInteger256([
                    0xe0891da851c01c72,
                    0x2935844b29c34b73,
                    0xd800c0df9e2b2245,
                    0x6ec9ccfeedfdc411,
                ])),
                Felt::new(BigInteger256([
                    0x8f174362d58a8508,
                    0xfc97d1fe0a8f442d,
                    0xc49f21f653f0db41,
                    0x013c48a156e57e69,
                ])),
                Felt::new(BigInteger256([
                    0x66975c1f63ebaa37,
                    0x630a43a2e45afa97,
                    0x30df7a8ec7b815c0,
                    0x33efdc3c7bf12f2e,
                ])),
                Felt::new(BigInteger256([
                    0x4b8d7f3478744b1a,
                    0x34319c576acf7b2f,
                    0x323441be709d917f,
                    0x2edfebab1293dfb1,
                ])),
                Felt::new(BigInteger256([
                    0xa20e764423f75a5b,
                    0xc195064f3ce9469d,
                    0x41831ee2104c9d43,
                    0x10bd1c9b4ad088c4,
                ])),
                Felt::new(BigInteger256([
                    0x63d37ba9b0ab95c5,
                    0x62c9f12b91693cdc,
                    0x42432ed0ef57800a,
                    0x30ed5b75d33c661a,
                ])),
                Felt::new(BigInteger256([
                    0x5c1365190f465525,
                    0x119fa38a632cc2d7,
                    0x9c817343b18d6d97,
                    0x4322b08e27ad5dfa,
                ])),
                Felt::new(BigInteger256([
                    0x43e1523b22830495,
                    0xe48b782f7fdf8147,
                    0x94250ed6524790f8,
                    0x6dfe54f77ee680f7,
                ])),
                Felt::new(BigInteger256([
                    0xc37b47e12791f8b4,
                    0x42be8bb7554524e8,
                    0xc3d1adb0463a164b,
                    0x1337f16e6048a65d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x567d742270eec3d9,
                    0xd31892056516c9c4,
                    0x7985246396e93efc,
                    0x4979eb868be4b57d,
                ])),
                Felt::new(BigInteger256([
                    0x6dcde3d6388ea917,
                    0x9120359fa82a3c79,
                    0xe278f799f1652be8,
                    0x73314945c7801b2c,
                ])),
                Felt::new(BigInteger256([
                    0x5b588702867fb841,
                    0x8dfe28f7c99c8db3,
                    0xec6a5ea35bb99486,
                    0x67d67885c532d471,
                ])),
                Felt::new(BigInteger256([
                    0x8bdd9b5daefe8d95,
                    0x81d813872e683cc3,
                    0xe2dd4bc2053863af,
                    0x2199d314eec233c4,
                ])),
                Felt::new(BigInteger256([
                    0x136bccc38a1813d6,
                    0x1b65f2152bbac89d,
                    0x03ca08b274fafefd,
                    0x29e57399b134c30d,
                ])),
                Felt::new(BigInteger256([
                    0x048be5578d7852a6,
                    0x4d9d581da0f138ab,
                    0x893e081882d5c90c,
                    0x3f2d3d4747c9eb3c,
                ])),
                Felt::new(BigInteger256([
                    0xc5cebb003ab9202f,
                    0xe810fd4f9d0954a7,
                    0x6bc193c0dbd0e144,
                    0x3520745cdd53f5a0,
                ])),
                Felt::new(BigInteger256([
                    0xe2df53bb2825e0ea,
                    0xc90dde71bafecce6,
                    0x75eb4e5a29997ad2,
                    0x5717c1fdbc98b117,
                ])),
                Felt::new(BigInteger256([
                    0x130c07883bbec041,
                    0x80e617d5f1d3d966,
                    0xdcc9264a982733ec,
                    0x4eae82ca1cfb9296,
                ])),
                Felt::new(BigInteger256([
                    0x6d1633d373fbdfa2,
                    0x5b701a3f2060fb01,
                    0x91cae2372e4bf9e4,
                    0x66174d9eeedbc104,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x59ea888fb16f36b8,
                    0xf58489dedea9efc6,
                    0xd43560b231f14634,
                    0x4dbad35aaa7f35e9,
                ])),
                Felt::new(BigInteger256([
                    0xe39bb1b1c4784264,
                    0x089e1bea6fcfa191,
                    0xe6bc45e44a00ee22,
                    0x0c7a52495959c1bb,
                ])),
                Felt::new(BigInteger256([
                    0x55033008b503fa22,
                    0xcbe4d0d5351564a4,
                    0xefe13936fafa66d5,
                    0x417052e34faec18e,
                ])),
                Felt::new(BigInteger256([
                    0xc24139344080fb74,
                    0xddbd33d09ade5d77,
                    0xe7865dd5c220ac42,
                    0x57f25d5311b89830,
                ])),
                Felt::new(BigInteger256([
                    0xbedbb8105cb94770,
                    0xc4d8c7d5db6cb0d7,
                    0x4116c9d088a5647b,
                    0x1ab74486c43ef8b5,
                ])),
                Felt::new(BigInteger256([
                    0x064344a90c980f12,
                    0x493bad8f5e106184,
                    0x55cdd0dc768e51b6,
                    0x281e2dbaef1e76bb,
                ])),
                Felt::new(BigInteger256([
                    0xaf56d6217cc2387b,
                    0x8dda8f2d2689b863,
                    0x61a0e348689c350f,
                    0x0eee35e85502495f,
                ])),
                Felt::new(BigInteger256([
                    0xa70aedfbb15f5f74,
                    0xecb8d0a717b4b0c0,
                    0x9974c7cd35a98ace,
                    0x62d87c8bd6137876,
                ])),
                Felt::new(BigInteger256([
                    0x8188cdbc7bcd7589,
                    0x66f07a0f188e9d30,
                    0x4b46429cb540c84f,
                    0x0bffa87fce9c74cb,
                ])),
                Felt::new(BigInteger256([
                    0xf8ea5c24376e72bc,
                    0x7d013979e10187b5,
                    0x592456077aca1fab,
                    0x39a3a6b792617f47,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x1d197f0c4212800f,
                    0xedb864979e644f58,
                    0xf3794e9c084562b6,
                    0x1c21cf0ec79d632b,
                ])),
                Felt::new(BigInteger256([
                    0xe132927022d27f7f,
                    0x752bdd6dd520ea48,
                    0x1b1961e97a268d14,
                    0x3fe4de0c93dd3d11,
                ])),
                Felt::new(BigInteger256([
                    0x276eec400cd64dcb,
                    0x37ff7a3e51be9fcd,
                    0xe2b553aa9c23624c,
                    0x29109174c13cfa8b,
                ])),
                Felt::new(BigInteger256([
                    0x509ef76d2030855f,
                    0xd7e41c88aa6a5433,
                    0xa5f4bbd3623fbeed,
                    0x14fcf173c870ad9e,
                ])),
                Felt::new(BigInteger256([
                    0x5a4ce7bf45917f6c,
                    0xddf78803676674ba,
                    0x10fc87a05cc69274,
                    0x06d071deaffcf5c4,
                ])),
                Felt::new(BigInteger256([
                    0xc1ba6a44497716ba,
                    0xd67793d06c1d3743,
                    0x8d57533bc5d0aaad,
                    0x27a718232fa4561f,
                ])),
                Felt::new(BigInteger256([
                    0xaec94b9c38b57e81,
                    0x33dce571a0a0f254,
                    0xd3fccbaf6df91d75,
                    0x115580e0af935b38,
                ])),
                Felt::new(BigInteger256([
                    0xa6c8f92db0783c9a,
                    0x7a8066cabbf774b8,
                    0x2128bb5dd289c7ec,
                    0x0eddf6b7ac16ee1f,
                ])),
                Felt::new(BigInteger256([
                    0x349b735e9f1db8bd,
                    0x6a39d73300578f67,
                    0x99338ca5f8bcfdac,
                    0x38837ffc855cd7f3,
                ])),
                Felt::new(BigInteger256([
                    0x08b1788b6e0b3922,
                    0xa4fedf1bc8809a9e,
                    0x5e095dbc06ef185c,
                    0x306ac1e20ed57b43,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb1e07176eba727a1,
                    0x921cf8fc4b35a132,
                    0x06310b7a11dd8186,
                    0x6032fd7d7149e704,
                ])),
                Felt::new(BigInteger256([
                    0x5ce6f8bf81a8ce8e,
                    0xf24ef4c7280ddf45,
                    0x8f3026fd59cf6ffc,
                    0x50ef616068ec163f,
                ])),
                Felt::new(BigInteger256([
                    0x22280147ee35d7f1,
                    0xab446b67f4daba82,
                    0xf9330a0632d5e4e6,
                    0x6e127b4c1d92f10d,
                ])),
                Felt::new(BigInteger256([
                    0x9035e56c01310f64,
                    0x9624bf15defb86b5,
                    0xf10ec34accc02825,
                    0x2f700fb132db9517,
                ])),
                Felt::new(BigInteger256([
                    0xa29c529a19346ac1,
                    0x7290dc42924c1c66,
                    0x65f8512a917eac14,
                    0x54ea7baee0208140,
                ])),
                Felt::new(BigInteger256([
                    0x3acc03539b6c0901,
                    0xcc2ae11f98aaeb21,
                    0x60b3c1d7568f415b,
                    0x08071a261f379181,
                ])),
                Felt::new(BigInteger256([
                    0x924d8f49cca30fb1,
                    0x3505a33c589bcda8,
                    0x92a96d7ad4761505,
                    0x38ade0bccef7f89b,
                ])),
                Felt::new(BigInteger256([
                    0xbeab4227eca3caf4,
                    0x73f4f4d50549eabe,
                    0x302074a1da3c9de7,
                    0x3ce6c7346872363a,
                ])),
                Felt::new(BigInteger256([
                    0x1e46a09b53f1254a,
                    0x83ac8a208ba22f20,
                    0xad00f8e2f32fae54,
                    0x5a0f6fe1bd01b865,
                ])),
                Felt::new(BigInteger256([
                    0x24433a9605581d19,
                    0x05c9eb9e592a6b7f,
                    0x425b0eff708cd504,
                    0x133c6e67e2d30ee9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe29d590f4d6f8df7,
                    0x6c369ad1bd7c292c,
                    0x0b330c4feb1e6abf,
                    0x0fc19f208819c51b,
                ])),
                Felt::new(BigInteger256([
                    0xc2b1687fa0ce0e2c,
                    0xbc82ee3d7ca3f250,
                    0x7b34a70d6ec73627,
                    0x7251a8effa13c00c,
                ])),
                Felt::new(BigInteger256([
                    0x421aaaaf4bed000b,
                    0x01dcb56006a70e3c,
                    0x5127749d4fe8477e,
                    0x41fc88b5a9eb8970,
                ])),
                Felt::new(BigInteger256([
                    0xb72da6ee0f16e6b9,
                    0x6f5fae5d5876241d,
                    0xc2b64e12c9515a75,
                    0x3836452f0e12944a,
                ])),
                Felt::new(BigInteger256([
                    0x7b5613c7d546bea7,
                    0x36f3f3187de7ae2b,
                    0xf3515eb698c42651,
                    0x30e2151aabf1cbce,
                ])),
                Felt::new(BigInteger256([
                    0x13f001e7bcb323eb,
                    0x133cb6f53c37c492,
                    0x77d44d545a9b2919,
                    0x5d14a5c324810931,
                ])),
                Felt::new(BigInteger256([
                    0xbbcb9b43a172e1be,
                    0xda9d67ee4d1e8e6a,
                    0xac945f71067f56ac,
                    0x2e2daf8968293916,
                ])),
                Felt::new(BigInteger256([
                    0x2e1159a6e93ea23d,
                    0x10d4d8a699b31491,
                    0x69bf75aa3bea3657,
                    0x2863939bebdcc22c,
                ])),
                Felt::new(BigInteger256([
                    0x248d82e4f4290b99,
                    0x39594b4592653a00,
                    0x1c2c8d608abb4cf6,
                    0x1ce10f8657c8c758,
                ])),
                Felt::new(BigInteger256([
                    0x45439e883a0f2de1,
                    0x5ac6a599ba9d3e2a,
                    0xd198a675ffefcbd1,
                    0x37cac16bdd8ad53a,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6dadb6db6dc,
                    0xe6b5824adb6cc6da,
                    0xf8b356e005810db9,
                    0x66d0f1e660ec4796,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xd99f4a8fe00e11bd,
                    0xe12a753d82b33b30,
                    0xba87bf86c47e6f0b,
                    0x58de312b5993b67f,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
                Felt::new(BigInteger256([
                    0xb4c1972e044567f4,
                    0x8e14aacbecb9fb59,
                    0x2c0f182612f81cd9,
                    0x34d6a5db27797543,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0x34413b9512617cf9,
                    0x7e6bdaab3f8443c5,
                    0x752178862c9a6ab7,
                    0x3dde7b14d2951772,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
                Felt::new(BigInteger256([
                    0xbdf2fa0b931e7a04,
                    0x60f39c6eae7a9a3c,
                    0x34e97cf1bd62a467,
                    0x13b9e8a487cc4745,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xdb6db6ecdb6db6ca,
                    0x035ffa14db8a4eec,
                    0x5ea2264f581fdd5a,
                    0x401b2e0d73d97883,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
                Felt::new(BigInteger256([
                    0xfffffffd00000003,
                    0xfb38ec08fffb13fc,
                    0x99ad88181ce5880f,
                    0x5bc8f5f97cd877d8,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbab34723d08a0628,
                    0xf9421a2d63f15ee9,
                    0x9478e1123bb96191,
                    0x4ab33e671beef9da,
                ])),
                Felt::new(BigInteger256([
                    0xca2e968b09a5a34b,
                    0x77b4c72a8fb3678e,
                    0xebda0182f6b6a30d,
                    0x29ed0bfbd912db5b,
                ])),
                Felt::new(BigInteger256([
                    0xd537a6b0b8f5fa31,
                    0xd441377e18a86edc,
                    0x71c7e660448f7b9b,
                    0x1f9d54d7108b7737,
                ])),
                Felt::new(BigInteger256([
                    0xfbd3df12842b8e76,
                    0x74bc2f8d7c0a4238,
                    0x20da294ea1dd9515,
                    0x4f4b83d2a66014f6,
                ])),
                Felt::new(BigInteger256([
                    0x4832d5bed6ce0802,
                    0xa58d3a486e64a6ac,
                    0xb4cf946c63c0c13b,
                    0x5f0617f8d0bd3867,
                ])),
                Felt::new(BigInteger256([
                    0x2aa7d7f17ccbaa0d,
                    0xfded4724c294541a,
                    0x38a4b60237a65066,
                    0x0c3625c6a3b538e7,
                ])),
                Felt::new(BigInteger256([
                    0x4bf0d9b4ee095d54,
                    0x5413717c31a7d6fd,
                    0x905d509366e22c43,
                    0x54a74dc407276102,
                ])),
                Felt::new(BigInteger256([
                    0xefe70b9cf214b343,
                    0xa33e3d2789e0c52d,
                    0x56a604bba8400b49,
                    0x24f1c2a3813e5eb1,
                ])),
                Felt::new(BigInteger256([
                    0x2087cf3b3a5075da,
                    0x8664c785c4dfeec9,
                    0xacf504ab932ee435,
                    0x5b1ddbf8e2455284,
                ])),
                Felt::new(BigInteger256([
                    0x9103e8f134be6d3b,
                    0x3eca6ffa0e4c5a34,
                    0x7b35d8b8ef07a1af,
                    0x3088c5303cd910ff,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbdfb044348a83617,
                    0xdf6bf4087584022e,
                    0x53ae9f8e49d39d44,
                    0x73138b33a9fff493,
                ])),
                Felt::new(BigInteger256([
                    0x35eebc6633efab69,
                    0xd7939af776cdfc77,
                    0xa18f38b422f4a151,
                    0x4a1603b43170c0b7,
                ])),
                Felt::new(BigInteger256([
                    0xa4b8ceef9a0a19c2,
                    0x677c7fa569fe4487,
                    0x4383c67b0c1c451b,
                    0x3054f5ff52b6cbe0,
                ])),
                Felt::new(BigInteger256([
                    0xaa4641ec14ed4a64,
                    0xbdecb6cdbccc654f,
                    0x5fed3bb606328c10,
                    0x6f1d5c3ddbee8ab0,
                ])),
                Felt::new(BigInteger256([
                    0xd7fa560e89045549,
                    0x768d620036ee9670,
                    0x92e0f677becef8e3,
                    0x4ca298b0774ad4a0,
                ])),
                Felt::new(BigInteger256([
                    0xe08ee82cb42339d3,
                    0x54e47b0372c75b61,
                    0x419186c586353e98,
                    0x01e89367cc17f8b9,
                ])),
                Felt::new(BigInteger256([
                    0x7ffcbc3bf9ae8c00,
                    0xf1d5af2a69a3d25f,
                    0x156cfa44cf09ca77,
                    0x5d22ee05dbd2cd02,
                ])),
                Felt::new(BigInteger256([
                    0xbb78b68c9e57e774,
                    0xd65e371e6acd1e0e,
                    0x2b78497f6d701f28,
                    0x73b8ec2aefb21b4d,
                ])),
                Felt::new(BigInteger256([
                    0xdea154cb301edc1c,
                    0x1817ba8b21023ee1,
                    0x8d09659090ba9a57,
                    0x56721b84a0a43dea,
                ])),
                Felt::new(BigInteger256([
                    0x986e4770898e4583,
                    0x960e869e0f83f444,
                    0x3e0c81bbaa717c01,
                    0x09598b55f7169661,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xf9b1a8cc1066cb22,
                    0x0cc55b28b20e7b22,
                    0x968c568466e1d7c8,
                    0x106d540e03ca733c,
                ])),
                Felt::new(BigInteger256([
                    0x4d666087ac091b52,
                    0x7eb36ef00f9a502f,
                    0x33633b048b7e4300,
                    0x564b2e7dec01bed4,
                ])),
                Felt::new(BigInteger256([
                    0x705e5c31981b5a1e,
                    0xc586d0eacc04d7f5,
                    0xbfce97a162835624,
                    0x066e743c10127fac,
                ])),
                Felt::new(BigInteger256([
                    0x01d012cdc9b6a3e9,
                    0x70c4959ab704a7bd,
                    0xce60d8551c7bef18,
                    0x324761ff5fd85f5e,
                ])),
                Felt::new(BigInteger256([
                    0x47fc5948b7c5661e,
                    0x12e83e2850ff4363,
                    0x0f0f541dfff1d3e1,
                    0x5efb3d13934a619a,
                ])),
                Felt::new(BigInteger256([
                    0xac048b8258e86041,
                    0x2dcef395315b2ed5,
                    0x7125044c599e4cec,
                    0x2bc3672a21cefeb7,
                ])),
                Felt::new(BigInteger256([
                    0x3baf9cef10085c90,
                    0xf58b43edec184497,
                    0xa0b61856b014de6c,
                    0x106ef30ff9da0d41,
                ])),
                Felt::new(BigInteger256([
                    0x3112d3188dfcc3d2,
                    0xc5c3f588ccd2f9ac,
                    0xbe4b0ba64602b55a,
                    0x5c770f2c3688f770,
                ])),
                Felt::new(BigInteger256([
                    0xd9739e3f2ab763bb,
                    0xb72247ad1295f523,
                    0x5ce640feebb3f0e7,
                    0x0aea73e3d544aa61,
                ])),
                Felt::new(BigInteger256([
                    0x09de597615e27e0d,
                    0x2733fa0b91dc97bc,
                    0xa7b13658c558452f,
                    0x0558129299ae1072,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x97a44b66db50c12d,
                    0x41781ee97e7e0a74,
                    0xe1012cd1bcf9c05f,
                    0x6e8108cd64a08c2e,
                ])),
                Felt::new(BigInteger256([
                    0xc856aa769cef9f86,
                    0x3de40185408bb388,
                    0xadff52c6ab235a55,
                    0x0e6a935d72e10acd,
                ])),
                Felt::new(BigInteger256([
                    0xb478cc7f15ea0e75,
                    0x37693d3dae9a8f48,
                    0xcfad5e74e8899fd1,
                    0x2ae9b064fcd58c16,
                ])),
                Felt::new(BigInteger256([
                    0xe3b45dd328dd20de,
                    0x2b797414aee8fbac,
                    0x4d90f7ab051a14f4,
                    0x64e276fca8edbbbb,
                ])),
                Felt::new(BigInteger256([
                    0x60bd6340b860fa5a,
                    0xd6f1ad90d017142b,
                    0x7f71cb1af98312ab,
                    0x12e56a8fbb5f7840,
                ])),
                Felt::new(BigInteger256([
                    0x61f0ae1007d67abe,
                    0x58851f83fc4a1a12,
                    0x3b7b31ec46d11439,
                    0x3863b2cd1a3c90d1,
                ])),
                Felt::new(BigInteger256([
                    0x6eb802393f7959ff,
                    0x282f0f2f8bdb618b,
                    0xdd802e789b1c9905,
                    0x21060eae5b029320,
                ])),
                Felt::new(BigInteger256([
                    0x93bd997ba803c4f4,
                    0xa32a784fe00b1f09,
                    0xbe11fdc9c0b5446e,
                    0x5119611fe728c8ae,
                ])),
                Felt::new(BigInteger256([
                    0x09d50d38303602aa,
                    0x6fbbd62c15d57146,
                    0x3dd5dcb234a87759,
                    0x07156ca5456d3482,
                ])),
                Felt::new(BigInteger256([
                    0x20d4f0b9b0a97f66,
                    0x5e5b8c8dfc78bcbd,
                    0xac60d2f6593b9586,
                    0x286400c67ff43b36,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc65926ee0b57ef39,
                    0x31fc24c08540b2f2,
                    0x69105d71695e1139,
                    0x12c6cbcddcccb4fb,
                ])),
                Felt::new(BigInteger256([
                    0xb9d9c015b11cf8d3,
                    0xebd630992fcc7398,
                    0x8813d8676191f58d,
                    0x6fc530f80e662caf,
                ])),
                Felt::new(BigInteger256([
                    0xe6b1a3004b496125,
                    0xbcdc869ca1106a36,
                    0x2b27bfb2e16ac94d,
                    0x5cc8a4f953363f9b,
                ])),
                Felt::new(BigInteger256([
                    0x151f34038d5cf1ae,
                    0x03329dfe667461fd,
                    0xb40caeec8f9e214d,
                    0x2baba3b9e464bdc2,
                ])),
                Felt::new(BigInteger256([
                    0x0d03d7b5c5b964ed,
                    0xba4febe8eb056f41,
                    0xb8e2b247e8f7b4ea,
                    0x4ed2cf5a3a0cf448,
                ])),
                Felt::new(BigInteger256([
                    0x3a23f44cc8f417fd,
                    0xd274a8892c489285,
                    0x092c1be1d9133918,
                    0x4eafab27ee12b838,
                ])),
                Felt::new(BigInteger256([
                    0x219e6c7fb1111697,
                    0xeed64201c659d863,
                    0xf476ffd7ace14172,
                    0x3226916a84508fd9,
                ])),
                Felt::new(BigInteger256([
                    0xba92ecb38872b1bc,
                    0xb25b05c49daeaf83,
                    0x6c5ca581aaf4cef2,
                    0x3d5c48e7d61a9dce,
                ])),
                Felt::new(BigInteger256([
                    0xe488604607b1df73,
                    0xcd6cf0fd1be6761f,
                    0xeb7f3c06ca22824c,
                    0x21788741c46fed31,
                ])),
                Felt::new(BigInteger256([
                    0x90f40646de252eaa,
                    0x6e63f923ba791e6f,
                    0xdfaa81a5cd525b9a,
                    0x60ee948ac5a0316f,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd6164bd4751f4de8,
                    0xcc5aca0141cccf5f,
                    0xf278b5f7544216b8,
                    0x5a6d87127c81775a,
                ])),
                Felt::new(BigInteger256([
                    0xe69b63d3bbf12091,
                    0x332155592e7300a6,
                    0xc5ca6bbda20b5248,
                    0x15b7383be6a0384f,
                ])),
                Felt::new(BigInteger256([
                    0x53bf97e6d9b9728c,
                    0x498e54da41f26851,
                    0x69e41d6173088066,
                    0x507f9e2adbcd1bb1,
                ])),
                Felt::new(BigInteger256([
                    0x91f9b0b5ce320140,
                    0x41d4f92c328d3c0a,
                    0x137ec4852c9fb46b,
                    0x158908c8e9b31add,
                ])),
                Felt::new(BigInteger256([
                    0xb873c46e16d20d71,
                    0x5079e052d724a8ae,
                    0x52332a99261091f4,
                    0x41ec3e90824ca26e,
                ])),
                Felt::new(BigInteger256([
                    0x309b682cf49ee7c9,
                    0x93766def97f173bc,
                    0xf434f6e74e0ae3ff,
                    0x4340bf04a849fdfc,
                ])),
                Felt::new(BigInteger256([
                    0xa86ef49105f82ca1,
                    0x2e896fcb5a2643f2,
                    0x93dc4f44d9c2a983,
                    0x6c510f5ad155353b,
                ])),
                Felt::new(BigInteger256([
                    0xa4453a43eb39ec4c,
                    0xb8140867e478aa66,
                    0xe9ea5f7fd87d49db,
                    0x036e2754138cabb4,
                ])),
                Felt::new(BigInteger256([
                    0x1cfcd84c87e20525,
                    0x97103f5621a36d8a,
                    0xde44947b577074a8,
                    0x684e7629d54c6efe,
                ])),
                Felt::new(BigInteger256([
                    0x36ee9e045e24ba45,
                    0x10eb5d8162605c94,
                    0x14d0bfbee633d4f2,
                    0x68d14668d5dad90b,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/vesselinux/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x55b23b0219d51b82,
                    0x21a8a69200d24d8f,
                    0xc76679da83d0ff6a,
                    0x03882d837ee82f14,
                ])),
                Felt::new(BigInteger256([
                    0x2a780310f572787d,
                    0xd26f328f1e103326,
                    0x6c3a04aad1ca3c15,
                    0x5bdd65f6b02651d9,
                ])),
                Felt::new(BigInteger256([
                    0x3201cb5c800c9f31,
                    0x298dc378f336a841,
                    0xf0d756551c065b02,
                    0x36349dd305549c82,
                ])),
                Felt::new(BigInteger256([
                    0x85b7f815fca309f4,
                    0x0b909ddbe26793d0,
                    0x6b1485e001c9c3c3,
                    0x41a54042321df426,
                ])),
                Felt::new(BigInteger256([
                    0xd3ed31aa616718a9,
                    0x7f03a553e683d368,
                    0xa90425b452475146,
                    0x46340fe2590b20f2,
                ])),
                Felt::new(BigInteger256([
                    0x2a2f0d2e5a73f48a,
                    0xce78ba46b44711ec,
                    0x08799d0f2e6bc73f,
                    0x165fd1c7acb66f11,
                ])),
                Felt::new(BigInteger256([
                    0xcd469b26d2354c03,
                    0xec93052c8882b8c6,
                    0x9ce637f0c394becc,
                    0x4ed0e750d44a5e1b,
                ])),
                Felt::new(BigInteger256([
                    0x2b39bd588ef91528,
                    0x3e99c38b3ec3a6c3,
                    0xcb2fc45944ca5d4a,
                    0x4bfe4bb1829592c0,
                ])),
                Felt::new(BigInteger256([
                    0xda722c982c5e2877,
                    0xf8085df6da08a87c,
                    0xe6a5366713068848,
                    0x5b8513c04f9b9cfc,
                ])),
                Felt::new(BigInteger256([
                    0x3a84700bad786bd8,
                    0xc483fc2036970d34,
                    0x20c793e4051a0ce6,
                    0x6f77e1ffc9185852,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x867d865a80f0a143,
                    0xcbbf46097639dbbd,
                    0x522cd110ac11a2ad,
                    0x2c7fd7ccc36f4258,
                ])),
                Felt::new(BigInteger256([
                    0x200c8a6eb4099d03,
                    0xcdd28d0226a92612,
                    0x3961307d2d661170,
                    0x7335571d5e552115,
                ])),
                Felt::new(BigInteger256([
                    0x6d746037e7ccb201,
                    0xc0d513dd7e63a760,
                    0xbb9c3f8e25811391,
                    0x31dbe7f087944cbb,
                ])),
                Felt::new(BigInteger256([
                    0x10663b3bde2e29c9,
                    0xbb09a912772eaa81,
                    0x73d7ab31643bf2b8,
                    0x67826e7a4671a5b7,
                ])),
                Felt::new(BigInteger256([
                    0x3a94c807c400bf0a,
                    0x69ba7fac7f693fb3,
                    0xdae26de373c0f034,
                    0x4dbfbc473b6c908e,
                ])),
                Felt::new(BigInteger256([
                    0xba3f7b84647dab52,
                    0xc2e2a7dc39553b43,
                    0x4360e0158b2500f3,
                    0x5dfcf7ed68ccc0d4,
                ])),
                Felt::new(BigInteger256([
                    0xc279542d2b327498,
                    0x20e202585c07a3ec,
                    0xa42ebf695d001ba9,
                    0x27a7bae4710630ca,
                ])),
                Felt::new(BigInteger256([
                    0x91f442be31c545b8,
                    0x68e6acf30d30fbf2,
                    0xd126845f14077ed8,
                    0x014a24bb4f514b50,
                ])),
                Felt::new(BigInteger256([
                    0xadf969efdf568996,
                    0x7153a73a758487bf,
                    0x106a34c96f3d93a5,
                    0x2104c4cfe9d9d95a,
                ])),
                Felt::new(BigInteger256([
                    0x20fde63c9d3ac650,
                    0x49525d1939a1b7d7,
                    0xdaabcc3a33ebd360,
                    0x335b58b3d6bfaad4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x97c1b7c7ac501345,
                    0x3eaeba3dd8ab0556,
                    0x839d114a10924e0a,
                    0x51227fee99aa9fef,
                ])),
                Felt::new(BigInteger256([
                    0xd3b2758a21b5d2df,
                    0x681d7a5da5057d06,
                    0x2811b496afec1f31,
                    0x2ccee403aaf3deea,
                ])),
                Felt::new(BigInteger256([
                    0x96627873b5089b8b,
                    0x28d2e1a2809a682a,
                    0xef147f9860ad2464,
                    0x094afa4ccd893c61,
                ])),
                Felt::new(BigInteger256([
                    0xe490153bfd6e1762,
                    0xb1905466d9b8eba4,
                    0x060017b961bc13e6,
                    0x021cc3728aec977f,
                ])),
                Felt::new(BigInteger256([
                    0xa0fd672a234f5b26,
                    0xb8d43b2fc70a0f2a,
                    0x241f9eccc65defbb,
                    0x6ee584e272b02621,
                ])),
                Felt::new(BigInteger256([
                    0x79001967272b4961,
                    0xb7cb571da3d49824,
                    0x53c6e196d6f37e0e,
                    0x7203934185602aee,
                ])),
                Felt::new(BigInteger256([
                    0x923e5e94af794da2,
                    0xac0569f3a6fee5cf,
                    0xc85dc1b945c32414,
                    0x0d97112f01ec8da6,
                ])),
                Felt::new(BigInteger256([
                    0xb42039e9f339966f,
                    0xd4cca3fd34d8d86f,
                    0x89f6c03ac2f99038,
                    0x6bfa1d0c3f88a552,
                ])),
                Felt::new(BigInteger256([
                    0x66063f5e2d1d4b7e,
                    0x16cf7473a2e838ce,
                    0x23de6870f1a2c84d,
                    0x0f445002ce0501a8,
                ])),
                Felt::new(BigInteger256([
                    0xa014bee709e3b1f0,
                    0x718f800fdafc8ef0,
                    0x43a11ae2d6e0fd35,
                    0x672131bc39b72987,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x83a3cea752aabf0f,
                    0x7fbf4d335ae76bdb,
                    0x40f2034ab2a6ff5a,
                    0x4fd325c8977862ec,
                ])),
                Felt::new(BigInteger256([
                    0xa30b817e0eeb4b09,
                    0x983b1aa9c99d1f5f,
                    0xc27fac56db5d1c35,
                    0x0cfb24eed0c3b250,
                ])),
                Felt::new(BigInteger256([
                    0x7898a789e39895a7,
                    0xb23b2e7f9c9bf511,
                    0x31c1eecbc5919940,
                    0x72d07b5b94cfe8a5,
                ])),
                Felt::new(BigInteger256([
                    0xf50bfe3f8c3accf5,
                    0xa999170f829faac1,
                    0x7fefe9db1896bf2a,
                    0x17958d469c1e4f5a,
                ])),
                Felt::new(BigInteger256([
                    0xedcb162bb4162a75,
                    0x1bb085be3522b950,
                    0x9029628132e0e7e4,
                    0x56f9f18bb7911d87,
                ])),
                Felt::new(BigInteger256([
                    0x383b868f3683eaaf,
                    0xfe57fbdd5db45ad1,
                    0x60d43c0c89232690,
                    0x5a8fe8c4be328cc5,
                ])),
                Felt::new(BigInteger256([
                    0x40efed3f5e501e6e,
                    0xbf83dd5eab5a48ca,
                    0x9fc027bbeaa043e3,
                    0x3b65a36b16e9922b,
                ])),
                Felt::new(BigInteger256([
                    0xfbdaf3de89967c0e,
                    0xa3878cbebd944d95,
                    0x22641451b87671c2,
                    0x30c619cca1c6c06c,
                ])),
                Felt::new(BigInteger256([
                    0x4dc5fef974ff59f1,
                    0x1a4ff32950b60cb1,
                    0x51dd014d67ec56f4,
                    0x688a04df31179bcd,
                ])),
                Felt::new(BigInteger256([
                    0xbbbf9bb077c6029e,
                    0xcdd4062d7c2785c8,
                    0x1a511db1d13ea4b7,
                    0x07711410f1759f25,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x22d90eb1f5c82498,
                    0x4c60f3fa74be33b9,
                    0x0b5672bcb1eb03a1,
                    0x337d99d3ef850761,
                ])),
                Felt::new(BigInteger256([
                    0x67a191940d470098,
                    0xe03815ec3605c670,
                    0x7f4c104f7ce24016,
                    0x3953b6c563ba9893,
                ])),
                Felt::new(BigInteger256([
                    0xe93285bceb3f6e79,
                    0x61ffbfaec6bcf1a1,
                    0xc34d5f1d556c36b5,
                    0x34fb8b955c064c3c,
                ])),
                Felt::new(BigInteger256([
                    0x76587a8959d0e52f,
                    0x641a6999c1971a99,
                    0x4053b7bc77dfcfdc,
                    0x1454838bf499ddd1,
                ])),
                Felt::new(BigInteger256([
                    0x0ff201aa4054b85c,
                    0x83934468bdb1133e,
                    0x8696ec38f9ffca69,
                    0x3b7f055698305ccd,
                ])),
                Felt::new(BigInteger256([
                    0x9d9ff15e6d3d9e01,
                    0xdaf8f2563a5b3ce6,
                    0x79c14103648bb4b7,
                    0x3d0dfe521afb577e,
                ])),
                Felt::new(BigInteger256([
                    0x2548a0070c9e16ad,
                    0xd154b76957de625a,
                    0xd2650afbff7f70b0,
                    0x51df5fcee4d3c0f3,
                ])),
                Felt::new(BigInteger256([
                    0xf2096a27ee90c4f5,
                    0x9964dde3da11d265,
                    0x9a3411bfb465cfce,
                    0x02e7cf7442772a61,
                ])),
                Felt::new(BigInteger256([
                    0x1a4f35747930df3d,
                    0x7ccb62e15ef3ff75,
                    0x1538bc4d1f212cd8,
                    0x0605c75c665df877,
                ])),
                Felt::new(BigInteger256([
                    0xf430226e133f6901,
                    0xfd5777046b509b1f,
                    0x2a3304a53fa5423d,
                    0x5b45f2cba66766a6,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd4b7c32a024fb97a,
                    0x1cc354fe0cf46380,
                    0xb1ff2316b9fe38e8,
                    0x49493e372b0b373f,
                ])),
                Felt::new(BigInteger256([
                    0x7649cb488931a86b,
                    0x592984a1c7f90bf7,
                    0x75f6e0a1f6ed8de8,
                    0x36f63a53af44a2bb,
                ])),
                Felt::new(BigInteger256([
                    0x4ed08bebb3365716,
                    0xd18e3d2c234c9d8c,
                    0x329c3234d6f513ad,
                    0x3d234f265825ec80,
                ])),
                Felt::new(BigInteger256([
                    0x7958bf1f43d95d0c,
                    0x7d5d1c97e39d8dd3,
                    0xf7f37177aa038999,
                    0x12ccd09a07142218,
                ])),
                Felt::new(BigInteger256([
                    0x7b1bdcc22e43894b,
                    0x3fa762212451a053,
                    0x27ee229099a9a45f,
                    0x58bf521dfcd82986,
                ])),
                Felt::new(BigInteger256([
                    0xffea5ac26f2cadf3,
                    0x795ac040579a3406,
                    0xbc54d76ba6029044,
                    0x59a344c55f6bc10d,
                ])),
                Felt::new(BigInteger256([
                    0x6a1b19f4f36f0909,
                    0x2c6cb646d6ffe525,
                    0x970c42e23391029e,
                    0x23d6d074edb19324,
                ])),
                Felt::new(BigInteger256([
                    0x59a86a1431c59451,
                    0xebd2f91ce5f6be50,
                    0xca476cf89aa53385,
                    0x1c68634046b71135,
                ])),
                Felt::new(BigInteger256([
                    0x3b66fbd7dee10bf3,
                    0xc632892af3a6b67d,
                    0xdb94740e8811779b,
                    0x4e2ca9bc37e75b1c,
                ])),
                Felt::new(BigInteger256([
                    0x7919b4a1a7f9dcfa,
                    0x73391a110772d28a,
                    0x9071d9fb560f82cf,
                    0x0ee6708a6476b489,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 10],
            [
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::new(BigInteger256([
                    0x0000001dffffffe2,
                    0x2fc6c7a60031381e,
                    0xff38af0edf08af60,
                    0x6a2664411f8b5189,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x50b178db68fd14a8,
                    0xcfe6598a02c365ce,
                    0x98f86d5208cd09cd,
                    0x3c1d2a21a16d5ed4,
                ])),
                Felt::new(BigInteger256([
                    0xe9d1a468722e21b3,
                    0x205471b656b09c4d,
                    0x273eac8d9f36ec73,
                    0x3dd6a30b5a76c799,
                ])),
                Felt::new(BigInteger256([
                    0x5ea253d4d375bb93,
                    0x5e86105222cdc44e,
                    0x5e593be203122c8e,
                    0x6c57d5a8b5435962,
                ])),
                Felt::new(BigInteger256([
                    0xfea4dfdf01927306,
                    0x129dfa6d03be3dcb,
                    0x9c0dcb487901ba8a,
                    0x595c99b5e971089a,
                ])),
                Felt::new(BigInteger256([
                    0x0da67bc64af54c23,
                    0xadd48aad7a72ba89,
                    0x2947bc0b81145ba4,
                    0x52e1949ad5000f66,
                ])),
                Felt::new(BigInteger256([
                    0x44d3e066606e509a,
                    0x8fc45666b52d0776,
                    0x2fb5401af0e70ca1,
                    0x3bafd48f7cb86a2f,
                ])),
                Felt::new(BigInteger256([
                    0x60567697489acf56,
                    0xbf02f8c438487a77,
                    0xacc2821ca5a7231c,
                    0x3a11968ab8dbe140,
                ])),
                Felt::new(BigInteger256([
                    0xa0bee38cfce50bb9,
                    0x75564f3d895f3068,
                    0xf29296b9bc9bf86b,
                    0x25ea4838b000ae72,
                ])),
                Felt::new(BigInteger256([
                    0xbda9231298476355,
                    0x399be5d0c1aef2fa,
                    0xe0e461e599dd96f3,
                    0x588219551484d61f,
                ])),
                Felt::new(BigInteger256([
                    0x0781c303ee673d0f,
                    0xe8260673723b0aff,
                    0x45276ecbc5a98f5b,
                    0x5d4ecbed9482ce2b,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x55680690391cb696,
                    0xe7316d3171e5a47e,
                    0x0724fa26c6fed28c,
                    0x44b66c1c84dd4bbf,
                ])),
                Felt::new(BigInteger256([
                    0x497a5c45cb16eece,
                    0xc37dd8e0576c367e,
                    0xbd1f7e405de82b38,
                    0x51a978002b3102aa,
                ])),
                Felt::new(BigInteger256([
                    0xe7cdc12799efaefa,
                    0xfb7d510b0e120254,
                    0x5aabd2d6219420a2,
                    0x614cbc19ef28eb61,
                ])),
                Felt::new(BigInteger256([
                    0x81eba12d7c26baa5,
                    0xe588721f6be97a9f,
                    0x3b03cbc20040b267,
                    0x61755bb69e7a170d,
                ])),
                Felt::new(BigInteger256([
                    0x290896c35727d03d,
                    0x040da170b726e7b8,
                    0x0a97b64ad2e262e2,
                    0x1992d851f83dc0d9,
                ])),
                Felt::new(BigInteger256([
                    0x858ed74a665ac8e5,
                    0x874ae497cf02bad4,
                    0xfb928b4102bbbf90,
                    0x03ded53bc1950aa8,
                ])),
                Felt::new(BigInteger256([
                    0x5843f25d52bf1678,
                    0x6fb43e91e11fa3ec,
                    0x80a64b0be2d20a9b,
                    0x43098ddf9c0b2cbe,
                ])),
                Felt::new(BigInteger256([
                    0xe16061294fae80d0,
                    0x4460d5fd0d3ffcd5,
                    0x8eccd4a4f636f2aa,
                    0x43b20b39a5390d49,
                ])),
                Felt::new(BigInteger256([
                    0xd0597af3a7159635,
                    0x4ddf17e6076d616c,
                    0x07987bdf357d7cdc,
                    0x56c6f651e44cf236,
                ])),
                Felt::new(BigInteger256([
                    0x8f70bedeb47ff6f6,
                    0x036c8f69b331193e,
                    0x151f9cc4be45a888,
                    0x3ea85279fa769a01,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe5ceef759364de05,
                    0x8d397afb499f8d4b,
                    0x122fad5f0f80c88d,
                    0x152f0d1c1cac60f0,
                ])),
                Felt::new(BigInteger256([
                    0x92836147b9d6817a,
                    0x782c6d140a557b82,
                    0xe52164c85eb3dc46,
                    0x62332894c10a2d01,
                ])),
                Felt::new(BigInteger256([
                    0xdf6dee0676322fc7,
                    0xbdfeb84f4b4483d2,
                    0xd1ab579983fbf378,
                    0x512d2ced4aa5b39b,
                ])),
                Felt::new(BigInteger256([
                    0x8b88d42d35b00185,
                    0xf050dbe441e63bc8,
                    0x00830290ccb9e860,
                    0x0277f70faa06d498,
                ])),
                Felt::new(BigInteger256([
                    0x8430cb8dfc09ca1b,
                    0x4fbfa509d1d0b27b,
                    0x6096bac33530085c,
                    0x1a6775527d21d1f9,
                ])),
                Felt::new(BigInteger256([
                    0x55c4d1421571fd27,
                    0x30cc5b0463b8612c,
                    0xa24df67c1539e024,
                    0x6a99e38fb6b84d2c,
                ])),
                Felt::new(BigInteger256([
                    0xb99cf489480da163,
                    0xdda5e6c13b10bbb7,
                    0x17da080da4ce3c9d,
                    0x1d366a9b8ce6a94a,
                ])),
                Felt::new(BigInteger256([
                    0x3eb5e6682a88003b,
                    0x962b11820da925a2,
                    0x691457dadc9a08ed,
                    0x0b542f9066b0b5a8,
                ])),
                Felt::new(BigInteger256([
                    0x9e701890edf3b763,
                    0xfc39132d75c42e50,
                    0x98593c95096701c6,
                    0x469610d6cf67ab4b,
                ])),
                Felt::new(BigInteger256([
                    0xe01fddbd963901f0,
                    0xd754df0ebbfad537,
                    0x01d94bf21184a5e2,
                    0x64d2f9b451a29490,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x09a0aea3c1b9d322,
                    0xc195cc390e91d414,
                    0xcf774fb6f269ab46,
                    0x270a6f05e00eb5fa,
                ])),
                Felt::new(BigInteger256([
                    0x442785c204e2aca6,
                    0x96d307398935354c,
                    0x5fa232ede66acf20,
                    0x1226909ec0a1037f,
                ])),
                Felt::new(BigInteger256([
                    0x74ceaa662159555e,
                    0xb098b8d61a5cf018,
                    0xff195ad7506d8a6d,
                    0x57f6411ecfa4a829,
                ])),
                Felt::new(BigInteger256([
                    0x54ebcc12e5f94cf6,
                    0x82aeb774fe060e83,
                    0x3be8f1525faa540d,
                    0x309ab217f84affe2,
                ])),
                Felt::new(BigInteger256([
                    0x062ffeb87f0b21fe,
                    0x86997828ec798561,
                    0x2bf6a716cf0c4c97,
                    0x575a49fd277ad70e,
                ])),
                Felt::new(BigInteger256([
                    0x2e44ed9f3690482b,
                    0x96d3cb8d204015b4,
                    0x9e8ffac38a192611,
                    0x5cde14aaa57bf575,
                ])),
                Felt::new(BigInteger256([
                    0xa27d826a178820b4,
                    0x941758aa52613ee0,
                    0xfeb13d5a0a5fbc6f,
                    0x175f9bc2ef4ada9e,
                ])),
                Felt::new(BigInteger256([
                    0xa13ea6b4b9820293,
                    0xc8b1a60e4754c60b,
                    0x530aef74d5f8cf95,
                    0x35a04ea3be5e7f14,
                ])),
                Felt::new(BigInteger256([
                    0x2b14b45f3890fa7c,
                    0x7e786cd865d750cf,
                    0xe378687bb6ab5098,
                    0x428f2c0c240a04de,
                ])),
                Felt::new(BigInteger256([
                    0x4e9255c85c72f21b,
                    0x206492eef1733414,
                    0xff6f2a3c19464304,
                    0x381365743c69fb72,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x6f2e23fa6db89f1e,
                    0xd22e1156b9d4cdb0,
                    0x76aae44ac066e33e,
                    0x42ecd79a6298598a,
                ])),
                Felt::new(BigInteger256([
                    0xa1e2d714d434b701,
                    0x5804b3e0800b8b79,
                    0x567f4d0d6b5aea13,
                    0x57189edcdbd5a3f6,
                ])),
                Felt::new(BigInteger256([
                    0x20ed17f71f92120e,
                    0xecfe5bf7a286cd12,
                    0x0de0e7d4b997a4a5,
                    0x30d42c5cd039692b,
                ])),
                Felt::new(BigInteger256([
                    0x1b588b5048d7360a,
                    0x413dc7fa975472f4,
                    0x834608cbec7ba6f0,
                    0x20f2ff6bbcb2408e,
                ])),
                Felt::new(BigInteger256([
                    0x5e3440bfcc041286,
                    0x4a6b54d4b77019d4,
                    0x5e886adf9f784058,
                    0x10e83eec19ec4189,
                ])),
                Felt::new(BigInteger256([
                    0x4b1feb22d5f3335c,
                    0x26e47da01fe0a826,
                    0x827a9918cccd4778,
                    0x4da45c2e813a351a,
                ])),
                Felt::new(BigInteger256([
                    0x19d3ec8b958cc892,
                    0xf2d4e4221bc9a2a0,
                    0x973556b5d5140989,
                    0x08e70ced332f8f46,
                ])),
                Felt::new(BigInteger256([
                    0x36b0bee6af7555b9,
                    0xaca4aff21b312ab4,
                    0xf926d082e03b26ef,
                    0x2ad5fcff6d46cae6,
                ])),
                Felt::new(BigInteger256([
                    0x4d5ba7cabe8ebb0b,
                    0x26a20983f05731f9,
                    0x5461d304f306e06d,
                    0x5be53d2ffcb80d01,
                ])),
                Felt::new(BigInteger256([
                    0xc73251da8a8e8d81,
                    0xbbaaedf7b4da4feb,
                    0x428351850bd25b51,
                    0x34756349d09e0849,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x84617e849bdb89c7,
                    0xd421721482ed1d13,
                    0x00aa24d09abc75f6,
                    0x1319afb5cbfc8a85,
                ])),
                Felt::new(BigInteger256([
                    0x452ad773cc90db2c,
                    0xe70dccfb683641d7,
                    0x438cb8b9911e0442,
                    0x526be78dc3f142e4,
                ])),
                Felt::new(BigInteger256([
                    0xdbcce66b39117ffb,
                    0xf48eef338f995239,
                    0x519412aac5254b69,
                    0x66a29f534af828da,
                ])),
                Felt::new(BigInteger256([
                    0xd5d5ce231de267d8,
                    0x458c4601ff3b184b,
                    0xa43292a43cba8a92,
                    0x2971bf25d78fadd3,
                ])),
                Felt::new(BigInteger256([
                    0x4caeed15ec406995,
                    0x7e3d949d887f9712,
                    0xdde2af8eb62d4d9c,
                    0x55d44a4be99a330c,
                ])),
                Felt::new(BigInteger256([
                    0x59f30fe98d9e9ad4,
                    0xa00f9c586bc2ed40,
                    0xb02598ddc2ea696b,
                    0x6efd5efb51635d6a,
                ])),
                Felt::new(BigInteger256([
                    0x128d70a886721c26,
                    0x2c872ccf81666a49,
                    0x3ba0e2ea8e9b499e,
                    0x6d633f59fe15fb74,
                ])),
                Felt::new(BigInteger256([
                    0x1cf63afe9af8fc7a,
                    0x4f996699dbc1a549,
                    0xf079c888737d7f34,
                    0x43bdd60c02e78305,
                ])),
                Felt::new(BigInteger256([
                    0x46f9f0d112ef3305,
                    0x09b0b75e3e3317bb,
                    0x519462086fe62ef1,
                    0x14fd1869c5a74bbb,
                ])),
                Felt::new(BigInteger256([
                    0xc21b2980bb51f498,
                    0x1f73d4cfd45f7ecb,
                    0xf2a13b3247ed61d6,
                    0x1241d400271e088d,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
