use super::{sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 8 field elements or 256 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 8;
/// 7 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 7;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 4;

/// 2 elements (64-bytes) are returned as digest.
pub const DIGEST_SIZE: usize = 2;

/// The number of rounds is set to 14 to provide 256-bit security level.
pub const NUM_HASH_ROUNDS: usize = 14;

// HELPER FUNCTIONS
// ================================================================================================

/// The field multiplicative generator: G = 5
const G: Felt = Felt::new(BigInteger256([
    0xa1a55e68ffffffed,
    0x74c2a54b4f4982f3,
    0xfffffffffffffffd,
    0x3fffffffffffffff,
]));

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        let beta_y2 = y2 + y2.double().double();
        *t -= beta_y2;
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        let beta_y2 = y2 + y2.double().double();
        *t += beta_y2 + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3]];
    let y: [Felt; NUM_COLUMNS] = [state[5], state[6], state[7], state[4]];

    let g_x0 = G * x[0];
    let g_x1 = G * x[1];
    let g_x2 = G * x[2];
    let g_x3 = G * x[3];
    let g_squared_x0 = G * g_x0;
    let g_squared_x1 = G * g_x1;

    state[0] = x[0] + x[1] + g_x1 + g_x2 + g_x3;
    state[2] = g_squared_x0 + g_squared_x1 + x[2] + x[3] + g_x3;
    state[1] = state[2] + g_x1 + g_x2 + g_x3;
    state[3] = state[0] + g_x0 + g_x1 + x[3];

    let g_y0 = G * y[0];
    let g_y1 = G * y[1];
    let g_y2 = G * y[2];
    let g_y3 = G * y[3];
    let g_squared_y0 = G * g_y0;
    let g_squared_y1 = G * g_y1;

    state[4] = y[0] + y[1] + g_y1 + g_y2 + g_y3;
    state[6] = g_squared_y0 + g_squared_y1 + y[2] + y[3] + g_y3;
    state[5] = state[6] + g_y1 + g_y2 + g_y3;
    state[7] = state[4] + g_y0 + g_y1 + y[3];
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies Anemoi permutation to the provided state.
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Anemoi round function;
/// implementation based on algorithm 3 of <https://eprint.iacr.org/2020/1143.pdf>
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x384adf241cc810ba,
                    0x68ae877abddc956e,
                    0xcf56377ce47b8a3f,
                    0x37d21ffd428659ab,
                ])),
                Felt::new(BigInteger256([
                    0x212500cabbb298f5,
                    0x8cd91167381de686,
                    0x76ba0b42cef3a5d6,
                    0x1d7fe7bae5b8e3d6,
                ])),
                Felt::new(BigInteger256([
                    0x0894f231237b4171,
                    0x8d58d0bb196af5bd,
                    0x72e1a9238958143c,
                    0x36f3bd0e951bda94,
                ])),
                Felt::new(BigInteger256([
                    0xb79f1d431d4bde36,
                    0xa26fb79ea23c62d7,
                    0xabe1615298471b3c,
                    0x17d3c02c39b5937f,
                ])),
                Felt::new(BigInteger256([
                    0xdf16a237abc983f7,
                    0x80fe112a9836ea95,
                    0x4d26080cdd422956,
                    0x13bdc3ba4e07a9f1,
                ])),
                Felt::new(BigInteger256([
                    0x67df0b56db72418f,
                    0x5d4b5b26dfa1cb95,
                    0x23fc4632798eb08f,
                    0x2bd0bd7e546a51a0,
                ])),
                Felt::new(BigInteger256([
                    0xda2eb195a230177c,
                    0x5a9063fde8dfcb2d,
                    0xd47a390771efc7bd,
                    0x1954176aa6191d4a,
                ])),
                Felt::new(BigInteger256([
                    0x230e1314dd63ec42,
                    0x753f309ef37bba7e,
                    0xcba4d45c1addde1a,
                    0x09f04417907f41ee,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x08ee0d239dc990a2,
                    0x8c83b2af44d70ec6,
                    0x6a5932c946c2c23f,
                    0x332fc1b1a9812dae,
                ])),
                Felt::new(BigInteger256([
                    0x0f546df0f96e44a1,
                    0xe2e069e22a59fc46,
                    0x7fe6496a837e6c51,
                    0x2b13a744c86fb69c,
                ])),
                Felt::new(BigInteger256([
                    0xe530a1d1293d640d,
                    0xf5f30ffcb52063d8,
                    0xaabeb5025d226c92,
                    0x26fe34db20680fa8,
                ])),
                Felt::new(BigInteger256([
                    0x06ec410a87218650,
                    0x20249b656c988081,
                    0x85aef3176535ef45,
                    0x3162ae05b9e7ac48,
                ])),
                Felt::new(BigInteger256([
                    0x406b2a37435edf60,
                    0x1565501765a99cdf,
                    0x62a6329c925a5716,
                    0x3446c7a8ac3a6cee,
                ])),
                Felt::new(BigInteger256([
                    0x086cae8ba294e0d4,
                    0x2a85178abfe23540,
                    0x5a76f37a091b789c,
                    0x0dd08a0f4be69254,
                ])),
                Felt::new(BigInteger256([
                    0xcb7fc0450e10e62f,
                    0xd05dd48f065d6fe7,
                    0x388081fc42b4fe58,
                    0x2aab14a5a85f7086,
                ])),
                Felt::new(BigInteger256([
                    0x8b9b33fb24a1070c,
                    0x17a7a7cfd9fb68ad,
                    0x0c0cb048cf1ae285,
                    0x343a1a2a2671cf5c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3831af5dfebfa84a,
                    0x8c29f502c8aec5c0,
                    0x1ecf7c62cd51f812,
                    0x310c5525a19242f6,
                ])),
                Felt::new(BigInteger256([
                    0xe2536b74ca3f49d4,
                    0x9df82839abd1732b,
                    0x51980dead8d2d90c,
                    0x09811c2277ff38e2,
                ])),
                Felt::new(BigInteger256([
                    0xbea0513529ff92b3,
                    0x5bfa4e0499f40035,
                    0x17e9ae77d31395a0,
                    0x2abb8e8c134c6f41,
                ])),
                Felt::new(BigInteger256([
                    0x339e1c878a5ec48e,
                    0x6830b91958d48b7c,
                    0xdde3cd8a1cd2738b,
                    0x2cea1121733d6c63,
                ])),
                Felt::new(BigInteger256([
                    0xd46d6b7633c0bb04,
                    0x20f750846d5dcb64,
                    0x6e1edb952fa946e7,
                    0x25381e2986ccf5b0,
                ])),
                Felt::new(BigInteger256([
                    0x75c79efd9fda6a59,
                    0xf553d4db07c6b615,
                    0xda06355c6b088a81,
                    0x145d53dfd24e3cd5,
                ])),
                Felt::new(BigInteger256([
                    0x62c96dcb9d4ae23a,
                    0x7d0e8c5d0507c581,
                    0xddb0a651788a77a7,
                    0x049950ceb52088bc,
                ])),
                Felt::new(BigInteger256([
                    0xace430c2471b9919,
                    0x1d37b67eb54e5fb2,
                    0x6f8a17803d3d992e,
                    0x1975a329d8959f90,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xad309e3c2ceb0af7,
                    0x1be4f11d9224baf9,
                    0x8f4d616801b864a9,
                    0x33f04bddedda616d,
                ])),
                Felt::new(BigInteger256([
                    0x852cfddb33eeab0c,
                    0xa203c16d8af1b3f1,
                    0x6641b033ec603c48,
                    0x021eab480700030b,
                ])),
                Felt::new(BigInteger256([
                    0x429f065804b1f0e2,
                    0x4e7b2c1d698529f3,
                    0x1e9f0753d27d136d,
                    0x119f2d262806758f,
                ])),
                Felt::new(BigInteger256([
                    0x04cf3f7f1014e803,
                    0x0db7b6b077d55f22,
                    0x5507990f4f819ed7,
                    0x3788a723dbc442e7,
                ])),
                Felt::new(BigInteger256([
                    0xc9033cb4a9a4b1ac,
                    0xac73111530044adf,
                    0x6b33a70b73c6212d,
                    0x0269142579e3cd80,
                ])),
                Felt::new(BigInteger256([
                    0x0398199cea2cb65a,
                    0xce4d4e277106e2e7,
                    0x4972fc6af2945908,
                    0x27bcae1e26a20db2,
                ])),
                Felt::new(BigInteger256([
                    0xeca6ee664cd72848,
                    0x79d778bdc0a80b0f,
                    0x9a09a7028cf5f36e,
                    0x1af521bdf7d56f8d,
                ])),
                Felt::new(BigInteger256([
                    0x064575b206685dcb,
                    0x383034eb452c91a4,
                    0x1536e28a925ccd20,
                    0x2aa8c5051ac87cbc,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x27b1e642d8805180,
                    0x20c6e4158e3ad8c1,
                    0x3293ca30e022921e,
                    0x2990fab978b65bcf,
                ])),
                Felt::new(BigInteger256([
                    0x8ca5bf62a85d6970,
                    0x85fbb206db6ee03e,
                    0xe78a3f9eb6a4fda3,
                    0x1c98fb83dbc066c1,
                ])),
                Felt::new(BigInteger256([
                    0x7b3187fd36548e5a,
                    0x1fee4d189f534bc4,
                    0xd78f59b599eabc4e,
                    0x032eb551ff68c50b,
                ])),
                Felt::new(BigInteger256([
                    0x2273734a643b5026,
                    0x90538b115fc30d31,
                    0x4e2274251936dabc,
                    0x12a6fdc6e00cb582,
                ])),
                Felt::new(BigInteger256([
                    0xed7659c96a463ab7,
                    0x3518b67abd1c2c9b,
                    0xc3d42aa84a71827c,
                    0x0aeeee3d9b20acf6,
                ])),
                Felt::new(BigInteger256([
                    0x2c67d0ebd67c0793,
                    0x35e8e79496977b19,
                    0x00a20c0e7a1a8f30,
                    0x0a59202017e27363,
                ])),
                Felt::new(BigInteger256([
                    0xa54295e80425aca2,
                    0xc37e85753609b809,
                    0xae08e4f41be6ab14,
                    0x21d101fe946bd005,
                ])),
                Felt::new(BigInteger256([
                    0x26781daf3068ddff,
                    0xcc73f614f944e9bc,
                    0xef40ff49e480a5f7,
                    0x1bb1ab6c535472b4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xfcf7f2b0e6f9fc3a,
                    0x6c4f32e9823a2f8e,
                    0x70b92bd65be6f99f,
                    0x31ab56a89eadd1f6,
                ])),
                Felt::new(BigInteger256([
                    0x267f6e8f39df92e7,
                    0xfe9bdd7a7d2f0829,
                    0xadeef9c88f1acebb,
                    0x0db0655684d4100b,
                ])),
                Felt::new(BigInteger256([
                    0x4e379d1d3ab38239,
                    0x8477e46b0fb90a2a,
                    0xcba4833ac3193f32,
                    0x10dbbc3dbb4a4da4,
                ])),
                Felt::new(BigInteger256([
                    0x713aff56f10f1f34,
                    0x2b18288be822118c,
                    0xb43e768f519aaf2f,
                    0x3dc54a6167c3c350,
                ])),
                Felt::new(BigInteger256([
                    0x47f23ffbd6f629a9,
                    0xbd6985996139db5e,
                    0xba60ba178a334ef2,
                    0x1903f6ccf64b0b82,
                ])),
                Felt::new(BigInteger256([
                    0x5afc81cd4210f5d2,
                    0xc053bf8c4ff1f08e,
                    0xa462f44e2b8661b9,
                    0x3513beb32f5e4b0e,
                ])),
                Felt::new(BigInteger256([
                    0x0b0d4c9c62e5f7ba,
                    0x20149bc20ba1ec9a,
                    0x98ed046e194a32ef,
                    0x23701155f0c6b2d1,
                ])),
                Felt::new(BigInteger256([
                    0xc4d51dba3b5bd615,
                    0xccd74f4007f19b3d,
                    0x140919a0a72b1329,
                    0x231960022f4e68c4,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xad3901abedfcc821,
                    0x2f80f0ff62c132d5,
                    0x937ed9f4bafd8798,
                    0x313dc8897f006e9d,
                ])),
                Felt::new(BigInteger256([
                    0x7874550d1ce0a5ca,
                    0xf8f5c0f9c55cea6b,
                    0x3d503c16683536ae,
                    0x062168438205f6a9,
                ])),
                Felt::new(BigInteger256([
                    0x886a7ef6a546f37b,
                    0x2224aaa225bb9369,
                    0x0986e9c4a360fb6a,
                    0x1cadc7d763ac131f,
                ])),
                Felt::new(BigInteger256([
                    0xcb2bdb439db57ea3,
                    0xcbc61390f398e65e,
                    0xcad0abb866c25c30,
                    0x1cf159578354d7a8,
                ])),
                Felt::new(BigInteger256([
                    0xf7ba13b265839b7e,
                    0x06c5ecbd83de419f,
                    0x345edc4d2f57c3ff,
                    0x161bf0c24beb2ee9,
                ])),
                Felt::new(BigInteger256([
                    0xf7ad128c4dc9fc6b,
                    0xfb3ef0746d2bce04,
                    0x3ae107e040f5ae71,
                    0x0e260c06f36991d6,
                ])),
                Felt::new(BigInteger256([
                    0xc8f82d223621792c,
                    0x12ec4eca4294373f,
                    0x607727d6b2369396,
                    0x36ef92d487810ddd,
                ])),
                Felt::new(BigInteger256([
                    0x771edb966c8cf383,
                    0x452eb3e997cfc335,
                    0x7a97c4c6662a7fe9,
                    0x375ee02e5f39666c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xccefd3ba361c6e34,
                    0xae886c8e3f1bdbea,
                    0x43f9d9fc0d9a64ee,
                    0x054fc1f1f6a3b9da,
                ])),
                Felt::new(BigInteger256([
                    0xf236ab7e344d734f,
                    0xbb690d7d91802257,
                    0xdb6dda192e1f37ca,
                    0x37bdcf6ca7ffc9de,
                ])),
                Felt::new(BigInteger256([
                    0x61729345df877621,
                    0x0a03f38df13411c9,
                    0x10e49b70c32d07b8,
                    0x013512239adeaf0d,
                ])),
                Felt::new(BigInteger256([
                    0xaf29c521f1385fdd,
                    0xd7ae16b5ee1da833,
                    0xe161f5c55093d2f2,
                    0x124c23deaadbef0a,
                ])),
                Felt::new(BigInteger256([
                    0xd0cb501736d60319,
                    0xd0e855bc87a7cdaf,
                    0x37015f413c4586cf,
                    0x017fbd096a884ec2,
                ])),
                Felt::new(BigInteger256([
                    0xcdf9128f00ff1a2f,
                    0x862a0ea392375325,
                    0x27fc99f6c2d28e9d,
                    0x3459c143302df782,
                ])),
                Felt::new(BigInteger256([
                    0x4d28419255dd6618,
                    0x4d043819b10efda9,
                    0xd16172539af69cb1,
                    0x36f0cc8e6bafbefa,
                ])),
                Felt::new(BigInteger256([
                    0xbdbc2a8350e2fc0f,
                    0x1b082b7440354f77,
                    0x25465d8b5ba1df2e,
                    0x2fff019b19349ca3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x4c826198edd79c76,
                    0xe56e6b4527f8afde,
                    0x53c6808c18a4a45e,
                    0x377368d7b5c0b5bd,
                ])),
                Felt::new(BigInteger256([
                    0x036333760692b3d6,
                    0xca89604c3789e2c1,
                    0x526374b2912bd985,
                    0x1f19644378cf9f38,
                ])),
                Felt::new(BigInteger256([
                    0xd181a2b38de0d0ae,
                    0x5b81df7850486926,
                    0x7a46fbd0cf65208a,
                    0x05aa47a55083d9ef,
                ])),
                Felt::new(BigInteger256([
                    0xd95d937defbcc623,
                    0x166b903a412f0808,
                    0xe8cce7cd60e2bc55,
                    0x2016227daeaca27f,
                ])),
                Felt::new(BigInteger256([
                    0xce9954f3ea28d301,
                    0xdea07406b5065305,
                    0xacb640c2667b5b1c,
                    0x1e7743f3f931d33b,
                ])),
                Felt::new(BigInteger256([
                    0xef3b4ead5aeab0a6,
                    0xb1ff9bf2d44ce0a3,
                    0xa77305bc525e61cc,
                    0x10b4efbad9c6092f,
                ])),
                Felt::new(BigInteger256([
                    0xf249ca22f79d2318,
                    0x1d80990e1039d8c6,
                    0x88a054dbde085f5e,
                    0x1e1dc460cb812288,
                ])),
                Felt::new(BigInteger256([
                    0xe22c01d476ee55b7,
                    0x06aeb6b13ff457b8,
                    0x2c5bbeb8a74f136a,
                    0x1897f2e13d8d1cf0,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x16eed0cace6d04d1,
                    0x6cb3f1d01a5a6bf8,
                    0x27eccee16a094c3b,
                    0x269353d912f7f790,
                ])),
                Felt::new(BigInteger256([
                    0x81913c54d0c516af,
                    0x7672c566bef7bf9b,
                    0x7432df3baad23ea7,
                    0x2964c464c63790da,
                ])),
                Felt::new(BigInteger256([
                    0xb413bc32a5eb3a99,
                    0x43722dfaa792e6da,
                    0x5d78b8628f71ee5f,
                    0x195e9ec1a52f5c20,
                ])),
                Felt::new(BigInteger256([
                    0x04e2a10d238bf42c,
                    0x622db1c06d5bfc2b,
                    0x82746e925378bdf3,
                    0x15ff6b30a43c67e3,
                ])),
                Felt::new(BigInteger256([
                    0xbca906f8de0f2f0f,
                    0x109fd164ef35e8d9,
                    0xfda4770e091e05fb,
                    0x2b8bd014ffcabee3,
                ])),
                Felt::new(BigInteger256([
                    0xd4cfd39aad9e4e9b,
                    0xe6e442389f697e56,
                    0x8885ef8a39ea37a1,
                    0x3955b7431b9db2d8,
                ])),
                Felt::new(BigInteger256([
                    0xef4f69b80ac02efd,
                    0xd9a1b995c52ddc42,
                    0x6d144f5eadc5652e,
                    0x3b0bb62aaceec990,
                ])),
                Felt::new(BigInteger256([
                    0x0847fb1e8143b655,
                    0x8616d20fbe99a204,
                    0x59b159c70bca2d19,
                    0x03cba1fd6a22d6a2,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x19fda01c1738a8d3,
                    0x0b981b21927ad916,
                    0x34c7e57ebc26d109,
                    0x090971a1f24f8e95,
                ])),
                Felt::new(BigInteger256([
                    0x73eaea6d1a3bdc65,
                    0x31817483a495288d,
                    0xd6df218d7d36b07b,
                    0x1a3ba86aab231e73,
                ])),
                Felt::new(BigInteger256([
                    0x8bbaa30b644041e4,
                    0x9ce862c3c1ab76c8,
                    0x8975eef162d3ee3d,
                    0x3a2083d8baba07ed,
                ])),
                Felt::new(BigInteger256([
                    0x49c61e03994a0b81,
                    0x13e96b907f80a443,
                    0x0d6afef9fc6a964f,
                    0x24aa24231073c17c,
                ])),
                Felt::new(BigInteger256([
                    0x905eb802c4efb1c6,
                    0xc4543c76a0358263,
                    0x8f544e9a2509bb65,
                    0x16e19d37c76c2f21,
                ])),
                Felt::new(BigInteger256([
                    0xc8120fe48ef3acd8,
                    0x7913ab4e53bcb53b,
                    0xe4bc63557f2572b0,
                    0x097b06e29c583762,
                ])),
                Felt::new(BigInteger256([
                    0x80953676ea47016c,
                    0x9d81b9cd6586650b,
                    0xd10b457554ddab8c,
                    0x026d310df204f5da,
                ])),
                Felt::new(BigInteger256([
                    0xdbc29d506f3eeddf,
                    0xee7023ba4881b48f,
                    0xc1f64f9be2bcc892,
                    0x3f1d8ca1f623f88f,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x36b2d8b0576aebac,
                    0xc786f192a24b03ef,
                    0xe9a877061cb34632,
                    0x03ba4a14ad23b22a,
                ])),
                Felt::new(BigInteger256([
                    0x1487226238c27368,
                    0xb3912bfd4961a9ae,
                    0xfa0afd379e9b16c1,
                    0x26d5cce02b6f89ed,
                ])),
                Felt::new(BigInteger256([
                    0xba9e618e4204a92b,
                    0xa841428f7c9be483,
                    0x1fdcd3e06fc599d0,
                    0x3382a67530fc3715,
                ])),
                Felt::new(BigInteger256([
                    0x245987db7bcac62d,
                    0x2597992a25ead986,
                    0x4e16377c4e2ba0c5,
                    0x01485f69808b242a,
                ])),
                Felt::new(BigInteger256([
                    0xb217a221d9d96512,
                    0x1e6b8c3cfb9a6258,
                    0x6cb1c3f3298c9aa5,
                    0x14ad7bfdfc328ffc,
                ])),
                Felt::new(BigInteger256([
                    0xaa60538cd1e34db1,
                    0xe94726d09b3988c9,
                    0xde062acf00952c2f,
                    0x1a8c3e5ca8c16e2a,
                ])),
                Felt::new(BigInteger256([
                    0x2370ca88a9d09ce7,
                    0x31beb057e5788fd4,
                    0x4b9c1d7a4de41edc,
                    0x0230640799d45df7,
                ])),
                Felt::new(BigInteger256([
                    0x521cc67aa28baa3b,
                    0x6179b2e0e1b1d8d0,
                    0x0472ab60aae17a93,
                    0x05428b09968b0dee,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x3d93908a59bcf5ed,
                    0x0e5b515de3d2a65a,
                    0xae5858d20c5bdf60,
                    0x0e46dc465cef45e8,
                ])),
                Felt::new(BigInteger256([
                    0x2977ea1515b43952,
                    0x9c327169f17e0cb5,
                    0x51ebb388ac2f39ae,
                    0x2b28586de3924324,
                ])),
                Felt::new(BigInteger256([
                    0x7d3506ff77abc4ff,
                    0xc8cdb6d4fc2948cc,
                    0x310a39c9c1b48ffb,
                    0x02a53b5a1d64e0d8,
                ])),
                Felt::new(BigInteger256([
                    0x818d443ad8ed2f73,
                    0xfa449c49c87b6631,
                    0x9954981dde9dd216,
                    0x1313aeed07f968bb,
                ])),
                Felt::new(BigInteger256([
                    0xe8c54e6d7a93309e,
                    0x0ff723be2ed2e803,
                    0xb9c36174fbecdf4a,
                    0x27c8429fd36c49c4,
                ])),
                Felt::new(BigInteger256([
                    0x01965d10861041f6,
                    0x77eb120149465860,
                    0x2ada837545559bbb,
                    0x2a9d435c6c1f1c39,
                ])),
                Felt::new(BigInteger256([
                    0xc34e5fd773a916c1,
                    0xb1dde30f316403ee,
                    0xab65c4538cff9b15,
                    0x20e70d38390e522c,
                ])),
                Felt::new(BigInteger256([
                    0x3c5d076d54baebac,
                    0x0f1b049dba795fcd,
                    0xb09a78fae9cc0997,
                    0x3382d03bd1f2e7a6,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x7db96009ac1fbffa,
                    0xac28b1ab8b158c57,
                    0x2621c4fe3b4fddb2,
                    0x2759cc1570fc1268,
                ])),
                Felt::new(BigInteger256([
                    0xe10487a0aa29c723,
                    0x83b102d060a5f289,
                    0xae4a09d9b57c6c41,
                    0x0cc3385791d5147e,
                ])),
                Felt::new(BigInteger256([
                    0x8e8c0c16f17a48bb,
                    0x6c0be9102320b24d,
                    0x8f509f410297e324,
                    0x3e591a9aa124061b,
                ])),
                Felt::new(BigInteger256([
                    0xbc5c2e302a26cd3d,
                    0x6cb290d84828c5b1,
                    0x85cfc8ec718e185c,
                    0x21ad9607397474a3,
                ])),
                Felt::new(BigInteger256([
                    0x9cf714e2623b6b3d,
                    0x4058a5164218ced4,
                    0xbb71337ba8c5334c,
                    0x36287acd160a4124,
                ])),
                Felt::new(BigInteger256([
                    0x259cdfc670a720d6,
                    0x32bb936c93d78276,
                    0xd33b148dc3adb95f,
                    0x3f44a88efc9de39a,
                ])),
                Felt::new(BigInteger256([
                    0x81a17fe77665ce9d,
                    0xa7114bd455b4a7db,
                    0xfa96bf8d8b9460ed,
                    0x14e20e379758359e,
                ])),
                Felt::new(BigInteger256([
                    0x279e8fdecacdcefa,
                    0x5aeae8b2e7312b24,
                    0x9cfeb52338454c43,
                    0x2ea14de9b9662518,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe7e4d395c5d3ef12,
                    0x4b8a93e2f5dee5fb,
                    0x7acf9f6da5737ded,
                    0x29c408a559eacd90,
                ])),
                Felt::new(BigInteger256([
                    0x618e8f7a41c0762a,
                    0x49cce9287e5afc3b,
                    0xc7e0f62655de1bd6,
                    0x0c2050e590139f32,
                ])),
                Felt::new(BigInteger256([
                    0xf9e3b026480414e5,
                    0x7ebeceb982b5d7f4,
                    0x796296ac89492831,
                    0x2640062c3fbd7faa,
                ])),
                Felt::new(BigInteger256([
                    0x5a4ba0e0f5072368,
                    0x67da4f01d32979e4,
                    0x67a17eeb467b9492,
                    0x09670697dfe41232,
                ])),
                Felt::new(BigInteger256([
                    0xa0356ea9bc40422e,
                    0xb069677a403b67fa,
                    0x0d64ab3eaeeadfc6,
                    0x379a87db2347782e,
                ])),
                Felt::new(BigInteger256([
                    0xf096f40f21bc8484,
                    0x7a2e0b701a65ac10,
                    0xc36b4aa60374414a,
                    0x23763828ad1d8ab0,
                ])),
                Felt::new(BigInteger256([
                    0x0d7ed6523ad113e8,
                    0xf8bbf79d353a5886,
                    0xa3c00740811afd61,
                    0x38b3f47811e1d15f,
                ])),
                Felt::new(BigInteger256([
                    0x88e781e9e98a2c64,
                    0x0f9f3316e108bb13,
                    0xe68a31be215c538a,
                    0x26155ac675325561,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd33b211d8da52246,
                    0x07aa7200451c3d16,
                    0xe9b9e2a6ac58d1fe,
                    0x04c2fcbf1a8ffb07,
                ])),
                Felt::new(BigInteger256([
                    0xc446a91a0d2adf62,
                    0xa681e306d66534e0,
                    0x7274ef96cba43d41,
                    0x1df7caaaf1b23c22,
                ])),
                Felt::new(BigInteger256([
                    0x86c54f6e378b5da1,
                    0x6088b8060e2a5d71,
                    0x87c14786f82bd40f,
                    0x35f2d6918acc332f,
                ])),
                Felt::new(BigInteger256([
                    0x14cfc61b6f6a3186,
                    0xc8b963999c6b0694,
                    0xc93ddd55ca1c44bd,
                    0x3701585dd3e92775,
                ])),
                Felt::new(BigInteger256([
                    0x8565ca86868f28b4,
                    0x440b33989350d975,
                    0x320fca9234fa6a3f,
                    0x12e9e6dba0cc5642,
                ])),
                Felt::new(BigInteger256([
                    0x5e3c969834fd028f,
                    0x4573f5960020ffa0,
                    0x337082ec74636ae6,
                    0x1a0f01b86f348ef8,
                ])),
                Felt::new(BigInteger256([
                    0xa3e600f4fa241c92,
                    0x2388a065345025ea,
                    0xc8fc307bfc1e76ea,
                    0x1c85d3d40f7bc5d5,
                ])),
                Felt::new(BigInteger256([
                    0xad2f31aa815f6db6,
                    0x75c1b27f5d9b40b7,
                    0x62de539c31a5e558,
                    0x03ed77c75d527911,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x603e1f158ed257f3,
                    0xfba294a3e186db61,
                    0xbf8e7c28785c8d41,
                    0x37f2a6674e4b5262,
                ])),
                Felt::new(BigInteger256([
                    0x780375814b6ce903,
                    0xbaa50bf86ca2b7dc,
                    0x4e93e764413fb1e9,
                    0x247b3bdf0d6d0bdb,
                ])),
                Felt::new(BigInteger256([
                    0x5c83b1e62356cd48,
                    0x4af68f37471e6e9c,
                    0x5faaf4f813d205c7,
                    0x1265ceeadee7a6de,
                ])),
                Felt::new(BigInteger256([
                    0xbf690ee67bbe94c7,
                    0x519801180151b919,
                    0x37f2bd8bb77d3f16,
                    0x38641d83cdd0c49f,
                ])),
                Felt::new(BigInteger256([
                    0xd1ea2056725ce60b,
                    0xeb76723a46655bcf,
                    0x7a04db0434dcf014,
                    0x180e3dc93e6c225b,
                ])),
                Felt::new(BigInteger256([
                    0xf551c89857ca0184,
                    0xde695de8251d232b,
                    0x41f08a1d66f9a976,
                    0x07538c6b8509564d,
                ])),
                Felt::new(BigInteger256([
                    0x671468b5c0227d9e,
                    0x3db316405c625bb4,
                    0x0c761dd2a71fe107,
                    0x3d746fca740c74f9,
                ])),
                Felt::new(BigInteger256([
                    0x2f6c8b71c841fc31,
                    0x4120e8ea27002806,
                    0x813e9b63ccbbd2ae,
                    0x1ee3ac48f6ccb110,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x415bf6668f3c659b,
                    0xc858a1d26b60d9cf,
                    0xc98bcc1c680d762e,
                    0x1544a27577e512d9,
                ])),
                Felt::new(BigInteger256([
                    0xc5e2e7b69c95d845,
                    0x83fab4e8b7ee3969,
                    0xfeafcbe44c7c438d,
                    0x372994e7af7d14b7,
                ])),
                Felt::new(BigInteger256([
                    0x7341ebc76a62ada8,
                    0x1f93c84b68cc7ee9,
                    0x237a9d7f70343826,
                    0x1387ab31ecf01fc2,
                ])),
                Felt::new(BigInteger256([
                    0xefa6cc36411d67ff,
                    0x7d58c86081aaad69,
                    0xff1b4ff108a1dbbf,
                    0x38b33da623c8b560,
                ])),
                Felt::new(BigInteger256([
                    0x126ea37c40598325,
                    0xa55d1cb8f84270f7,
                    0x0f54194760ce9b0d,
                    0x31081e901493bc5b,
                ])),
                Felt::new(BigInteger256([
                    0x4b398d3c18b6fa9c,
                    0x3d773e1af1c5e710,
                    0x9e8c4b722b053d7f,
                    0x017da56faca7a4a5,
                ])),
                Felt::new(BigInteger256([
                    0xd71e684d8f649078,
                    0x584c5f4b854f8f78,
                    0x69183f29063796db,
                    0x16552e1ffd93616a,
                ])),
                Felt::new(BigInteger256([
                    0x847a495728520965,
                    0x1a36ff6bebbd1379,
                    0x826892955ec2cc65,
                    0x334a2f9c84f3d4a8,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x324c908b6ef3140e,
                    0xdb849c87357d8005,
                    0x8db8a78c371323d4,
                    0x3dd5823d6d3448a5,
                ])),
                Felt::new(BigInteger256([
                    0x05a819a66eca638f,
                    0x4899e83204e49cd6,
                    0x5d1f9a8a7d84f9b7,
                    0x155dc80bc696771b,
                ])),
                Felt::new(BigInteger256([
                    0x3a6703ba6f487ec0,
                    0x17a30e72a4b7cfe0,
                    0xcfaaff58fefceef1,
                    0x10f77a8299e3b782,
                ])),
                Felt::new(BigInteger256([
                    0xb931454275162fb7,
                    0x7f2d09cbfa0b87f9,
                    0x28617d6fb0687334,
                    0x301538afb7b55ea2,
                ])),
                Felt::new(BigInteger256([
                    0x53546021488d57e4,
                    0xe7b7344fa31a1bfa,
                    0x4312619a0fefcaa1,
                    0x387ef0f7fd51005e,
                ])),
                Felt::new(BigInteger256([
                    0xbaefa551e61bb84b,
                    0xd65a5070c39176b2,
                    0x6447de269946338c,
                    0x2f1adee2400ffc2d,
                ])),
                Felt::new(BigInteger256([
                    0x9352d12b9747b91d,
                    0xf625783591d4bdeb,
                    0xf775c4555bab9fbb,
                    0x02203e7ee7ec6a34,
                ])),
                Felt::new(BigInteger256([
                    0xe455089ba3bf440e,
                    0xd8acf27bf62601c6,
                    0x2c1729fb2786bc00,
                    0x19dcc67f0aa07220,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd7c6f8dc333fd89b,
                    0xc98bc33b93b3d196,
                    0xa58008fbc0f850be,
                    0x140e914c20f4f31b,
                ])),
                Felt::new(BigInteger256([
                    0xef3a6cc138879b65,
                    0x29d83e56ab72a9b4,
                    0x41cac206000bb4ef,
                    0x3f319a4a5e6f5ab0,
                ])),
                Felt::new(BigInteger256([
                    0xdd042aa25b9149e6,
                    0x6ddf969afa2d5de3,
                    0x70b687e22fdfae24,
                    0x1f400d6b404b8e7b,
                ])),
                Felt::new(BigInteger256([
                    0x0923e9ac0cd64965,
                    0x9c64768f51522d41,
                    0x516adc1fe683dadf,
                    0x3a4d3d74687f2a41,
                ])),
                Felt::new(BigInteger256([
                    0x0a8e2db718381b8d,
                    0xceb3257c07839863,
                    0x6cf31cf96e5c7cbd,
                    0x3481e96e95e12487,
                ])),
                Felt::new(BigInteger256([
                    0xd11af003d9a0e097,
                    0x006c2560ff009a11,
                    0xba44e992097373fa,
                    0x0bb73ac4b2972de7,
                ])),
                Felt::new(BigInteger256([
                    0x6dcb21faa875b47d,
                    0x0b85df25e1092c00,
                    0x1b23a0b3ea591189,
                    0x2b5c081cb0ac229a,
                ])),
                Felt::new(BigInteger256([
                    0x22539996fdb43401,
                    0x3dd75ef68ef171f3,
                    0x2d7d74fda36c3389,
                    0x0f6bf61c8fb9e3cd,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd846d0f6818ecd8a,
                    0xdbf4a2926adc8b14,
                    0x8f29d04ab77fd4c5,
                    0x20c92ddb58886211,
                ])),
                Felt::new(BigInteger256([
                    0xa8df5b853da73469,
                    0xd7f3dec0f95b0b33,
                    0xb6e3665a7754e2b8,
                    0x0cdbc09cc7788138,
                ])),
                Felt::new(BigInteger256([
                    0x1a0bed9ec3accc1b,
                    0x9156b93a02b86256,
                    0x6a6a2ba3bb26a7b6,
                    0x21f6ec4c58ee8bea,
                ])),
                Felt::new(BigInteger256([
                    0x3d1e9d739c7beb1a,
                    0xa569fedd5df38b9f,
                    0x443e3b19e6936a29,
                    0x37a5f429ca649414,
                ])),
                Felt::new(BigInteger256([
                    0x47d530d5bf9724c1,
                    0x512b1928872fc815,
                    0x5d95c7191b7a3228,
                    0x0c1d602112c976be,
                ])),
                Felt::new(BigInteger256([
                    0x74f89ed2bfe92831,
                    0xee2b1afaec9674e0,
                    0x408ba9ebc3c5a47f,
                    0x23c6191c43993ebe,
                ])),
                Felt::new(BigInteger256([
                    0x920c07715cdf9bdb,
                    0xeda36be3abb9b846,
                    0x4a2134b92cdab103,
                    0x33d2e59befcf2410,
                ])),
                Felt::new(BigInteger256([
                    0x150e0bfe4a9b6103,
                    0x2df1c8050b237e26,
                    0x6ed30bd861314b4c,
                    0x108ac71ff10dbb3e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe1db693b1f722a4a,
                    0x43f7bb733a17ba47,
                    0x2d73387f3d9abd88,
                    0x1956a76d9e482911,
                ])),
                Felt::new(BigInteger256([
                    0xbb4fb0ed76fad8bc,
                    0x21c36708d630715b,
                    0x110b65cc32299c00,
                    0x1ad4422346c074fc,
                ])),
                Felt::new(BigInteger256([
                    0x70f611e9f258b01a,
                    0x8bf8009cb79a290b,
                    0x3fc6ff8a6c8bedb7,
                    0x2438621fb4ba8315,
                ])),
                Felt::new(BigInteger256([
                    0x20ac8fa594ec6415,
                    0x0cbafd3c44230f5f,
                    0xc39b31085fa84e84,
                    0x3dfde4ddaf7c645a,
                ])),
                Felt::new(BigInteger256([
                    0xcdd4c597397e9e09,
                    0x328dd27cc96a8193,
                    0xd2003cbc5e3bc259,
                    0x3766d1dfc2b53e9c,
                ])),
                Felt::new(BigInteger256([
                    0x0b95865a4d53eaf8,
                    0x03e90b77af9bfe9a,
                    0x0b6e219059ed50b4,
                    0x0ac3b7f8c559b08b,
                ])),
                Felt::new(BigInteger256([
                    0x3fe3585042f66c10,
                    0x3a57cef61aa2a291,
                    0x35da983c6c33702b,
                    0x09f1bba58154c6bc,
                ])),
                Felt::new(BigInteger256([
                    0x6005913eabb3625d,
                    0xd826f71134703936,
                    0xf22f8858c5bf95a9,
                    0x1b38e479dcf33ce4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc02ebada6ecab846,
                    0x1387b42a7a863606,
                    0x8d1a6514f867110f,
                    0x08c7abcafe73b2fa,
                ])),
                Felt::new(BigInteger256([
                    0xf03f0f43ee871920,
                    0x03bd7137a96ddcb9,
                    0x8faf2084bfce7d70,
                    0x17d362654988cb65,
                ])),
                Felt::new(BigInteger256([
                    0x6f24b81359fba1cf,
                    0x8436c4ad73c440d5,
                    0x10b71efc8103ab8c,
                    0x2b7998e0a6cd76a9,
                ])),
                Felt::new(BigInteger256([
                    0xef76294b2dc591d3,
                    0xe251106fb8400678,
                    0x0bb914604ff18bfe,
                    0x0f5134ae96de4ed0,
                ])),
                Felt::new(BigInteger256([
                    0x6ab9ae81fdb35e5a,
                    0xd8ceb14815652180,
                    0x75068d1559b4bd70,
                    0x0ac7bd854770353f,
                ])),
                Felt::new(BigInteger256([
                    0x6e464160b24ea9e1,
                    0x81a86fcb024e1669,
                    0x2c020913b6032c6b,
                    0x2cc081950ed0c30c,
                ])),
                Felt::new(BigInteger256([
                    0xc6c5933fcc87caa8,
                    0xa2af99af651b7aad,
                    0x056223ee6a67f978,
                    0x26c0c045c0765913,
                ])),
                Felt::new(BigInteger256([
                    0x0cc0d0bde7aec00a,
                    0xa5726b60b4c71a28,
                    0x770cafc9d51161fb,
                    0x3abde85c63494ffa,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3e47e273943fe371,
                    0x77cf1fcde8fb5bbb,
                    0x6e9836a88f256efa,
                    0x1d64ac1be86fb8d9,
                ])),
                Felt::new(BigInteger256([
                    0xa556eac2a108cdf1,
                    0x21e76a6e6ef8a2ce,
                    0x524cf3df200e3740,
                    0x2f74f9ee5d47ce8c,
                ])),
                Felt::new(BigInteger256([
                    0xd520b57f389b285f,
                    0xd425085f9fff6130,
                    0xabf0553745728201,
                    0x1e7e852f9c3a3d44,
                ])),
                Felt::new(BigInteger256([
                    0x21ecaec0b07880c9,
                    0x82da6af1da169981,
                    0x56dd7e9d1e77eb66,
                    0x143efe93d1233413,
                ])),
                Felt::new(BigInteger256([
                    0xe5e5e6d9806c1c15,
                    0xd8aaa5bc31ec181f,
                    0xedcd21b80e29cbdf,
                    0x3d18410e9dc1c235,
                ])),
                Felt::new(BigInteger256([
                    0x17912c1eed6c4229,
                    0xdb441c548db855a1,
                    0x839b4a864f782312,
                    0x1256fd8393b49281,
                ])),
                Felt::new(BigInteger256([
                    0xed306bbc151bb129,
                    0xbaa3acfadc2ead25,
                    0x9d72b369728b2b8d,
                    0x2d119004a02dd65b,
                ])),
                Felt::new(BigInteger256([
                    0xd884c33f094f569b,
                    0x04060a8161b2ee71,
                    0x2357f00765288cb2,
                    0x253e816d057c9ce1,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
