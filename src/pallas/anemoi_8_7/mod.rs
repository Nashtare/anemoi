//! Implementation of the Anemoi permutation

use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 8 field elements or 256 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 8;
/// 7 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 7;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 4;

/// 1 element (32-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t -= mul_by_generator(&y2);
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t += mul_by_generator(&y2) + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    apply_mds_internal(&mut state[..NUM_COLUMNS]);
    state[NUM_COLUMNS..].rotate_left(1);
    apply_mds_internal(&mut state[NUM_COLUMNS..]);
}

#[inline(always)]
fn apply_mds_internal(state: &mut [Felt]) {
    state[0] += state[1];
    state[2] += state[3];
    state[3] += mul_by_generator(&state[0]);
    state[1] = mul_by_generator(&(state[1] + state[2]));
    state[0] += state[1];
    state[2] += mul_by_generator(&state[3]);
    state[1] += state[2];
    state[3] += state[0];
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies an Anemoi permutation to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Applies an Anemoi round to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x1e8a3d280e020c6f,
                    0x22c449b76530d63e,
                    0xde9c7cf83a9b8944,
                    0x303d527e1ca67941,
                ])),
                Felt::new(BigInteger256([
                    0xca826ef90c5a285a,
                    0xeeb9ae9b16cbf20b,
                    0xeebe98287f4bf777,
                    0x0d54799106a5aced,
                ])),
                Felt::new(BigInteger256([
                    0x2ef577834407896a,
                    0x17e358582144a318,
                    0xa8dd732630a83f3d,
                    0x2f6937d29e088f8f,
                ])),
                Felt::new(BigInteger256([
                    0x67a88dd767231467,
                    0x784143e48eeafd60,
                    0xf685929c681588cb,
                    0x1c54e5451b0ff2fc,
                ])),
                Felt::new(BigInteger256([
                    0x39d7cbb09e276704,
                    0xc53913ab0bc6569e,
                    0x3b1ed2dd00765b70,
                    0x16ea2fd59d0d118f,
                ])),
                Felt::new(BigInteger256([
                    0xb4c8e72055c053aa,
                    0xa41e63dd77cc9d49,
                    0xc9a5bf673f510635,
                    0x38a528304f30de0b,
                ])),
                Felt::new(BigInteger256([
                    0xd4bb21536c5c25dc,
                    0xf6c92c11085e8534,
                    0xfbf9d11d1d3bb163,
                    0x3a8bf22cc344102a,
                ])),
                Felt::new(BigInteger256([
                    0x34a08f3ea0d73e4c,
                    0x5fa77278bbd65fc2,
                    0x768423bec0cae271,
                    0x31e5d1f0de5a611a,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x9cfc5d2873b52e98,
                    0x4c55ccb3806c8c43,
                    0xf297ea1e47aacc2c,
                    0x2e9330cd57bdb9fa,
                ])),
                Felt::new(BigInteger256([
                    0x16e88eada5acadbe,
                    0xce593d8058ce45ce,
                    0x6edcc40ca360f828,
                    0x3dac3b0e562c5475,
                ])),
                Felt::new(BigInteger256([
                    0xd0bb87fad40341dc,
                    0xd838f9b7959e3329,
                    0xc68b662c653f0309,
                    0x35c9c9e4de5ccad7,
                ])),
                Felt::new(BigInteger256([
                    0xf09a57d5eef0e527,
                    0x62cd8a763240e78a,
                    0xac2249f5a5d45c50,
                    0x2786b68f2342e386,
                ])),
                Felt::new(BigInteger256([
                    0xdcab6b5f3c8c31ab,
                    0x8eda696b7e4fb64e,
                    0x5823c5401e58e874,
                    0x068122b3c0a84f93,
                ])),
                Felt::new(BigInteger256([
                    0xe6ff5589618fd834,
                    0x4a74b4ab05b550ad,
                    0x1df6959dbc122b83,
                    0x2797b70c028533f8,
                ])),
                Felt::new(BigInteger256([
                    0x769d235308a693c0,
                    0x7b9613cb896f33ec,
                    0x89dc2a2f9279230c,
                    0x0e3a3b8a27aeebc4,
                ])),
                Felt::new(BigInteger256([
                    0xb78cde4e37446282,
                    0xaea2a02cbed1577a,
                    0x48df25b85ebceafc,
                    0x20c6b51d52e09b79,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x133112fe9f35366c,
                    0xb831223933eeb250,
                    0x31d0ffb33b9ebd1a,
                    0x29d53dbc75924cca,
                ])),
                Felt::new(BigInteger256([
                    0xb36eeb17bed6e75f,
                    0xf78371e9923427ba,
                    0xec22d50f270af7ce,
                    0x342a7b95b126fd29,
                ])),
                Felt::new(BigInteger256([
                    0xa736bf7c68783786,
                    0xe089254c22505786,
                    0xa9d4dee962ba7c48,
                    0x0dea1f3c85922265,
                ])),
                Felt::new(BigInteger256([
                    0x146e2cf54748249e,
                    0x13b791aa19d3838a,
                    0x604f61e8e95c10dd,
                    0x3af808fbc7b6c3c7,
                ])),
                Felt::new(BigInteger256([
                    0xa02a945cc187e2b6,
                    0x8a057d36fc1705f6,
                    0xfde53f1f434498aa,
                    0x0169d56cb4161063,
                ])),
                Felt::new(BigInteger256([
                    0x9390bc68c542e592,
                    0xded0537e857c371e,
                    0x7854132c9c0672ed,
                    0x0c86dd5ed553317c,
                ])),
                Felt::new(BigInteger256([
                    0x4fc9d9ebf17c9893,
                    0xd9d99639b0dc5c4d,
                    0xcd51f1e7d8e841a7,
                    0x3889be140ca890b6,
                ])),
                Felt::new(BigInteger256([
                    0x5360baa3e27d0ca0,
                    0x0daf8b2fc5920fa5,
                    0x3a07080e608f25e6,
                    0x2734b28fbcdd4af6,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x8937273640e7edf2,
                    0xb103f69699578b37,
                    0xbaaf7f78b6444cba,
                    0x397e087be28194a2,
                ])),
                Felt::new(BigInteger256([
                    0x30464b316a8a9149,
                    0x83092d895e01d73c,
                    0x9ccc6d50ab758311,
                    0x38980e7115fea016,
                ])),
                Felt::new(BigInteger256([
                    0x5d301855c6770b19,
                    0x460d02a78424affe,
                    0x49c2f0a26e0f33f0,
                    0x03a8ee1d8e988600,
                ])),
                Felt::new(BigInteger256([
                    0x13b79c28ad79ae3d,
                    0xb914f087f6f2cd8a,
                    0x2d5b71e815fb3c4f,
                    0x1205b8a09b4e9459,
                ])),
                Felt::new(BigInteger256([
                    0x963eb87c3a8073f4,
                    0x7ca20b83d2093eae,
                    0x3b98aa57c944e974,
                    0x26371ecb17400812,
                ])),
                Felt::new(BigInteger256([
                    0x7c7b9ff3d157f417,
                    0xa5999390f98cc66c,
                    0x9c486671a17ff779,
                    0x0f5f4f2be0974032,
                ])),
                Felt::new(BigInteger256([
                    0x75051017692f1e21,
                    0x400b057d529b0afa,
                    0xb2e4cacaacc4efa8,
                    0x2d20c6a1dff73a53,
                ])),
                Felt::new(BigInteger256([
                    0x954828b1c74ab707,
                    0x707437933228ff86,
                    0xd18d951374079f60,
                    0x30be4a4ffd78d6fc,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x521bc0d02e5f2316,
                    0xb849f81b587900ce,
                    0x5cfc7b5ff54bc89e,
                    0x0d2ef00002529d3f,
                ])),
                Felt::new(BigInteger256([
                    0x858404a1b01830d1,
                    0xf9c672df1d39609d,
                    0xdf68e3b935877955,
                    0x06d783d63330787d,
                ])),
                Felt::new(BigInteger256([
                    0x3a03f29404d4b498,
                    0x5d20eaf73b753798,
                    0xdd96d862974550cb,
                    0x3a4ae9a711df2671,
                ])),
                Felt::new(BigInteger256([
                    0x2756ed7af2d7ef7c,
                    0xbbf06237c7c5396d,
                    0xbc00120e871d551b,
                    0x30aaf40fb8f32325,
                ])),
                Felt::new(BigInteger256([
                    0x6ea284f086918bae,
                    0x4dfd267299d7c5ec,
                    0x6071d517806ac5b8,
                    0x10b8466ca19617b8,
                ])),
                Felt::new(BigInteger256([
                    0x1bb944d43c708850,
                    0xafc401dc84e2cd77,
                    0x6ef6929fd83f855d,
                    0x2b3c4f38b9e4a66b,
                ])),
                Felt::new(BigInteger256([
                    0xd501ab3b29c25072,
                    0x07d0b8c2d870e31e,
                    0x61de18887b88ba17,
                    0x38d690e98f144072,
                ])),
                Felt::new(BigInteger256([
                    0x6c08732bead161ab,
                    0x2eabc951238982e8,
                    0xee870f968f2fc964,
                    0x3a8aebaaf50635fe,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb78120499f1097c4,
                    0xf38546a6f7f27727,
                    0xe5f6e8b97201d63a,
                    0x13b8d8f51093e48a,
                ])),
                Felt::new(BigInteger256([
                    0xec26aadc16748e90,
                    0x0b75811cc98c5e9b,
                    0xcb6f3f3be496317d,
                    0x1109445308cb08ab,
                ])),
                Felt::new(BigInteger256([
                    0x53529ba62512283f,
                    0xc0768c4cee6d15ea,
                    0x571490f341d7365b,
                    0x1fd9ec1019cd8a75,
                ])),
                Felt::new(BigInteger256([
                    0x5e58c660dc954c36,
                    0x9e0527e28208ff5a,
                    0xc826b338368c4054,
                    0x35c5c8dc38a755df,
                ])),
                Felt::new(BigInteger256([
                    0x9d8921ce18c2b71f,
                    0x16c7cc88c40ac71d,
                    0x7f5e8a8fd6adab53,
                    0x21f5b19be67a25fd,
                ])),
                Felt::new(BigInteger256([
                    0x6400175c8f27d04d,
                    0x87e99e91267724bb,
                    0xc37c98ac9d252394,
                    0x3b43b588d642d9e8,
                ])),
                Felt::new(BigInteger256([
                    0xb622e4586da65a5f,
                    0x028e781bc815ce95,
                    0xabc193ae74bfd79e,
                    0x21e45cae53b6265a,
                ])),
                Felt::new(BigInteger256([
                    0x09602845f758b62b,
                    0xece6f6995f824ac4,
                    0x62ba395e652d30f4,
                    0x3171a5d1aafc5eff,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe7d435483544c466,
                    0x755029264c684822,
                    0x46f4b2d8785d758c,
                    0x003aba494dd61753,
                ])),
                Felt::new(BigInteger256([
                    0x9e682ae1d1a97984,
                    0xafbb94cd00823b74,
                    0xf475f554cab2df8a,
                    0x139cb6023d0aa166,
                ])),
                Felt::new(BigInteger256([
                    0x44b2f190991cfcfb,
                    0xcc8299aa7d51cd55,
                    0x74a63e61aa85f46f,
                    0x0ec0724fd46f2453,
                ])),
                Felt::new(BigInteger256([
                    0x8d940f2fa5a86fb8,
                    0xef8f0672ffc013aa,
                    0x7e32aad372d6ceee,
                    0x12118c62c7621850,
                ])),
                Felt::new(BigInteger256([
                    0x15b44bc6123f660f,
                    0x43eef38e0ac63753,
                    0x377bb80286ea6408,
                    0x2b6850f8389f669e,
                ])),
                Felt::new(BigInteger256([
                    0x04a33159498413ed,
                    0xb59cfa0c0b95150f,
                    0xecabf72c3d3be43c,
                    0x080347bfd46a2233,
                ])),
                Felt::new(BigInteger256([
                    0x3ee2f1c54f41a91a,
                    0xee2f5953781ca4fe,
                    0xb5b51c4951dfc7d2,
                    0x303ab85b060649be,
                ])),
                Felt::new(BigInteger256([
                    0x30979d77e890a7da,
                    0xf10aba747c561b0e,
                    0xe8122827da9c379a,
                    0x2f4f3025be318f07,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3f6fcf04f70b5432,
                    0x17d8f57f3bcd59c5,
                    0x3285e60a17fc92d0,
                    0x0a2b30a5ee58ccf4,
                ])),
                Felt::new(BigInteger256([
                    0x899c7af4cb70c0d1,
                    0xd7bbb12d9cb8c8a8,
                    0x71af00989ca0bcd1,
                    0x38302ae5c2919b73,
                ])),
                Felt::new(BigInteger256([
                    0x9cefcae71db4c248,
                    0xa8cd3e1c3021eb83,
                    0xba9cb588489066a2,
                    0x2ebad89b5c03dc08,
                ])),
                Felt::new(BigInteger256([
                    0xf6b73c048df3832b,
                    0xa38f7b6abff08482,
                    0xffbe94558219cc8d,
                    0x3560298a4f015cbe,
                ])),
                Felt::new(BigInteger256([
                    0x834c7d2d7092f288,
                    0x7a634dbbe2816074,
                    0x921fd27f210af1f5,
                    0x13839e488a9653bd,
                ])),
                Felt::new(BigInteger256([
                    0xe518080d6e406bae,
                    0xf39a4e674a635f25,
                    0xc6e2ae4ca3d686d0,
                    0x3fee961e0a74d359,
                ])),
                Felt::new(BigInteger256([
                    0x0f84b017ae3b7484,
                    0xd3e33ae4f070f339,
                    0x9b7956a2e74963cb,
                    0x06bffea9c2adcb0f,
                ])),
                Felt::new(BigInteger256([
                    0xf80d81245e5914e9,
                    0xe38f37a8004abb87,
                    0xa0d38990c49c2986,
                    0x3ab1a7602a46f838,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x350f5a50c94217bf,
                    0x770f224cfa753421,
                    0xa419f0109402872a,
                    0x01cfd292485d5aad,
                ])),
                Felt::new(BigInteger256([
                    0x7057106bee0113de,
                    0xa155268cb8a4457b,
                    0x3ad9cc17cb522710,
                    0x1ea785f7ef8df218,
                ])),
                Felt::new(BigInteger256([
                    0x20ebf7dce7119100,
                    0x1800e392bf6ef8b7,
                    0xc0717d757e6759b8,
                    0x045b8e07f3036bd5,
                ])),
                Felt::new(BigInteger256([
                    0xf1f885567f1623ce,
                    0x48d57f6f05102309,
                    0xd7dc522fc87382e4,
                    0x0dfe1d2336067bd2,
                ])),
                Felt::new(BigInteger256([
                    0x1f89cb1264854c83,
                    0x3eeb22c32c984070,
                    0xf31b3a66d0acda22,
                    0x370fbf85d0c07888,
                ])),
                Felt::new(BigInteger256([
                    0x1617fd2c689c76ec,
                    0xcbf91f611234c77c,
                    0xc8679ef2529e8b6c,
                    0x2c4f3117a3e1a87f,
                ])),
                Felt::new(BigInteger256([
                    0x6398f80570db6fb3,
                    0x80354a3b6e4f401f,
                    0x797671356ca22be4,
                    0x0132dee18d47d5d4,
                ])),
                Felt::new(BigInteger256([
                    0x2104d6ed34c2179f,
                    0x68d5452531052eef,
                    0xb0b8ee947a35c053,
                    0x29753efbe42c3754,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa3a025b12d2f9f46,
                    0x5fa699b35ec12347,
                    0x01558d5d707c0adc,
                    0x314e4e0f6caf3558,
                ])),
                Felt::new(BigInteger256([
                    0xac63b80fffa8647f,
                    0xff6f4b6449da1776,
                    0x74904b313455ac1d,
                    0x27c613a8b122a412,
                ])),
                Felt::new(BigInteger256([
                    0xd88f867b7b6cc99f,
                    0xbea74e1dd252dab5,
                    0x31008c61d290a747,
                    0x3dc2d0f7c4caafdb,
                ])),
                Felt::new(BigInteger256([
                    0x85e6c7df57fbd8ac,
                    0x52172934e182319d,
                    0x13dd7f110fef2830,
                    0x1cb7b9630dc43dd9,
                ])),
                Felt::new(BigInteger256([
                    0x7ec609ffdcca6f9b,
                    0x838ef5b96edfcaf2,
                    0xea12286c4c908817,
                    0x3b25b52a4150ba38,
                ])),
                Felt::new(BigInteger256([
                    0xa26e73b8e2383236,
                    0xcfb9bc754e6a458f,
                    0x6df61934c25f7720,
                    0x23bc07da9fb06fbe,
                ])),
                Felt::new(BigInteger256([
                    0xe24531686989288f,
                    0xe9b061aff1caab5b,
                    0x4b0a9b79b8a99c60,
                    0x123cb0232ae15fb3,
                ])),
                Felt::new(BigInteger256([
                    0xcf2bf1993e7112ff,
                    0xb54d283f22df5433,
                    0x59c9485929ed96e1,
                    0x3f4c428eacaed918,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x70ce149cc28fc2b8,
                    0x7793b953f7975848,
                    0xb86489312b7dc62c,
                    0x36a86af8428d7093,
                ])),
                Felt::new(BigInteger256([
                    0x102963765530336a,
                    0x241c3df6bb4bfd98,
                    0x62cf9b5c9c41b074,
                    0x1bd0cea49202490f,
                ])),
                Felt::new(BigInteger256([
                    0xaefabc9075293d59,
                    0xbc2032bf6adb914f,
                    0x598168035ba2b692,
                    0x018ae350f8a8dfc8,
                ])),
                Felt::new(BigInteger256([
                    0xaf6215f4dec1bf79,
                    0x94b8f2f692537b81,
                    0xdf3d24b8308a27e0,
                    0x0d096d684a5ea1a3,
                ])),
                Felt::new(BigInteger256([
                    0x01d193993fa32154,
                    0x9316a5a9003d04a3,
                    0xd6592646a8007d6b,
                    0x1ce90026ecbd74b4,
                ])),
                Felt::new(BigInteger256([
                    0x7581159cbf00b92f,
                    0xcad7e771589a60ab,
                    0x456f5d4db172c559,
                    0x31300b8149cb1d28,
                ])),
                Felt::new(BigInteger256([
                    0xf881f23331a99cce,
                    0x57a60e578253b355,
                    0xf95b62afc629cc2a,
                    0x15ecd8508d118e49,
                ])),
                Felt::new(BigInteger256([
                    0x6913a5015a72b3a6,
                    0x0ef0433d43507761,
                    0x68f49b2b5d8f3062,
                    0x24eef53d407a088c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x740297fccb0fa4e9,
                    0xb789cd39a7dcdfe1,
                    0xe8246288af4e0648,
                    0x14252346fb5f6fc6,
                ])),
                Felt::new(BigInteger256([
                    0xc30d41f7dee1967f,
                    0x4170d67ad529bc56,
                    0x816d634d7cccb4aa,
                    0x09b21c34ee21fcf4,
                ])),
                Felt::new(BigInteger256([
                    0x938e5f23dbb81c1c,
                    0x4daa9859d8660dab,
                    0x136f3958dd0a32f9,
                    0x05e6ddbbb5f542a8,
                ])),
                Felt::new(BigInteger256([
                    0x91944f0e7d85f709,
                    0x338e28df858ad02c,
                    0x9c72f7ef21fe7b19,
                    0x3272faf5136a68ab,
                ])),
                Felt::new(BigInteger256([
                    0xe9ba62bc229125a5,
                    0x418599155416f935,
                    0xbeab3bbdbc4460c5,
                    0x1b9a5ef61d36f762,
                ])),
                Felt::new(BigInteger256([
                    0x3b8b7acc0c4798f1,
                    0x042ad3d571bcd55f,
                    0xc5c1d530dbda2da5,
                    0x08801db13a258877,
                ])),
                Felt::new(BigInteger256([
                    0xfb4d3f83f558e8d5,
                    0x45efc3b6da8d5e41,
                    0x0895a4b6a00a7231,
                    0x1af92620bde491b4,
                ])),
                Felt::new(BigInteger256([
                    0x07231c7a244caeac,
                    0x27b53cdb3be17145,
                    0xc360c4460be5910a,
                    0x234f7918a9c2d6bf,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x2096b31dd623e381,
                    0xec832cebb3580aa8,
                    0xfd9c9820ac7c35bb,
                    0x2dd826b1fcd463b0,
                ])),
                Felt::new(BigInteger256([
                    0x397cb69bfe8ff836,
                    0x002c1549f6e4ad07,
                    0xd892e667e6b1b084,
                    0x2137b6c45f450e13,
                ])),
                Felt::new(BigInteger256([
                    0x6069ae73c3168283,
                    0xa82fae3fd8e4e5c4,
                    0xd32193c82ae40942,
                    0x2f278d26be56aff2,
                ])),
                Felt::new(BigInteger256([
                    0xe4853b91f2e433b6,
                    0xc5193a8e59a7fe51,
                    0xf96214d0471b4fd3,
                    0x25877291e68b4301,
                ])),
                Felt::new(BigInteger256([
                    0x684472df93f9236c,
                    0xa49668dc6c5b5c12,
                    0x90168b0cee672da1,
                    0x0c580bae4b38ae69,
                ])),
                Felt::new(BigInteger256([
                    0xa314b07250b6c11e,
                    0x21af2cbc6958c7fe,
                    0xe50b4a6ef0648218,
                    0x130899b34acb14f4,
                ])),
                Felt::new(BigInteger256([
                    0xc90823633df133e9,
                    0x06cd65fa910dedd6,
                    0x7962421c64fe0982,
                    0x1bffd76332ef7f64,
                ])),
                Felt::new(BigInteger256([
                    0xa238b3b544657cb6,
                    0xcc195098a02fd502,
                    0xe215775a084b2728,
                    0x13bd7da3cdc357d5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xf67112a57a1a3a8a,
                    0x63c8a5329e76871f,
                    0xfbe42b4efcd53460,
                    0x14e197eab2d381ea,
                ])),
                Felt::new(BigInteger256([
                    0xcc676ff779b57f0a,
                    0x412536bc6dd6da23,
                    0xebc6ed391046f14e,
                    0x31a4fc913aa15ad0,
                ])),
                Felt::new(BigInteger256([
                    0x1c946dcc0907b124,
                    0x5d60ee37c15d6ac4,
                    0x655274e4306db60c,
                    0x22ad7bc93ad0c56e,
                ])),
                Felt::new(BigInteger256([
                    0x3d3e1f6635580f0e,
                    0xb0fb67041a075f39,
                    0xfaf979afe1acc6d9,
                    0x08aba79b59a46de5,
                ])),
                Felt::new(BigInteger256([
                    0xc4b76ec2f4aa14cd,
                    0x54358c3aa076b026,
                    0x5a6d03cd462a9007,
                    0x389daab2d0d1b19e,
                ])),
                Felt::new(BigInteger256([
                    0x58d113ed210d4fb2,
                    0x60f03f08755dba27,
                    0xa914edf3dd3284e7,
                    0x3847a47782c8d266,
                ])),
                Felt::new(BigInteger256([
                    0x034434b3a59b68a2,
                    0x61fafc3fa2859d24,
                    0x2bf1f1498aa481b8,
                    0x3f024148744920ac,
                ])),
                Felt::new(BigInteger256([
                    0xa91876c342b8c48d,
                    0xc496d24bca3d1bf5,
                    0x2a92be6b70004bc0,
                    0x3b8794e52356c357,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb3b00f4fd659bf51,
                    0x22eab17437d74325,
                    0x4a911bef6806a0f4,
                    0x1028505bf4ba040b,
                ])),
                Felt::new(BigInteger256([
                    0xcdcad924c480d7ab,
                    0x9c71bd2c0e9a3ffa,
                    0xbddebe0198ab8751,
                    0x3b35b3c578737dd2,
                ])),
                Felt::new(BigInteger256([
                    0xe426c345bd61e9d5,
                    0x143c8b2f37310c12,
                    0x0f4e875ef1777788,
                    0x05995c9a6b9d990f,
                ])),
                Felt::new(BigInteger256([
                    0xb7e0e5fc6b59c1f4,
                    0x6f80f77fd780f1e7,
                    0x20e10f1ad9f6e071,
                    0x035763781d83b13a,
                ])),
                Felt::new(BigInteger256([
                    0x27321d06ff427719,
                    0x2896c4dc29d18d8d,
                    0x43b7014b74d90cf6,
                    0x3ff75ebb47394a67,
                ])),
                Felt::new(BigInteger256([
                    0xc1a7270c03f3c4e2,
                    0xd1d1a0eff3d1ba40,
                    0xb56c7e3a55b76f95,
                    0x0b7fa637ed9b30e9,
                ])),
                Felt::new(BigInteger256([
                    0xbaa90f1b3f286a19,
                    0x3db7ffa09c82efd9,
                    0xef06a82b8e462e3a,
                    0x32e4be7705c91d32,
                ])),
                Felt::new(BigInteger256([
                    0xae1b1cdc39f0e5e2,
                    0x58e09af148aee549,
                    0x35f8fdff15c0c983,
                    0x1db3fe1d17718ad1,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x98fd09b91fc8d685,
                    0xaabcb0994214fcae,
                    0xab3c9a1f5225e37b,
                    0x16413342c585efaf,
                ])),
                Felt::new(BigInteger256([
                    0x1905ffb851219558,
                    0x80d82cef9daa3208,
                    0x9372fbfbf4fcb145,
                    0x09645fa677b638da,
                ])),
                Felt::new(BigInteger256([
                    0x051230ad40a47dd5,
                    0x1fbf2e099ee78d28,
                    0x03dccce3f39d7d47,
                    0x0d3f4ea98212f105,
                ])),
                Felt::new(BigInteger256([
                    0x72e1efca45928e44,
                    0x66743d6799fd685e,
                    0x19680f65550d725f,
                    0x1917b43b5e13acf8,
                ])),
                Felt::new(BigInteger256([
                    0x80fe7dea49aa4045,
                    0xbaed1d4f51112759,
                    0x9de36bcccc1675e0,
                    0x3b10a222ee112bcb,
                ])),
                Felt::new(BigInteger256([
                    0xcefd542a9b620581,
                    0xedd885c60ffe9d1e,
                    0xa34e4cfcc9443456,
                    0x2643b41a916c698f,
                ])),
                Felt::new(BigInteger256([
                    0xc692d0158148a7d6,
                    0x0d6623afba915925,
                    0x445fae7483a871ce,
                    0x1db47d51c27c113e,
                ])),
                Felt::new(BigInteger256([
                    0xc89d8e6d522c7d84,
                    0xe2462ecf023affca,
                    0x7c774238922e7cf7,
                    0x2756127817188e35,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0b003feea9902612,
                    0x21217707a25b6698,
                    0x211d31b0981a2f92,
                    0x24e766f106434a30,
                ])),
                Felt::new(BigInteger256([
                    0x615c90ab759b34d4,
                    0x091de80f68410e56,
                    0x3ff5a3a113eaebf4,
                    0x199cb2fbe63d51a6,
                ])),
                Felt::new(BigInteger256([
                    0xb13fa80aa800fc5c,
                    0x90075fd27154f89c,
                    0x1bfc3c27fc15077d,
                    0x271fb3a355692fef,
                ])),
                Felt::new(BigInteger256([
                    0x1049c94469a4347c,
                    0x238190a4843de646,
                    0x3811f955cdf30354,
                    0x29800886eae8107f,
                ])),
                Felt::new(BigInteger256([
                    0x902c263beeee0f68,
                    0x50d8e157bde86cdb,
                    0x2e14dfcdbd591abf,
                    0x149879a246c67039,
                ])),
                Felt::new(BigInteger256([
                    0xf8d3dbb999238d36,
                    0x123d65a329534c25,
                    0x49b5f8d2c34ed0a3,
                    0x13c255f4f3992a7d,
                ])),
                Felt::new(BigInteger256([
                    0xf801182acd782427,
                    0xfb8632a8fd49ddad,
                    0x665e4cb5ee946467,
                    0x3840ad8a17384ab3,
                ])),
                Felt::new(BigInteger256([
                    0xf0e15c1365ed40e3,
                    0x114769250fcb89cf,
                    0x506d9f742816bd4e,
                    0x1f282ba15443ccbe,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbdbcf54f2a7fe1cd,
                    0x04054a71f89cdc4a,
                    0x0855a00888d91705,
                    0x004e8afaf2b81be8,
                ])),
                Felt::new(BigInteger256([
                    0xbeb0735d3eb0d0f7,
                    0xabdbfbc242ba5dd1,
                    0x2ea174c3e596d4b2,
                    0x26fbfaf7284cd354,
                ])),
                Felt::new(BigInteger256([
                    0x34a5eeb1ea6fa814,
                    0xe4c0fbd173d92352,
                    0xd32a417680c475d3,
                    0x32090f934cb2aee4,
                ])),
                Felt::new(BigInteger256([
                    0xe4b68565a48b7036,
                    0xe7a2d0fe92e56df9,
                    0x983fb32387811381,
                    0x1f39d2c53779bdbe,
                ])),
                Felt::new(BigInteger256([
                    0x68afd4f65636d250,
                    0x0406bf36790f3fc6,
                    0xf8f02357f28c7645,
                    0x11b006119b060fe9,
                ])),
                Felt::new(BigInteger256([
                    0x4cb0fcadd02fc6ba,
                    0x1006dee7ba599602,
                    0x4dec3be4442b4f11,
                    0x0e1410be6177c923,
                ])),
                Felt::new(BigInteger256([
                    0x7f89c66c5d962993,
                    0x777a61fc65182614,
                    0x0976b27ec94ce76a,
                    0x3803ab44d016efa8,
                ])),
                Felt::new(BigInteger256([
                    0x97880fc836481388,
                    0xd4382eb080877b66,
                    0x9fc77f90b57cc7a3,
                    0x39806c37b2258c41,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 8],
            [
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe92c31f8ffffffbd,
                    0x0785f60990dacdc6,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4656264cfffffee1,
                    0x92da7d7192b4ba0f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2ced9dd8ffffff1d,
                    0x9b665883c0bf1c87,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9567c93cffffff91,
                    0x2363aab7f79ffd08,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xd669a3a05b6943d8,
                    0xb9363ed61c72d22e,
                    0x0fa0498a4ea31642,
                    0x1c916de770dc76f0,
                ])),
                Felt::new(BigInteger256([
                    0xabc42171c0b595a5,
                    0xa30b2ffac8bfd0a4,
                    0xcf823701f0789475,
                    0x16626d9238d96362,
                ])),
                Felt::new(BigInteger256([
                    0x9640b69e3a002d83,
                    0xb43d9a5e4d3cbd09,
                    0x96116c0035036472,
                    0x08e0dd2124165e37,
                ])),
                Felt::new(BigInteger256([
                    0x4d13995875d0c21a,
                    0x2dcd958c882f972c,
                    0x37efd70575a3e555,
                    0x0d6833c923e6f2ca,
                ])),
                Felt::new(BigInteger256([
                    0x8fd5510cfe371939,
                    0xd28d32f8dfe372e6,
                    0xf834e31c1fd46317,
                    0x1b7354a0f954308c,
                ])),
                Felt::new(BigInteger256([
                    0x6801f06e1a32630c,
                    0xba9d5f2ed321ff4d,
                    0x1516c9d3bfc7b27b,
                    0x220bb27653e9873d,
                ])),
                Felt::new(BigInteger256([
                    0x44497336aaa33eda,
                    0x108cbeeceda5423c,
                    0x7b4f7342f555dafe,
                    0x35a0ceebd84feb09,
                ])),
                Felt::new(BigInteger256([
                    0xaff523645b7805c4,
                    0xb87815780b0c77b5,
                    0x606f2ce1b9284abb,
                    0x12f595bfb931c4b5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb890ed058c39f5b8,
                    0x2040cfe8300fcd0c,
                    0x64096389b9034cb3,
                    0x177d3448f8e5a376,
                ])),
                Felt::new(BigInteger256([
                    0xc7f4fc01b0cb66f4,
                    0x5a1a0b10b06f527d,
                    0x633eff4e6e213435,
                    0x0ace89549085ade6,
                ])),
                Felt::new(BigInteger256([
                    0xd23c919918612ad0,
                    0xdec717178cace6b4,
                    0xe6e0b44cc23a0d30,
                    0x39d7e9878514e72b,
                ])),
                Felt::new(BigInteger256([
                    0x2cfa73ee84a0a4a4,
                    0x3c39ecaf4fcc3bf3,
                    0xe55a57e1dc3ccff5,
                    0x00c9c24ff5d26107,
                ])),
                Felt::new(BigInteger256([
                    0x97d3eddf17a00231,
                    0x26ad0a61ce7fccef,
                    0x49bf60c8abe3da20,
                    0x370f6a220149df3b,
                ])),
                Felt::new(BigInteger256([
                    0xfb370d0fb6268b39,
                    0x56823a99be7f985e,
                    0x8b8523c57d0c2500,
                    0x353689373339960c,
                ])),
                Felt::new(BigInteger256([
                    0x264b36e4652f415b,
                    0xd079d283fe96299f,
                    0x16cca23a38ff517f,
                    0x357104d52901a9e4,
                ])),
                Felt::new(BigInteger256([
                    0x9404ad96ed95b097,
                    0xd0722c3080187d5f,
                    0xcd4ec0c8f9418b44,
                    0x041e9194a5755037,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xfb884ee93d09283a,
                    0x92a117ffa120e245,
                    0xaeb78059f53384bc,
                    0x201e475975156a69,
                ])),
                Felt::new(BigInteger256([
                    0xf85bb62f0303c54a,
                    0x528e7aa77243acb2,
                    0x4dc8d0f213280573,
                    0x0a945be6ce0d57a6,
                ])),
                Felt::new(BigInteger256([
                    0x7e4e4fba60d5340c,
                    0x7f49d14817944d8d,
                    0xa7812a891ea6a8fc,
                    0x35d418aec6256f1a,
                ])),
                Felt::new(BigInteger256([
                    0xa3c0999eaea7dd14,
                    0xf148a2b8a10b8d2a,
                    0xf9c7d129d2a52e89,
                    0x1c4bbf78b47ca4f9,
                ])),
                Felt::new(BigInteger256([
                    0x1e0158039ce71253,
                    0x302751e66bc9ea42,
                    0xb0046bb4605db551,
                    0x1134ed3be9a80a35,
                ])),
                Felt::new(BigInteger256([
                    0x6b827af21d0b2a35,
                    0xed31aa05204ce21a,
                    0xe7130b0592fb9816,
                    0x081e94237dd8a621,
                ])),
                Felt::new(BigInteger256([
                    0xc9d15915c34046dd,
                    0xcc93f8af44d7a1f2,
                    0xdb81c5b7169b8095,
                    0x354e0b968794ea08,
                ])),
                Felt::new(BigInteger256([
                    0x1bb55e40ebb6744d,
                    0xd8c6a3ad2f74f3ae,
                    0x29fb2cfd492ad756,
                    0x09224361f1d6db2c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x2230e6aca5a5930e,
                    0xc5b4737ceb571011,
                    0xb246cf757b68b95c,
                    0x0e4e7fa1f48c5ac0,
                ])),
                Felt::new(BigInteger256([
                    0x285eebc41db38325,
                    0x824579009de5d10e,
                    0x2f0a0b481894d6fa,
                    0x29a1cd8d68b9268c,
                ])),
                Felt::new(BigInteger256([
                    0xb8310e88e8f85bf4,
                    0xe825e30c924defb3,
                    0xbb72d1ede44eb25e,
                    0x3af8e0d4b168f455,
                ])),
                Felt::new(BigInteger256([
                    0x439a72e71fcc3ca0,
                    0x9f3d399cc82976ae,
                    0x051ccd6334231381,
                    0x05a2126b84ccd26c,
                ])),
                Felt::new(BigInteger256([
                    0x51895832ae47a967,
                    0xd73545a7a994c387,
                    0xc151c9d2b68f9d64,
                    0x04802b0c3a25730a,
                ])),
                Felt::new(BigInteger256([
                    0x9928536d6a71e892,
                    0x825d80d86f639b81,
                    0xa96d257747747114,
                    0x2d7eac7dc3708b53,
                ])),
                Felt::new(BigInteger256([
                    0x4401ee8dd8d4ec81,
                    0x84204baa8711d523,
                    0xcfc95715ddd179d4,
                    0x2cf6b2dddd339316,
                ])),
                Felt::new(BigInteger256([
                    0x274965cf87474c59,
                    0xacb41c5bb7a7e392,
                    0xe59b1ed6034551fd,
                    0x1369c44ccbc104db,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb8442229c36d5739,
                    0xa50638da8c0b5513,
                    0x452612ec01c3ed61,
                    0x11b245abad49763d,
                ])),
                Felt::new(BigInteger256([
                    0x3300b655d15813f1,
                    0x404f2b2011136aaa,
                    0xcb5226bef2059d68,
                    0x0e349aaeb031a540,
                ])),
                Felt::new(BigInteger256([
                    0xe71964c62d16179e,
                    0xc588515c8fa48a84,
                    0xe73ee9249c46cb8c,
                    0x3b066eefef68cad9,
                ])),
                Felt::new(BigInteger256([
                    0xe87c09cfc8ea522e,
                    0xf063a80616d6a677,
                    0x629636da2bd07a53,
                    0x33c6cfd336b491ec,
                ])),
                Felt::new(BigInteger256([
                    0xeb873ff2123cf78e,
                    0xad88a92cc9dd8d9a,
                    0x2878415fd5f86354,
                    0x2809a183861e1b87,
                ])),
                Felt::new(BigInteger256([
                    0x44ef7223b057357a,
                    0xc7af1afecb856617,
                    0x0f49a4771b72ba23,
                    0x230cfadb86ab862d,
                ])),
                Felt::new(BigInteger256([
                    0xb10ff52904b5ef48,
                    0x05a371221ef80934,
                    0x96e5a89ff75d8bda,
                    0x07065cd70b5edfd6,
                ])),
                Felt::new(BigInteger256([
                    0x98cd041602357dc1,
                    0x758bee191109f4f4,
                    0xc6f27cd90cc1874a,
                    0x38b12ca102fbd5b3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb8ea04b26d8c40ff,
                    0xb25e37374db22a9d,
                    0x393023a213bdc1e0,
                    0x0084d88079632f12,
                ])),
                Felt::new(BigInteger256([
                    0x2eeb73460fd14ca5,
                    0x1917ec2d1bafd086,
                    0xc5028b181c06c5f6,
                    0x1ce567659b66be13,
                ])),
                Felt::new(BigInteger256([
                    0x5941a6530b75be69,
                    0xf454622e0007e6e9,
                    0xc2c97c4276b8efcc,
                    0x03ab14d73d087e3d,
                ])),
                Felt::new(BigInteger256([
                    0x403c02af200b2f06,
                    0xa2939c46ed64cfd3,
                    0xe4433ec3c36e6ff8,
                    0x2433490037f598fd,
                ])),
                Felt::new(BigInteger256([
                    0xb61200c1c02f3d59,
                    0x9d173d80928d6e2e,
                    0x824a99684426f11a,
                    0x161c4fc9c3db73ed,
                ])),
                Felt::new(BigInteger256([
                    0x8d1ccdeb464ec5dc,
                    0x5b96a84dce61d23e,
                    0x28f94651ec3399ed,
                    0x0bf680b7bd86b2bb,
                ])),
                Felt::new(BigInteger256([
                    0xa3459043b3e578d0,
                    0x4600abb15b462026,
                    0xfe119b4cb584df4e,
                    0x3bf1ecf12b39f798,
                ])),
                Felt::new(BigInteger256([
                    0x84d87facfb43c124,
                    0x78fcab43710783c1,
                    0x302964af7a0c77c8,
                    0x064301eb56ab1fd0,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate().skip(4) {
            println!("{:?}", index);
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
