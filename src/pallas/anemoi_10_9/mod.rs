//! Implementation of the Anemoi permutation

use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 10 field elements or 320 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 10;
/// 9 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 9;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 5;

/// 1 element (32-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

/// Applies the Anemoi S-Box on the current
/// hash state elements.
#[inline(always)]
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t -= mul_by_generator(&y2);
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t += mul_by_generator(&y2) + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
#[inline(always)]
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3], state[4]];
    let y: [Felt; NUM_COLUMNS] = [state[6], state[7], state[8], state[9], state[5]];

    let sum_coeffs = x[0] + x[1] + x[2] + x[3] + x[4];
    state[0] = sum_coeffs + x[3] + (x[2] + x[3] + x[4].double()).double();
    state[1] = sum_coeffs + x[4] + (x[3] + x[4] + x[0].double()).double();
    state[2] = sum_coeffs + x[0] + (x[4] + x[0] + x[1].double()).double();
    state[3] = sum_coeffs + x[1] + (x[0] + x[1] + x[2].double()).double();
    state[4] = sum_coeffs + x[2] + (x[1] + x[2] + x[3].double()).double();

    let sum_coeffs = y[0] + y[1] + y[2] + y[3] + y[4];
    state[5] = sum_coeffs + y[3] + (y[2] + y[3] + y[4].double()).double();
    state[6] = sum_coeffs + y[4] + (y[3] + y[4] + y[0].double()).double();
    state[7] = sum_coeffs + y[0] + (y[4] + y[0] + y[1].double()).double();
    state[8] = sum_coeffs + y[1] + (y[0] + y[1] + y[2].double()).double();
    state[9] = sum_coeffs + y[2] + (y[1] + y[2] + y[3].double()).double();
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies an Anemoi permutation to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Applies an Anemoi round to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xb03b0bf4e26dccb8,
                    0x08fe434b18f1f269,
                    0x46684bbffad5526e,
                    0x1b167ebddffaf892,
                ])),
                Felt::new(BigInteger256([
                    0x93d8e1a71c2531dc,
                    0x879a3fd2d12ee218,
                    0x8a592e0c9b2504d3,
                    0x19f1a8099481db17,
                ])),
                Felt::new(BigInteger256([
                    0xbe099a0926c6d9c7,
                    0xee2b0322e76a29c7,
                    0x26c59bef5dfdb4f2,
                    0x35c87d23ab25289c,
                ])),
                Felt::new(BigInteger256([
                    0x478c3ce1ed7d4ef1,
                    0x4cd569e7dbd438d8,
                    0x9618bb62517f73ad,
                    0x090ca5eb259704f9,
                ])),
                Felt::new(BigInteger256([
                    0xf5f255ff08fe76c4,
                    0x43355bee71f38b4f,
                    0x309c167fd56dbec9,
                    0x2b44fdb5351d2252,
                ])),
                Felt::new(BigInteger256([
                    0xdd78bc67301ea1f3,
                    0x498acd297e49fa5a,
                    0x05a26e8e186fbf91,
                    0x1a72e507b88860bf,
                ])),
                Felt::new(BigInteger256([
                    0xfab313fb5176f978,
                    0x4d9a85a6d631570a,
                    0x6709e41461a3b0f8,
                    0x23e1a740b938ba3c,
                ])),
                Felt::new(BigInteger256([
                    0xed53a24d1428d4da,
                    0x3ed2f7a7d56cd30a,
                    0xfb06fed9637f026e,
                    0x1d3dce3cadbf8fbb,
                ])),
                Felt::new(BigInteger256([
                    0xde73d230bfee408a,
                    0x77dfeed4435b3ac4,
                    0xd38ee457669beecd,
                    0x38b2bfafe4c84497,
                ])),
                Felt::new(BigInteger256([
                    0xe50f5979fe38735b,
                    0xf0086d4bf9649a40,
                    0x2110218e4326026c,
                    0x03c1d164a23109a4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb7a66e8835781e8e,
                    0x76af90bfac48b543,
                    0x7d1cdc075f5f4d9d,
                    0x31b4ae1a96781f86,
                ])),
                Felt::new(BigInteger256([
                    0xc816ebef8c5fbfcb,
                    0x3c4b0418680f87b5,
                    0x48715bdbfbaf102a,
                    0x180eadd17b731b78,
                ])),
                Felt::new(BigInteger256([
                    0x1c9771e7b883b3f5,
                    0xc4a536b8b4ee48c2,
                    0xa57092e4b9a2c35b,
                    0x1e18729c6f006ae7,
                ])),
                Felt::new(BigInteger256([
                    0x32d3726c59e6d0a5,
                    0x25cdb81263288606,
                    0xa5e7e83fa286465c,
                    0x32cf5302fa387ba6,
                ])),
                Felt::new(BigInteger256([
                    0xcf3bcc352b33a8d3,
                    0x7ef3009caa3a0cfb,
                    0x9952ef08b6e4d3c1,
                    0x20b30fbeab01be20,
                ])),
                Felt::new(BigInteger256([
                    0x385d9677fda64966,
                    0x8770076fce079c8e,
                    0xc510c411893f961f,
                    0x1808027c86811ebb,
                ])),
                Felt::new(BigInteger256([
                    0x3bfd8b6d7704eac2,
                    0x04c8bcd5b794443d,
                    0x5c55cd6df2ff104d,
                    0x1f7ca29a1cf56f6d,
                ])),
                Felt::new(BigInteger256([
                    0x8dae248dcaa00298,
                    0xe1a046eb22c37278,
                    0xc4bf8f74f12072dc,
                    0x1185ee1043b375b3,
                ])),
                Felt::new(BigInteger256([
                    0x68ea74920d605847,
                    0xf911da9224734e28,
                    0xe34113937f9258d7,
                    0x27071a3388e4d5a4,
                ])),
                Felt::new(BigInteger256([
                    0x1b4a857f61f3e4e6,
                    0x268f10a2a7aa9209,
                    0x68214f07c2436b5b,
                    0x157ac5ada91b9bb5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x8e74fa52ddbb16a6,
                    0x4957cc393a0adc46,
                    0x636cdfdc44380751,
                    0x1fdbdd700c422c84,
                ])),
                Felt::new(BigInteger256([
                    0xc5274c13a7f16573,
                    0xdf6eb1435d856791,
                    0xcfc325f519759b4c,
                    0x1d72e0bbdfa7e839,
                ])),
                Felt::new(BigInteger256([
                    0xbf3c03849a48a4eb,
                    0x25980e1ef3bbd2c5,
                    0x4edbccb8a0173826,
                    0x2215ac620875f5b2,
                ])),
                Felt::new(BigInteger256([
                    0x71406f64be46e1a6,
                    0x45e014fd120f2932,
                    0x49d13bdd26cd4af8,
                    0x12a27ff8ed60df2b,
                ])),
                Felt::new(BigInteger256([
                    0xb57a0b75c50247c2,
                    0x148ee3958fc10032,
                    0xd0ab368a532111c8,
                    0x2b3422d9647f03e6,
                ])),
                Felt::new(BigInteger256([
                    0x179ea4bcf3115cd3,
                    0x68b1d4de6fbcc497,
                    0xf6de692dd96d7726,
                    0x024d508be0bc476c,
                ])),
                Felt::new(BigInteger256([
                    0xcffffa8538db8130,
                    0xcc63174743267dd2,
                    0x3cee1804066e191e,
                    0x26a07b8d7971a110,
                ])),
                Felt::new(BigInteger256([
                    0x0f2213928105cc30,
                    0x961100ab3fc072aa,
                    0x76eff8e52c23f1a2,
                    0x237c7a81c471b214,
                ])),
                Felt::new(BigInteger256([
                    0x88056d7b48246658,
                    0x70b5ff28084db257,
                    0x5426ef6cf0409194,
                    0x370b7a1e3b4d2bc1,
                ])),
                Felt::new(BigInteger256([
                    0xf898a5d72e0744e9,
                    0x12e3220ebffe9da7,
                    0x88c502813d7cc617,
                    0x1bad7579f1178f7c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xeb21d80221f06e38,
                    0x8dc66f923b23e23c,
                    0xa92a0d987c1e4507,
                    0x3a8d625989bd9d0f,
                ])),
                Felt::new(BigInteger256([
                    0x129bb58a1e8b2a0d,
                    0x7fca9d3710f9a57d,
                    0x353998c9efdf90fc,
                    0x07ed9b5acc9d8db5,
                ])),
                Felt::new(BigInteger256([
                    0x7dc4962cf4dd2515,
                    0x4cae6d31630078c1,
                    0x1e1a7fd64e4f376b,
                    0x12efe88e691319c2,
                ])),
                Felt::new(BigInteger256([
                    0xbfa06f50a1e2bbf7,
                    0x7fcf4ad8c8786169,
                    0x2d2e5004e2f88264,
                    0x2d3600b0189a5e6b,
                ])),
                Felt::new(BigInteger256([
                    0xa49d07a20d4d2da0,
                    0x468d747637d89cdd,
                    0x7e11df78accb773a,
                    0x3cec17c26903a5f2,
                ])),
                Felt::new(BigInteger256([
                    0x2245453d2263b080,
                    0x359e3c57eab00d11,
                    0x1dd7ba43c1afdbdb,
                    0x32b6a190ca843ceb,
                ])),
                Felt::new(BigInteger256([
                    0xe54f74c85d288df7,
                    0x98ea1a47422b5d95,
                    0x293e213a7ed0d4b0,
                    0x27cabd1ac8c48108,
                ])),
                Felt::new(BigInteger256([
                    0x8f45c1747331bdf3,
                    0xe5d085e5e012ea81,
                    0xd9d5779d0cd9ae9f,
                    0x39aa3e7c0799828a,
                ])),
                Felt::new(BigInteger256([
                    0xd6d8554bc840cba8,
                    0x2a98f3acc6a4a041,
                    0x34c4d73f9090bc56,
                    0x2eee9e11e96c6d35,
                ])),
                Felt::new(BigInteger256([
                    0x6fe5721918c35cd1,
                    0x656b745bd06f748a,
                    0x6b853d0c096964c1,
                    0x37d838883a4588e5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x6e10c04a7da9af25,
                    0x8f9fc9d40a75eeff,
                    0xcce658f4ed353fb7,
                    0x309734fa17de59e1,
                ])),
                Felt::new(BigInteger256([
                    0x4e7305ca8368e922,
                    0x58e7e760afada584,
                    0x936e9d9dcf12412f,
                    0x3df53bcd2c0a8f79,
                ])),
                Felt::new(BigInteger256([
                    0x464bd549c74da172,
                    0x51e1ef64bd39bbfe,
                    0xae4b125477f6c370,
                    0x153be8343dc275a3,
                ])),
                Felt::new(BigInteger256([
                    0x2a049bef87027d13,
                    0x46014c977e5aa97a,
                    0xc408cd24d734c5d6,
                    0x2b745d15d76ce7d2,
                ])),
                Felt::new(BigInteger256([
                    0xeee6901cfbdb600d,
                    0x11843d61d025051f,
                    0x02da93af28301d3c,
                    0x16746d8e722fc9de,
                ])),
                Felt::new(BigInteger256([
                    0xbe232e1c638c45b0,
                    0xd1742e1ee3bec6fb,
                    0x99adf2d7ea24bfa2,
                    0x384c458e4cad6d01,
                ])),
                Felt::new(BigInteger256([
                    0x8416260190fd8056,
                    0x77c9d3d9f93eb45f,
                    0xc708203905eca392,
                    0x0131f8fd5e500654,
                ])),
                Felt::new(BigInteger256([
                    0x485444c74485806a,
                    0x33041c3c5df0d068,
                    0x61d1fd06649b2a26,
                    0x0e52993fef5217c2,
                ])),
                Felt::new(BigInteger256([
                    0x067f9152151059f8,
                    0x7cd5ac45477fff33,
                    0x03403add1c47fc07,
                    0x10dd01d7ce8e2184,
                ])),
                Felt::new(BigInteger256([
                    0xaa728caa3ca455bb,
                    0x950d6593fafee61c,
                    0xa0296cf62bf893cf,
                    0x2e33eb7e7c1d3bb5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x2f71b0795804d53a,
                    0x5723bde93a13b9e0,
                    0x9d15bcead03b9ad0,
                    0x0b64717e3b147a60,
                ])),
                Felt::new(BigInteger256([
                    0xd1550cf59b8e68a2,
                    0x054153523c87787c,
                    0x92840f36cff155fe,
                    0x3f5ea726e8cedc31,
                ])),
                Felt::new(BigInteger256([
                    0x90b258365c2ffb85,
                    0x875bac983068fdb1,
                    0x5e6f8dcf51e3d748,
                    0x0c1f4f8632072beb,
                ])),
                Felt::new(BigInteger256([
                    0x27cbf879da7dd813,
                    0x8da7dc72fd43e55b,
                    0xbf6489cb2a57e0b3,
                    0x0489416591ca7c2e,
                ])),
                Felt::new(BigInteger256([
                    0x07511b33665124e7,
                    0x6a09243e7511f186,
                    0x9e82f9673324ddc8,
                    0x3a7feacc50f02acf,
                ])),
                Felt::new(BigInteger256([
                    0xe8a5e812c48e7c74,
                    0x5af3d9423aed5433,
                    0x177f4f2e7467e3ed,
                    0x086a27cdd34e7c33,
                ])),
                Felt::new(BigInteger256([
                    0x61901348447744ab,
                    0x2cfb6b77db46bd88,
                    0x6125b108a55a3447,
                    0x0b1c3c3b89d68c1e,
                ])),
                Felt::new(BigInteger256([
                    0x1bb9aa42521ff152,
                    0x44b7cc608a73f815,
                    0x19647dbb7aada97c,
                    0x22aec561aa62bb4f,
                ])),
                Felt::new(BigInteger256([
                    0xd05d6f904df71831,
                    0x9cc57d6a26854b73,
                    0xef091d6c968e9cad,
                    0x3791e639e0c411f9,
                ])),
                Felt::new(BigInteger256([
                    0x86eb6abdccd022f0,
                    0xf25c62bbb95a339a,
                    0x2a32c0bda99aa866,
                    0x3a642cbd70bc6b0e,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x0a7e7c3e99999999,
                    0xb83c0a9bfa6b6a89,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x3785babe3451890e,
                    0xbad6a04b96e7e335,
                    0xdaecef0c6271ae56,
                    0x309b6fa4569ce2e5,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
                Felt::new(BigInteger256([
                    0x376eae911f9c7044,
                    0xf15d13a83fed92e2,
                    0x8a6f1eb3ded38974,
                    0x0a63a5046381f69e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0xe89d156895f33598,
                    0x22cc8f90197cdefa,
                    0x59d1af10ece372fe,
                    0x3c38ccf4eeef1fb8,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
                Felt::new(BigInteger256([
                    0x1fae7c1b952b2763,
                    0x6ff92987f72625f6,
                    0x05ce29c9b82e2059,
                    0x02ee5a311dcf8a77,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xae41e60699999981,
                    0x819db2fb1b340ff2,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x64b4c3b400000004,
                    0x891a63f02533e46e,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa4d4a4d56aaffa46,
                    0x6268cac88145e589,
                    0x463239a1334a2282,
                    0x03887946aca30702,
                ])),
                Felt::new(BigInteger256([
                    0x78cb8ed5bdcdaa73,
                    0xe35d600b75f96ea8,
                    0x71406c474898a67c,
                    0x25b9941486313681,
                ])),
                Felt::new(BigInteger256([
                    0x98a1078e435eae46,
                    0x10c4093015fad9ca,
                    0x96384d0488e045ba,
                    0x16b8170f74359516,
                ])),
                Felt::new(BigInteger256([
                    0xca6055b38cb20291,
                    0x43c0a32e055bb70a,
                    0xea7e2457137ce53d,
                    0x1c87566364bb5285,
                ])),
                Felt::new(BigInteger256([
                    0x93adaa5b44b321d5,
                    0xc1320189736ba98b,
                    0x2303a80954ea942d,
                    0x3178603923529a84,
                ])),
                Felt::new(BigInteger256([
                    0x94445431a26d8517,
                    0x40ea1009c90e8664,
                    0x0efaf3767f01acf8,
                    0x05f615b7d4e6acd3,
                ])),
                Felt::new(BigInteger256([
                    0xcbd99b6d29c69b10,
                    0x0d504670746e09cb,
                    0xe63942d61356f647,
                    0x37cad560be95f9bd,
                ])),
                Felt::new(BigInteger256([
                    0xb65f47cbcb8eaa26,
                    0x8f5822e83a221e9a,
                    0x17158dd9e75891f1,
                    0x0a448afb74b26f6e,
                ])),
                Felt::new(BigInteger256([
                    0x8c543fc8f531bd51,
                    0x7fe4b596a79d486b,
                    0x210c10b8d1382b10,
                    0x308c599ac14d3447,
                ])),
                Felt::new(BigInteger256([
                    0x497a86763c01807b,
                    0x1f404a4972a9cbb8,
                    0x2d7cc8fd042951ad,
                    0x3bb4d8abc79b4d9e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5b3b84b02769f8ce,
                    0x9d0f4e082ed19f70,
                    0x67791d0757661e8e,
                    0x0632d2f110655dba,
                ])),
                Felt::new(BigInteger256([
                    0xbf5632dff285f398,
                    0x2329dfffc257a09e,
                    0x5c2ad5f18b707d42,
                    0x0a71dad612dc9fba,
                ])),
                Felt::new(BigInteger256([
                    0x98b19712ac09bb44,
                    0x6a4a4873e4ae0541,
                    0x44eb30b2677ce816,
                    0x1a14a8f79f8e8252,
                ])),
                Felt::new(BigInteger256([
                    0x19974df0b8c1a1de,
                    0x693c7d42474f72bf,
                    0xbaa85c5b7cdf1c47,
                    0x0077b1492a64deff,
                ])),
                Felt::new(BigInteger256([
                    0x9a46a95527fcdfd5,
                    0xbaf63d017e89a5a3,
                    0xd85f7c7583bdd262,
                    0x143e35f328afe7db,
                ])),
                Felt::new(BigInteger256([
                    0x101cefa011ba32db,
                    0xef310778202ebcec,
                    0xc50e9e910749fab2,
                    0x12f2cc7f7bdf7501,
                ])),
                Felt::new(BigInteger256([
                    0xb186f98b2727c285,
                    0x0705103368fb876c,
                    0x248a678dd5b8a344,
                    0x22b726e2a0ff4ad8,
                ])),
                Felt::new(BigInteger256([
                    0xf8b5fbb01e048346,
                    0x07e18bc86385a6d5,
                    0x1e360979cbe59519,
                    0x2ad6e873a8d55251,
                ])),
                Felt::new(BigInteger256([
                    0x7ed2a4404cad4e66,
                    0x147977e73a553e1c,
                    0x28529ff18fdbc672,
                    0x29f76f9a3a05e49d,
                ])),
                Felt::new(BigInteger256([
                    0x0c4986fc97a50fa6,
                    0x017d8c60d44afe8c,
                    0x62a93e3f039153eb,
                    0x22b51ed0793d51d7,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbb9941802985b1e0,
                    0xd344489832b261ae,
                    0x4f43ddfd8a518c5d,
                    0x3b34af8a5dbaa0b3,
                ])),
                Felt::new(BigInteger256([
                    0x98ccb4053397a507,
                    0x024e60fd0c58b10e,
                    0xaa5989628cd521cd,
                    0x140c5e17e2032d20,
                ])),
                Felt::new(BigInteger256([
                    0xa590046aee7b4111,
                    0x68e07d9ab3bdfa79,
                    0x2663b6c1b5d9e60e,
                    0x1eb85afdacc80276,
                ])),
                Felt::new(BigInteger256([
                    0x51b9fa3ba678a551,
                    0xf6372507943889fe,
                    0xe28fd4522b10cf19,
                    0x326e4e22308291dc,
                ])),
                Felt::new(BigInteger256([
                    0xa32d0f59a04edbd1,
                    0x1df586c805440716,
                    0xf7865b0fee232052,
                    0x2667029e3ead8f1b,
                ])),
                Felt::new(BigInteger256([
                    0x0c494b843d5ac83b,
                    0x820bad2a84aa249f,
                    0x1ddcc316b4648e56,
                    0x24bf5a5859fa9705,
                ])),
                Felt::new(BigInteger256([
                    0x50770d20b675c1f0,
                    0x82e06395180ce052,
                    0x82135d6e3d1eb940,
                    0x2f52df16092e6c5c,
                ])),
                Felt::new(BigInteger256([
                    0x1eb7965ab5e93788,
                    0x23389f23484b591f,
                    0xa99e0c5cce5cc6f0,
                    0x1eb95b76b567b26f,
                ])),
                Felt::new(BigInteger256([
                    0x413d49bb198eb841,
                    0xb3474bba9ccf9e04,
                    0xfc7e4e464afe5121,
                    0x3728fec26e9011c2,
                ])),
                Felt::new(BigInteger256([
                    0xe1f8c6f18101514d,
                    0x5035c8cd66ac35ba,
                    0xf33befdea1f36726,
                    0x0136ff885a6df713,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd914738d5b46494b,
                    0xbc90696f16987f52,
                    0x6b6f80575a5f30c6,
                    0x33d78a42799cf09c,
                ])),
                Felt::new(BigInteger256([
                    0x7e4dab7372c52e08,
                    0x1b4f243a4819a8d8,
                    0x9c24d6e73f28a0f5,
                    0x1dcd2491269e58b0,
                ])),
                Felt::new(BigInteger256([
                    0xca573759d4764e91,
                    0x17cd7ee0be389bd8,
                    0x3d6f26484481990c,
                    0x105134ee41e1493e,
                ])),
                Felt::new(BigInteger256([
                    0x8474ddacd097557c,
                    0xcedc3cfb06ddb2c3,
                    0x56d8b2c69352e808,
                    0x11d169db98f5409a,
                ])),
                Felt::new(BigInteger256([
                    0xc7cdc77252f76449,
                    0x3e4afc306d10c621,
                    0x1389a599171adcec,
                    0x1a79aef37fe618d9,
                ])),
                Felt::new(BigInteger256([
                    0xb30498675beb812f,
                    0x22a09ad5b27fe0c8,
                    0x1558d499cde0ab8a,
                    0x1efd0ef9dd16af55,
                ])),
                Felt::new(BigInteger256([
                    0x680d1156b7713d2c,
                    0xdcf2c09edcb324d7,
                    0xa5a5329484b860f8,
                    0x26be02e0394a8203,
                ])),
                Felt::new(BigInteger256([
                    0xf75819ef3d12fff4,
                    0x245d877c45d48f1a,
                    0xcad228024e93aa38,
                    0x2e623d9957dc1a32,
                ])),
                Felt::new(BigInteger256([
                    0xd4717f5a0bc64c0d,
                    0xbb79271f17ed4402,
                    0x7064d9760b33bc4e,
                    0x0bd92b4e4ce918d6,
                ])),
                Felt::new(BigInteger256([
                    0x0b3c1b2d913c92be,
                    0x50cfb3eee7a4280a,
                    0x0660067734e6debd,
                    0x26b61d01ddd375b2,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x7a691d626dd1a7ab,
                    0xee326407938b1bd5,
                    0x9ff49223cff7e5c2,
                    0x0ffb8142fdd4f6c4,
                ])),
                Felt::new(BigInteger256([
                    0x4e1b4e71ccc1bc0a,
                    0xa3fecde8a640b61d,
                    0x2c060b657087f258,
                    0x27d051e34e074ccc,
                ])),
                Felt::new(BigInteger256([
                    0x4a43b6580a6ebf19,
                    0x9607744f07697c8c,
                    0x3758cb3c0fe9f017,
                    0x09eeaad63d701223,
                ])),
                Felt::new(BigInteger256([
                    0xd57367dc62906f23,
                    0x27110e11c17609ed,
                    0x8e43a76d834ceed0,
                    0x056bddb9bc59aca0,
                ])),
                Felt::new(BigInteger256([
                    0xbd55ab5665ca9019,
                    0x219626975dd18826,
                    0x2a7cec5186ec70f5,
                    0x37ffb118b12f0e61,
                ])),
                Felt::new(BigInteger256([
                    0x747934303180f7ed,
                    0xf7fcd754c90c3445,
                    0x6a7b0fab2c086888,
                    0x0f6fb3a30902a750,
                ])),
                Felt::new(BigInteger256([
                    0x169b65e686a01cd0,
                    0xbd96639f9caecbbb,
                    0x83d73e1d8642630d,
                    0x2eeba1b4a5ed19bf,
                ])),
                Felt::new(BigInteger256([
                    0x25a0a726b9fd69e6,
                    0x9d14d2f71cade8b6,
                    0x57b6f9ed02b4df36,
                    0x3df7ee63d02e850a,
                ])),
                Felt::new(BigInteger256([
                    0x03be03d37381132a,
                    0xde6ae1367cc41aed,
                    0x588c2626437a44d4,
                    0x3ab6f0b38327fdac,
                ])),
                Felt::new(BigInteger256([
                    0x2946d368514a1e5c,
                    0xd0e674aebd33950d,
                    0xfb61d9983a9b3252,
                    0x22a65b097d7bedc9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdfbbf61641fb75ba,
                    0xeb3c4ee78359692a,
                    0x8370185ee96db5aa,
                    0x3dbcdd714e6701ec,
                ])),
                Felt::new(BigInteger256([
                    0xd61aadd0865a030a,
                    0x9d664ed1b5f5ca04,
                    0x1d514a40e2639c42,
                    0x380a629322d12dc1,
                ])),
                Felt::new(BigInteger256([
                    0xb3a65d4cd02dde21,
                    0xc769178e95798d32,
                    0xabd0428d1850fdb5,
                    0x29ae85751bdba2c7,
                ])),
                Felt::new(BigInteger256([
                    0xd3d7427febc209bd,
                    0xeb4b9ebdc3ae16db,
                    0x4b3a860139966732,
                    0x22c96505fbed9aba,
                ])),
                Felt::new(BigInteger256([
                    0x81c1e472541d5c80,
                    0x328896d803ea6b8a,
                    0xcd2a2ef8f40d8be9,
                    0x2c552695c5db5bb1,
                ])),
                Felt::new(BigInteger256([
                    0x3d5181663fdc4ed6,
                    0x764cb194f430c52f,
                    0x6ba6d1b76ef9c7a2,
                    0x1a76519ea055beba,
                ])),
                Felt::new(BigInteger256([
                    0xdefdc76165d87cc5,
                    0xe006e2ef9411569b,
                    0x436fd9f0a1b1a4f4,
                    0x37de0c9f67cbea24,
                ])),
                Felt::new(BigInteger256([
                    0x30288e190758f8e4,
                    0xdef575ca41f1df09,
                    0xddd15f66ecc1733c,
                    0x298375f99db16c9e,
                ])),
                Felt::new(BigInteger256([
                    0xd8c2726be5e2148c,
                    0x1e16ab1fe7831187,
                    0x91b0ba8a1445df3f,
                    0x11314ac829060eec,
                ])),
                Felt::new(BigInteger256([
                    0xdf39b27c3e204403,
                    0xebdccd36782f3f50,
                    0x460808e011d7c074,
                    0x0cc1eb322d3b7c77,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xfe3609133eb384cf,
                    0x58a4a66e507c37e3,
                    0x35c3195dc111f4d7,
                    0x21a50917156e5d62,
                ])),
                Felt::new(BigInteger256([
                    0xfbd13aa4f31c94dc,
                    0x8fc33c402c1337e8,
                    0x7de5aa7aef36eaa8,
                    0x05010c98621fa87c,
                ])),
                Felt::new(BigInteger256([
                    0x1e8e9861cd7a3baf,
                    0xdbd9d9b26fdc3556,
                    0xc0c5202767f033a3,
                    0x23f54280a05c2857,
                ])),
                Felt::new(BigInteger256([
                    0xe3ea1482cbdcaf64,
                    0xf51f5d5e35291ca0,
                    0xbfa7e4f54eafc49a,
                    0x31737c1ab96f5502,
                ])),
                Felt::new(BigInteger256([
                    0xeda3a330f7aee441,
                    0x3943d8fd8892bc0b,
                    0x0219ddca202e6acf,
                    0x33b27ca486a6cc7b,
                ])),
                Felt::new(BigInteger256([
                    0x7b26f4e367ce614b,
                    0x5550380e8fd33d24,
                    0x6ac5d49e4695143b,
                    0x1f55aa3270e84ad1,
                ])),
                Felt::new(BigInteger256([
                    0x7892ddaa06cce687,
                    0xee06d3467d4c3245,
                    0x954ed58b1d874dc7,
                    0x258bf340f205d0a3,
                ])),
                Felt::new(BigInteger256([
                    0x8095a2c8a3dad41c,
                    0x68782f0fe31702fd,
                    0x287b003616cd8215,
                    0x2528f518fbf859bd,
                ])),
                Felt::new(BigInteger256([
                    0x2a35ef3ffa2cbb79,
                    0xddc92f24a7f7418f,
                    0xfa7542ccfbc32439,
                    0x24662795829aab2d,
                ])),
                Felt::new(BigInteger256([
                    0x9c90f6b781e3def8,
                    0x583697ac6929ea5d,
                    0x6cb4b9227dd3e17a,
                    0x085cabef28fecdb4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x41a06f6c7dc0398b,
                    0xc5d7716e0b3ce203,
                    0xbd7785d856df548a,
                    0x00b77eaa7d33d17d,
                ])),
                Felt::new(BigInteger256([
                    0x7befa7413268a823,
                    0xd1941caeddbdf6c9,
                    0x0e99d6b8a55f8f75,
                    0x0231e879d71295cd,
                ])),
                Felt::new(BigInteger256([
                    0x91105098cfdce1ab,
                    0x3c2e12fea352be22,
                    0x79767767b974c945,
                    0x055effd31e5c5b3a,
                ])),
                Felt::new(BigInteger256([
                    0x67536541d7b376f5,
                    0x2184201c6f91913b,
                    0x6417aea2c96223cb,
                    0x2cbf82b646a09afc,
                ])),
                Felt::new(BigInteger256([
                    0xb9ecd4d4da4099fa,
                    0x6b91b47122f5af05,
                    0x4979b4164cdce42b,
                    0x020afae5b1e71306,
                ])),
                Felt::new(BigInteger256([
                    0x8e5e313ea6f39166,
                    0x4339718e8399ede2,
                    0x90b56b6ceb4c4011,
                    0x22b067bda999fc95,
                ])),
                Felt::new(BigInteger256([
                    0x7b021c60321f2520,
                    0xb841eeb28a558aa1,
                    0xa8a3000f5ef3ce71,
                    0x3c9cbe9457c000fe,
                ])),
                Felt::new(BigInteger256([
                    0xdac43180c9fbe5a3,
                    0x586854dc3db7d9c5,
                    0x3795e1c821c7c3df,
                    0x12b096cba9276fba,
                ])),
                Felt::new(BigInteger256([
                    0x7a49762501fbb54f,
                    0xe56174c6878c37e8,
                    0x48ac5712b23bbbdb,
                    0x3b15ac425eaf1eec,
                ])),
                Felt::new(BigInteger256([
                    0xf56a4fb03b1e3dc2,
                    0x3549f464d282fa18,
                    0x67bc5c3cfbddbc7f,
                    0x0a0a6db12ea83790,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x6987c198af776d71,
                    0xdc79defd8eb9c4f0,
                    0x32a576359a010dec,
                    0x35bbf962801aa3f8,
                ])),
                Felt::new(BigInteger256([
                    0x69745d2d351e1fe2,
                    0xe074b163220bedb3,
                    0xf2ec0f5c4b8c0e3f,
                    0x267da2c41b8c0a0d,
                ])),
                Felt::new(BigInteger256([
                    0x4d7eef52b69013b7,
                    0xeae81cdf3ffebcbe,
                    0x8bbd2c2b2d805f03,
                    0x2034b701e69c6ece,
                ])),
                Felt::new(BigInteger256([
                    0xa3316808549c9177,
                    0x7e486829ffce98f8,
                    0xf673534849d1a6d6,
                    0x31a0f7820d80866d,
                ])),
                Felt::new(BigInteger256([
                    0x9ccf0aacd80a8257,
                    0x46b209bd3008d71a,
                    0x743e9c953b61296e,
                    0x33b436dfe15ceca4,
                ])),
                Felt::new(BigInteger256([
                    0x18505e4b4e9f483e,
                    0x411e1db8cd26ff6a,
                    0xfa0da9d39ce31795,
                    0x2cdf9ae06dc51440,
                ])),
                Felt::new(BigInteger256([
                    0xa4928a4bfb4dcf3a,
                    0x6be2e35a443995c8,
                    0xed6662cca295b570,
                    0x3c4784bb7f26feea,
                ])),
                Felt::new(BigInteger256([
                    0x465ff229e8fb7bc2,
                    0xe728c6b1ca12a3a6,
                    0x367fbf99aedeec1f,
                    0x3a771e3991f04181,
                ])),
                Felt::new(BigInteger256([
                    0xcbcd355f0555409c,
                    0x4eaf899951bad11a,
                    0x47b8cec67a246a07,
                    0x3aff489a64295370,
                ])),
                Felt::new(BigInteger256([
                    0xfd75fe867e15c482,
                    0x3da266267ed15f84,
                    0x11a7a2e265a7e354,
                    0x3e6ff0f1597fc56f,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa5e67b194e3470e0,
                    0x4b9b4e440179ad50,
                    0x6f1653e7817b85f1,
                    0x1e1b15834b17f6c7,
                ])),
                Felt::new(BigInteger256([
                    0x8814fb60176060b5,
                    0x477706159aec3b2e,
                    0x00d7e70db2d81733,
                    0x287acbacc90563e0,
                ])),
                Felt::new(BigInteger256([
                    0xabb19de95e115216,
                    0x0a1db1ecad2f2c0d,
                    0x7f56e60454d80ec7,
                    0x2334141b2a6babb0,
                ])),
                Felt::new(BigInteger256([
                    0xd6c20f8d608bda2d,
                    0x1058b462f452e58d,
                    0x0e989c31504a717b,
                    0x2765542e40cd9d48,
                ])),
                Felt::new(BigInteger256([
                    0x95ca57d1ed78b3fb,
                    0xbe9070c0c5417bb0,
                    0x3b03957f03a903b5,
                    0x177712a2cd6cdafe,
                ])),
                Felt::new(BigInteger256([
                    0x899c3f48ea95e48d,
                    0x6c3129c6fc48b709,
                    0xfa9aa78d61d7cc35,
                    0x084b6ec22284e9d1,
                ])),
                Felt::new(BigInteger256([
                    0xc309764b8e9b31e5,
                    0x38baf06f7e7dd8cd,
                    0x8e0620e2911c5501,
                    0x1ec3526f435ce753,
                ])),
                Felt::new(BigInteger256([
                    0x49e7419ba1f5291e,
                    0x5b00af7656c1ecb9,
                    0x652302498ad6b6ca,
                    0x12fceb19def4c42f,
                ])),
                Felt::new(BigInteger256([
                    0x3665c0e2307f4d1f,
                    0x2b70a798d48f27aa,
                    0x92e7cf171a170263,
                    0x08527c3a47c2fdec,
                ])),
                Felt::new(BigInteger256([
                    0xf86fd1c522179ab3,
                    0x9902713327d3247a,
                    0x8fa034b195813f31,
                    0x2d24d55646b939c9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb77b503f01e8b38a,
                    0x3b55ff020f13a61b,
                    0xcfa2a43bb68acc75,
                    0x2026728e44991b36,
                ])),
                Felt::new(BigInteger256([
                    0x814b97522fc0e16d,
                    0x18685841cd13a3aa,
                    0x0a7de7b7d02220dc,
                    0x1f5fe11bf0ecbd8e,
                ])),
                Felt::new(BigInteger256([
                    0xbcca11c7b468b06c,
                    0x3254f56572d222d7,
                    0xa562f1edc4fce65c,
                    0x36e0c7a25872e861,
                ])),
                Felt::new(BigInteger256([
                    0x5cca0268caa1ea1b,
                    0xdd9d87f9a20d8070,
                    0x9a2b724b2cdac92d,
                    0x1101bfc43a776d92,
                ])),
                Felt::new(BigInteger256([
                    0x28e498384cb9322b,
                    0x6f0282deaa09135a,
                    0xad826ec1dc6dc558,
                    0x30fbfeb9324fc236,
                ])),
                Felt::new(BigInteger256([
                    0xfb6d840096bc2481,
                    0xa58d93e96fafd585,
                    0xaf29f1153e2cd1f2,
                    0x397872aba93f3eb0,
                ])),
                Felt::new(BigInteger256([
                    0x391639d40e4bd771,
                    0xf55096f81a5ac0a5,
                    0x079013fb8bef2183,
                    0x0ed962e1de61f825,
                ])),
                Felt::new(BigInteger256([
                    0xa9c226ee61b070ba,
                    0x7a1a4ad6b898c22c,
                    0x9f9108d81faa2579,
                    0x390f39aca797400b,
                ])),
                Felt::new(BigInteger256([
                    0x3d478dfdd0cba4ea,
                    0x9c6cf08319349ac4,
                    0x9a862612f338ea1a,
                    0x2bad3bcf54f27f85,
                ])),
                Felt::new(BigInteger256([
                    0x9a9437ebdb4eee15,
                    0xc91d09695c1bc75d,
                    0x3c2916216015a183,
                    0x0298ff6c2aa8044b,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x8e1e6c1292544d33,
                    0xaa7d4fa04ed13b27,
                    0x86ab8a6e3e19c5e1,
                    0x21299d403d3d1441,
                ])),
                Felt::new(BigInteger256([
                    0x77487f35f5bd106b,
                    0x62a2219319466945,
                    0xd130c3db2bb2025f,
                    0x251f68b775faba81,
                ])),
                Felt::new(BigInteger256([
                    0x60396a188f9cea88,
                    0x71ce46713a6891a3,
                    0xd78465579e9491f5,
                    0x32230280f4e20f04,
                ])),
                Felt::new(BigInteger256([
                    0x1a3930664f635172,
                    0xca1599881069a132,
                    0x4feef4db1ceb6794,
                    0x20e797ed3ce05f28,
                ])),
                Felt::new(BigInteger256([
                    0x246a476c9bb67b30,
                    0x37f2f70f5e264249,
                    0xe3f5feeddd021887,
                    0x1864c25dc6547e62,
                ])),
                Felt::new(BigInteger256([
                    0xbece1f7ce47288f7,
                    0xe30b2f1423ec3f21,
                    0xbb086b29aa756323,
                    0x210dc4a70b7cec4c,
                ])),
                Felt::new(BigInteger256([
                    0xfbb439d40700b40c,
                    0x1f5ffb9614b72fb2,
                    0xbd13ee7071907f4d,
                    0x1117a26c97de2f04,
                ])),
                Felt::new(BigInteger256([
                    0xac35e57e13f382c1,
                    0xc77e7682e88ec274,
                    0x844d3a54827e9921,
                    0x31f2cf9fb32eaeed,
                ])),
                Felt::new(BigInteger256([
                    0x96c3355f57503bb4,
                    0x318135c9ec18ddad,
                    0x23d00477622fce92,
                    0x35e782827ddece8b,
                ])),
                Felt::new(BigInteger256([
                    0xdc1531cd6563f94f,
                    0xabdc4ec5dea32dd9,
                    0x293a708e968a200d,
                    0x24cd38cabf192fde,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 10],
            [
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x174a7d14ffffffc9,
                    0xa2d521da00767b12,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x26f6d688a01bff84,
                    0x3a4ac155f7f16c96,
                    0xff190d16c3c0a2e2,
                    0x1ad03cd2dfa1d157,
                ])),
                Felt::new(BigInteger256([
                    0xaa51434b3c6a07be,
                    0xd90d0a4aa5bb01e8,
                    0x92d96f7f8949df8d,
                    0x3453e36eb48cd4b3,
                ])),
                Felt::new(BigInteger256([
                    0x1842ba6f3ac09358,
                    0xe07ff31b2540a692,
                    0xd3435858c785a153,
                    0x101997df2e17a2c2,
                ])),
                Felt::new(BigInteger256([
                    0xbd2e91dc4f7b9fe7,
                    0xf4f7c53b56fc9405,
                    0x1e7b598976a0bac4,
                    0x11e392e92aaca54d,
                ])),
                Felt::new(BigInteger256([
                    0x9cddcdcd40f0834d,
                    0x8a483ee8e56c3066,
                    0x72e9f000d814c535,
                    0x2b71220ce3116dbf,
                ])),
                Felt::new(BigInteger256([
                    0x53eefce0a7c54f60,
                    0x4fe509d29d8ff793,
                    0x75d9a9c97fd7279c,
                    0x360661d34e52d8d3,
                ])),
                Felt::new(BigInteger256([
                    0x30e97880e4ed3246,
                    0x7ca08fec40881ced,
                    0xfeafec9b3a052092,
                    0x1bb7898a774dac7f,
                ])),
                Felt::new(BigInteger256([
                    0x6d3712ba01f57cf3,
                    0x08767881e423eba2,
                    0xc71dd105357703f0,
                    0x1ac0689cb2435c96,
                ])),
                Felt::new(BigInteger256([
                    0x269865807063ed9e,
                    0x7e7bc2a103f74253,
                    0x1d9d5d3b63049c83,
                    0x22f8ca33ecdf494b,
                ])),
                Felt::new(BigInteger256([
                    0x2f4554dbcc520cdd,
                    0x01944e89359234e9,
                    0x82e253ac0cb4e08e,
                    0x2fc476c02e3bd9ea,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe42732e0c1d06462,
                    0x850b02cc241ed7eb,
                    0x383401c2ce7643d5,
                    0x103b57f34361440b,
                ])),
                Felt::new(BigInteger256([
                    0x407546376723764a,
                    0xb93d66f581329c8e,
                    0x8d93c79ba0cafb7f,
                    0x1990d55b02f0258a,
                ])),
                Felt::new(BigInteger256([
                    0xff2d0564295e5568,
                    0xad630c94f421bd4f,
                    0xf8da8b49ffc8b90a,
                    0x0616f845a2de6241,
                ])),
                Felt::new(BigInteger256([
                    0x120487700427c672,
                    0x2f8c619052867f02,
                    0x7fafa42b4fa331c8,
                    0x14939aa2643b41d4,
                ])),
                Felt::new(BigInteger256([
                    0xecb6e3ea652fa560,
                    0xd79e9d8066a858c5,
                    0x0d0f04e56898bf23,
                    0x3e91bfd98ee719c3,
                ])),
                Felt::new(BigInteger256([
                    0x31e68ecf3148f8af,
                    0xf6277c59f9a4ca30,
                    0x2cba71241f62f836,
                    0x162a17a027979aab,
                ])),
                Felt::new(BigInteger256([
                    0x0c66622a13bc5368,
                    0x71a24ea7b478a3ce,
                    0x457bfb924f90bdb5,
                    0x25b6e3fdf0f72ca7,
                ])),
                Felt::new(BigInteger256([
                    0x1c6f6c1aec5cb7eb,
                    0x8f7af20a01af974b,
                    0x1b025ebc94b445b1,
                    0x3d173d7836ea7edb,
                ])),
                Felt::new(BigInteger256([
                    0x60b83276aa495f96,
                    0x49566c803e054489,
                    0x3c100256064f22ad,
                    0x14bfc9a65d8b90a8,
                ])),
                Felt::new(BigInteger256([
                    0xb6d72398668c716f,
                    0xd70461ffca08f14e,
                    0x09793a5063daf80b,
                    0x35e9c03460d5de46,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5c85d8fd92ec99fd,
                    0x8180be800326c532,
                    0xe7cf661ebe3aa3b8,
                    0x05e0b193ec4eb35f,
                ])),
                Felt::new(BigInteger256([
                    0x27a68e05b7031485,
                    0x589d8ed08e38ef64,
                    0x3038f6c1460b4d1f,
                    0x3711fab830a2f291,
                ])),
                Felt::new(BigInteger256([
                    0x80be66645ac08157,
                    0xbab39b4e5808d835,
                    0x681e7ad70b360116,
                    0x04566682225a7d50,
                ])),
                Felt::new(BigInteger256([
                    0x434d207ca0563e33,
                    0x3e4803ec50796371,
                    0x89046cc764e80e1d,
                    0x018738a35e6bb13b,
                ])),
                Felt::new(BigInteger256([
                    0x460ff0eca82b7594,
                    0xb3191856d0359301,
                    0x7edd91f5df202059,
                    0x15e0ca2092100a26,
                ])),
                Felt::new(BigInteger256([
                    0x8fa5a30975bc8802,
                    0xdfeb483d90e97a9a,
                    0x23f36b6566f0e2df,
                    0x01da46ebc86bb5be,
                ])),
                Felt::new(BigInteger256([
                    0x748f04a98b9436f2,
                    0x73573e94b261d098,
                    0x3e660c54fa73e9a9,
                    0x11aa3cd3357030d9,
                ])),
                Felt::new(BigInteger256([
                    0xd63fe7ace969857e,
                    0xe7b48bfbcba90af4,
                    0x0da1b856ab27067a,
                    0x157fb43add4598d4,
                ])),
                Felt::new(BigInteger256([
                    0xe9e1841c7d36ac76,
                    0x4d2acce369fa171c,
                    0x14837d63087ddddd,
                    0x30fefdee81497da7,
                ])),
                Felt::new(BigInteger256([
                    0x8467421590a163ac,
                    0x36164e7dc0fef4de,
                    0x021cb4f330eeaa26,
                    0x3cb95168f2e1009c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x48cfef09a553b46b,
                    0xbbb2408b0e6b9d91,
                    0x4f6749428652a1f1,
                    0x031acb6899b719d0,
                ])),
                Felt::new(BigInteger256([
                    0xb5a76929d3fe4598,
                    0x2941899a09ac9295,
                    0xc3769b278e9d26f8,
                    0x3642926e63052546,
                ])),
                Felt::new(BigInteger256([
                    0x539933b734baef36,
                    0xf9f9e129bcaf9217,
                    0xff8b159534441727,
                    0x13d0f09eecfaa870,
                ])),
                Felt::new(BigInteger256([
                    0xa8cf853f6c79fe03,
                    0x123d73014a83626d,
                    0x16f147b34bfeadb4,
                    0x2b1d3a95e7b2468f,
                ])),
                Felt::new(BigInteger256([
                    0xeb17030bdcced22b,
                    0x488e5706c7733dab,
                    0xf2f84397828141c3,
                    0x00cd80806147be8f,
                ])),
                Felt::new(BigInteger256([
                    0xdd39ba5adf5a23e9,
                    0x0df2c86fba717d32,
                    0xcf66a8faa9740cc6,
                    0x28c4315bc1181d88,
                ])),
                Felt::new(BigInteger256([
                    0x615acfc9ac1ad1fe,
                    0x72830705dde1bc75,
                    0x5774b217c25e509d,
                    0x1dbc3e8bd5c79b62,
                ])),
                Felt::new(BigInteger256([
                    0xe49fae06768f2a9f,
                    0x29db613e77c98fa8,
                    0x441f896acfc28c2d,
                    0x28577f155e466767,
                ])),
                Felt::new(BigInteger256([
                    0x9e0d7b1632d03afe,
                    0x6b800c2dfc34fab7,
                    0xa7605380587bf183,
                    0x074a54f115f6dff2,
                ])),
                Felt::new(BigInteger256([
                    0xe03fa228cb83cbc2,
                    0xb55c001069e7cd88,
                    0xd1ca1320e75a8b19,
                    0x23079e17836a3655,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe55a983cf9094976,
                    0x7a0b1dd3c4994bf4,
                    0x968354b2d7339fd6,
                    0x1d1ba340244b1345,
                ])),
                Felt::new(BigInteger256([
                    0x5d324bf5807f9a81,
                    0xd85fbd34d87a0405,
                    0x429a20b91e1c766c,
                    0x2df61fb719027f94,
                ])),
                Felt::new(BigInteger256([
                    0xc86cbbf55b9d664a,
                    0xd46d8c680f90d858,
                    0xbb15c80471f6d5b3,
                    0x384fb356f0ddbd39,
                ])),
                Felt::new(BigInteger256([
                    0x97d7ba2562242eac,
                    0x49b76c00a152fa21,
                    0x1b7c26444661f722,
                    0x325480c3b884018e,
                ])),
                Felt::new(BigInteger256([
                    0xf720ab1da4b0de2c,
                    0x210ad937d4c8e244,
                    0x3503cd53f7987bb7,
                    0x1fcdf1f9cfcfdb7b,
                ])),
                Felt::new(BigInteger256([
                    0xbde727f34147a5bb,
                    0xb4fb8da87c54cc71,
                    0xd3299cfc3c7aa518,
                    0x34ae8b077dad0161,
                ])),
                Felt::new(BigInteger256([
                    0x2adc684866d4a716,
                    0x0500042bf0d7f5b6,
                    0xd10a998de782e37d,
                    0x1ca82cd879689fee,
                ])),
                Felt::new(BigInteger256([
                    0x35de747b91f091e0,
                    0x7bc3bfda7e5ee74b,
                    0x20428b9adbe442e4,
                    0x33613f253ad460b1,
                ])),
                Felt::new(BigInteger256([
                    0x514943af37aa945b,
                    0x32f1784530de247e,
                    0x84e624e880d5006c,
                    0x273cac7cb626a935,
                ])),
                Felt::new(BigInteger256([
                    0x94be5ca455d2882b,
                    0x9aca6698ad6455f0,
                    0x2c53268bd66a33df,
                    0x2f316eeda7790a87,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x14cef9cf7f05cae7,
                    0xb2b14f0fee9c59cc,
                    0x91f34c620a419717,
                    0x1a4839046505f061,
                ])),
                Felt::new(BigInteger256([
                    0x4e325e15be035e01,
                    0x7701701746803fa8,
                    0xc9b3b7a2cb920a97,
                    0x015c4eb86d0145d2,
                ])),
                Felt::new(BigInteger256([
                    0x445946a1c8263466,
                    0x8aee7ca3ddcf24e9,
                    0x03f753fd25676682,
                    0x1a7c621dc799dee5,
                ])),
                Felt::new(BigInteger256([
                    0xddd643f5471b8a87,
                    0xb2db9e1a99c0495b,
                    0x42409d367be9b508,
                    0x2bf5e16e5b414f6f,
                ])),
                Felt::new(BigInteger256([
                    0x52fc441adaa63af6,
                    0xb1c6fcf5ea155cec,
                    0xcbf03293a91d3343,
                    0x15fe9b6a696bda06,
                ])),
                Felt::new(BigInteger256([
                    0xcd259cae2cb17bf0,
                    0x87d67212a552b563,
                    0xf8e51035c911f40e,
                    0x1d3ab401fa7ea68b,
                ])),
                Felt::new(BigInteger256([
                    0x25e729cf503d5274,
                    0x57f9a8f530083e10,
                    0xc151e55089f4d0ed,
                    0x2fef3b3d93a3a95d,
                ])),
                Felt::new(BigInteger256([
                    0xcae4d1eee9d02dd6,
                    0xf98921ced30c843e,
                    0x07f593eb4ad512e7,
                    0x3bfaa1133ed0ea06,
                ])),
                Felt::new(BigInteger256([
                    0xce10e7466337d3e9,
                    0xce0bf6bd2bb79852,
                    0xdfc3a6b08a9a6e79,
                    0x0e72afc2d4456da6,
                ])),
                Felt::new(BigInteger256([
                    0x04041ff67f829298,
                    0x45bd8e5ba82e5032,
                    0x62684d3e1cf38862,
                    0x179dfbf26fe0519d,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
