use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 8 field elements or 256 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 8;
/// 7 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 7;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 4;

/// 2 elements (64-bytes) are returned as digest.
pub const DIGEST_SIZE: usize = 2;

/// The number of rounds is set to 14 to provide 256-bit security level.
pub const NUM_HASH_ROUNDS: usize = 14;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        let beta_y2 = y2 + y2.double().double();
        *t -= beta_y2;
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        let beta_y2 = y2 + y2.double().double();
        *t += beta_y2 + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3]];
    let y: [Felt; NUM_COLUMNS] = [state[5], state[6], state[7], state[4]];

    let g_x0 = mul_by_generator(&x[0]);
    let g_x1 = mul_by_generator(&x[1]);
    let g_x2 = mul_by_generator(&x[2]);
    let g_x3 = mul_by_generator(&x[3]);
    let g_squared_x0 = mul_by_generator(&g_x0);
    let g_squared_x1 = mul_by_generator(&g_x1);

    state[0] = x[0] + x[1] + g_x1 + g_x2 + g_x3;
    state[2] = g_squared_x0 + g_squared_x1 + x[2] + x[3] + g_x3;
    state[1] = state[2] + g_x1 + g_x2 + g_x3;
    state[3] = state[0] + g_x0 + g_x1 + x[3];

    let g_y0 = mul_by_generator(&y[0]);
    let g_y1 = mul_by_generator(&y[1]);
    let g_y2 = mul_by_generator(&y[2]);
    let g_y3 = mul_by_generator(&y[3]);
    let g_squared_y0 = mul_by_generator(&g_y0);
    let g_squared_y1 = mul_by_generator(&g_y1);

    state[4] = y[0] + y[1] + g_y1 + g_y2 + g_y3;
    state[6] = g_squared_y0 + g_squared_y1 + y[2] + y[3] + g_y3;
    state[5] = state[6] + g_y1 + g_y2 + g_y3;
    state[7] = state[4] + g_y0 + g_y1 + y[3];
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies Anemoi permutation to the provided state.
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Anemoi round function;
/// implementation based on algorithm 3 of <https://eprint.iacr.org/2020/1143.pdf>
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x3c06718514a2430c,
                    0x85d4952095869aef,
                    0x013920951986158b,
                    0x2a5ceabda1f1f4e3,
                ])),
                Felt::new(BigInteger256([
                    0x88d2382d5d2e0260,
                    0xc6a2f3b484a677e9,
                    0x3d147ba58264ed83,
                    0x3435267711877d98,
                ])),
                Felt::new(BigInteger256([
                    0x8ed0c49118febc01,
                    0x21b77c575ef677bd,
                    0x4ed0c5a1f600a21a,
                    0x0ff73464b067fd01,
                ])),
                Felt::new(BigInteger256([
                    0xec5bf2dce2fdfc1e,
                    0x699e85a89ccbc68f,
                    0x8f75c9c8341c2580,
                    0x03ac6796183fec94,
                ])),
                Felt::new(BigInteger256([
                    0x276bdcd08deb57f6,
                    0x82e348d4624b9fc6,
                    0x49794b7457baab12,
                    0x22bb68380a3845a9,
                ])),
                Felt::new(BigInteger256([
                    0x57f66f531d72f076,
                    0x475b228d07f841b7,
                    0x7d3d6badee680c21,
                    0x15a570a79fca2ed3,
                ])),
                Felt::new(BigInteger256([
                    0x14bdfcace3adef52,
                    0x67f7fe1aeca6b34e,
                    0xd7d3fcff2ebc9d40,
                    0x146999fc8c15ec88,
                ])),
                Felt::new(BigInteger256([
                    0xed46a36c47adfc42,
                    0xdb533cf78443b3d8,
                    0x4071d0878324aebb,
                    0x26b9d5ff207ff274,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0b8fded0e73a55a3,
                    0x843d10dd0b83fe60,
                    0x640ef2ba035befb0,
                    0x09e6f6d846eae3ee,
                ])),
                Felt::new(BigInteger256([
                    0x44871e572709ba9e,
                    0x423cb3c119e83744,
                    0xb09d3e07fcf1aae1,
                    0x3f99bf4711f0dd0c,
                ])),
                Felt::new(BigInteger256([
                    0x6c12397c456b14fb,
                    0xdafe26a467e32256,
                    0xd1fc295ca9b30bca,
                    0x07b5ba480b1dee4e,
                ])),
                Felt::new(BigInteger256([
                    0xfeee2ecd64e30285,
                    0x9d63a8758decee12,
                    0x32e746eede992f3d,
                    0x105911c03f299e28,
                ])),
                Felt::new(BigInteger256([
                    0xd9936f22649af029,
                    0xe3d003fea2ed1b68,
                    0x864a7a1974f40b66,
                    0x35bc338426a6bc61,
                ])),
                Felt::new(BigInteger256([
                    0x41d1baf741543523,
                    0x81409d47d5939dc6,
                    0xf1a5ffb0e0a54499,
                    0x04fef64664a67e39,
                ])),
                Felt::new(BigInteger256([
                    0x4e1d2fc5f0365d54,
                    0xa91965576f9d9c8d,
                    0x8a8a6206ed265133,
                    0x02a5a1a5cc393a0a,
                ])),
                Felt::new(BigInteger256([
                    0x836ad2b9a19696f9,
                    0x09e3f84e40a0b15f,
                    0x403e3cc1318d7a91,
                    0x2450fe0e405cb5c0,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xeb77cf844c2699b0,
                    0xbeec656f24a99b09,
                    0x7eb4d631eebaa362,
                    0x3fe53be0e9621cd4,
                ])),
                Felt::new(BigInteger256([
                    0xafcea0f0bb0dc010,
                    0xacbe8e4dea2310b4,
                    0x6a9a34152b851ace,
                    0x2172b87bfc596c66,
                ])),
                Felt::new(BigInteger256([
                    0xf86c1d9860566f9b,
                    0x40e84c7f5777bad7,
                    0x5b8bebfbe3bff6a3,
                    0x2d9005b13b350c8e,
                ])),
                Felt::new(BigInteger256([
                    0x61671c3ffc9b3545,
                    0x7934edea348efb78,
                    0xb59a1c493cef12d1,
                    0x3f18af305c4646c9,
                ])),
                Felt::new(BigInteger256([
                    0x357c57ae4c6cd9a6,
                    0x0ea095d0921ed39b,
                    0x950a31cad208dbe6,
                    0x0fa65baf11f3289a,
                ])),
                Felt::new(BigInteger256([
                    0x8b56196b1f5705f7,
                    0x14958e40ab41c2cd,
                    0xedfbd55859bc5c30,
                    0x0cbd28c75c8bbde0,
                ])),
                Felt::new(BigInteger256([
                    0x6281e53d5110e0e2,
                    0x6023ee3eb220321d,
                    0xcb7c6ec69369c3d5,
                    0x2e323915d203d40d,
                ])),
                Felt::new(BigInteger256([
                    0xb82c1c6080da9c85,
                    0xb22b00bf18c7d7fa,
                    0x488fbc7934ca9892,
                    0x15c7d32cff66e9e5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xfd7679514c32d24c,
                    0x125b3ccf75c0f54f,
                    0x01ddc41c2990db6f,
                    0x01421a7b9a60f12e,
                ])),
                Felt::new(BigInteger256([
                    0xf5914e0ea67af1b9,
                    0x3a8fd52803124550,
                    0xd235e6a3d972211f,
                    0x0b4efde68466d47f,
                ])),
                Felt::new(BigInteger256([
                    0x766ece11d35d4f3a,
                    0x0c844a6ba002ce0b,
                    0x28a3b4372b09a157,
                    0x17c03dda74f17bbc,
                ])),
                Felt::new(BigInteger256([
                    0x570de18368a12ee8,
                    0x914355cb17a94028,
                    0x6404bf0756bd0b4e,
                    0x2f54e47bd0bf2063,
                ])),
                Felt::new(BigInteger256([
                    0x25b84d543ab9a13b,
                    0x4114572b2bb34c9a,
                    0x433346c25114aa27,
                    0x266ed16f91d41013,
                ])),
                Felt::new(BigInteger256([
                    0x20d369ac6f05cc1c,
                    0x7e88ab39d5ba9f4e,
                    0xd9256cec17943fc9,
                    0x15e88e11bc6f477a,
                ])),
                Felt::new(BigInteger256([
                    0xd27a508e095bbcda,
                    0x63e7369435fc26b7,
                    0x2edbf92046368d6e,
                    0x15fd47d81b22dfa2,
                ])),
                Felt::new(BigInteger256([
                    0x39b1b90b4b9de83b,
                    0xe87363c9c7d25210,
                    0xd47650682926c7b8,
                    0x27af02e879624fd2,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xca2eb1bb043d05e4,
                    0x77bad7953d6af9d6,
                    0x57270c297f9204ac,
                    0x08da72a6c1d2226a,
                ])),
                Felt::new(BigInteger256([
                    0x571aea1c820ae01c,
                    0x487812301ac67ae2,
                    0x7d13cd99f99f8f40,
                    0x0c659297e1c47ad9,
                ])),
                Felt::new(BigInteger256([
                    0x2f1a2008dd04e5d6,
                    0xc4183068cc82eb2c,
                    0x977089228490225a,
                    0x26bdfdb06ba94d6c,
                ])),
                Felt::new(BigInteger256([
                    0x340dc1931d40e82a,
                    0xf5873dd519b6cc20,
                    0xe0c0e63c4351d358,
                    0x290148de1875a43a,
                ])),
                Felt::new(BigInteger256([
                    0x562f654d91598087,
                    0x2285c41734f8129f,
                    0x9a3a92e900a2ba71,
                    0x38380bd992576182,
                ])),
                Felt::new(BigInteger256([
                    0x07a1f31379b76935,
                    0x7b88b395104ac72a,
                    0x561b7253df10f3a5,
                    0x3bc7b96baaf80668,
                ])),
                Felt::new(BigInteger256([
                    0x9f216b33345995b7,
                    0x8f1f3bc7949224c5,
                    0x0844e766c195392c,
                    0x26b933e403fad9b1,
                ])),
                Felt::new(BigInteger256([
                    0xe8a414f61c1e975b,
                    0x1a49058a83d95712,
                    0xf98587c3c3c5c910,
                    0x0a31ed7ea346e9da,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbb7e7dc81e12cd8b,
                    0x0d9b13bb117278d0,
                    0x8fe2770b572a452d,
                    0x2f9aae8ff560d6bf,
                ])),
                Felt::new(BigInteger256([
                    0xf539e8d32db69e8d,
                    0x7b2fb4491ee326ed,
                    0x89e16c64d5351357,
                    0x2f0f5ff34b5c07fc,
                ])),
                Felt::new(BigInteger256([
                    0x8ef55ee418c7693e,
                    0x8db7f4238dbede30,
                    0x1ecac5536b200126,
                    0x05f86ad95a6d664f,
                ])),
                Felt::new(BigInteger256([
                    0x5ba7d10ec1f9f64c,
                    0x346d0555594f748e,
                    0x724dcf2e06ea41b4,
                    0x0ec203c72c10813d,
                ])),
                Felt::new(BigInteger256([
                    0x59239329082fc8cf,
                    0xdd6d0abefd0a58a6,
                    0xbf975150604b3a41,
                    0x2db29ccf392c4338,
                ])),
                Felt::new(BigInteger256([
                    0xe13c96f56f4bd8e7,
                    0x795712ac685e5b5d,
                    0x66ed0b32d99485f2,
                    0x1420c6605068e35d,
                ])),
                Felt::new(BigInteger256([
                    0xe733f50b0c238a91,
                    0x5168199ca4fcec6e,
                    0xe67f9d8d8bfca7f0,
                    0x1a74eaa0ab0dd0a0,
                ])),
                Felt::new(BigInteger256([
                    0x17dcd2dc5a5c74b0,
                    0x9da80536c68cfbd1,
                    0xf38a12e0719c1edf,
                    0x2b7836319b7da65a,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x9ee664763dba65b1,
                    0x6c71a1cc4f4b4de1,
                    0xc331d2119b64d534,
                    0x05d50bbb5f0a2872,
                ])),
                Felt::new(BigInteger256([
                    0xc8c98db7c0f63917,
                    0x0d84e16a81b61e15,
                    0xb1f8602b451916f4,
                    0x315122f48d5bf016,
                ])),
                Felt::new(BigInteger256([
                    0xec9fab2acaece88a,
                    0xf0898b1ceb54d455,
                    0xd7b636984f2d418d,
                    0x19e84164773929d5,
                ])),
                Felt::new(BigInteger256([
                    0x7895356632e4c4f7,
                    0xcd61597269644688,
                    0x817c026aa48cdeaa,
                    0x14b370684b8eeaae,
                ])),
                Felt::new(BigInteger256([
                    0xcdfe0fe202a4a407,
                    0x85bede6850e4bd66,
                    0x6edea7c16ac550b0,
                    0x11774f2680cec453,
                ])),
                Felt::new(BigInteger256([
                    0xdafa7981bc2e16b4,
                    0xb57afc087a548d6f,
                    0x49f2acd30ea2d159,
                    0x23bd3250516df5d3,
                ])),
                Felt::new(BigInteger256([
                    0x05daf35a4d044040,
                    0x09b3b84532593118,
                    0x0409ea41f70d0ac2,
                    0x0cebd90c5999dbb1,
                ])),
                Felt::new(BigInteger256([
                    0x3b2d7fade29a8ed2,
                    0xef46ce1aa3ca50aa,
                    0xfa58b7aadf367700,
                    0x0e666a49591e0b21,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x6de17ae2d631193c,
                    0x4db5d36d3b38a75a,
                    0x34f2e75e5e7a4095,
                    0x382d94b99521acd3,
                ])),
                Felt::new(BigInteger256([
                    0xb64936ef27dd89a4,
                    0x4b3d2158288b67a7,
                    0xccc1f12f3e0b1eb6,
                    0x39828192dcd9d4e9,
                ])),
                Felt::new(BigInteger256([
                    0xd26475a289659651,
                    0x7cb801e0d17b49cf,
                    0x62cef32e4714c590,
                    0x07d019d4aba39a9c,
                ])),
                Felt::new(BigInteger256([
                    0xd957903af592cd8a,
                    0x9cccdfd33103abe6,
                    0x8e02bc4dae1166ba,
                    0x05301089a5231b7a,
                ])),
                Felt::new(BigInteger256([
                    0x412d37ecb5e49f77,
                    0x8b0efe74f079a833,
                    0xcf0dfd265a5113aa,
                    0x11435fb02aef96c2,
                ])),
                Felt::new(BigInteger256([
                    0x19284a17193978b3,
                    0x5baaec914fbcbfb9,
                    0x8533882b3b6dbd76,
                    0x08d0f2a65d213112,
                ])),
                Felt::new(BigInteger256([
                    0xda17307a579df68c,
                    0xf73acdf938175939,
                    0x42a982dbd2bec746,
                    0x1ecfaee9ecaecd3d,
                ])),
                Felt::new(BigInteger256([
                    0x92465e337024f9c7,
                    0x21abbd17ef3202ea,
                    0xc7b97a0a829863a3,
                    0x0ba1a263be87d7a3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbd28cdff95f8ae08,
                    0x26de6a10ed8b4a90,
                    0xc83b37b1b71e5803,
                    0x105c7648cbfecc1f,
                ])),
                Felt::new(BigInteger256([
                    0x5c5ec6a1551ce872,
                    0x0eede5bb3f0e44f0,
                    0x6b59df35698b2f8e,
                    0x0a983b27ea43b034,
                ])),
                Felt::new(BigInteger256([
                    0x6cd9e394a0b29a23,
                    0x92d03986206301a4,
                    0x979c1b5797e98175,
                    0x1dc841c3ce4dfa19,
                ])),
                Felt::new(BigInteger256([
                    0x4a1216f382816355,
                    0x67a9277753b0e2c1,
                    0xd8d31fd5a72c7d49,
                    0x224b5b1285d26704,
                ])),
                Felt::new(BigInteger256([
                    0xe2b4f9db5f75775a,
                    0x391cdf3ae47d7298,
                    0xd9782ad099a4baef,
                    0x215a3fefc0e86ff3,
                ])),
                Felt::new(BigInteger256([
                    0x9377f9dfe2971b95,
                    0xcb749facfcb893af,
                    0x4ef33722ecfc8695,
                    0x2c7383426387cd39,
                ])),
                Felt::new(BigInteger256([
                    0x98b79c68015489bf,
                    0xb3b5d0938982ca91,
                    0xb8f6cac0ed18787a,
                    0x3fa727ff097221ce,
                ])),
                Felt::new(BigInteger256([
                    0xb2a24298a453a094,
                    0x3ed909a429d5e5a4,
                    0x923560caf228f87f,
                    0x097763521a3e9d3a,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xf9b32b18e7afd05b,
                    0x113ae52e9e1a0996,
                    0x247bfa65f19aaa6e,
                    0x23f073b14d4d8fdd,
                ])),
                Felt::new(BigInteger256([
                    0x12bdf31b23fd3ae8,
                    0x8f22cb092ef72a89,
                    0xadca01cd3bca1b45,
                    0x186b1490e07e8b09,
                ])),
                Felt::new(BigInteger256([
                    0xce77fd89ae1ed592,
                    0xacd01cc7e7fcbaae,
                    0x65840674c267b464,
                    0x3548a6e4989819b4,
                ])),
                Felt::new(BigInteger256([
                    0xe404dfc70072855f,
                    0x167c30c13bf8b865,
                    0xfb711f10791adc78,
                    0x3aaa6f5fe9840a71,
                ])),
                Felt::new(BigInteger256([
                    0xb67a9ba3dba35085,
                    0x4336db08d7484c09,
                    0xa77410a5b7eca903,
                    0x0c10181cf5330f3a,
                ])),
                Felt::new(BigInteger256([
                    0x2223639db107d91a,
                    0x31558572ad1b62d9,
                    0x01f2b9ef0f055d4a,
                    0x0812b7e99bac38ba,
                ])),
                Felt::new(BigInteger256([
                    0xac7b00fd17d5468a,
                    0x06b5ce738f562588,
                    0x07d2e1d63eca325d,
                    0x24f3125d0f9fb9cd,
                ])),
                Felt::new(BigInteger256([
                    0x90c468b170e66761,
                    0x0f4580970f0a19fb,
                    0xdaa8c423de34eb8b,
                    0x05b3aa9676182382,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa97ca094f391f024,
                    0xfcc5b50ff9acb55f,
                    0x41b3b2f07397d341,
                    0x01158a0d70ddee61,
                ])),
                Felt::new(BigInteger256([
                    0x30f1c3b05203ec15,
                    0xc83b6876cb0612d1,
                    0x5ad3678f3f785678,
                    0x035dd1c03849ce56,
                ])),
                Felt::new(BigInteger256([
                    0x6d28cc78132d41c6,
                    0x0e217896ab2ffc98,
                    0xfc3893329a280ffa,
                    0x0daad9834c9d89bd,
                ])),
                Felt::new(BigInteger256([
                    0x090dd2be8c72ac20,
                    0x868a257c0dbfa93e,
                    0xe578172f786e14dc,
                    0x14737d7bc0535632,
                ])),
                Felt::new(BigInteger256([
                    0xf5e99390421ded1c,
                    0x50ccdd27bd1a84ba,
                    0x197643b7007a321c,
                    0x2eeb78e1bcd6889b,
                ])),
                Felt::new(BigInteger256([
                    0x446f3a8157e180d8,
                    0x694c23b9cccaef4d,
                    0x894f1032237d888b,
                    0x1dd32aa2af76cd4e,
                ])),
                Felt::new(BigInteger256([
                    0x4c22dd4cf3fa9ca0,
                    0x811ce4e6b37679c6,
                    0xb8e33d05141a11ba,
                    0x20aaeea814a14336,
                ])),
                Felt::new(BigInteger256([
                    0xf37b8a1e595ff7ce,
                    0x9824b1c7232e955c,
                    0x7cd486af0b074f7b,
                    0x1d02c03d522e66ec,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc7de13553f68dbbc,
                    0x284c0e1761cf53f2,
                    0xa54ab336aa1f0186,
                    0x270cf805858c80a8,
                ])),
                Felt::new(BigInteger256([
                    0x4c7696a075923d7b,
                    0xa5d7d2ee3a131f3b,
                    0x076e36b3c8976fca,
                    0x0e958e467ad79089,
                ])),
                Felt::new(BigInteger256([
                    0x74457eab82ebbd74,
                    0x6dd39b8d94d604c2,
                    0xe292ff3370ee612c,
                    0x1c58c899dfeab651,
                ])),
                Felt::new(BigInteger256([
                    0x9b06fd0becec2a21,
                    0x85dfa03088398437,
                    0xcfdc14da76087d3c,
                    0x32d4642af51f367c,
                ])),
                Felt::new(BigInteger256([
                    0x7633f42e3cb4cf66,
                    0xb4629dae43d2bf3c,
                    0x71404e355bf1f790,
                    0x36e2c5780a64663c,
                ])),
                Felt::new(BigInteger256([
                    0x80f8e75e13c3f8a1,
                    0xda54c119cb2c41d5,
                    0xd133d5fced667a7e,
                    0x1535051172167a4e,
                ])),
                Felt::new(BigInteger256([
                    0xa5cae3866603fcb2,
                    0x1f4ccd3bd780584f,
                    0xb5d0d6f16487cdde,
                    0x2cd6e58b8e7a699d,
                ])),
                Felt::new(BigInteger256([
                    0xe17cdf941370a272,
                    0x7a9cf106231dcc90,
                    0xd6999e837049e302,
                    0x3e82f8dc6805abd8,
                ])),
            ],
        ];
        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xa5fe2ed381a19bea,
                    0xdecaead5195d6350,
                    0x85fefdd87a178b83,
                    0x0a4bfcfef5e3f110,
                ])),
                Felt::new(BigInteger256([
                    0xb4ce3f2905cf49b3,
                    0x4fad02ba69a2f502,
                    0x5339202a1bfdf445,
                    0x1ba25ce9f4b7f330,
                ])),
                Felt::new(BigInteger256([
                    0x96728c9473bbffec,
                    0x012ca9a6246ebb56,
                    0x232fd9604dacc1f3,
                    0x2b4e5159112b5b09,
                ])),
                Felt::new(BigInteger256([
                    0x02d432e890bb3962,
                    0x74901bb983b6d1c3,
                    0xccf09aa67506c3af,
                    0x0d375d8247e7c096,
                ])),
                Felt::new(BigInteger256([
                    0x3d6b8bf901719720,
                    0x831c7ae8ce15eaa8,
                    0x9909a6ecc5797225,
                    0x3a566da88f8867ed,
                ])),
                Felt::new(BigInteger256([
                    0x7a96163b08a978af,
                    0xb0d52b66f567df0b,
                    0x9b2c77493fbd2c74,
                    0x3c9c3d9dea11e584,
                ])),
                Felt::new(BigInteger256([
                    0xd8d24a4bea13a672,
                    0x29e8a2f7ac281776,
                    0xa21d50d18e07d219,
                    0x03ca726161bbcac0,
                ])),
                Felt::new(BigInteger256([
                    0xd9654e0ee040ac62,
                    0xf2447f13fd1ea9cc,
                    0x0de37d3aa01260a0,
                    0x03d5df02d5b2d20a,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3e39431e4481a1c0,
                    0x653d835c4f290a70,
                    0x01be5a5dc1c434da,
                    0x03c9f088c7a0dd1b,
                ])),
                Felt::new(BigInteger256([
                    0x9eadf951c591dc97,
                    0x363fdf01ae171aad,
                    0xaadb4537b1d9252c,
                    0x26286dec41ef9c9e,
                ])),
                Felt::new(BigInteger256([
                    0x5a7e0af3d368d356,
                    0x3f210999b701d9cc,
                    0xa79b0e12a56bd7b5,
                    0x2457b9341c3a517b,
                ])),
                Felt::new(BigInteger256([
                    0xaeebdbec209cbde5,
                    0x0146c50cc58e5b16,
                    0x2e438c680785f08c,
                    0x164b644da35aae96,
                ])),
                Felt::new(BigInteger256([
                    0xd5e16bb039cf77d7,
                    0xdff26e4ac7700ea5,
                    0x1bf24eb1a7b7f492,
                    0x265fd234630823f2,
                ])),
                Felt::new(BigInteger256([
                    0xedbc48a46b99fe9f,
                    0x4358d29a44360eb9,
                    0x6559e8abdb7a4cee,
                    0x1e3463b56b9e08f3,
                ])),
                Felt::new(BigInteger256([
                    0x1b23c0f13baa6701,
                    0x6ad752e9660fee42,
                    0xe43c4dfbf9e59d2b,
                    0x3c9e772c8e4bf2bf,
                ])),
                Felt::new(BigInteger256([
                    0xdc3401955aef5b71,
                    0x97568fc64aaa6b62,
                    0x78b70abae724a4b4,
                    0x124560ee76a3198f,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3d21e22488b7bf12,
                    0x8cc1a1131a37ff2b,
                    0x7d70e3f3615a17f1,
                    0x365f2c0edbffe57d,
                ])),
                Felt::new(BigInteger256([
                    0x6750bcf18a0c51e6,
                    0xb62ea49d2f74e008,
                    0x44572532c88d84be,
                    0x16bd3e7e6a4d49df,
                ])),
                Felt::new(BigInteger256([
                    0xc8a1ac317904021c,
                    0xdce63a64ea6b896e,
                    0x37fcc16562eacaa5,
                    0x2ddb03cd89cd30b2,
                ])),
                Felt::new(BigInteger256([
                    0x91c76d6d3fb5471b,
                    0xc4f12fd6e9f73a75,
                    0x10f8c12b4165c685,
                    0x190a8091be2d1d00,
                ])),
                Felt::new(BigInteger256([
                    0x6432083fbac9d08a,
                    0xecaec00c8d34ef29,
                    0x6d28817a65e00072,
                    0x179006cf0a957310,
                ])),
                Felt::new(BigInteger256([
                    0x48e92be69d146f16,
                    0x3714e96d3ea65f51,
                    0x83207a7682fea455,
                    0x0eef4860ce7a6712,
                ])),
                Felt::new(BigInteger256([
                    0x9bef1cb4a3b669bf,
                    0x959668cffcabea65,
                    0xb14d111706a068b4,
                    0x2c25da65d915331f,
                ])),
                Felt::new(BigInteger256([
                    0x146bc530693b6abe,
                    0x302a323e1987730b,
                    0x31dc7c1a6e56762c,
                    0x379b251f562e8ae6,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x125778ee620fddf2,
                    0xbdd6f1ad31b3c0c3,
                    0x34831967ebfec443,
                    0x33b050aa8c215d5e,
                ])),
                Felt::new(BigInteger256([
                    0x7a914462f25e2a6a,
                    0xab37be718a28622e,
                    0x4df50f644e5ab801,
                    0x16270c5c4c9955f9,
                ])),
                Felt::new(BigInteger256([
                    0xfefd1eac8575542f,
                    0x7cc6b668ef3250e0,
                    0x797506ea923f899a,
                    0x39d8d8497f8e4bd2,
                ])),
                Felt::new(BigInteger256([
                    0x611d3fd0b79a752b,
                    0x36e17bfef7aeed34,
                    0x83b12dacc96d2b21,
                    0x2655eef383ca73ac,
                ])),
                Felt::new(BigInteger256([
                    0xe39713e5a8b2b0ec,
                    0x86b28492b695cdb2,
                    0x42fc9871181739d6,
                    0x3d1defe5850f9ea0,
                ])),
                Felt::new(BigInteger256([
                    0xbb7b97f4f3e2feee,
                    0x0751e1da01835749,
                    0x3f3c5c630322b79d,
                    0x3b967f83e74c1eba,
                ])),
                Felt::new(BigInteger256([
                    0xcae1c02a3a5e3972,
                    0x852c08707353d59e,
                    0x2d114badb8e9419d,
                    0x32ec6e802085e3cc,
                ])),
                Felt::new(BigInteger256([
                    0xc51961eefbefd694,
                    0x334f3916b97e13d2,
                    0xe897fee5d350540f,
                    0x2721ca5e2228371f,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x94d1069ddeb358fa,
                    0xc919d11021402b73,
                    0xf696ae5305da148f,
                    0x28b467b79f46a767,
                ])),
                Felt::new(BigInteger256([
                    0xf20589aa018a0a46,
                    0x83642e73b622ca47,
                    0x6f35a894d7d193df,
                    0x3ca75f4c5b532882,
                ])),
                Felt::new(BigInteger256([
                    0x710f4ecaba39f44b,
                    0x41f5efc08324e6e7,
                    0x16288eda29fddbbd,
                    0x03c902ec83e18595,
                ])),
                Felt::new(BigInteger256([
                    0xe225c036ecd1a0de,
                    0xac5783122c6af118,
                    0x0363750aa98b8925,
                    0x2fc84122afd48c63,
                ])),
                Felt::new(BigInteger256([
                    0xb9af0f07c8b67c2b,
                    0xb510075d5acc232a,
                    0x768be18d1cb9d2b8,
                    0x2127c7d8ed7c343c,
                ])),
                Felt::new(BigInteger256([
                    0xd73bd249293faaee,
                    0x78aeec668607ed4a,
                    0x7d2dbf415ea27088,
                    0x2b468f0586f99712,
                ])),
                Felt::new(BigInteger256([
                    0xe4331fe00a629611,
                    0x99697d87bad72738,
                    0xacb690f7f7532dd5,
                    0x0a73798cd900bcce,
                ])),
                Felt::new(BigInteger256([
                    0xf02eb6c219c79408,
                    0xde05429e09666e09,
                    0x2f62ed8ab0465338,
                    0x228c8c87825928bf,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xae48a2fee4be89bb,
                    0x8c58e2442b91c078,
                    0xcd9df35112321718,
                    0x06263af822c71603,
                ])),
                Felt::new(BigInteger256([
                    0xaf9689cd551d8018,
                    0xe00e69383c498278,
                    0x7acc18a9194f97fe,
                    0x01a6113cc415febc,
                ])),
                Felt::new(BigInteger256([
                    0xc8b3d993cfcd7899,
                    0x3856b80541ba9b93,
                    0x5894fde37267093c,
                    0x3a7509483dc86ff9,
                ])),
                Felt::new(BigInteger256([
                    0x4d8a39d2c7b7b34d,
                    0xb7e1655986a11c80,
                    0x71e8d166e7c0c39c,
                    0x05d70604616f41b1,
                ])),
                Felt::new(BigInteger256([
                    0xc2771884097d65f3,
                    0xb2b22da30743e870,
                    0x9252c02858809bdb,
                    0x00f238d49179d740,
                ])),
                Felt::new(BigInteger256([
                    0x5be5be69df4ece78,
                    0x9717b8feeb6b1ba5,
                    0x9eb3ffeadd2fc24b,
                    0x29d7029f42ab756a,
                ])),
                Felt::new(BigInteger256([
                    0xdd6701efdc440def,
                    0x8d051a4e4edb5e43,
                    0x7ed35810de26a41b,
                    0x333320a079803282,
                ])),
                Felt::new(BigInteger256([
                    0x7ad8ac12c2912a7d,
                    0x7d70daf3cb0a3274,
                    0x13802be3edad6732,
                    0x3bad9b78ef092403,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 8],
            [
                Felt::new(BigInteger256([
                    0x4970765cffffffbd,
                    0x0785f6097e17ce04,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xbc7e6600fffffee1,
                    0x92da7d714256af9f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9d1d81bcffffff1d,
                    0x9b665883812e438c,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2d400cb0ffffff91,
                    0x2363aab7d88ac7f0,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x4970765cffffffbd,
                    0x0785f6097e17ce04,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xbc7e6600fffffee1,
                    0x92da7d714256af9f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9d1d81bcffffff1d,
                    0x9b665883812e438c,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2d400cb0ffffff91,
                    0x2363aab7d88ac7f0,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0x4970765cffffffbd,
                    0x0785f6097e17ce04,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xbc7e6600fffffee1,
                    0x92da7d714256af9f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9d1d81bcffffff1d,
                    0x9b665883812e438c,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2d400cb0ffffff91,
                    0x2363aab7d88ac7f0,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x4970765cffffffbd,
                    0x0785f6097e17ce04,
                    0xfffffffffffffff7,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xbc7e6600fffffee1,
                    0x92da7d714256af9f,
                    0xffffffffffffffd9,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x9d1d81bcffffff1d,
                    0x9b665883812e438c,
                    0xffffffffffffffe1,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0x2d400cb0ffffff91,
                    0x2363aab7d88ac7f0,
                    0xfffffffffffffff1,
                    0x3fffffffffffffff,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x0b44f953bad1749b,
                    0x199aa72d98da44d2,
                    0x29f802f6ef8ce14f,
                    0x0ab694c36f932e52,
                ])),
                Felt::new(BigInteger256([
                    0x716c54f84586537b,
                    0x0cfcace0824fa4b2,
                    0x780e4c7c0d663439,
                    0x13a985002eca72f8,
                ])),
                Felt::new(BigInteger256([
                    0xc0f3c9a11225c47d,
                    0x21d9f3426c75b833,
                    0x274e6787b3eed2b3,
                    0x2ee14a25a9d328e7,
                ])),
                Felt::new(BigInteger256([
                    0x2f4290c7f0c12a0b,
                    0x0fae9bc08ed4d59d,
                    0x350133aa52ff23ec,
                    0x1595b3d24c86642d,
                ])),
                Felt::new(BigInteger256([
                    0xb7ee9363ed9ab0df,
                    0x2986493cbce35cec,
                    0xaa7e10f78fa736eb,
                    0x0a386b3f2ea0c7de,
                ])),
                Felt::new(BigInteger256([
                    0xef999332983fd2fc,
                    0xce41ae179e2d81c9,
                    0x0d863a421b0a21b5,
                    0x35b55c247cce8ff8,
                ])),
                Felt::new(BigInteger256([
                    0xfecc75349d62413d,
                    0x5d329a3d79457281,
                    0xa051f1655927e958,
                    0x2be3a0e499fb785e,
                ])),
                Felt::new(BigInteger256([
                    0x4cba7f39acbde39e,
                    0x24b03616794d22ef,
                    0x75f8a06a59f9a1d5,
                    0x069048e4392da126,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc3274460aa08a369,
                    0xda8efec685df6c04,
                    0x303afe114d93fd28,
                    0x0dec179b1127892c,
                ])),
                Felt::new(BigInteger256([
                    0x0fdd990c32f1c233,
                    0x4c231dc3efc70392,
                    0x1bd24c96f6e3e8c2,
                    0x26c10599e70d5b95,
                ])),
                Felt::new(BigInteger256([
                    0x9d56a5fa92fc9d20,
                    0xeacae85f5d9313cd,
                    0x9830ee1b1ced459f,
                    0x02c74c73df764c22,
                ])),
                Felt::new(BigInteger256([
                    0x1dc28d19fd06d8fe,
                    0x7e74e4b520f08618,
                    0xbd7ea864972cafd5,
                    0x35f35431e4549862,
                ])),
                Felt::new(BigInteger256([
                    0x9038c15db9528903,
                    0xc20fc08fa34b6dca,
                    0xa6127bb2812afa56,
                    0x25252e6f01bdecfa,
                ])),
                Felt::new(BigInteger256([
                    0x722f48361d883a58,
                    0xd71db5052514d7ce,
                    0xac8c7e53579d4cdf,
                    0x216e01c738817705,
                ])),
                Felt::new(BigInteger256([
                    0x5e8fa54d0b7a16f4,
                    0xa0f780fd227abe22,
                    0x50103948abd23ca2,
                    0x171bae3a30ad85be,
                ])),
                Felt::new(BigInteger256([
                    0x304303f23777fcf2,
                    0xf6be228c71742670,
                    0x31f3dbab53c28168,
                    0x11a3470d4657fb6d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0adc76df60a01881,
                    0xe8d9c80d103dcbe7,
                    0x84474ff74a3e0a42,
                    0x214a38e1c1b32534,
                ])),
                Felt::new(BigInteger256([
                    0x200c39921a455c5f,
                    0x611a8a812c14853d,
                    0x4cd973f423422c8d,
                    0x200e3d5857cb7499,
                ])),
                Felt::new(BigInteger256([
                    0x2d5b76a7cc6954d5,
                    0x98ea6f285beeefac,
                    0x8a5a2d2302ebbefa,
                    0x0be06f03dc657ec1,
                ])),
                Felt::new(BigInteger256([
                    0x89377cf4fe29b46e,
                    0x2ed4be6d31196d2d,
                    0x5e283ee15d29e039,
                    0x3be2ce35df622f04,
                ])),
                Felt::new(BigInteger256([
                    0xd0d3ac09277511ee,
                    0xf2161fea0c8d3011,
                    0xc607d4e8cfd169aa,
                    0x23aa426bc8cd8fa1,
                ])),
                Felt::new(BigInteger256([
                    0xffc57b0d046fb3c7,
                    0x858397941584a997,
                    0x711c6f2688511b70,
                    0x32a0d30513f3419f,
                ])),
                Felt::new(BigInteger256([
                    0x87832c7e1dc57aad,
                    0x3dd230eb3ab51a5f,
                    0xdf8225cb421ebecf,
                    0x0a0bb35ff2b54c2f,
                ])),
                Felt::new(BigInteger256([
                    0xefdc87ac26351e9c,
                    0x32bc7e3c92764379,
                    0x39541026e5ccab4e,
                    0x22a3f71c193105ad,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x577dbc684193cb26,
                    0xecac6a85913dab9d,
                    0xfa007cb68c7e9bf6,
                    0x19847f0568751eb0,
                ])),
                Felt::new(BigInteger256([
                    0x4a1eb578fef8a6d7,
                    0x43496c48b897b6ac,
                    0xc4e068d34fb0ced6,
                    0x2591a9a85042f0c2,
                ])),
                Felt::new(BigInteger256([
                    0xf342cb4111d2e40c,
                    0x9d6518e5d9a18522,
                    0x4d5814e8fd8baf24,
                    0x15e487a9c0888569,
                ])),
                Felt::new(BigInteger256([
                    0x2f7d2c099f546a17,
                    0x632fc135fabd5258,
                    0x0a0a766079ab3472,
                    0x310f3f1b27e51313,
                ])),
                Felt::new(BigInteger256([
                    0xa89e756c8944fd0d,
                    0x0acd03ff69512d5e,
                    0x278b1727f1a006c9,
                    0x225fb9d6ee86a244,
                ])),
                Felt::new(BigInteger256([
                    0x0eb67b79cf8241f9,
                    0x24dca03f929e9fa5,
                    0xc9566a45f69b1356,
                    0x147b73f6eabccdbf,
                ])),
                Felt::new(BigInteger256([
                    0x602e730b747e7d4b,
                    0x8446ed8e948ff651,
                    0x0e18fb2ec10705c7,
                    0x209ea82404082e02,
                ])),
                Felt::new(BigInteger256([
                    0xb14312a4193dc7cf,
                    0xf933222e084c42f4,
                    0x880bf7ecb5f31ec2,
                    0x080c4fd09ab04d84,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x66365c582b298061,
                    0x2e342c0b7411887d,
                    0x1194b5483672843a,
                    0x1676f7cdc5c7f44f,
                ])),
                Felt::new(BigInteger256([
                    0xc4a31fbf780e87b6,
                    0x0672093ba09b6b35,
                    0xc73a281f21cd6143,
                    0x398c29e9e710422f,
                ])),
                Felt::new(BigInteger256([
                    0xccb57d6d2d226a93,
                    0xe02eaabbf0c386b8,
                    0x1b71c9bec9068577,
                    0x0870f9201be21dcb,
                ])),
                Felt::new(BigInteger256([
                    0xfc0ea9cd792e1176,
                    0x24864bd47f315675,
                    0x11f5dcda3458578b,
                    0x010a1c045a9d9046,
                ])),
                Felt::new(BigInteger256([
                    0x3819ebb4d405804d,
                    0x22eab995a293b976,
                    0xc71f30882b964141,
                    0x3c810e34cc28d4d4,
                ])),
                Felt::new(BigInteger256([
                    0xee23a56a794a1527,
                    0xbafbbf18fbbd1214,
                    0xab30ecc1973e5d9c,
                    0x2f6d178adee3141a,
                ])),
                Felt::new(BigInteger256([
                    0x7178abded8e6d5d9,
                    0xaa296f719a086d22,
                    0x0df60c72c19dbab9,
                    0x28a611e872b49327,
                ])),
                Felt::new(BigInteger256([
                    0xdd911de59ee7416e,
                    0x8713d5ae11d3f6df,
                    0x0f20a333f61c2bcf,
                    0x2a4b00e99988ac77,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x7da3a72ad90965c4,
                    0xd266ef834f2e1b5d,
                    0xa2db93bb6cd6a74d,
                    0x1186eee3d76186c4,
                ])),
                Felt::new(BigInteger256([
                    0xb3656250c3c5fdef,
                    0xfa9ab75b4eeb051d,
                    0x70d6997c61eab067,
                    0x2a2d413c027f72ed,
                ])),
                Felt::new(BigInteger256([
                    0x93a0e7f22498a1fe,
                    0x949b135467982cb1,
                    0x166511bb2095b831,
                    0x20729e8d11fb00e9,
                ])),
                Felt::new(BigInteger256([
                    0xa089c0fac20d4a30,
                    0xa84cce4add178694,
                    0x7ed6a1052e1fd65f,
                    0x3e5b71f0bb223037,
                ])),
                Felt::new(BigInteger256([
                    0x441971b1052ff438,
                    0x7f2387ee80473f0f,
                    0xd4c6ac8d70fdaa36,
                    0x0c28ebe59e3b8ccb,
                ])),
                Felt::new(BigInteger256([
                    0xf2f5a8a196762beb,
                    0xbd87c080949c92dd,
                    0x1ae798fd01c85235,
                    0x06772a539a377a8d,
                ])),
                Felt::new(BigInteger256([
                    0x5be20c294cd91419,
                    0x403a72e3450724da,
                    0x63a8446b4c210e66,
                    0x175861adb82795ae,
                ])),
                Felt::new(BigInteger256([
                    0x4f1fde0eb88ba827,
                    0xf677a72f67daeaff,
                    0xfabe24a0722e4614,
                    0x1e4dd4f8dc8fabad,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
