//! Implementation of the Anemoi permutation

use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 10 field elements or 320 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 10;
/// 9 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 9;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 5;

/// 1 element (32-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t -= mul_by_generator(&y2);
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t += mul_by_generator(&y2) + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3], state[4]];
    let y: [Felt; NUM_COLUMNS] = [state[6], state[7], state[8], state[9], state[5]];

    let sum_coeffs = x[0] + x[1] + x[2] + x[3] + x[4];
    state[0] = sum_coeffs + x[3] + (x[2] + x[3] + x[4].double()).double();
    state[1] = sum_coeffs + x[4] + (x[3] + x[4] + x[0].double()).double();
    state[2] = sum_coeffs + x[0] + (x[4] + x[0] + x[1].double()).double();
    state[3] = sum_coeffs + x[1] + (x[0] + x[1] + x[2].double()).double();
    state[4] = sum_coeffs + x[2] + (x[1] + x[2] + x[3].double()).double();

    let sum_coeffs = y[0] + y[1] + y[2] + y[3] + y[4];
    state[5] = sum_coeffs + y[3] + (y[2] + y[3] + y[4].double()).double();
    state[6] = sum_coeffs + y[4] + (y[3] + y[4] + y[0].double()).double();
    state[7] = sum_coeffs + y[0] + (y[4] + y[0] + y[1].double()).double();
    state[8] = sum_coeffs + y[1] + (y[0] + y[1] + y[2].double()).double();
    state[9] = sum_coeffs + y[2] + (y[1] + y[2] + y[3].double()).double();
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies an Anemoi permutation to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Applies an Anemoi round to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xa2155f4e8379ba51,
                    0xa25c1ee121f4d0cf,
                    0x622f210b906145fe,
                    0x10a8c9868cb333f5,
                ])),
                Felt::new(BigInteger256([
                    0x141ce9ae9a9bcb2a,
                    0xf6a5002ccc55ac6c,
                    0xfaae1e60b173b62c,
                    0x0837c0f02fd7ebc8,
                ])),
                Felt::new(BigInteger256([
                    0xbee8d6fd914f16f4,
                    0x2fe2e9b878a0a121,
                    0xe735f6807d8e4ee7,
                    0x1005ef50acf8f619,
                ])),
                Felt::new(BigInteger256([
                    0x066573933802eda1,
                    0xd11134d2b0935bf8,
                    0xd6113a37490aba27,
                    0x2032b793328e231d,
                ])),
                Felt::new(BigInteger256([
                    0xdc38c28bd03bf722,
                    0xe66f6b5c82eec9bc,
                    0x6dba5e22aed2b23b,
                    0x0a7788cceaf571af,
                ])),
                Felt::new(BigInteger256([
                    0x4413a2e91d281878,
                    0x7b7b3767756c637c,
                    0xcb48c46ef8445211,
                    0x3ece837dbced931d,
                ])),
                Felt::new(BigInteger256([
                    0x59d3463e69c81c0e,
                    0x0dcb02c73e7349bd,
                    0x551e8321c18cf0a8,
                    0x16aeaf923afe442a,
                ])),
                Felt::new(BigInteger256([
                    0xb6ca0e1ff1ff8857,
                    0x3390a7bdae8c430d,
                    0x87789290bb75ce5a,
                    0x159a82aa6acf80d8,
                ])),
                Felt::new(BigInteger256([
                    0xbfaed65032514a00,
                    0xa362773725e1f20b,
                    0xc35fe9acdce6b27c,
                    0x0c5961d72fbda0d0,
                ])),
                Felt::new(BigInteger256([
                    0x3e36615cbefd0f10,
                    0x809de754cb37677c,
                    0x5733c8743d63d9ea,
                    0x150dcb950be27416,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x7f801a8e34fe5785,
                    0x7036b4f4ec2b7988,
                    0xf020804a3f70db59,
                    0x1858c7b49353cfb0,
                ])),
                Felt::new(BigInteger256([
                    0xafe16f2283d9a943,
                    0x0368ac474851d52c,
                    0xca11702cea04d764,
                    0x0b5b0973eb17eccf,
                ])),
                Felt::new(BigInteger256([
                    0x5b41a23956f230de,
                    0x996c6c79f05ad5b7,
                    0x8fac2c34c429ceaf,
                    0x1e5ae213b9070a01,
                ])),
                Felt::new(BigInteger256([
                    0x523ba2d9bf4f5d8d,
                    0xf5bc9a503c9eb0e6,
                    0xd8d0b60689d45cad,
                    0x1c75ac1003f27c95,
                ])),
                Felt::new(BigInteger256([
                    0x09722ea578173b2b,
                    0x4cd5fd90bd15b5a4,
                    0x38c02d7a34ae5466,
                    0x33c627088da7e06a,
                ])),
                Felt::new(BigInteger256([
                    0xfb0238852510dfec,
                    0x0b7e8a94778c1d86,
                    0x178720094b7084e2,
                    0x2b23bd43d8866cda,
                ])),
                Felt::new(BigInteger256([
                    0xbd16054fe46da3fe,
                    0x8713cf3a0f1d3357,
                    0xd33ae68ccbb0d52c,
                    0x2c0b9153d04de976,
                ])),
                Felt::new(BigInteger256([
                    0x0cceb49f532d31c2,
                    0xc895804a19b68bf5,
                    0x92e7d14cb75fa4e2,
                    0x12a094bd934b02e8,
                ])),
                Felt::new(BigInteger256([
                    0x1b4bee4a1bd5e61e,
                    0xc1dada8010babbd0,
                    0x9e01fb1626981c64,
                    0x138b882a297caaa6,
                ])),
                Felt::new(BigInteger256([
                    0x49ceb8fadd20f6c8,
                    0x94dfc89f02a306a1,
                    0x418b181f1740f52e,
                    0x3bdf45fc3897b905,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb2375e87ef0336d3,
                    0x8b5b849618dd7872,
                    0x0b0b470a044a7d35,
                    0x154b1154ce5b88b8,
                ])),
                Felt::new(BigInteger256([
                    0x58a69aef744ea008,
                    0x41f1da4b5028cdbe,
                    0xf9cedac554af7e42,
                    0x24810fc0b8920f48,
                ])),
                Felt::new(BigInteger256([
                    0xbbd1aa78352c9027,
                    0x46ce2fd5c88bca37,
                    0x2bf0defc77ddb42f,
                    0x18b09ca62a82b256,
                ])),
                Felt::new(BigInteger256([
                    0xfccb2957170ed70a,
                    0x8427fb67a4fba205,
                    0x05c7bc8a39d570ac,
                    0x2cf8cfbfe4b27af1,
                ])),
                Felt::new(BigInteger256([
                    0xe2a4ce982f48ccc4,
                    0xe56d57d4ac6b624e,
                    0xc99f9a13678d0a93,
                    0x04b21ed3fbe31d2c,
                ])),
                Felt::new(BigInteger256([
                    0x7c65009597273d1e,
                    0x84e63d607b9bda8f,
                    0x088b34a5ec874f3b,
                    0x0aa0f8085d990de1,
                ])),
                Felt::new(BigInteger256([
                    0xd7ba15fed3a6f15a,
                    0xc4d40feb21153a56,
                    0x5f3f81567e6bf7a9,
                    0x3466158bd2bd479e,
                ])),
                Felt::new(BigInteger256([
                    0x5950b4e4106ed3c3,
                    0x76a2cff0293091c9,
                    0x43cacd589158c525,
                    0x1fc88f1ddfa8c8e5,
                ])),
                Felt::new(BigInteger256([
                    0x9fc5a9635d82ce00,
                    0xbf7e339cac8af533,
                    0xc0dd0c7c8f67c07f,
                    0x22efd83637362ee4,
                ])),
                Felt::new(BigInteger256([
                    0x06d43bf212e1c95b,
                    0x774bfd5dfc31ef29,
                    0xeb917df3effd15db,
                    0x05391bc8b2254ea3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x79158ae9351e7338,
                    0x152b6ab74d5b6b4a,
                    0x37378501464dfc9a,
                    0x1e2707ed13d15a85,
                ])),
                Felt::new(BigInteger256([
                    0x1a3f2b1d890c0d7b,
                    0xa36fb18657989ee4,
                    0xa113aecff7e1fa4d,
                    0x1dfa4aec71635357,
                ])),
                Felt::new(BigInteger256([
                    0x28fc79068a9e1b38,
                    0x4034bf063d8d4378,
                    0x726eab7f6d0e3c9c,
                    0x2ac7a9ec90b8b121,
                ])),
                Felt::new(BigInteger256([
                    0xd957e9f6bf0da88e,
                    0x4051c4cc23654fbe,
                    0x694d4502da85d719,
                    0x312ee28bf4f10f00,
                ])),
                Felt::new(BigInteger256([
                    0xcbc0c5c53112f660,
                    0xf2191e903ad801b8,
                    0x9d1551f1c506f81a,
                    0x259aa963187b3705,
                ])),
                Felt::new(BigInteger256([
                    0x06f75a349641a075,
                    0x048be9459638368a,
                    0x458abc39165f2979,
                    0x13e916a797ab61f7,
                ])),
                Felt::new(BigInteger256([
                    0xf2389739ccc96a51,
                    0x228279f2a9343cca,
                    0xf745ba080ea77069,
                    0x36411219f9c396bd,
                ])),
                Felt::new(BigInteger256([
                    0x394ec0940e5db9d2,
                    0xedd0a1aae834330a,
                    0xe0bf31b8e1eeef04,
                    0x181e722643fd1302,
                ])),
                Felt::new(BigInteger256([
                    0xfbce053266bdde1e,
                    0x49481aa3d7879641,
                    0x831b56b7c54e80f2,
                    0x1131126ca846efdd,
                ])),
                Felt::new(BigInteger256([
                    0x531ba58f80527b33,
                    0x1db229fd59f06536,
                    0x1fab9f06d69416fc,
                    0x0a421def133e222f,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5b8e30a27a679dbe,
                    0x08cd5ae75d27ea48,
                    0x5f1d8d0e2c093af8,
                    0x06b2c8507a3a3fb4,
                ])),
                Felt::new(BigInteger256([
                    0x31931847d19c7d0b,
                    0x00e9400f2064438a,
                    0xb711d97bb643c54f,
                    0x038cdbdb07f7bf9d,
                ])),
                Felt::new(BigInteger256([
                    0x29ddb002433e4331,
                    0x6b3787672088f157,
                    0x3b107664ebba104a,
                    0x1678a4f5c569aa94,
                ])),
                Felt::new(BigInteger256([
                    0x24bc058fbb27e0e1,
                    0x007e4f80f7b24fe5,
                    0xff965a376bf06c42,
                    0x30ba17071e4625f2,
                ])),
                Felt::new(BigInteger256([
                    0x8a802cb753d9b9fe,
                    0xb51814a646b9a7e4,
                    0x88d87e77bf1d6ca8,
                    0x12166f12e8aee2f4,
                ])),
                Felt::new(BigInteger256([
                    0xc911c864d883f9b9,
                    0x2f2b5e0749f2d530,
                    0x5df00ea4ebd29fa8,
                    0x157d5b88b0a2c3b5,
                ])),
                Felt::new(BigInteger256([
                    0xf5673de89806bb9d,
                    0x362792480214cced,
                    0x9e85261d29ed9c9d,
                    0x3a44cf3f582bb207,
                ])),
                Felt::new(BigInteger256([
                    0x8cf508836de8ff30,
                    0x2aa4abed8ec150e2,
                    0x7f5eac000d6d9809,
                    0x21bac16937cd587b,
                ])),
                Felt::new(BigInteger256([
                    0xf7d0df3993d854e1,
                    0xa755a2640dca1373,
                    0xad90589b4d6c21c5,
                    0x0273de7c8691f28f,
                ])),
                Felt::new(BigInteger256([
                    0x05baa677828156d9,
                    0xf477c6e735d33466,
                    0x5c2af7ca15b05352,
                    0x12a309881dec482a,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xae8b657b7c5284e6,
                    0x2901266a1b5980e7,
                    0xf8feba1f0a726024,
                    0x1528104a19480a84,
                ])),
                Felt::new(BigInteger256([
                    0xb9da45ce6c3b4c1b,
                    0xc52f92cf898569b7,
                    0xd9bbe41247e7b453,
                    0x0eaccffc65e87b50,
                ])),
                Felt::new(BigInteger256([
                    0xb87b167196b25d34,
                    0xab9be238ea4ad947,
                    0x87cce9fa643bbd36,
                    0x3e2dbb36b7d91f87,
                ])),
                Felt::new(BigInteger256([
                    0xf77c5c3d7e5b6760,
                    0x3a258dea8e6c86a5,
                    0x423f99b70c43f80f,
                    0x23f41747a5da7976,
                ])),
                Felt::new(BigInteger256([
                    0x7efc09455ccdb98c,
                    0xa60fa0041e0178b3,
                    0xd3ec71dfb8213470,
                    0x33473b3a153327c0,
                ])),
                Felt::new(BigInteger256([
                    0xd6462d621dbe4508,
                    0xf5fbc1adc15570ab,
                    0x293bbb7f6a13172c,
                    0x085c7b3e832ceb7e,
                ])),
                Felt::new(BigInteger256([
                    0xccafaf82a620ca3b,
                    0xa9c7d3469527c264,
                    0x257ff916e43d8dd3,
                    0x22be6216ee3f551c,
                ])),
                Felt::new(BigInteger256([
                    0xa507fb909a31a880,
                    0x78768f2fe48bed76,
                    0x711a34347e9901c8,
                    0x3e0bd1af9d69ab76,
                ])),
                Felt::new(BigInteger256([
                    0xbb0ce3a984b75b1e,
                    0x6b24111a0ffa2ae0,
                    0x1e906f309a1caeac,
                    0x3902e22e307ddf1a,
                ])),
                Felt::new(BigInteger256([
                    0xf9ddca04f2e62550,
                    0x33be2b7b8f25b17a,
                    0xd3af6fd850de8395,
                    0x1d1ea7cd2f488e4e,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x123bd95299999999,
                    0xb83c0a9bfa40677b,
                    0xcccccccccccccccc,
                    0x0ccccccccccccccc,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xa942fcc6b6fc9019,
                    0xe30fee4001297b6b,
                    0xc81bbbb990652d5f,
                    0x151360a4ca1bade9,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
                Felt::new(BigInteger256([
                    0xc1f5f40ca5f0c922,
                    0x8ed096798f9a2565,
                    0x343bf2efffdc45e4,
                    0x136f8d515fc00212,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0x2daf6d68ef718427,
                    0x5061c937d5b3a764,
                    0xf8541bb755f5c730,
                    0x24e19c62db751b35,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
                Felt::new(BigInteger256([
                    0xffc6f91ea63fca57,
                    0x291c6ce7a87d6cc6,
                    0x0dde5b4ffa4ac0ea,
                    0x0d38cb1a91ae29c0,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0xeb95ce3a99999981,
                    0x819db2fb145092b5,
                    0xccccccccccccccc9,
                    0x0ccccccccccccccc,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
                Felt::new(BigInteger256([
                    0x311bac8400000004,
                    0x891a63f02652a376,
                    0x0000000000000000,
                    0x0000000000000000,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe566ac30b35dfb9f,
                    0x65176deff9ce6d9c,
                    0xb166195589cd0244,
                    0x03db09af35c69b8e,
                ])),
                Felt::new(BigInteger256([
                    0xa7727ab6400fe930,
                    0x0c74338aaa9750c0,
                    0xecee97c6342caf8a,
                    0x3d91c514a4ca16e4,
                ])),
                Felt::new(BigInteger256([
                    0xecef92540e68583b,
                    0x94843c1153982b95,
                    0xe0d9a8d110925331,
                    0x04d8e708c809b1db,
                ])),
                Felt::new(BigInteger256([
                    0xccca2821c67044f1,
                    0x52944304317aeabe,
                    0x996a1840a54e400b,
                    0x24b9f680fc61ddd7,
                ])),
                Felt::new(BigInteger256([
                    0x5f13fb3883adcf0f,
                    0xffbd61efdce8c7f7,
                    0xdee4152b97e26692,
                    0x225fb78e5ad1d9d5,
                ])),
                Felt::new(BigInteger256([
                    0xe482588b6a95a2a2,
                    0xa8d5acc4c11e271f,
                    0x022fe552347ace3e,
                    0x28b66e2506835094,
                ])),
                Felt::new(BigInteger256([
                    0x6ffb9e3b9682b284,
                    0x814143fe3b2aa46d,
                    0x7014d4234128fe8e,
                    0x2a1bb18daf015024,
                ])),
                Felt::new(BigInteger256([
                    0x60e12fa6728602f8,
                    0x24787b2af1f34fd6,
                    0x983c4fd8a66aa8ee,
                    0x339bf4a67a296c1a,
                ])),
                Felt::new(BigInteger256([
                    0x88ecc6917183081b,
                    0xc51bce7647b52f60,
                    0x761666d7b30d9e9f,
                    0x044dfb2b50832037,
                ])),
                Felt::new(BigInteger256([
                    0x87dfab8f10349159,
                    0x548faf6cea43a4c5,
                    0x15fe7cb910c60c22,
                    0x26ff527a535b78e2,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x744d52b8aa9202c8,
                    0x88c556b53d433d8f,
                    0x906aa81711de72a8,
                    0x0984d71639ef1956,
                ])),
                Felt::new(BigInteger256([
                    0x93a5544e33c7efc1,
                    0xaf5e9a32c70e55de,
                    0xb51dc6c4dd617567,
                    0x3b72ca8142522d30,
                ])),
                Felt::new(BigInteger256([
                    0x0718725b047245eb,
                    0x8085022dc9ecc11b,
                    0xc39d3f0f220066df,
                    0x1a528ceb098c6199,
                ])),
                Felt::new(BigInteger256([
                    0x6882c0882f1dbafa,
                    0x46f303a2ab795cb2,
                    0xb4184e7aeb678222,
                    0x0d94aa81f9032a77,
                ])),
                Felt::new(BigInteger256([
                    0x1f635e5d35b15753,
                    0xf4e37cb5fe23a727,
                    0xc65467e11b1a06f1,
                    0x0cda2518acd6fde5,
                ])),
                Felt::new(BigInteger256([
                    0x1d477f563d25bcd2,
                    0x946bb7ce897fae97,
                    0xaf0568274221965d,
                    0x05c48541d8b4206d,
                ])),
                Felt::new(BigInteger256([
                    0x57b8d6561b09468d,
                    0xf4fd3b73a78250a3,
                    0xf7abd496cb7d7f8a,
                    0x0380ff0e0db46256,
                ])),
                Felt::new(BigInteger256([
                    0x4879109383bb4d8c,
                    0xe2e8730d007d96fe,
                    0x4cb533ba5ee15c25,
                    0x1ea1dd998eed812c,
                ])),
                Felt::new(BigInteger256([
                    0x490694062d4a47f7,
                    0x446b31a7bdff4461,
                    0xcaf68fa152f4b40d,
                    0x289a542ea1a1cea4,
                ])),
                Felt::new(BigInteger256([
                    0x9067fa7959d3b81d,
                    0xcb9c317302c792e0,
                    0x4fa131ed24822fcd,
                    0x0a76bcb77b3cfc9c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0dc3154634c74e35,
                    0x4a063ef391cd5766,
                    0x6faef115bf159dac,
                    0x14a71eaee8e705fe,
                ])),
                Felt::new(BigInteger256([
                    0xbfd13ce8fc042175,
                    0xe8f556d12833491a,
                    0xbfa6a23b5ac367a5,
                    0x217dbaed7ceee41b,
                ])),
                Felt::new(BigInteger256([
                    0x878368435fb1be8d,
                    0x2ec1aad1cd11a4ea,
                    0x9d3e87500698adcd,
                    0x3d517675bddbabbd,
                ])),
                Felt::new(BigInteger256([
                    0x64020780bbe5e8f9,
                    0x6d7af762d1cf0968,
                    0x47115bd8740434d1,
                    0x2522abffb789cf8c,
                ])),
                Felt::new(BigInteger256([
                    0x59a0e30495636a5e,
                    0x1ca6b7b9df97c6fe,
                    0x0913a726cb2cd750,
                    0x243528e36ab55783,
                ])),
                Felt::new(BigInteger256([
                    0xf7c52728967f5eac,
                    0x01f07f996a31cd57,
                    0xc5c684377be43f7b,
                    0x2da02d013c892245,
                ])),
                Felt::new(BigInteger256([
                    0xbc3f7dbfdb9a5654,
                    0x357bce1f8f831501,
                    0x64670670f4aad6c0,
                    0x336fddca7d05aef0,
                ])),
                Felt::new(BigInteger256([
                    0xda4b398d4411b87a,
                    0xb3aeffad77016dbc,
                    0xfbda38bf47cdd54a,
                    0x19085cf4755cc694,
                ])),
                Felt::new(BigInteger256([
                    0x052bcc3110374b11,
                    0x93e294d7fee98852,
                    0x8db3b75c9d23405b,
                    0x10e3892928a78b1d,
                ])),
                Felt::new(BigInteger256([
                    0x5e416b077ea29099,
                    0x50e0d351db656f3a,
                    0x076b726fbc959088,
                    0x28719ee8865166c3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe7f1c158c62db0e1,
                    0x5ee120925a14300c,
                    0x551658bf320f5181,
                    0x1e8253827b011fea,
                ])),
                Felt::new(BigInteger256([
                    0xaa262b55133457f0,
                    0x7f17abd174bdb32d,
                    0xde572c5fb0bcbf69,
                    0x35c1a2c9bd66a0de,
                ])),
                Felt::new(BigInteger256([
                    0x8269d97a90af2bea,
                    0xc2dbeebd70414cc2,
                    0x6c11d9f590c1c9d6,
                    0x2d222c15394b5d8b,
                ])),
                Felt::new(BigInteger256([
                    0xa322672734600069,
                    0x52abc4175b68efbd,
                    0x234cddbfb0bc602b,
                    0x0029223bd7945071,
                ])),
                Felt::new(BigInteger256([
                    0xe57ca01ac444c08e,
                    0x26fe7b90d81edc60,
                    0x108372a4dbba33cd,
                    0x169391ab2d0e8d1f,
                ])),
                Felt::new(BigInteger256([
                    0x8c5ea12bd135eb6a,
                    0x856dff535b2e2f34,
                    0x9706d7014a9552e7,
                    0x1925725127c0b2ce,
                ])),
                Felt::new(BigInteger256([
                    0xa895b91504f5398f,
                    0xcecd26fa33211516,
                    0x1111228712923c9b,
                    0x0c4545c3d4509f54,
                ])),
                Felt::new(BigInteger256([
                    0x3089c2c23912e562,
                    0x54b5adc6ea4843a6,
                    0xf5469c789b4feb23,
                    0x074dfa35fbea4edd,
                ])),
                Felt::new(BigInteger256([
                    0x398a19660b64b44a,
                    0x69ea2814a498b5e8,
                    0x3d4e14b4beee4eb8,
                    0x2875007ee9fdf03e,
                ])),
                Felt::new(BigInteger256([
                    0x071649182dbb1bc4,
                    0x768d2fc12fee6c7c,
                    0xfce8c5a30a5a3b30,
                    0x01f21a86c15bf480,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xea36d927f29608cf,
                    0xb5a83f6365ad4525,
                    0xc89f428ca952bcda,
                    0x287c87e9a66d01a6,
                ])),
                Felt::new(BigInteger256([
                    0x37378106e4844691,
                    0x8d5e73fdf9a7c04e,
                    0x5c36264a3de36196,
                    0x38500841929fa143,
                ])),
                Felt::new(BigInteger256([
                    0x375989a43eca1292,
                    0xeb197fe0656eaef8,
                    0xd29fe6f41bfca4da,
                    0x3cbb9c88f41a6aad,
                ])),
                Felt::new(BigInteger256([
                    0xd58e337892df82f5,
                    0xcc97bb63b0dc916c,
                    0xd561125e0ec3388a,
                    0x276a27e978484cb2,
                ])),
                Felt::new(BigInteger256([
                    0x02f972124bf9fde1,
                    0x23800b7cbd98c7d1,
                    0xcb4ce2d07878e94c,
                    0x20314666738b1220,
                ])),
                Felt::new(BigInteger256([
                    0x231c2303617c8912,
                    0x36a346433b840d04,
                    0x8b49ad1322ffbfe3,
                    0x1e737f516af1d9e1,
                ])),
                Felt::new(BigInteger256([
                    0x8596c6ee4b906325,
                    0xdfa0052f900f25d5,
                    0x682386c7b83bb7c5,
                    0x2bb8ef293556cdcc,
                ])),
                Felt::new(BigInteger256([
                    0x2d919eea55746576,
                    0x6c4da8961a70739e,
                    0xc8b5176c13ca8ebc,
                    0x29c7b05fe4175b1c,
                ])),
                Felt::new(BigInteger256([
                    0x41c5f2e72491c9ae,
                    0x6b3cb591944816b4,
                    0x8073e57ca754a42d,
                    0x0e4bd2bd68991de2,
                ])),
                Felt::new(BigInteger256([
                    0xd1d543b19e4c5f73,
                    0xdf4a93fcb03d6e4b,
                    0x858f747accb8bbd7,
                    0x0784bd53a7172f50,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x209ec983267f91ba,
                    0xd4c792378826e8a9,
                    0x221c8d15711b8787,
                    0x24bf1c7acdd40995,
                ])),
                Felt::new(BigInteger256([
                    0x766c61e6d27daa6f,
                    0x0671b25960dbb381,
                    0x2eedb31b1868f679,
                    0x0b180822c0570a77,
                ])),
                Felt::new(BigInteger256([
                    0x907bff59a783b977,
                    0x681c53eb2decfa03,
                    0x7ca03f312ef7e0e0,
                    0x36e333287d194b6f,
                ])),
                Felt::new(BigInteger256([
                    0x9b1fe888c7410acd,
                    0xbcdb48165aa2531d,
                    0x146404d8a6237482,
                    0x19b893588f22ac9b,
                ])),
                Felt::new(BigInteger256([
                    0x4491163c87e29d7c,
                    0x7f7d77cc8fb498be,
                    0x46d82a792e437f8a,
                    0x32df65dd0151ed01,
                ])),
                Felt::new(BigInteger256([
                    0xebd72166ee024356,
                    0x02e208b612aefc8e,
                    0x7b7bbfff11f193ec,
                    0x36b607ccddb2297c,
                ])),
                Felt::new(BigInteger256([
                    0x1b6b288b2ab45abc,
                    0xdc5ee42a563c2bb2,
                    0x14cd3763982a9c8c,
                    0x1a51b956d845b3dd,
                ])),
                Felt::new(BigInteger256([
                    0x43f09fb6204bbe17,
                    0xa6754b3c9446dd71,
                    0x9b1534f21262b683,
                    0x08d4adbf90acde49,
                ])),
                Felt::new(BigInteger256([
                    0x68c9332846e1d894,
                    0x502c7dba2d00dc41,
                    0x204e90cfd1b2049b,
                    0x19fdb3c4eb9494ea,
                ])),
                Felt::new(BigInteger256([
                    0x32c953a9e4c3c386,
                    0xe833dcce0a2bea63,
                    0x565fa243aa50875c,
                    0x028d6ef1e87a92dd,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x97addc7d8892478c,
                    0xa4c627e931ad38f8,
                    0xc92f2dc387986bda,
                    0x2585e1a428554a01,
                ])),
                Felt::new(BigInteger256([
                    0x3ad5c38430a7551d,
                    0xb0efc5eba6e9c9f7,
                    0xdcc4789c42d588d6,
                    0x376fb53ad6051d65,
                ])),
                Felt::new(BigInteger256([
                    0x90e96f95f098a7d7,
                    0x430758931fe394df,
                    0x98dca8476ab69754,
                    0x3221af813255a3d5,
                ])),
                Felt::new(BigInteger256([
                    0xe11df0902763515e,
                    0xd9d7e395e6c4f6bb,
                    0xddb7348cc3209748,
                    0x018cdef7b865ccf6,
                ])),
                Felt::new(BigInteger256([
                    0x1e6729e686e03d3f,
                    0xdbb8d88cec4b8ddd,
                    0xbdc9e9ccab5009d4,
                    0x1c33dc8a0a97581e,
                ])),
                Felt::new(BigInteger256([
                    0x0ac80cda786e6dbc,
                    0x15402f780dfc3291,
                    0x09759adeea87af28,
                    0x33dd26161212f83f,
                ])),
                Felt::new(BigInteger256([
                    0x675a47a16e0db69e,
                    0x2fccfa0cf23d319e,
                    0x750db0742bfc50c0,
                    0x32ffa1faf7800282,
                ])),
                Felt::new(BigInteger256([
                    0xa11d994b76960344,
                    0x73d1d0d7053a488a,
                    0x8993f02f69c6e3ca,
                    0x117a49a6cd65e403,
                ])),
                Felt::new(BigInteger256([
                    0x1b7aa8cdb27489d2,
                    0x26665cee7d957b63,
                    0x30eda76b8423a9d4,
                    0x1583986f6fe98cbf,
                ])),
                Felt::new(BigInteger256([
                    0x244c4ceb9ae986bf,
                    0x088c87c26a157178,
                    0xd6ef39c5573ff141,
                    0x3dd8959a45882135,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5775850b6b3f50a5,
                    0x869c10857d90f8d5,
                    0x3b6d97c1bf6114c9,
                    0x0915b3eb494b7b81,
                ])),
                Felt::new(BigInteger256([
                    0x7aa288aa7577f3c3,
                    0x8a8d07461e64735a,
                    0x92b675739da9fde2,
                    0x144ef14da894413d,
                ])),
                Felt::new(BigInteger256([
                    0x8dd69882e58efabc,
                    0x4f6e8429b37ebc32,
                    0x365f116fe8f52867,
                    0x2348cdbdf3417523,
                ])),
                Felt::new(BigInteger256([
                    0x41fea01e3f1a945a,
                    0xd06184926be6ebc6,
                    0x2340cd0e9a1ab7e5,
                    0x23560745655de068,
                ])),
                Felt::new(BigInteger256([
                    0x3fe93404271aa671,
                    0xcea2c4cf08ebfb37,
                    0xa8405765fb7a217f,
                    0x3cd1a5d13522f688,
                ])),
                Felt::new(BigInteger256([
                    0x3ca7a14c32bebb64,
                    0x3109909fb5e4bd3a,
                    0xbb3a363b0540889b,
                    0x21a6ac08d38b80fe,
                ])),
                Felt::new(BigInteger256([
                    0x1e0dfed25441e7bd,
                    0xcef8d523c7ff1845,
                    0xe091998578bca70b,
                    0x07ac89c9418823e3,
                ])),
                Felt::new(BigInteger256([
                    0x057852de78627faf,
                    0x6a2e85404ca2a587,
                    0x6b7c337b555b38b0,
                    0x16d6c6ee2caf0929,
                ])),
                Felt::new(BigInteger256([
                    0xcf09e342bdb7d9fa,
                    0x146f88d64a669eba,
                    0x76c599c89e3a3071,
                    0x30d049f245d9fabc,
                ])),
                Felt::new(BigInteger256([
                    0xe91a9758952bc1c6,
                    0xdff4b121e6ff49a8,
                    0x1e04ee1fa431f63e,
                    0x3e269120ea8ef5a5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbf8379a2bb536b52,
                    0x7c5dee0a8d356a58,
                    0xb82c8b8475c8ea4c,
                    0x1343376358f07f2f,
                ])),
                Felt::new(BigInteger256([
                    0x4af6959e929a66d7,
                    0x8daeb53e5ae76639,
                    0xf41f0ef3458e2312,
                    0x1ca129acb333fe06,
                ])),
                Felt::new(BigInteger256([
                    0x4f7eef66ca74aca8,
                    0x35a9b3383479d211,
                    0xb945e79905cca8a9,
                    0x0466c2bd12bc002e,
                ])),
                Felt::new(BigInteger256([
                    0x86a2250d008e36a3,
                    0x72f0b62d0d23a311,
                    0x25a0789b24bc0dbe,
                    0x0c3aeee27cdf089d,
                ])),
                Felt::new(BigInteger256([
                    0x81b67e1581d92a5f,
                    0xaea832b4ec843ae7,
                    0xbb53890dc0ddc2d7,
                    0x02e0a10070823f36,
                ])),
                Felt::new(BigInteger256([
                    0x6bd09f9739e49ce5,
                    0xcd6dffca60306b76,
                    0xd8d6991df6b49ec8,
                    0x012226ce1953bdc0,
                ])),
                Felt::new(BigInteger256([
                    0x0538d066b7624926,
                    0x185d066eec7fa094,
                    0x663324c9abaf3393,
                    0x365febcbb574c8fa,
                ])),
                Felt::new(BigInteger256([
                    0x7108681e0b3d0ab4,
                    0xea666ae73d8301a0,
                    0x330e9bd6c78ec031,
                    0x0f04d0aa27756bf1,
                ])),
                Felt::new(BigInteger256([
                    0xd413cbeabe419c8d,
                    0x5045747e0187f4d7,
                    0x25f6d8edf01bbcbe,
                    0x12cc197ab18d5832,
                ])),
                Felt::new(BigInteger256([
                    0x5aaec458205531b7,
                    0xa6d9d11e4091ab56,
                    0xf5d796dddc1c9967,
                    0x211e564caa9de979,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x6679dd0372f840ee,
                    0xc71bbd1fdfb20a1a,
                    0xcd06be43f6a092e1,
                    0x188e92fa6e2db0a3,
                ])),
                Felt::new(BigInteger256([
                    0xca61b1a099985022,
                    0xb301a6bbaaa70a7c,
                    0x665134ed450d452f,
                    0x2d30ec2e50c26861,
                ])),
                Felt::new(BigInteger256([
                    0xc7ba805d68b44739,
                    0x183b72af60ba7bf0,
                    0xda18d934a6273079,
                    0x2e32a90ebba06ca4,
                ])),
                Felt::new(BigInteger256([
                    0xef531497377c24d0,
                    0x230890835f3d0a0d,
                    0xc89af50c3219c854,
                    0x353460d8b10c3f01,
                ])),
                Felt::new(BigInteger256([
                    0xd6ec059f03a6c3a4,
                    0x7a531c09254e916c,
                    0xd4290f2a3bde134d,
                    0x0fc5658a902c1b75,
                ])),
                Felt::new(BigInteger256([
                    0xf137164ccec73a23,
                    0x3a7f4e130229b8ef,
                    0xc8314dca961718c6,
                    0x1bfdfe99557394cd,
                ])),
                Felt::new(BigInteger256([
                    0x1fbcd2896d13e5d8,
                    0x5afc8234d0070cec,
                    0xc99e72a647459791,
                    0x0feda4be0ea2fa24,
                ])),
                Felt::new(BigInteger256([
                    0xef982d0ca1befb94,
                    0x987513bc357dff95,
                    0x97507973e24c7164,
                    0x017a6121459f8efc,
                ])),
                Felt::new(BigInteger256([
                    0xa58c7fc7dc872aca,
                    0x51d55937297b9e43,
                    0xe5b3b5ce804b5e29,
                    0x10e220b489b82742,
                ])),
                Felt::new(BigInteger256([
                    0x21d3ae9d03de1f22,
                    0x2cfc8fe5d6314aa7,
                    0x858804a3b133d391,
                    0x263114b67dcb8c4b,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x82e68184d30277b7,
                    0x6d71e01e274df4f8,
                    0xc33e9831f7d96671,
                    0x30425ab31abcf1f8,
                ])),
                Felt::new(BigInteger256([
                    0xe1c12cace47cf439,
                    0x412ad1b6fbb414ca,
                    0xcf540f14dd200a65,
                    0x1bc7a9072236c387,
                ])),
                Felt::new(BigInteger256([
                    0xa0f26f4b0e7605e6,
                    0x691614c1d3b5795e,
                    0xea019af592fa7a71,
                    0x1fb3103216e6d0a2,
                ])),
                Felt::new(BigInteger256([
                    0x62923f358ca119b7,
                    0x9cab0407fb30e28d,
                    0x42b25b50d1e0bd38,
                    0x19e75eeebc07e07d,
                ])),
                Felt::new(BigInteger256([
                    0x8bd992a7ccb53447,
                    0x43ff4c0365b59976,
                    0x84d1114355ea8f72,
                    0x079831e4cf8f7d33,
                ])),
                Felt::new(BigInteger256([
                    0xd199168f17e5cbe4,
                    0x65e0ab4a28d3821c,
                    0x29af47ca2ac52f78,
                    0x3ea0062ce61dc66a,
                ])),
                Felt::new(BigInteger256([
                    0x0170fada633e6438,
                    0x1e2bc79712a92bca,
                    0x58d55f26a094913e,
                    0x3677e1b17454563b,
                ])),
                Felt::new(BigInteger256([
                    0xfc00c057e8f30654,
                    0x5a10137e99343fcc,
                    0x8e3c1394c8023562,
                    0x3a0f05e6b519b81a,
                ])),
                Felt::new(BigInteger256([
                    0x9283b8ff23cdd216,
                    0xd36a650c3a607bb9,
                    0x1bdf27aeb235c5af,
                    0x2756b573af4f7528,
                ])),
                Felt::new(BigInteger256([
                    0x7b695ef09196016e,
                    0x5d75c3141d0ef371,
                    0x2d9402c4b1a30347,
                    0x24bb9b15e78f4533,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbf8a5e3ff82756aa,
                    0x736e6e95869e1315,
                    0x2abbed961ac85dac,
                    0x0b620cf5f43e0377,
                ])),
                Felt::new(BigInteger256([
                    0x3d424d103ca09fae,
                    0x6903954cf5ee24a8,
                    0xd168ccb3e1a36940,
                    0x28d794d372f8a70c,
                ])),
                Felt::new(BigInteger256([
                    0xce75114377ac398d,
                    0xee00f796881229b3,
                    0x95e3e8e47fb2e301,
                    0x06efd128c743a55c,
                ])),
                Felt::new(BigInteger256([
                    0xa98c08cf90712673,
                    0x0a36fc06995bc955,
                    0xa3c35b8054bd06c8,
                    0x076c8c7cc4c89bd0,
                ])),
                Felt::new(BigInteger256([
                    0x8a0acd3306fd08a5,
                    0xa87cdd9a93abc2ed,
                    0x135d5a5c97f3439a,
                    0x1a270bff6b70ed21,
                ])),
                Felt::new(BigInteger256([
                    0x803c963cb9c4334c,
                    0xd73f703fbde0c150,
                    0xfdb8d428b5f53212,
                    0x2af4e9f48cd3e58e,
                ])),
                Felt::new(BigInteger256([
                    0x88c1848328bbb9c6,
                    0x129b72d0af9dc9ea,
                    0x8dc7ee0811e469d7,
                    0x0eb26fcad738f6aa,
                ])),
                Felt::new(BigInteger256([
                    0x60676444228f8fe2,
                    0xc8c70dbfe7743188,
                    0xd668faee7d49e36e,
                    0x3ecc494399207ce6,
                ])),
                Felt::new(BigInteger256([
                    0xca673caca1bc327f,
                    0x25ed123b62db7dbe,
                    0x0df6f9a49c173108,
                    0x039c8253eb36df22,
                ])),
                Felt::new(BigInteger256([
                    0xc05d83c633c8c5c2,
                    0x20966d4609b4bf6b,
                    0xec23315d5df637be,
                    0x38067a4d72b79c81,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 10],
            [
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::new(BigInteger256([
                    0xdcc37be8ffffffc9,
                    0xa2d521d9f10fb866,
                    0xfffffffffffffff8,
                    0x3fffffffffffffff,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x5811ffbecaf20bdb,
                    0x03202abe37536c9e,
                    0x9c5802686fa448f9,
                    0x06916ff3abe73f5d,
                ])),
                Felt::new(BigInteger256([
                    0x957178125dc64bc0,
                    0x5a995d19eb30a228,
                    0xf3da4a8e4a28289d,
                    0x1aa4dc002593faa3,
                ])),
                Felt::new(BigInteger256([
                    0xefe9c85cc22a78ab,
                    0xa59c7b2e882bc3fc,
                    0x2484ac559c54a7b6,
                    0x339034cdd9f0342d,
                ])),
                Felt::new(BigInteger256([
                    0x97f6a7c4bd9300df,
                    0x824ba5904cf74ff3,
                    0x666fd37a2620fcac,
                    0x26b9a2df8fbdabde,
                ])),
                Felt::new(BigInteger256([
                    0xc6283f5328bbba4e,
                    0x12fb908adaa154b3,
                    0xd54d294275e661f0,
                    0x384ff6ba184f8a7a,
                ])),
                Felt::new(BigInteger256([
                    0x33830b1fc1cf96f7,
                    0x6ec98d350840bf3e,
                    0x1c73845613d462d2,
                    0x3fb8c9c78521ead6,
                ])),
                Felt::new(BigInteger256([
                    0xde9b932301c5694f,
                    0xa11d6b555464420a,
                    0xae6a22ab79b6b1c1,
                    0x2efa65242bb3c1ec,
                ])),
                Felt::new(BigInteger256([
                    0xc0e4e03fbfce4489,
                    0x5ecba79fa8126ed0,
                    0xa858248b5bce5e81,
                    0x12559879cca814cd,
                ])),
                Felt::new(BigInteger256([
                    0x29555f16b41fd679,
                    0x6ed3237d9e21cecd,
                    0x5a81ebd8018a72f7,
                    0x3c2fc269a34270c6,
                ])),
                Felt::new(BigInteger256([
                    0x16abeb271a9ff721,
                    0x52a5eeafcc041bc8,
                    0x11a1da6a18a708dc,
                    0x2694f2c68d137fd6,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd4a617a35153c630,
                    0x15ad2dc13c6f482a,
                    0x47862abd69b812f7,
                    0x04af689e6aca6e74,
                ])),
                Felt::new(BigInteger256([
                    0xad74fceaccfdd883,
                    0x36c9501a6a0c1dd8,
                    0xfcfd426fffbd3be9,
                    0x024cefb90ef49b41,
                ])),
                Felt::new(BigInteger256([
                    0x08ea1169924e87c6,
                    0x8d4227b58ee7c887,
                    0x1da78ef987548d5e,
                    0x06f54ca8681b6d5e,
                ])),
                Felt::new(BigInteger256([
                    0x7aa0e8d7f99de16d,
                    0x3ed42feeb8a9ff90,
                    0xd87f18b7d729d950,
                    0x3d1092c4d8fb981a,
                ])),
                Felt::new(BigInteger256([
                    0xb2a967cac482a30a,
                    0x549963c588173bb6,
                    0x2591968b3a33690a,
                    0x00a588f840066c58,
                ])),
                Felt::new(BigInteger256([
                    0x75d63b2f5834a55d,
                    0xb6fd2bb0c71082f9,
                    0xd095620053d0f511,
                    0x11cfcf3e0bba78d0,
                ])),
                Felt::new(BigInteger256([
                    0xcf0cf8b165e21336,
                    0x1fd6f7c5d2199a4d,
                    0x8c11702a50dcb185,
                    0x2f142554c80c9c43,
                ])),
                Felt::new(BigInteger256([
                    0x444a607c9613eb46,
                    0x2aebddbbc2567076,
                    0x622c9217dfe87822,
                    0x24cee8f9909730bc,
                ])),
                Felt::new(BigInteger256([
                    0xcb0e82fc5ad174f8,
                    0x9ce25379585c6165,
                    0x7ac0bfc3803848f3,
                    0x063f67f992b0eca3,
                ])),
                Felt::new(BigInteger256([
                    0x464cd656d0e252eb,
                    0xbb982daaba28c182,
                    0x4f6f77f32bf16ab5,
                    0x27d9880a4753778a,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0fc8fcf438c28687,
                    0xbdcefa324f1950b4,
                    0x1740e0f424020c8a,
                    0x3c6789d36a5fdc49,
                ])),
                Felt::new(BigInteger256([
                    0xda39766e0ebf797c,
                    0x0013ca0e17becf1d,
                    0xa4733e2b09f293d4,
                    0x318b5203bb4890d6,
                ])),
                Felt::new(BigInteger256([
                    0x2b4e9ff51ae011e0,
                    0x03a078f1e5c6d3c2,
                    0xb62e742fa00c577d,
                    0x3576428dc4e7b951,
                ])),
                Felt::new(BigInteger256([
                    0x5b635223f3129d99,
                    0x72ea3d1ff688d5a6,
                    0x785366007a2c6713,
                    0x116baa7122aebe68,
                ])),
                Felt::new(BigInteger256([
                    0xe8b6592e21958e03,
                    0xa4df6a448adffdcd,
                    0xf1173ad7d62ffdb8,
                    0x3ac90aca9e59e447,
                ])),
                Felt::new(BigInteger256([
                    0x472f1f15a03000d2,
                    0x0906ae4ceb80a3ef,
                    0x1eb5a477858aa98a,
                    0x07ed241f1aac982e,
                ])),
                Felt::new(BigInteger256([
                    0xd4dd8ea9a6fc1db2,
                    0x111adc2be683d407,
                    0x9ce655c6813ec629,
                    0x1994233dc9736478,
                ])),
                Felt::new(BigInteger256([
                    0xfedf2194a1feff0a,
                    0xa97c784f185120af,
                    0x3e67d97e44dcc1c5,
                    0x1be8a6b34344ba8e,
                ])),
                Felt::new(BigInteger256([
                    0x014bd98c649ce39a,
                    0x4cf2d95c340d7aee,
                    0x8b544a59a4a48368,
                    0x1f70028bf9e86ae9,
                ])),
                Felt::new(BigInteger256([
                    0x1c791616adae70e9,
                    0x7cf431921e49f0a7,
                    0x3d46e779060e04f0,
                    0x15589a026073bab9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa203104d36dfcc28,
                    0xc2a35b40a0f4e9b2,
                    0x08db9ed321e0eb4f,
                    0x3403f96c86dee448,
                ])),
                Felt::new(BigInteger256([
                    0x727d548af63558fb,
                    0x338656d0e351279d,
                    0xec00e143421cfa43,
                    0x34df2cd5871c7315,
                ])),
                Felt::new(BigInteger256([
                    0xf3b1241b76ff4b50,
                    0x55c65e93c0ddf90f,
                    0x52dffd71bf9fd82a,
                    0x16e6235869b3ca7e,
                ])),
                Felt::new(BigInteger256([
                    0xa7a0a08e05f24fdb,
                    0x25a9f467653d0884,
                    0xdf9950bea4d29b62,
                    0x2a667d5578ed2d20,
                ])),
                Felt::new(BigInteger256([
                    0x79961bc4fba5c9e3,
                    0x361109ce0dd6ed3c,
                    0x278d9a4594c42146,
                    0x32b74586545ff2da,
                ])),
                Felt::new(BigInteger256([
                    0x7ffa113cbdc500fc,
                    0x15ff6aa0b5a66245,
                    0x1120a5095db6ed95,
                    0x28c8b3d593db181d,
                ])),
                Felt::new(BigInteger256([
                    0xa0c996e8e660e983,
                    0x76cae30cca7055d7,
                    0x1e79b19732eba330,
                    0x048bf214e7b79111,
                ])),
                Felt::new(BigInteger256([
                    0x231cdb4d29c57996,
                    0x2db773e234fe4ac0,
                    0xdedbcdae7c591149,
                    0x1227a9d59e882579,
                ])),
                Felt::new(BigInteger256([
                    0xc78bae3cef80cf0c,
                    0x0c9ca6a7d114456c,
                    0x84591d3927c64f6c,
                    0x0c4c2995c63f0fc8,
                ])),
                Felt::new(BigInteger256([
                    0xedf52ba8a68b5985,
                    0xfe04dbe6213d0f79,
                    0x8a381b38fb729eff,
                    0x32d8b11dd0cf966d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5bec29ac14efe9dd,
                    0x276d185b611f5bef,
                    0xf3763bbb8300a248,
                    0x38b9a9837f951b5f,
                ])),
                Felt::new(BigInteger256([
                    0x1ea7a909eab76eed,
                    0xe5d0ed4ce2dc6f55,
                    0x64e9fa0414a5fa7f,
                    0x18dd63183123e44c,
                ])),
                Felt::new(BigInteger256([
                    0xd1c7c925c3b16065,
                    0xffb4fff74e476ef6,
                    0xd4c5d64097a0b3bf,
                    0x1c52bcbf57a2c244,
                ])),
                Felt::new(BigInteger256([
                    0xd936b2d0ac9fa37f,
                    0x6d720922aeb017c0,
                    0xe097784962bc0dca,
                    0x3fe49603d72b54e8,
                ])),
                Felt::new(BigInteger256([
                    0xdaff10a5462c20ce,
                    0x5af9728d7d6e29db,
                    0xab8e0b1e4a71b0f3,
                    0x0b82a31f58b35ec1,
                ])),
                Felt::new(BigInteger256([
                    0x3fdaa373756fe1f0,
                    0x0ef375253b8d9e72,
                    0xc16b5bcd1b9e1226,
                    0x3299932b542e62ad,
                ])),
                Felt::new(BigInteger256([
                    0x474dbc3e11520151,
                    0xfb30c20ec1fa37bb,
                    0x95bf3e7b5d1c98fe,
                    0x1a700dc6f933c5ad,
                ])),
                Felt::new(BigInteger256([
                    0xe12d033216cde7a8,
                    0x02327e03a79bf947,
                    0xf102e0544e85a743,
                    0x041d0757a409ff0b,
                ])),
                Felt::new(BigInteger256([
                    0xa325d5202a082dae,
                    0x506c1282a6c2ca18,
                    0x260f7cbf593b9871,
                    0x33b0e9346b9e3882,
                ])),
                Felt::new(BigInteger256([
                    0x8babccf79d22928d,
                    0x7eb7b0162bac2da1,
                    0x80998e4164668800,
                    0x3849d6cebcc97395,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x1bbd42f500826801,
                    0xb2ed63d13fceae3b,
                    0xadb0a6c7c638dd17,
                    0x297e8333e958ab81,
                ])),
                Felt::new(BigInteger256([
                    0x4965c36b5a592077,
                    0xf1f155591d1b1ae7,
                    0x75b7d57a45444362,
                    0x27937c3dfb8fe5b3,
                ])),
                Felt::new(BigInteger256([
                    0x8933e4582cd4f2f8,
                    0x2119345794a8f31e,
                    0x35bb09566f9c398d,
                    0x168f9d9cde3259ad,
                ])),
                Felt::new(BigInteger256([
                    0x3e6cced0c8c3d18b,
                    0xcdf7ec961aa28532,
                    0x6a6b3de542157772,
                    0x09c72877bd286a59,
                ])),
                Felt::new(BigInteger256([
                    0xe617c25c65ece4c9,
                    0xdb390b9dfe69dede,
                    0x3cb41b21fe228af7,
                    0x20edda82ad928644,
                ])),
                Felt::new(BigInteger256([
                    0x68cc440da077f8a1,
                    0xf18bd5b94f35f204,
                    0x333ec0256916b9b3,
                    0x0f36bb06bcfffeca,
                ])),
                Felt::new(BigInteger256([
                    0x42b0addf126181ae,
                    0x1a9037fb89f54652,
                    0x64947f76648e952f,
                    0x1fcc114843ea991f,
                ])),
                Felt::new(BigInteger256([
                    0xae4e3182528e489f,
                    0xf05e18629d495983,
                    0x5a714644d5f01783,
                    0x3148e7fc5ef0777d,
                ])),
                Felt::new(BigInteger256([
                    0x06d6e5361aab625d,
                    0x42be3238290d2426,
                    0x32aa9b8f4b342a39,
                    0x1c52645481cab556,
                ])),
                Felt::new(BigInteger256([
                    0xb36d7415d40b4376,
                    0x6c9fafbb932b8cfd,
                    0xe347906185e3210c,
                    0x1c9ea25d19dfddff,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
