//! Sponge trait implementation for Anemoi

#[cfg(not(feature = "std"))]
use alloc::vec::Vec;

use super::digest::AnemoiDigest;
use super::{apply_permutation, DIGEST_SIZE, NUM_COLUMNS, RATE_WIDTH, STATE_WIDTH};
use super::{Jive, Sponge};

use super::Felt;
use super::{One, Zero};

use ark_ff::FromBytes;

#[derive(Copy, Clone, Debug, Eq, PartialEq)]
/// An Anemoi hash instantiation
pub struct AnemoiHash {
    state: [Felt; STATE_WIDTH],
    idx: usize,
}

impl Default for AnemoiHash {
    fn default() -> Self {
        Self {
            state: [Felt::zero(); STATE_WIDTH],
            idx: 0,
        }
    }
}

impl Sponge<Felt> for AnemoiHash {
    type Digest = AnemoiDigest;

    fn hash(bytes: &[u8]) -> Self::Digest {
        // Compute the number of field elements required to represent this
        // sequence of bytes.
        let num_elements = if bytes.len() % 47 == 0 {
            bytes.len() / 47
        } else {
            bytes.len() / 47 + 1
        };

        let sigma = if num_elements % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        // Initialize the internal hash state to all zeroes.
        let mut state = [Felt::zero(); STATE_WIDTH];

        // Absorption phase

        // Break the string into 47-byte chunks, then convert each chunk into a field element,
        // and absorb the element into the rate portion of the state. The conversion is
        // guaranteed to succeed as we spare one last byte to ensure this can represent a valid
        // element encoding.
        let mut i = 0;
        let mut num_hashed = 0;
        let mut buf = [0u8; 48];
        for chunk in bytes.chunks(47) {
            if num_hashed + i < num_elements - 1 {
                buf[..47].copy_from_slice(chunk);
            } else {
                // If we are dealing with the last chunk, it may be smaller than 47 bytes long, so
                // we need to handle it slightly differently. We also append a byte set to 1 to the
                // end of the string if needed. This pads the string in such a way that adding
                // trailing zeros results in a different hash.
                let chunk_len = chunk.len();
                buf = [0u8; 48];
                buf[..chunk_len].copy_from_slice(chunk);
                // [Different to paper]: We pad the last chunk with 1 to prevent length extension attack.
                if chunk_len < 47 {
                    buf[chunk_len] = 1;
                }
            }

            // Convert the bytes into a field element and absorb it into the rate portion of the
            // state. An Anemoi permutation is applied to the internal state if all the the rate
            // registers have been filled with additional values. We then reset the insertion index.
            state[i] += Felt::read(&buf[..]).unwrap();
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
                num_hashed += RATE_WIDTH;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        // Finally, return the first DIGEST_SIZE elements of the state.
        Self::Digest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }

    fn hash_field(elems: &[Felt]) -> Self::Digest {
        // initialize state to all zeros
        let mut state = [Felt::zero(); STATE_WIDTH];

        let sigma = if elems.len() % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        let mut i = 0;
        for &element in elems.iter() {
            state[i] += element;
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        Self::Digest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }

    fn merge(digests: &[Self::Digest; 2]) -> Self::Digest {
        // initialize state to all zeros
        let mut state = [Felt::zero(); STATE_WIDTH];

        // 2*DIGEST_SIZE < RATE_SIZE so we can safely store
        // the digests into the rate registers at once
        state[0..DIGEST_SIZE].copy_from_slice(digests[0].as_elements());
        state[DIGEST_SIZE..2 * DIGEST_SIZE].copy_from_slice(digests[0].as_elements());

        // Apply internal Anemoi permutation
        apply_permutation(&mut state);

        Self::Digest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }
}

impl Jive<Felt> for AnemoiHash {
    fn compress(elems: &[Felt]) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = [Felt::zero(); NUM_COLUMNS];
        for (i, r) in result.iter_mut().enumerate() {
            *r = elems[i] + elems[i + NUM_COLUMNS] + state[i] + state[i + NUM_COLUMNS];
        }

        result.to_vec()
    }

    fn compress_k(elems: &[Felt], k: usize) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);
        assert!(STATE_WIDTH % k == 0);
        // We can output as few as 2 elements while
        // maintaining the targeted security level.
        assert!(k <= NUM_COLUMNS);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = vec![Felt::zero(); STATE_WIDTH / k];
        let c = result.len();
        for (i, r) in result.iter_mut().enumerate() {
            for j in 0..k {
                *r += elems[i + c * j] + state[i + c * j];
            }
        }

        result
    }
}

#[cfg(test)]
mod tests {
    use super::super::BigInteger384;
    use super::*;

    #[test]
    fn test_anemoi_hash() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![Felt::zero(); 8],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![Felt::new(BigInteger384([
                0x2a854475670de875,
                0xd76a368e3324b130,
                0x09613eb34bb960b3,
                0xa19f8e583d647d73,
                0x82e469beff0cde16,
                0x007a1bd209902839,
            ]))],
            vec![
                Felt::new(BigInteger384([
                    0x6580f90617936204,
                    0x239c96c79e8e3531,
                    0x6832bc96bcd63c93,
                    0xb88b884d42e2a6d9,
                    0xc66188a04f21e686,
                    0x00c074c2596cbe8f,
                ])),
                Felt::new(BigInteger384([
                    0x417c877341085b63,
                    0x45f3abe10eb112b7,
                    0xc87e44d3397659fd,
                    0x31e77bc13edb09d7,
                    0xc09eb6f1f46207dc,
                    0x00bd1c3b48bf9cb4,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x35039360e08355da,
                    0x68b3f94fa4eff2a9,
                    0x1a63e8aff0a3c8bc,
                    0x65aeb24e8c3e28e5,
                    0xbc8417db4071425b,
                    0x013e3a6ed21dd855,
                ])),
                Felt::new(BigInteger384([
                    0x1a845b3628b77071,
                    0x09eb31498bb58220,
                    0x4de797da3050af60,
                    0xa2299209710aeb24,
                    0xd3ed0d1ca35ad269,
                    0x00c14b58e37d8eb0,
                ])),
                Felt::new(BigInteger384([
                    0x57855eb6051fa841,
                    0x393e6f5034a2584f,
                    0xb8482eee04b11492,
                    0xaacc1bc1837c24e9,
                    0x10fe10b7e57c1f00,
                    0x003ec2b384b11b08,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x61fbf721c92f09ba,
                    0xba651fd64e6f3c49,
                    0xe8223d83e61a4fac,
                    0x3e59e3aa288f6e1f,
                    0xf05b8f02c9a2ec6d,
                    0x00ce1cca985a4110,
                ])),
                Felt::new(BigInteger384([
                    0xae62de009f46100d,
                    0x13cc138ff83bf207,
                    0x7fb341cea8237640,
                    0x453758f1352c9f9f,
                    0x37df77f5d5d439d6,
                    0x010880239e50c0dd,
                ])),
                Felt::new(BigInteger384([
                    0x88879b76724d23c4,
                    0x728c59615d0355d9,
                    0xd4b118ab91cd66e4,
                    0xd7c04b40d73f4e3c,
                    0x7e30263b7d450a16,
                    0x007b329dccfd4e68,
                ])),
                Felt::new(BigInteger384([
                    0x6babd5d74ddcd6e0,
                    0x23fe3e335086e967,
                    0x2abd1d23799e3116,
                    0xdd73fbe909b98514,
                    0xb26f9abcbb9f62d1,
                    0x011deb42ce21357c,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xa0fd5ee82ec267d2,
                    0x48b0470c28225aa4,
                    0xffd42981dc8271e6,
                    0x32ace8ed52cf3002,
                    0xbfa131b80cda5680,
                    0x004a842e25c906e1,
                ])),
                Felt::new(BigInteger384([
                    0x2dc7fb33c0274fd3,
                    0x2c00a335627929dd,
                    0xc0f6a3bc60bc9f66,
                    0x724937b25daff498,
                    0x6fa648e185ef4aa8,
                    0x01349ca244dcfb29,
                ])),
                Felt::new(BigInteger384([
                    0x032bfc7f75f19581,
                    0x40e8b18c00136233,
                    0xf53dad4f12cc6451,
                    0x44e96110ff8f8e82,
                    0x8f92487563e76113,
                    0x00ed42ef23c1b9f7,
                ])),
                Felt::new(BigInteger384([
                    0xae8d6fb6b2d3886d,
                    0x91fb328916d384a3,
                    0x17ea68c7fd90fe26,
                    0xeff26f790bdd0f03,
                    0xcfce0c6d0a19f891,
                    0x01073bc4a9716c76,
                ])),
                Felt::new(BigInteger384([
                    0x928d02f70652eb3a,
                    0xf172a5144d641a3d,
                    0x17111a538a5e5f2f,
                    0x9579adbff8dbf025,
                    0x01686306c3c24cf2,
                    0x0157f89b69591868,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x77730c1e527b9c1c,
                    0xdda71be739010060,
                    0x830b0a4ca6b93e31,
                    0xcee74db90514111a,
                    0x5de4e81eaf00f2ed,
                    0x0017fa1470c30402,
                ])),
                Felt::new(BigInteger384([
                    0x68ff455a5c629ff9,
                    0x4862ac72880a48a2,
                    0x3501a2e3bc49e4e4,
                    0x6562410b5936114b,
                    0x5498f9ddacfe7782,
                    0x018cc31a40418b2e,
                ])),
                Felt::new(BigInteger384([
                    0x943a500f88640b32,
                    0x885af55edde6e988,
                    0xa6d8c12f9f9d184f,
                    0x3ee81ccaaa56363c,
                    0xfabfb43f4e9d7de8,
                    0x004bc3446379bb9d,
                ])),
                Felt::new(BigInteger384([
                    0xdaf6bcab7cf36efa,
                    0x0e2eecd962572ec7,
                    0x749fd490278168b1,
                    0x4ba260fa92de650a,
                    0x0391dd322c863f6f,
                    0x0064967410dfade2,
                ])),
                Felt::new(BigInteger384([
                    0x84e57a5d609ac8dd,
                    0xafc743997740cd1e,
                    0x3d898ec1c385bbd6,
                    0x7c3df7db82d80e58,
                    0xbcf12b546d2bc9af,
                    0x011cea3f1c84beaf,
                ])),
                Felt::new(BigInteger384([
                    0xc28c649c862958bf,
                    0xd3c00af423c0d236,
                    0xbe9018810d8bfa6c,
                    0xa5edd6727a6e872f,
                    0x59086fe732403172,
                    0x00e9d5910ee66c5e,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0xb2138843839d5b63,
                    0xd17f3b6551dd56f6,
                    0x55484aa0088983cd,
                    0x2983b0942100543f,
                    0xa0cb11adf7d33b98,
                    0x00ee1d6d33395537,
                ])),
                Felt::new(BigInteger384([
                    0xd2155e94f04b9686,
                    0xa3d47c25eb4a29b5,
                    0x2a16c481a6633989,
                    0x4a56f34e9b148bb3,
                    0xf90da2604f9a5801,
                    0x013f57265217296a,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xc1870ffa76e0beab,
                    0xcf149bd3911b72d6,
                    0x4f333acee5883ed9,
                    0x684f7608e987b204,
                    0x657016d61d8755c5,
                    0x00ff39264ee635fa,
                ])),
                Felt::new(BigInteger384([
                    0x81e700300ee038d7,
                    0x007c07ca06199913,
                    0xc18731908b16ec28,
                    0xf10df6f9ac793796,
                    0x6dfb45f77db69776,
                    0x00d13ba7b391ae5c,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x3ac76aae0bfa304b,
                    0x09e573b8eba4c764,
                    0xc35f1ba587ebbdd3,
                    0x39f9865f6bc5e4ef,
                    0x5285a615db06f915,
                    0x00cf9be2fdead894,
                ])),
                Felt::new(BigInteger384([
                    0x986200ea617a76dc,
                    0x5b55d00ceb5428e9,
                    0xd199ab73ee3cd01f,
                    0xa3ada27de0309f00,
                    0x089d9922e98ebb66,
                    0x01503d96416884eb,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x965a8e0b4d4f692a,
                    0x0bb5ce2640f3c413,
                    0x1170f022a0e6f0b4,
                    0x258f4503a0b8c5da,
                    0xf6851bfee40ecf8c,
                    0x000444b2a12d39c3,
                ])),
                Felt::new(BigInteger384([
                    0x0f2f813893b08436,
                    0x36c88af48be16e78,
                    0x037bafa76a6c60b4,
                    0x4af18d7497a4d7c9,
                    0xbb236f0a587b6156,
                    0x006d02d10d26fee5,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xf762422b3c810e0c,
                    0x9627b0991e45de59,
                    0x70734f865327f41f,
                    0xb3f2224de0a68e94,
                    0xa85f414ab52fc2b6,
                    0x012c745360e4e2c4,
                ])),
                Felt::new(BigInteger384([
                    0x21cd3a7a24bb002d,
                    0x2ea52335de9bcbd7,
                    0x660861a7b113ac93,
                    0x755986e9212d1ccd,
                    0x10a0188434c64b07,
                    0x00d5ee8893029420,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0840efacdcdb122a,
                    0x269b8c308a6c575a,
                    0x2b954d79a4778aae,
                    0xaf10f49d8ae0d97d,
                    0xec62d2d0cd40b43c,
                    0x00ec161f641803e0,
                ])),
                Felt::new(BigInteger384([
                    0xbfbb856c2a350b5e,
                    0x46b2cf92e506a808,
                    0x85ef44eb5cbfaeee,
                    0x3bb0017a0350e1c9,
                    0xc5c856e32bf710bb,
                    0x00fa6557c1dc3de5,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x53c136cdc2f4315a,
                    0x1b819138c1a238bb,
                    0x5bc2c7b1a8b79521,
                    0xbd80541ab4856fac,
                    0x52fa25df43eb13c3,
                    0x009163497ad0bdb2,
                ])),
                Felt::new(BigInteger384([
                    0x2e980d9f02f96fb4,
                    0x763f94fc71530251,
                    0x9553f68e1dc36c29,
                    0x105efd6c011b4261,
                    0x3b97fc9f8b1ad2b2,
                    0x00b3e78fa2ce2216,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xc529448384253fdf,
                    0xcedc759549381bec,
                    0x2a442b543f1cccd8,
                    0x0efde4b7ef0feb03,
                    0x32166a1621c2fedd,
                    0x0160a8e034fae6b5,
                ])),
                Felt::new(BigInteger384([
                    0x04adbdd37be6f1ff,
                    0xa2f61aa2365833ea,
                    0x9d79922ed8a64dab,
                    0x5f68bfc88529041f,
                    0x6d36a8628f723872,
                    0x0199b0347b62633f,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x216568080e223261,
                    0x8999e67987f46806,
                    0x088447506f6ea450,
                    0xbdc8439da0e43779,
                    0x16fa82a6b422bf1d,
                    0x01a2fcd201c9cac7,
                ])),
                Felt::new(BigInteger384([
                    0x59dd972e10ac102c,
                    0x5f29064b806011af,
                    0xae07bdbc4dffba54,
                    0xdf3b5bd21df4cfeb,
                    0x85a576956f8e34b8,
                    0x00304238a720c86c,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x2d358520bb75ce41,
                    0x7754a390499e746c,
                    0x7139e1ae596dfdfa,
                    0xd440193f71acc596,
                    0x20a7ad8c494da356,
                    0x017906f0ee4d8b33,
                ])),
                Felt::new(BigInteger384([
                    0xdcc727b8db3aea84,
                    0xb9ffad5ccc6f46e7,
                    0x930d3cc25023177d,
                    0x3ed1c6714421d941,
                    0xdb65a0e06f201d62,
                    0x00ca1ada3282f739,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected, AnemoiHash::hash_field(input).to_elements());
        }
    }

    #[test]
    fn test_anemoi_jive() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![Felt::zero(); 8],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x805c96dadddde5ff,
                    0x3b1f64483e4c4531,
                    0x1c97a6ac0f87e9f2,
                    0xcc2913a439ca29b1,
                    0xb1c0a091d62a4090,
                    0x003673a426d0ab07,
                ])),
                Felt::new(BigInteger384([
                    0x3e3faa568326aad0,
                    0x513b59ac864f2905,
                    0xb266d9f04456a6b3,
                    0xc4a6dcfec5b09ea7,
                    0x16edca31bb1713f3,
                    0x009472ec776f18dc,
                ])),
                Felt::new(BigInteger384([
                    0xabcb04af28f8dec1,
                    0x6297e8e819a764be,
                    0x99a0149b49a61bcb,
                    0xf308251f292ea5e7,
                    0xf8f9bb5706f2f178,
                    0x00de7f452fbc257a,
                ])),
                Felt::new(BigInteger384([
                    0x27dc731f6dea932c,
                    0x98425fcbb354d37d,
                    0x036aa1401d542828,
                    0xdddb9d81d2922acb,
                    0xff20f0d2b0d4ec61,
                    0x016677f2906fb73e,
                ])),
                Felt::new(BigInteger384([
                    0x6db299bfc8f662cc,
                    0x0a65c49b3574e915,
                    0xfde45483d18d8d54,
                    0xee4a17d000be3628,
                    0x4767aac7ee650a4d,
                    0x014db52eb3d9e20c,
                ])),
                Felt::new(BigInteger384([
                    0xf7d1fd35f07aea35,
                    0xb82aca9cbecd1004,
                    0x858f4cc6d63dff42,
                    0xc6e24e04ef19f2d7,
                    0x13ead1ebd2254802,
                    0x00390bd14144bcab,
                ])),
                Felt::new(BigInteger384([
                    0x213006c53255c386,
                    0x830349c14456dfb1,
                    0x35381fb1c21a3749,
                    0x911e3a88248a6289,
                    0x0a0dd8d08059e994,
                    0x016b1fce0042dc2b,
                ])),
                Felt::new(BigInteger384([
                    0xeb34281c26d1a267,
                    0x26ce0ea145b6c841,
                    0x06c77ab74fc5b3d9,
                    0xb5de9b8f98ba6056,
                    0x48db62e71ded38d0,
                    0x00679540abbd55d1,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xb88ee80b99b85ede,
                    0x0b8ca192e46391e3,
                    0xf11154f3925d311b,
                    0xcbbd5e094915b234,
                    0x9877e8ce6728e8d8,
                    0x016474b2d2cec125,
                ])),
                Felt::new(BigInteger384([
                    0xf590cde2d63bd027,
                    0xd4e95deb91731cf7,
                    0xa0d7588dc8a814b7,
                    0xa62adbe99856b116,
                    0x44b85353bfdba8cf,
                    0x009ecd60afbf95ff,
                ])),
                Felt::new(BigInteger384([
                    0x73ee29533b2d032b,
                    0x4fcb15924fca5086,
                    0x1cc470be59a08f93,
                    0x6788406c235e9727,
                    0x75fb4911c626a7ec,
                    0x01661453bd150442,
                ])),
                Felt::new(BigInteger384([
                    0xe229d98d408b58ab,
                    0xed9f4bf3fb7f1a47,
                    0x70549245afced3b2,
                    0xd7ad414b33721e09,
                    0x44aeb01e9f8b5545,
                    0x0002d04a8d4d391a,
                ])),
                Felt::new(BigInteger384([
                    0x4da133f85aa6a4d1,
                    0x6461b0ccd8c745fc,
                    0x603a955489e165f1,
                    0x2b6606494f24c732,
                    0xe01b7363d99a065f,
                    0x00c5ff695286e6e6,
                ])),
                Felt::new(BigInteger384([
                    0xc7a26b4c35c8d0f9,
                    0xfdafdfe00ab4dada,
                    0x8d7e9e6c0e1ecab0,
                    0x2524bd373673a45f,
                    0xac0480f0b4b78580,
                    0x015c1450ceae91cb,
                ])),
                Felt::new(BigInteger384([
                    0x6ef1f68e305e9cbd,
                    0xd7364acd1a645474,
                    0xc6285132345114c2,
                    0x3ed57fa40391dfb0,
                    0x38d2129ad211b4ff,
                    0x002c2e640c7a7692,
                ])),
                Felt::new(BigInteger384([
                    0x8e30daa66f54373f,
                    0x48b6fde70f30fc63,
                    0xa08c70b11ff67f33,
                    0x571e98b276997caa,
                    0x6a78aa974e936a2a,
                    0x00f512920fa1b1ac,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x53b637a2233e4d59,
                    0x0136ee33ad42e5a5,
                    0xda2062097eb5327d,
                    0x5d6ea7bf90ac2ccb,
                    0xc6312ed688c4d4b7,
                    0x00add288fa42d3c8,
                ])),
                Felt::new(BigInteger384([
                    0x0fdca12f3c7cfd1d,
                    0x6da3bb519ea34dbb,
                    0xa44661a383702ff2,
                    0xb518c05107cedb2f,
                    0x9a4dba0e508a5623,
                    0x0053197ff9f1c95e,
                ])),
                Felt::new(BigInteger384([
                    0x963a8ed7e6bf5d8d,
                    0x7e8463289f491ec0,
                    0x747c9fb37ee7ac4d,
                    0x97101e090128322e,
                    0x28d92ff245a33ba1,
                    0x013ea3b438ea17e5,
                ])),
                Felt::new(BigInteger384([
                    0xd8d2e8708e99b063,
                    0x95bb72e1d499bb72,
                    0xe6fa20014b120f01,
                    0xcde73f781941ae08,
                    0x429cb4201946b55d,
                    0x004e6b7731400b49,
                ])),
                Felt::new(BigInteger384([
                    0x43e027fec2fa451b,
                    0xe23aee344120d5bc,
                    0xaca8ba9432a9bcf3,
                    0xb496e24afcee354b,
                    0xdfab59932ea43c7b,
                    0x00d9cdef3fb9345d,
                ])),
                Felt::new(BigInteger384([
                    0x1654942b9eb7fd40,
                    0x6975cb6a83e3ffd7,
                    0x1eddd616fc97525b,
                    0xf984466d1a1c7241,
                    0x7ff30850ce6bb234,
                    0x0017c976de381a68,
                ])),
                Felt::new(BigInteger384([
                    0x7aa28011d41f9f5d,
                    0x1a56b57a04b8f9d4,
                    0xa53ca06405473120,
                    0x92cb1e1543a61676,
                    0xbf4d071b06a02580,
                    0x0052327b3ea80dd6,
                ])),
                Felt::new(BigInteger384([
                    0x3dd368c4c87b9747,
                    0xb7d41bd30f637ace,
                    0x936328cac996e681,
                    0x3bd2c02169b6f877,
                    0xb7096489a0341063,
                    0x00d759475305d448,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x3596720e55574373,
                    0x7ffc9e7746d87252,
                    0xd0262a646e0bfdae,
                    0x07887c6439715be6,
                    0x52866864bd235266,
                    0x00cc2560def5e359,
                ])),
                Felt::new(BigInteger384([
                    0x12a4c61a9661f523,
                    0x87fc82a555d16dfa,
                    0x534c1fa10095d0b0,
                    0xc6bb67d57c879063,
                    0x5a879aeed49aff23,
                    0x0002651720be5a67,
                ])),
                Felt::new(BigInteger384([
                    0x5caad457b1033da3,
                    0x8d8b55af96bda6bf,
                    0xb0414bf3ac48d787,
                    0x91a6d5319374f537,
                    0x41b63a0b9506fed4,
                    0x0169fc254b6d01c5,
                ])),
                Felt::new(BigInteger384([
                    0x2769af8171b1157a,
                    0xd1f02ace151cc373,
                    0x80c48905f5799e54,
                    0x65266a7b4b84187f,
                    0x9e8454b8cb45985e,
                    0x00c16cb37d71887c,
                ])),
                Felt::new(BigInteger384([
                    0xdca304a1ce6b0ada,
                    0xdc43d1db2bf550d0,
                    0x97bc6c9a707f980c,
                    0x715940c107dc4c0c,
                    0xb2275db394f1b8a4,
                    0x0060504768ad21c7,
                ])),
                Felt::new(BigInteger384([
                    0xad7feeb2b016a594,
                    0xd8b76c937d70e039,
                    0x3de2a9568b5de75b,
                    0x4426c434c4b33a9f,
                    0x554afc5479134943,
                    0x0050c23600d2806e,
                ])),
                Felt::new(BigInteger384([
                    0xfec30fe25cc7b2ab,
                    0x71e174dfe3b2626b,
                    0x766bcde36b2e2c39,
                    0x73b7f8df36ff7955,
                    0x12cce55ef2d9b3bd,
                    0x0090af610e35f22f,
                ])),
                Felt::new(BigInteger384([
                    0x7aef536e40406708,
                    0x5c11357012601d92,
                    0x41598884eea35879,
                    0x9295225b49a85715,
                    0x5bda8540379ed7e2,
                    0x015efbd5a160737b,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xda7c9c8a6279664d,
                    0x5f784c4aae464514,
                    0x17ad82c68209b070,
                    0xf9dad9e8ee5d58ca,
                    0xd4b093d8faa03296,
                    0x010348a001430d3b,
                ])),
                Felt::new(BigInteger384([
                    0xdb8b125489530ec2,
                    0xd70fd868c0ad796b,
                    0xb2473c1a38bf2a20,
                    0x4f6bd6b7684de037,
                    0xd054c28b9ad74d46,
                    0x01808b419e22061a,
                ])),
                Felt::new(BigInteger384([
                    0x5db5fd60efd7c8e1,
                    0xc373286ae25e5d6f,
                    0x8f154449fa55ad52,
                    0xfb6ffc3ec7ea7127,
                    0x6097af81c9bbd44b,
                    0x003087b87d037e57,
                ])),
                Felt::new(BigInteger384([
                    0x4fd13edeb19271b3,
                    0xfceb6160a3ea325f,
                    0xb180a27ac51fdb55,
                    0xfab98bc7c16a8905,
                    0xca253e32c3a16aef,
                    0x016ef1dc4937aa1b,
                ])),
                Felt::new(BigInteger384([
                    0x7fb632af0e91b043,
                    0xa067659e245c1040,
                    0x0baf19974c81433b,
                    0xc88ca54dd955e2ce,
                    0x02e263f4243cb0d3,
                    0x01574fefda30f2d2,
                ])),
                Felt::new(BigInteger384([
                    0x49578666eea7d00a,
                    0x040b5e455ceccecc,
                    0x9ebf0d6fb9957c0c,
                    0x3cfe6fdbc73bac84,
                    0x3cf7292b1c631865,
                    0x0127f387c0ca5688,
                ])),
                Felt::new(BigInteger384([
                    0x76952670ffc42ee3,
                    0x41cc404dc08d36a6,
                    0x5a1ed707c199d128,
                    0x6b0b4ff88872af5b,
                    0x17670208572eec90,
                    0x013d644fb377b222,
                ])),
                Felt::new(BigInteger384([
                    0xd480f4c0637721bd,
                    0x1df4b3f08d1ddf50,
                    0xade0014bba8ee8e6,
                    0x44bcdeaf26061883,
                    0x560b68c07134ab44,
                    0x017272c942afac85,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xbc20ffde3e4d4fd6,
                    0xe2e662d7db5ad410,
                    0xe5d1af56cc708373,
                    0xcb86058b3f3f3841,
                    0x89ca9b67e5d9ac21,
                    0x0024a1fe0a6c6edb,
                ])),
                Felt::new(BigInteger384([
                    0x8e90538ebbf0b077,
                    0x8a15e49bb3f15c20,
                    0x37d33910c5a822dc,
                    0x2a8a47c8f460e088,
                    0xb4c4fd9881c5cee2,
                    0x001b79f16aabd755,
                ])),
                Felt::new(BigInteger384([
                    0xb8ccdc9cb9b8717f,
                    0xd9ef878519ceb111,
                    0x55287e6d2857e6a4,
                    0x4f46f98041d05eda,
                    0xcb34d46d5e9940e6,
                    0x000f22578d9d3e1c,
                ])),
                Felt::new(BigInteger384([
                    0x8f0ddba62f136df4,
                    0x267be06e1c66b54e,
                    0x52559ec02be5e168,
                    0xc4e4d12dddd3f8fe,
                    0x4fa242463244e382,
                    0x0076cb5d8ffc6dd9,
                ])),
                Felt::new(BigInteger384([
                    0x609bcf13dbd5332e,
                    0xf0224542673532f7,
                    0xda415902ddc142e7,
                    0x8b48d919dcc29bc6,
                    0x89b036717fe51d17,
                    0x001d7c1ba8f747a4,
                ])),
                Felt::new(BigInteger384([
                    0xab46c7e3157c5622,
                    0x4fc4accfb0a5ad32,
                    0xc74c2cc18e5ad583,
                    0xf76c7d3dc79d2d3c,
                    0x63bb5988acfd5568,
                    0x0197127f67166174,
                ])),
                Felt::new(BigInteger384([
                    0x1470c55f9b06b3f8,
                    0xd507b54e5523c963,
                    0x85e2ec3ac02ce401,
                    0x18c2ae8183295084,
                    0x0eedff4488660245,
                    0x0096fd9f92e0ff05,
                ])),
                Felt::new(BigInteger384([
                    0xf2c61a27d7a61186,
                    0xc350f6bc60c403b4,
                    0x4343a45e12a5f903,
                    0xfd529465a77815eb,
                    0xf97d5111bfa73008,
                    0x00934bc67c829843,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0xf1880f59e5aa2ee5,
                    0x4fb0c5b6f34dc9dc,
                    0x2d053e2bc33176a2,
                    0x6be23031b2535f17,
                    0x1a35a69fbe7bc267,
                    0x0135c600e1a065ac,
                ])),
                Felt::new(BigInteger384([
                    0xbdfa1f91dd9db631,
                    0x360bd3dbba14ef12,
                    0x4834852a250ebce7,
                    0xc8c993594a4fc689,
                    0x76317edd6626f95d,
                    0x005c0b714194b556,
                ])),
                Felt::new(BigInteger384([
                    0x706c6eb4f2d7bb8b,
                    0x2f9e380bcdaa7ad3,
                    0x25b18612d7d01e59,
                    0x9dcf1b024dba7617,
                    0xce85e44db3c47512,
                    0x0191a4efa07cd955,
                ])),
                Felt::new(BigInteger384([
                    0x6871ad59073d60a1,
                    0x7983b740b5438218,
                    0xa17b8b55a057b8c5,
                    0x4cbbf695a7ecff0f,
                    0xd4771b00327e891c,
                    0x01005bfade5eaed2,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xbfeeaa952e95e6f4,
                    0x4a8f7f06a7370ed3,
                    0x29c9eb4b9283141a,
                    0xaa9eb8adc07b3e1e,
                    0xaaa21d28b7061fbd,
                    0x00bec1d7e9f01da8,
                ])),
                Felt::new(BigInteger384([
                    0x386436b5e1487e8c,
                    0xf6cc2090d0fbd6e5,
                    0xc903e8cc14126db3,
                    0x332307f34c320776,
                    0x374dce977c497929,
                    0x004f6b6f175bd9d2,
                ])),
                Felt::new(BigInteger384([
                    0x31f9852173fe4a8c,
                    0xada58eeae8861115,
                    0x7ecd7e490540a4e8,
                    0x11766806edc7a9ee,
                    0x580ee3ede24d38c2,
                    0x001c8ad37908b4e7,
                ])),
                Felt::new(BigInteger384([
                    0x380519454e0d33a1,
                    0xc0849adf5e0e9909,
                    0xc52e7883a04e2e40,
                    0xdecc8fd6adee3df4,
                    0xdfae04fb87e0eab9,
                    0x012ae3982b31c6c8,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x978fa2d43b124880,
                    0xd3af2548b148e443,
                    0x6c09b9a6ab5e2287,
                    0x0f8975461daa63e5,
                    0x758756f23a520f8e,
                    0x0092c7bf834c0cd3,
                ])),
                Felt::new(BigInteger384([
                    0x32bc88bfded0f83b,
                    0x52fa7cbaf5520805,
                    0x6174205c7006998c,
                    0x48e377deec14e895,
                    0xed23b542fcfee97c,
                    0x00a110b8b2e59340,
                ])),
                Felt::new(BigInteger384([
                    0x80d159331e66fd8c,
                    0x3da164e5e3c702c9,
                    0x70b7257c8b66ed11,
                    0x7c56f02440532e9d,
                    0x243f687473e9851c,
                    0x015e8008d5e06a37,
                ])),
                Felt::new(BigInteger384([
                    0xafd0c6861151d94d,
                    0x0824a47d0799351d,
                    0x86b0b9adb8d9cc3a,
                    0x035596b1e524025b,
                    0xe8c76e1611372e8c,
                    0x00b48b9161afbd5d,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x9c1182064eb3f8c4,
                    0xc8244e70929a9546,
                    0x2c5aaca9a745d065,
                    0x4d85fa0779ee3be8,
                    0x878ee224b1dd8254,
                    0x00004fbf6dfe35b4,
                ])),
                Felt::new(BigInteger384([
                    0x4ab392af5d70cab5,
                    0x3580fd3c72a14304,
                    0x498964e40fd6d652,
                    0xc0e402c5689df8b7,
                    0xe40d70cceb004e11,
                    0x0146dd02e4a0f9fc,
                ])),
                Felt::new(BigInteger384([
                    0x0dc4b65dafded2f9,
                    0x981cac6fba562207,
                    0xfadeb2889030c990,
                    0x79130a3da55e175a,
                    0x3d896dc119864d76,
                    0x015d814d330c7d14,
                ])),
                Felt::new(BigInteger384([
                    0x0a1498187a1ada1e,
                    0xae6237392695ad44,
                    0x118d9bd88c54ffe3,
                    0x06f7e600f9c2d0de,
                    0x1c5eac9f04a0fe0f,
                    0x00bfb7901b0d76a5,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0caa070d3a21c99c,
                    0xcb4cf0ef050cd43e,
                    0x0036e7bd4892e5ea,
                    0x1abc3df0d615cf0a,
                    0xc8805bd9c0b85fa3,
                    0x0189fa007e3976e7,
                ])),
                Felt::new(BigInteger384([
                    0x8ea78aa7100f7b41,
                    0x14dad029303bb550,
                    0xd1a5c4d99dfc0ea7,
                    0xf67dfa0d1ab54610,
                    0x266df8f1b6033a75,
                    0x002845e949202db9,
                ])),
                Felt::new(BigInteger384([
                    0xbb1edec569f39545,
                    0xe158b3e9bee53b78,
                    0x35cbc96aa7725cee,
                    0x3c4b45a01db4a8b6,
                    0x729af90bd69669be,
                    0x0130999bd4ad4122,
                ])),
                Felt::new(BigInteger384([
                    0x87abfd5c847c75cb,
                    0x469ae31a7ff3e6bc,
                    0xf1440d20eadd52a9,
                    0x9f83330908505911,
                    0xed162f859e124b1c,
                    0x00f4d90bdbeb64da,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x3150c887d983bd55,
                    0xe6cdea7611ac5033,
                    0xd542ac35f33e09e5,
                    0xbc6a6b1bc4d71745,
                    0xa4d8ff487ac3f6e6,
                    0x0068bcc1f65b05b1,
                ])),
                Felt::new(BigInteger384([
                    0xada41b21acbb8450,
                    0xe14a9d5585cac1f4,
                    0x94c9329d13514f39,
                    0x0d774b44a70140c7,
                    0x1cd06b4069c78695,
                    0x010e542b3e8a095e,
                ])),
                Felt::new(BigInteger384([
                    0x64a3bdb453b1db06,
                    0x6bc4f71b7437731d,
                    0x6f59dfd5fa9ce52a,
                    0xde0929297281b48c,
                    0xbba9bbdbcd1a130e,
                    0x019cd220ba0593e9,
                ])),
                Felt::new(BigInteger384([
                    0xc1a6008bcc309eb4,
                    0xe842d263cdc2f39f,
                    0x79fd627661c383f7,
                    0x3bdb73df5cdf15c4,
                    0x6b83ded7bd320e17,
                    0x0166a8027b278a9a,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xbc252e43ef6eac57,
                    0xb6e0f2be02463346,
                    0xc5073254e284db6b,
                    0xcc2257fd29b00eef,
                    0x4fa39b7405d05265,
                    0x006e08b3879dc283,
                ])),
                Felt::new(BigInteger384([
                    0x7db74e98e4c174c0,
                    0x99dff8edb934acfe,
                    0x03a69af50ae6bf7f,
                    0x33a0666d8a8a671d,
                    0x142f5bfc9001044d,
                    0x011bfcdee0fa9f66,
                ])),
                Felt::new(BigInteger384([
                    0xf1c414be9829a6b4,
                    0x9a0c0c0c4ea20323,
                    0x57a35c61b037a488,
                    0xcf1967ad57fb1410,
                    0x28026e31418ea19f,
                    0x012fe014a6f5aa01,
                ])),
                Felt::new(BigInteger384([
                    0xff02e032dba06a79,
                    0xfbcdaf71429a02b8,
                    0xbc344c24357ded1b,
                    0x03c1f621e16ccbb7,
                    0xecd5b8c52a07fccd,
                    0x0199492377ee17da,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x67752d100afb0725,
                    0x9a1b16ae116f02d1,
                    0x987ea7849677d140,
                    0x62cd389587569518,
                    0x96aad1fad73e5172,
                    0x001890a42e088fcb,
                ])),
                Felt::new(BigInteger384([
                    0x4a309cb8f209e33c,
                    0x2c7c7711f66a2d4d,
                    0xc55ebbfe4c383988,
                    0x61a05190c9dd1674,
                    0x214143cf3c562208,
                    0x01ad29fcecf4e17e,
                ])),
                Felt::new(BigInteger384([
                    0xa785d587d4dc5fc0,
                    0xef119ba9976e7e2b,
                    0x4e19775d01ff8d69,
                    0x752b51dc35dd541a,
                    0x4d569d573ba3cde7,
                    0x0135929911192a2a,
                ])),
                Felt::new(BigInteger384([
                    0xac773dde16f1e1cd,
                    0x40d5bb06ef9799c8,
                    0xb240a01f6de7644e,
                    0xdb56ae527ac3b085,
                    0x549b7cfd2b401e2f,
                    0x01444dba0b519cab,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x702425ee8a881718,
                    0x575b47600c51fede,
                    0xf24924e1dace35fe,
                    0xc88c8a5d037aaea9,
                    0x8bc48d1c0da1a841,
                    0x016d79d91cc9a9f0,
                ])),
                Felt::new(BigInteger384([
                    0x0891d2b3ca60e3e9,
                    0xab73fdac40d84bca,
                    0xa8d0e8d889fd8440,
                    0x2906de7da0f3c37c,
                    0xbc4ff020f04db475,
                    0x0161ff5d4582ad7d,
                ])),
                Felt::new(BigInteger384([
                    0x07aa277c679311bd,
                    0x3d89fdcee499bc38,
                    0x249a4720565c740b,
                    0x762daba147921552,
                    0xf34a32228f0d9c39,
                    0x00b2c4a6f06b3534,
                ])),
                Felt::new(BigInteger384([
                    0x2599dc70c20ea475,
                    0xd96952b612d61d12,
                    0x81dc1d67e6247062,
                    0xa396cd6f8fdab44a,
                    0x876ed0b362026894,
                    0x002c604fed63764c,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x3c19fbab3601b936,
                    0x7f40220153b2145a,
                    0x47e0fb3f6a17c6bf,
                    0x6ed9a032af54c39a,
                    0x3d3351127489ece5,
                    0x00806954d318a64d,
                ])),
                Felt::new(BigInteger384([
                    0xfb6ee9032a8fe04a,
                    0x1e1949eb418e8f79,
                    0xf1fd57483719f990,
                    0x5995d5c4b225080c,
                    0xe7f2592f1adddfd9,
                    0x00fc73d7817532fb,
                ])),
                Felt::new(BigInteger384([
                    0xbedc6250608db95c,
                    0xea99dd9853f22dd4,
                    0x033c8320b5bfaa59,
                    0x743b9e5e94752d59,
                    0xee43b61e28d1e41e,
                    0x01705b059e5a035f,
                ])),
                Felt::new(BigInteger384([
                    0xe79e9cad6d35ccc3,
                    0xc78031eed4060637,
                    0x195d7a6fc7a836d8,
                    0x7b43ee412e4312c7,
                    0x333c1ab7a24dc17c,
                    0x00748faf14cbebdb,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress(input));
        }

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 2));
        }

        let input_data = [
            vec![Felt::zero(); 8],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x00415480c787d700,
                    0xffec7e3a24dd3cfa,
                    0xfd41d799557f9a81,
                    0x34b9e34169df4173,
                    0xccf585fef3fb54ff,
                    0x0168ff4fb81878aa,
                ])),
                Felt::new(BigInteger384([
                    0xce39a3fe12bcf2a7,
                    0x2be394c02d35d473,
                    0x3fdaee8eb4904cea,
                    0xc770a89d81bad2ee,
                    0xd811087770677a42,
                    0x015b2da76451883c,
                ])),
                Felt::new(BigInteger384([
                    0xa760d7a725326a51,
                    0xaff55627c0f4329f,
                    0xeb02e40f8eb38935,
                    0xdc570382411730af,
                    0x7fe506f20902b21c,
                    0x00472e9cea4ae54c,
                ])),
                Felt::new(BigInteger384([
                    0x38c6ca32fefb6d7e,
                    0x874dead47573c461,
                    0xc2516355900b6e46,
                    0xce964a291c4bccc2,
                    0x52b8a5ade7c3832b,
                    0x0132854aa970391a,
                ])),
                Felt::new(BigInteger384([
                    0xf76b78ff3ce188ba,
                    0xe7f44721a6229e89,
                    0xc78920ac319f2a46,
                    0xcf7bcb020c338aef,
                    0xac46835a57a49060,
                    0x01a6be464fcd5f6c,
                ])),
                Felt::new(BigInteger384([
                    0xd4b3757b3e93f5ae,
                    0xf1210a94e1524a3f,
                    0x24aed8b203330ef2,
                    0x2b156f3a45432d06,
                    0xc25ba6df72869bea,
                    0x017eff2ccb60bb6f,
                ])),
                Felt::new(BigInteger384([
                    0x911e485c90e5cee4,
                    0x49d1ad61a52e0202,
                    0xe19aeb36ce4dc5f9,
                    0x8e6356431ef02543,
                    0x1c5d06a2b93eec79,
                    0x0129bda9dc8be0ff,
                ])),
                Felt::new(BigInteger384([
                    0xc15d5c1c548bac1b,
                    0x4a0d039ba55cc221,
                    0x4e384497b48a1628,
                    0x658917e0b61e0517,
                    0x8a95d43d2050b641,
                    0x01aa3318ef548b6c,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x5a189d7dfe81ed83,
                    0x705112e66bd8a8dd,
                    0x169ebeb947daa665,
                    0x2b16855a94c7b1e3,
                    0x6c1e65de3903cb92,
                    0x007a578ce45d8f29,
                ])),
                Felt::new(BigInteger384([
                    0x560752b0214ff183,
                    0xc22657f53b8f84a8,
                    0x47ea6f536dfb9c47,
                    0xa55ffe57ff7807bd,
                    0x09da1d8173dc7203,
                    0x00830a0f09845333,
                ])),
                Felt::new(BigInteger384([
                    0xe374a68bb544db9a,
                    0xc4aaa73de9c1badf,
                    0x438e9e86b3c37689,
                    0xfc776a93d0abb8d3,
                    0x1cf69513d9eab8a3,
                    0x0151175ac756110e,
                ])),
                Felt::new(BigInteger384([
                    0x684ce5d6191ffdcb,
                    0x2271d03f906a6d7c,
                    0x3a0734ca14a723fa,
                    0xf61fd970a6b8ae00,
                    0x5d5f2f5a02d67705,
                    0x0128633b6e168591,
                ])),
                Felt::new(BigInteger384([
                    0x9e31c1d07be4493e,
                    0x5c4e9cff52f59e3b,
                    0xf7409ddf315891af,
                    0x8e7a5c9ace5b0f6c,
                    0xe0027a060411e2aa,
                    0x0035060bba4cfbd5,
                ])),
                Felt::new(BigInteger384([
                    0x8685aa42941b3197,
                    0xff74de5894fe2722,
                    0x69c26b860b25c8bc,
                    0x156858e98e062817,
                    0xb59a7a226e5f2ee7,
                    0x0192ac4addb7c889,
                ])),
                Felt::new(BigInteger384([
                    0x2ad35b1dc01c4f85,
                    0xc467054bc5a3e340,
                    0x7f8ac9bda91a5956,
                    0x585f5ba85028fce6,
                    0x742e9ec5e830c4ec,
                    0x0124aa06029e5c9f,
                ])),
                Felt::new(BigInteger384([
                    0x8765c3cd8c874861,
                    0x6b61f1bc2513aea2,
                    0x896ec8be2659c61c,
                    0x337b217b8cafd725,
                    0x4818c810aec92cff,
                    0x00b167f99000471c,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x0f2e3235d8f8bc3c,
                    0x99ba3f8d53ff8ada,
                    0xdefecd38aed5959a,
                    0xa4fb393d888b3f69,
                    0x1251fc46864daf79,
                    0x00932f7e23b2fc87,
                ])),
                Felt::new(BigInteger384([
                    0x5681808913f6ac57,
                    0x37342a9793b990e5,
                    0x2fe05cacc205ef8c,
                    0x7277ac2174748ec9,
                    0x59d01da213f5e641,
                    0x01116a9570591773,
                ])),
                Felt::new(BigInteger384([
                    0x60baabc2697bf5b3,
                    0x08b7c51290894569,
                    0x85d95b89fc828a62,
                    0x9403abc5cd1744b6,
                    0x641480659bd98e35,
                    0x019cd2c2309db1b8,
                ])),
                Felt::new(BigInteger384([
                    0x5eee6d274010e04f,
                    0x0cb93c14c2f73f24,
                    0xb28bab680606d8f5,
                    0x44ba89591a1f2985,
                    0xf36380f7a7b5d255,
                    0x009a79e284f70c88,
                ])),
                Felt::new(BigInteger384([
                    0xb786326938cfbd4b,
                    0x618d4251cd945519,
                    0xb96c6209d23e6e06,
                    0xfcb29c27f091ee73,
                    0xbd378da8da6f2b94,
                    0x010e86f51244173a,
                ])),
                Felt::new(BigInteger384([
                    0x048d639fc39fad11,
                    0x687a65fe45133c3e,
                    0x1ca0d63ccdef829a,
                    0x0ee1e0e1832cf752,
                    0x6bc626e948f5dbac,
                    0x01453b91de0b1ae3,
                ])),
                Felt::new(BigInteger384([
                    0x57f9bccc7391889b,
                    0xa6b0c5fea0f75bc4,
                    0x121d6b304ecc0229,
                    0x002615b30148c37d,
                    0xbbce9eccdfd9b00b,
                    0x00150ea499d4756f,
                ])),
                Felt::new(BigInteger384([
                    0x4be07be4c7ad5a17,
                    0x1714a291f70d8fcf,
                    0x0acde80225971145,
                    0x5477adc5392400e1,
                    0x25327faa520d6340,
                    0x01196f011a4b96ce,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x41a016bfb5dffd01,
                    0xe739b7969ee6a5f2,
                    0x5bd2a79640c8626f,
                    0x46d7f0006c35db1a,
                    0x8e75bab7df2b996c,
                    0x01402212b367c166,
                ])),
                Felt::new(BigInteger384([
                    0xc8826bd803921e81,
                    0xe8df37e6962de9de,
                    0xc25f886ac2331986,
                    0x114668f89a778a51,
                    0x2ddeb79b9fe3f2fa,
                    0x015637b6a66cf544,
                ])),
                Felt::new(BigInteger384([
                    0x721962d2ff3eba01,
                    0xe05f3b2be46a6b4d,
                    0x1130910d074edb10,
                    0xcd96e87186bcacb4,
                    0x6f5cfb5710a0b506,
                    0x0082674e9391006f,
                ])),
                Felt::new(BigInteger384([
                    0x5f47f299c1db73ab,
                    0x2ebd6f19120bdaaa,
                    0xbd5af2ba23e70c1f,
                    0x6dd236e982206115,
                    0xa57f1d8b10b6138b,
                    0x013148b5fc0411f0,
                ])),
                Felt::new(BigInteger384([
                    0xed83418c26666be2,
                    0xc2acf8d68e613c19,
                    0xebd757a87fd492e7,
                    0xd552ef9c93bce0c5,
                    0x4d4e2550cab8deea,
                    0x00f84ea928045d51,
                ])),
                Felt::new(BigInteger384([
                    0xabb466c4998d1f12,
                    0xc08f07bafe36514a,
                    0x222755a5ffc2b88c,
                    0xae4814d547e14be5,
                    0x48631090ffd2428a,
                    0x014dc3d0a0262efe,
                ])),
                Felt::new(BigInteger384([
                    0x7fb7e57d032883ac,
                    0x367a3511d813022e,
                    0x39d9dd691d32031e,
                    0xc436d0d67abf4c07,
                    0xcc168dc2795559a6,
                    0x012bafd7408eb740,
                ])),
                Felt::new(BigInteger384([
                    0x02cf9ba571783909,
                    0x76ee9e41c4f80f50,
                    0x57f06a82f4c8c53c,
                    0x773b88d2132ca238,
                    0xa5ada37458202982,
                    0x00925f5c5759a1b3,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x1e1ea3da71ada983,
                    0xfabb23bb1ea285bb,
                    0xc1140ee60dcbe0e8,
                    0x3c3df90cad394dee,
                    0x6dacf77e2b14e481,
                    0x0024f09a55db974c,
                ])),
                Felt::new(BigInteger384([
                    0xe15769643b9ba3cc,
                    0xa6206823407a50dd,
                    0x92803fd421175f86,
                    0xaa0114cf4370f603,
                    0x59e3d5f0df1c9062,
                    0x009b15230d9aedb6,
                ])),
                Felt::new(BigInteger384([
                    0x33000cfeb1bc5074,
                    0x600fbeb730a32175,
                    0x772c63463ff06c48,
                    0xe9f846315199db38,
                    0x016ccee6f23d1210,
                    0x001349369af29f11,
                ])),
                Felt::new(BigInteger384([
                    0x13f1cb8006affb42,
                    0x44256eff17a2febf,
                    0xcecd0b5c1cc33bf8,
                    0x25342a57fb860d79,
                    0xd7038d04acff9c65,
                    0x005d15452fe3cc2e,
                ])),
                Felt::new(BigInteger384([
                    0x1ded02f1ae6211d1,
                    0x04734d095620ed3f,
                    0x69a8f7a5b4915c93,
                    0xff612769a51c6c5a,
                    0x34a5ef1bacf2f848,
                    0x017e28d2722da25c,
                ])),
                Felt::new(BigInteger384([
                    0x146f437411b3ee23,
                    0x4b3a74b422b71ccc,
                    0x57d814ad079798eb,
                    0x2fccd9cfdb8e6797,
                    0x17cc7fe23d3f1b36,
                    0x00916331723020d2,
                ])),
                Felt::new(BigInteger384([
                    0xdbdc6f53884489eb,
                    0x27f628f738299a98,
                    0xc86e1061fd1cf796,
                    0x5930cdf38cdc9719,
                    0x42c1636c0aca40c2,
                    0x0000e83bd57c5a6b,
                ])),
                Felt::new(BigInteger384([
                    0xda23ed6d851e2ca5,
                    0xa221ed2ae534824a,
                    0xe69c629a888850a6,
                    0x5dcddf6448f1278c,
                    0x2726e2f80cfdf809,
                    0x0130de18b9ab4cfe,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x97b8547310201da5,
                    0x5910c2e0d6483359,
                    0x88c4ff31815d29a0,
                    0x760c1bff2abd9615,
                    0x6c8aeca59047156a,
                    0x0056fd14129e3410,
                ])),
                Felt::new(BigInteger384([
                    0x8baca9186e0b6474,
                    0x971eb05829750c8d,
                    0x6bfeaa8cf5615950,
                    0xcd41ebd0637cb078,
                    0xf6c879afb58d35d1,
                    0x017c9e4571d5cb36,
                ])),
                Felt::new(BigInteger384([
                    0xa1b787687ff0f7fd,
                    0xa1faad8473f47754,
                    0x6edd98fbd5eb2035,
                    0x4d452c375909c87b,
                    0xd1f850cfb208386a,
                    0x011be46313cf0c91,
                ])),
                Felt::new(BigInteger384([
                    0x9b0e48d47fb85870,
                    0x06c4d04dec71efe8,
                    0xcadccd6b90c7b3f2,
                    0xd3ec1289d7156002,
                    0xe93318e4fb894194,
                    0x00213b8996024c7a,
                ])),
                Felt::new(BigInteger384([
                    0x2258bf4890a9988f,
                    0x7ddc336cf1ec5841,
                    0xd4bb7193728b0ef8,
                    0xe83ba1228fc16bb5,
                    0x44e113aaf17e434f,
                    0x0159248db27d7240,
                ])),
                Felt::new(BigInteger384([
                    0x03b4fd16daa0ba29,
                    0x5a589cf4c1b45570,
                    0x145734b00a3db085,
                    0x0a4106356bb92529,
                    0x12545ed9b4d6f24a,
                    0x00c326cc8902155c,
                ])),
                Felt::new(BigInteger384([
                    0x517d0146e2dbbaec,
                    0x9be2d5148306aa06,
                    0x99d01989b253923f,
                    0xbc48b67c0bdd4a7e,
                    0x42b35cc91c4b0b43,
                    0x00c701402dcf2584,
                ])),
                Felt::new(BigInteger384([
                    0x94fb2b1b0f6afba4,
                    0x8d8d1c1a7449a95d,
                    0xe77d281a54558913,
                    0x4aeeb2cfcf901489,
                    0x8d00168e24ca7e27,
                    0x013bbdc4bd9fc3e6,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0xdcebbe0ed881ea6f,
                    0x6843a07e90f844af,
                    0x33c3620ee0f84cfb,
                    0xef8e7140ff18c19f,
                    0x2280852d059eee3e,
                    0x011930aa6a582e17,
                ])),
                Felt::new(BigInteger384([
                    0x266bcceae4db16d2,
                    0xaf8f8b1c6f58712b,
                    0xe9b0107fc56675ac,
                    0x158589eef23cc598,
                    0x4aa899dd98a5827a,
                    0x015c676c1ff36429,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xf1e82fb6a2943180,
                    0xf8350df18fbd1fe8,
                    0xa897699497c3b902,
                    0xbc1520b4ae42e80c,
                    0x02b101169953587f,
                    0x00db4cab62f8d290,
                ])),
                Felt::new(BigInteger384([
                    0x70694ffb2f55b22d,
                    0xb750bb702f0a6fee,
                    0x8e32614fb4609bf4,
                    0x11ef97c9fa20456b,
                    0x16fbd393042a63e3,
                    0x017a4f07428da09b,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x93583c075979460b,
                    0xfa452cea650fe70c,
                    0xbdcd7cf37cbbc798,
                    0x71bd8b775d087ef3,
                    0xd38bb9a6419a4b6f,
                    0x00430d824167661f,
                ])),
                Felt::new(BigInteger384([
                    0xe28d4f45f022d188,
                    0x5b1f2137fceb3d22,
                    0xe824da0a28e065c6,
                    0x4c390e90d138eaf0,
                    0xd5eb23590e361808,
                    0x01559c4a1495509e,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xa9d63863fe92cbbd,
                    0x6040fae04cf0b74d,
                    0x27395f32377699f6,
                    0xc69904451f4c5343,
                    0xc5184fe5cb63cfca,
                    0x015dd10ca10ab2c8,
                ])),
                Felt::new(BigInteger384([
                    0xcfbf6ac7d78ba4d2,
                    0xccd7d7316936f047,
                    0x3c239e8ce2228e35,
                    0xadb90ed3616bb606,
                    0x3a3117ab830002e5,
                    0x00585a4ce7e95fb7,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xa9c027e3521683a4,
                    0x553aaa3ba331604a,
                    0xba627d315b26ecd6,
                    0x47ce7c6133841d78,
                    0x619e4b8ac4854e84,
                    0x0053f66982a0aed4,
                ])),
                Felt::new(BigInteger384([
                    0xab633df623de9b6f,
                    0xfa16fadf07547011,
                    0x5c7fec1e56d1d1d3,
                    0x2ccfc3cf5ef02f0a,
                    0xb7d5989eea2b9570,
                    0x000d31b1fe181c29,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8ad6307aae8b18c8,
                    0x740bb26c1a790ae9,
                    0xc4f6c3ba67605948,
                    0xe1d8157a75dd6c85,
                    0xfdf8cb8f8ac6d505,
                    0x01053c1e25afd80d,
                ])),
                Felt::new(BigInteger384([
                    0xeb4effcc18be375c,
                    0x1ee51e3d7d898410,
                    0x0172d2d07855cb26,
                    0xe90c6af6584ae33e,
                    0x5edb6577741d49ea,
                    0x002909b6d19864da,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xb02dc5c52c75294a,
                    0x82b5c21eb09e39b6,
                    0x9e6f8ef7669ee1a1,
                    0x1dceea2b8d794eef,
                    0xf07d25c2dce4c72e,
                    0x015d1eda127d5448,
                ])),
                Felt::new(BigInteger384([
                    0xa8707cbb9b695543,
                    0x806bdd74f11938da,
                    0xa5c6d310de7a5528,
                    0x4a6062d3b4d67d44,
                    0x12e978896978a1eb,
                    0x00fd5262ce771bb7,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x782486b8297e0d45,
                    0xfb2624695fe599f5,
                    0xd90aa5a2c90258a0,
                    0x9e51c2ce45ea0c49,
                    0x2cdd0792445cd1cf,
                    0x006340d04d5273ae,
                ])),
                Felt::new(BigInteger384([
                    0x3e8e67109c23e926,
                    0xfbb4c9e98a67540d,
                    0xad94ed2976bd5274,
                    0x26743f9797ef802c,
                    0x9ecb5478c4c2ad23,
                    0x009e14f724fa8ab3,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x2cecb9457692dafd,
                    0xe4f2ab8cce540031,
                    0xf1e087f176765b95,
                    0x9baa6e7c2e2cddbd,
                    0x8dcf4ff6cd02a889,
                    0x0163c7cc54c4a68c,
                ])),
                Felt::new(BigInteger384([
                    0x297342023284b516,
                    0x9dcce45a0e747bce,
                    0x138169a21bd3582b,
                    0xe1117dc139f8bda8,
                    0x5f39a72dacadae0f,
                    0x00bf2afa50009f86,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x3f8d591926571acf,
                    0x9a5b80b0f279a805,
                    0x0f8ca914244cf0cd,
                    0x72d435e4653ba3c1,
                    0xc58972f046ceb361,
                    0x002d6c6bed7b98ca,
                ])),
                Felt::new(BigInteger384([
                    0xfcec15050560e6de,
                    0x761ef228936ebde2,
                    0x03778e5a5fb0236e,
                    0xa7973d641ad014ba,
                    0x7bea73a355d6e3a6,
                    0x00a8c507f867f2c9,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 4));
        }
    }
}
