//! Sponge trait implementation for Anemoi

#[cfg(not(feature = "std"))]
use alloc::vec::Vec;

use super::digest::AnemoiDigest;
use super::{apply_permutation, DIGEST_SIZE, NUM_COLUMNS, RATE_WIDTH, STATE_WIDTH};
use super::{Jive, Sponge};

use super::Felt;
use super::{One, Zero};

use ark_ff::FromBytes;

#[derive(Copy, Clone, Debug, Eq, PartialEq)]
/// An Anemoi hash instantiation
pub struct AnemoiHash {
    state: [Felt; STATE_WIDTH],
    idx: usize,
}

impl Default for AnemoiHash {
    fn default() -> Self {
        Self {
            state: [Felt::zero(); STATE_WIDTH],
            idx: 0,
        }
    }
}

impl Sponge<Felt> for AnemoiHash {
    type Digest = AnemoiDigest;

    fn hash(bytes: &[u8]) -> Self::Digest {
        // Compute the number of field elements required to represent this
        // sequence of bytes.
        let num_elements = if bytes.len() % 47 == 0 {
            bytes.len() / 47
        } else {
            bytes.len() / 47 + 1
        };

        let sigma = if num_elements % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        // Initialize the internal hash state to all zeroes.
        let mut state = [Felt::zero(); STATE_WIDTH];

        // Absorption phase

        // Break the string into 47-byte chunks, then convert each chunk into a field element,
        // and absorb the element into the rate portion of the state. The conversion is
        // guaranteed to succeed as we spare one last byte to ensure this can represent a valid
        // element encoding.
        let mut i = 0;
        let mut num_hashed = 0;
        let mut buf = [0u8; 48];
        for chunk in bytes.chunks(47) {
            if num_hashed + i < num_elements - 1 {
                buf[..47].copy_from_slice(chunk);
            } else {
                // If we are dealing with the last chunk, it may be smaller than 47 bytes long, so
                // we need to handle it slightly differently. We also append a byte set to 1 to the
                // end of the string if needed. This pads the string in such a way that adding
                // trailing zeros results in a different hash.
                let chunk_len = chunk.len();
                buf = [0u8; 48];
                buf[..chunk_len].copy_from_slice(chunk);
                // [Different to paper]: We pad the last chunk with 1 to prevent length extension attack.
                if chunk_len < 47 {
                    buf[chunk_len] = 1;
                }
            }

            // Convert the bytes into a field element and absorb it into the rate portion of the
            // state. An Anemoi permutation is applied to the internal state if all the the rate
            // registers have been filled with additional values. We then reset the insertion index.
            state[i] += Felt::read(&buf[..]).unwrap();
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
                num_hashed += RATE_WIDTH;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        // Finally, return the first DIGEST_SIZE elements of the state.
        AnemoiDigest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }

    fn hash_field(elems: &[Felt]) -> Self::Digest {
        // initialize state to all zeros
        let mut state = [Felt::zero(); STATE_WIDTH];

        let sigma = if elems.len() % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        let mut i = 0;
        for &element in elems.iter() {
            state[i] += element;
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        AnemoiDigest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }
}

impl Jive<Felt> for AnemoiHash {
    fn compress(elems: &[Felt]) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = [Felt::zero(); NUM_COLUMNS];
        for (i, r) in result.iter_mut().enumerate() {
            *r = elems[i] + elems[i + NUM_COLUMNS] + state[i] + state[i + NUM_COLUMNS];
        }

        result.to_vec()
    }

    fn compress_k(elems: &[Felt], k: usize) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);
        assert!(STATE_WIDTH % k == 0);
        // We can output as few as 2 elements while
        // maintaining the targeted security level.
        assert!(k <= NUM_COLUMNS);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = vec![Felt::zero(); STATE_WIDTH / k];
        let c = result.len();
        for (i, r) in result.iter_mut().enumerate() {
            for j in 0..k {
                *r += elems[i + c * j] + state[i + c * j];
            }
        }

        result
    }
}

#[cfg(test)]
mod tests {
    use super::super::BigInteger384;
    use super::*;

    #[test]
    fn test_anemoi_hash() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![Felt::new(BigInteger384([
                0x895ad2af250b136b,
                0x92d04594b7bfc4d0,
                0xeab54647f2a965ef,
                0x9287f332457867ea,
                0x790c09b72beae36d,
                0x00bb9ebb35d9ee03,
            ]))],
            vec![
                Felt::new(BigInteger384([
                    0xba55d1cea417ef85,
                    0x71ad88154996818e,
                    0xeaf4d9d0face4a01,
                    0x1f52d7ebc6f76175,
                    0xbcda24c37e7f120b,
                    0x019112731ca3957a,
                ])),
                Felt::new(BigInteger384([
                    0xa2c2b97ac564f7ee,
                    0x956db0bca0b28d58,
                    0x1f10053a149bc21d,
                    0xb9236a8e2c6b0093,
                    0x92d769bbf78e73a6,
                    0x00877844ca1868c3,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x0528b9e0be3d176a,
                    0x94c2b37d0bf351da,
                    0xda564b2763fc134b,
                    0xea7e36b1fd663413,
                    0xf31a71977ac0100e,
                    0x0128194eb090d7cc,
                ])),
                Felt::new(BigInteger384([
                    0x254d168ccdff83fd,
                    0xb236e30683fe11db,
                    0x857d5b02cc00f1de,
                    0xc81810136cb56ba8,
                    0x9c21f4eff9fc1bf7,
                    0x011634bb158d4277,
                ])),
                Felt::new(BigInteger384([
                    0xc7987d2b3f501268,
                    0x4a5c2d72f446b049,
                    0x744ba9187daff6ac,
                    0x6292171a23099775,
                    0x290b9c6a845e1dd7,
                    0x0040f2c273d45257,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xaa1faecf582f9c39,
                    0xa7214ca6245b7dac,
                    0xf8eabf87bcbdb30c,
                    0xacc97bf86f868557,
                    0x8c0b59975f115a0e,
                    0x00038663a88ba864,
                ])),
                Felt::new(BigInteger384([
                    0xf0f6caa746514078,
                    0x32de89f13de7a0c3,
                    0xe6dd1a5d7ac63cb5,
                    0x9ce666cecaf8ee25,
                    0x1f1bbf26ab542d25,
                    0x00c2477db18e3d71,
                ])),
                Felt::new(BigInteger384([
                    0x04d3a83ed35c73b5,
                    0x19803c0073cca72b,
                    0x75669d6492645c49,
                    0x4232316d7192fe52,
                    0x24f86566e1c73999,
                    0x005c83856b867ae5,
                ])),
                Felt::new(BigInteger384([
                    0x23cb99f76395552d,
                    0x475bc8fa2d8d540e,
                    0xf514de31e3478ee1,
                    0x2cd6bf554226fcc2,
                    0x927a882fa6e36b07,
                    0x009c9b7bd210d6bf,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x8f32a13016811cd9,
                    0x3a163e8c1f213202,
                    0xd7bf73a082ab6696,
                    0xacbc9a637ec8540a,
                    0xf836a28d4de16237,
                    0x00d04b72822dd6df,
                ])),
                Felt::new(BigInteger384([
                    0x8931160bf1107b2c,
                    0x324ff34ea40f8463,
                    0x12d289b0d1247a17,
                    0xc4cab1675822c41c,
                    0xcd8efe82d8f3468d,
                    0x014d4ac95630d95f,
                ])),
                Felt::new(BigInteger384([
                    0xc3c555a2cb84fb7a,
                    0x74d9856a5142fb5a,
                    0xe779e859f1a991a2,
                    0x825717c70c541b77,
                    0xa04bec5cf1cde892,
                    0x016942db1c51086e,
                ])),
                Felt::new(BigInteger384([
                    0x400aab15c4ab62ff,
                    0xfade4c07032c096e,
                    0x48100eef41152250,
                    0x9f36a916228e9200,
                    0xe902f853fbf63f1f,
                    0x015526dd62a65bed,
                ])),
                Felt::new(BigInteger384([
                    0xe08c3557db5f4921,
                    0x9f1798ae062fd5d1,
                    0x7491b8c1be7755c0,
                    0x76b6b987ca81b802,
                    0x2ee0a3aeb899a759,
                    0x0109de2eeadeefc0,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x05635ff2a18e20d3,
                    0x1cf21b183ea65fd4,
                    0x6b059144dafd58f4,
                    0xdd7ed0567a0fc312,
                    0xa0be76caac2f719b,
                    0x00455e7997a97939,
                ])),
                Felt::new(BigInteger384([
                    0x9439c164a17a2722,
                    0x1a38af4393065bec,
                    0x3cc16421465e635c,
                    0x754c96cc48ee4e54,
                    0xe6932ba872e0f647,
                    0x009129000176aec6,
                ])),
                Felt::new(BigInteger384([
                    0xf9bbd4bcf94e4bcb,
                    0x2119517c682d8f06,
                    0x5475137b49340358,
                    0x4993c25ccd083dae,
                    0x8b4e7256d042df44,
                    0x0087091ef9255fa2,
                ])),
                Felt::new(BigInteger384([
                    0xe63f3f48a3c9c094,
                    0x5b68694741dadbe5,
                    0xc867b40af0fec449,
                    0xa20b5804da6881d2,
                    0x5b22fce4504343d1,
                    0x0158e4a102c8dd64,
                ])),
                Felt::new(BigInteger384([
                    0xccb9ca3398d5a802,
                    0xc626c27ca64cec09,
                    0x27b98b2cd7f4402c,
                    0x8bf50d958d0c906f,
                    0x5f6d45c541f27f73,
                    0x00afa804fc97e4fe,
                ])),
                Felt::new(BigInteger384([
                    0x17fb8ebd383c4358,
                    0x2034011087896af1,
                    0xab7e1e3404078b33,
                    0xbe80b493299dfb91,
                    0xf992b028014b40ec,
                    0x010e9e41f64c4392,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0x639a70f279fc2a4a,
                    0x54ecaa7ea4624b7d,
                    0x71b23287dd2ad70b,
                    0x6ecce4b4a77fedf0,
                    0x06d6b359087acb5a,
                    0x00ad4c543cedd4dd,
                ])),
                Felt::new(BigInteger384([
                    0xb8623adb494e2b35,
                    0x2f8fcb24deffc9e6,
                    0xbb4d5332aee4dc44,
                    0x34ab82a0b92ef16b,
                    0xdec6eeb905ab6f92,
                    0x008c18b6b67ed64e,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x3e2f083fd2cd6773,
                    0x17e7de7f3c2d4840,
                    0xefa566a8df6e64d1,
                    0x726c898e592b9b05,
                    0x1194d6816c1041e9,
                    0x008820202ca076c4,
                ])),
                Felt::new(BigInteger384([
                    0x4bba99207742217d,
                    0x5e2f6cd290ad103f,
                    0x8d8bb07c0b0da827,
                    0xbbcfe4cfd3a17f19,
                    0x9aafd8c8b1660f14,
                    0x008ccfd3c82d5f79,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xdece6de5b7742159,
                    0xb119ecdc998b7a58,
                    0x2580e6ecb634613e,
                    0xe3309c96e1efaa87,
                    0x1f1aba7ab8c7bbea,
                    0x01a18f71aad0cb7b,
                ])),
                Felt::new(BigInteger384([
                    0xf6848899d666814b,
                    0xc44de01f4d3c4e2c,
                    0x440edb729bdfbc49,
                    0xc4c9e8ecab44268e,
                    0x327b6848205ccbf6,
                    0x005cda6209a8eaa1,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xf6ad69d6d67ee729,
                    0x7eeaeb28ec5ea6f2,
                    0x4dc940dce5ee4e1a,
                    0xb5c89effd4bb5c0b,
                    0x44ac6a6d43f55f26,
                    0x008dc671f6fe5633,
                ])),
                Felt::new(BigInteger384([
                    0xf1c6375251a00883,
                    0x176938bacb334e1a,
                    0xb872dbad4a805d64,
                    0xcbd04ce66f0560a0,
                    0x0a022015e6ccdb3e,
                    0x015d0659bb98bc90,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x6c3321da40e844d9,
                    0x779bfc975981be7c,
                    0x897da4dad3947068,
                    0xbcf4432505af7823,
                    0x617ba314ca19b153,
                    0x003a5d8e1428ff2c,
                ])),
                Felt::new(BigInteger384([
                    0x84f3bf985d2faaa8,
                    0xa55a398951387acb,
                    0xd2690a688b6e0cf7,
                    0x9355d3a3611fb122,
                    0x8b51322a66aeadbd,
                    0x0032a8bd3e901577,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x5c7d1db4e6ed56b2,
                    0x151ef93ecbbfca26,
                    0x9ac6619d19e625c6,
                    0x5fcb01fa27da5961,
                    0x36006ad2ddc9d808,
                    0x00896b1d096317d9,
                ])),
                Felt::new(BigInteger384([
                    0xc2e071dc9b446391,
                    0xb3a30c20266a484a,
                    0x57a95aa64a1c589a,
                    0x634b00ff27456f52,
                    0xace6afee117ebdb3,
                    0x01123e1a59dce5e9,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x5e16f096558e197b,
                    0x69aeaca5ae830dc7,
                    0xf47db52e6bd7bfff,
                    0xa571b9966ed40b2c,
                    0xe62410d0ec555eca,
                    0x0158f3386fbc5c0b,
                ])),
                Felt::new(BigInteger384([
                    0x51476bb75341e007,
                    0x2510fea2eb82d630,
                    0x2fd14f9ce558fd7f,
                    0xef5546452ecd6fa1,
                    0xb2a2dab0b58aec20,
                    0x016bfdc7c2b9d86b,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xc17df8cc8ac7c4b3,
                    0x531565f1cb3202aa,
                    0x0ef76826b29ede96,
                    0x16a6d581bb72d00d,
                    0x99dcfbb823c30913,
                    0x007bf39ccf98e719,
                ])),
                Felt::new(BigInteger384([
                    0x5d35b6251dac80b6,
                    0x6a3e3b6b278c12b7,
                    0xf74a924f7da7d2c0,
                    0x0113d65f5a947dd0,
                    0x12c50ff177035a39,
                    0x0155934affa4ad94,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xd8327b528fa7e4c5,
                    0xb5ea760ba423e9de,
                    0x196fe7beaf0afe8c,
                    0x152f448dbffc57eb,
                    0x51c530cdeff443f6,
                    0x0128f03dde53f8f5,
                ])),
                Felt::new(BigInteger384([
                    0xff42416030770e97,
                    0x5ddafe12ef20784a,
                    0x3886cf57dd8b7c90,
                    0x850768b8ab967d1e,
                    0xb0bf1387b63f63a6,
                    0x012943668a01b5b9,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe921e2ad59c85685,
                    0x0171f835cd8848c6,
                    0x2cd29f2e99bca3f4,
                    0xcad0478c427417b6,
                    0xc135becbb452f8d6,
                    0x00cf8f878808c216,
                ])),
                Felt::new(BigInteger384([
                    0x5c85f3bddb4393c3,
                    0x20a2c370a1a93fc5,
                    0x806c4dff61667f9a,
                    0x08a5fe514592da70,
                    0xba85e1e6fcb0e61c,
                    0x0167c226e7e62e14,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected, AnemoiHash::hash_field(input).to_elements());
        }
    }

    #[test]
    fn test_anemoi_jive() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![Felt::zero(); 8],
            vec![Felt::one(); 8],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xfe94344b968c660f,
                    0xd7d14bf98b0e9a8a,
                    0xd16c1ca6fb9646b1,
                    0x10deff8f6e016f92,
                    0x7d17263326c8c687,
                    0x00d9720714ee1c5b,
                ])),
                Felt::new(BigInteger384([
                    0xc8fa2b6ea961464c,
                    0xf61d3e00061e23b7,
                    0x26001c078503e214,
                    0x0d0c6edb9a194ebf,
                    0xf5006397cd5cbf98,
                    0x015d9d196834d31d,
                ])),
                Felt::new(BigInteger384([
                    0x383c043111fc31c4,
                    0x39e3dd2d1fb77422,
                    0x97b2dad37cb9707e,
                    0xf54fa59cebbce9c7,
                    0xc76c0c0b1bcecb4a,
                    0x00c9c271c531bfbf,
                ])),
                Felt::new(BigInteger384([
                    0x13ce814272b39ada,
                    0xf6ed7f356419722b,
                    0x14d7ba9c021839a1,
                    0x1815812378cbf174,
                    0xf210d460ead5c457,
                    0x00ba367de4471031,
                ])),
                Felt::new(BigInteger384([
                    0x37273ab6170725f4,
                    0xbf545a995226bf68,
                    0x265bdc215ed3eb4f,
                    0x24bcdcd5b072a4a0,
                    0x8b8787fa96e3758a,
                    0x00a0d8781ad9a48b,
                ])),
                Felt::new(BigInteger384([
                    0x83be806ab335e826,
                    0xf43f64e525f7d531,
                    0x9945fad7f59cb5f5,
                    0x7baab34ec160ab82,
                    0x8866587eba10dc1a,
                    0x0094eb7fc17e0deb,
                ])),
                Felt::new(BigInteger384([
                    0x3590ec2ae4d4a608,
                    0xf5ce2e68bf431d3b,
                    0x19c22dcb4e1d6554,
                    0xff761d02a25fd50e,
                    0x5884364c09dff55e,
                    0x005a8efaa6037cc4,
                ])),
                Felt::new(BigInteger384([
                    0x7dce82cb39f7379d,
                    0x753fbd1d26c7b03a,
                    0x16803b108902198f,
                    0xe81044b06572544a,
                    0xdb5b30023b97ea19,
                    0x014c85e8701f6030,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xce134d42bea0a90f,
                    0x52529ee8aa5fd0d5,
                    0xf4a917254d20cf85,
                    0xdc72aa1e0c610780,
                    0x9f6afd2ae1546915,
                    0x0070f2d326607735,
                ])),
                Felt::new(BigInteger384([
                    0x56bb76277f9292e5,
                    0x9dca3f336c9d81a5,
                    0xa22ebb60543d5ae9,
                    0x7eb851756176e9be,
                    0x18ffb1be2c2bc233,
                    0x017855197c6a8852,
                ])),
                Felt::new(BigInteger384([
                    0x9992284cf6050d38,
                    0x5cc6a4c3f1872a92,
                    0x2f8ad8f6b72d0c46,
                    0x23abc59c579019b2,
                    0x31d2d555c66eb3c4,
                    0x014e06d4ba951afd,
                ])),
                Felt::new(BigInteger384([
                    0x6faec5d9bcab68bb,
                    0x211e4eba8a4602b8,
                    0x48887376274cc265,
                    0x29f17bef4f946568,
                    0x5e7aef666aab01ca,
                    0x015967fd41eb028a,
                ])),
                Felt::new(BigInteger384([
                    0xc2336704520c5218,
                    0x6639a0a79b4196aa,
                    0x784349c22d4d0923,
                    0xad25e30f5195d776,
                    0xb9bc9954cdf42076,
                    0x01720c5dee65e080,
                ])),
                Felt::new(BigInteger384([
                    0x5f71400807fffc3a,
                    0xbffc85ec89d0033a,
                    0x25e2e555016b9030,
                    0x9e72086c738f528d,
                    0x3114a8f6cb4dbdad,
                    0x0170d01ad30a7127,
                ])),
                Felt::new(BigInteger384([
                    0xc32cef62ef315e14,
                    0x320ef3e5a55ec101,
                    0xff30a3a64c7f8671,
                    0x1360f991b616d3c3,
                    0x04838c2279044f37,
                    0x017867ca4edcd5fa,
                ])),
                Felt::new(BigInteger384([
                    0x3eeaac2b71810059,
                    0x712a01b63182e652,
                    0xcd64c7f3596c1099,
                    0x4eeb9970a4e45533,
                    0xa4f067fcc1401cd9,
                    0x00d2febf8f0b4750,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x8246c6ff0483d392,
                    0xf8cfce5199e563d3,
                    0x765a31ad1199a3ec,
                    0x4b11aceba2fb1ac5,
                    0x16010669bd72db81,
                    0x00555bc5e45d2259,
                ])),
                Felt::new(BigInteger384([
                    0x4f27ab3af1d848b4,
                    0x13a416098ae27bb3,
                    0x15985ff8679f6096,
                    0x48c778e64f9253be,
                    0xc065b285b8542d81,
                    0x00be0305cce6b5e2,
                ])),
                Felt::new(BigInteger384([
                    0xcaafa7c82fcc9290,
                    0xa054db3d1729d316,
                    0x53036c84eda5f4bd,
                    0x30f3d68ecf372dd3,
                    0x8048b16a26e2bcc6,
                    0x00ab6f4610f6790f,
                ])),
                Felt::new(BigInteger384([
                    0x6cb4f1d2809313f8,
                    0xa8c3d508a58dd8ae,
                    0x17157d03fd1e7ed3,
                    0xf0425d7d4536d82e,
                    0xd0e71bdb84606806,
                    0x00677c994dd196e4,
                ])),
                Felt::new(BigInteger384([
                    0x1646f9d5096a32cb,
                    0x07e74809f268af97,
                    0xe834e12cc797f97c,
                    0x0a8a7d5c6e922543,
                    0x28f9f33bd3689bb0,
                    0x016b3020d14d8d23,
                ])),
                Felt::new(BigInteger384([
                    0x314a4c9733b854e5,
                    0xa6ca6b1ae1c77adb,
                    0x4d5fade06855469f,
                    0x18d79b5ca8eaae57,
                    0xf6cf06b15581a737,
                    0x00d25ad88795c57d,
                ])),
                Felt::new(BigInteger384([
                    0x7c1c526399fd7b0a,
                    0x8c34fcf97a16c97a,
                    0xf7ae1fbbfd9ee47f,
                    0x526069de3191b482,
                    0x5d8158b8c6828921,
                    0x0090912a5de77a8c,
                ])),
                Felt::new(BigInteger384([
                    0xdaee593ff4488993,
                    0x9ca2483f3c3efa4f,
                    0x917537479c4cce56,
                    0x1f1294c69feae452,
                    0xe0bee6b3ff8363f2,
                    0x019a8eb27724c36a,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xb14f0eb397c22fdc,
                    0x874f994e48590316,
                    0x3bd5f5d6f5fe2f26,
                    0x73db46ca79b5d985,
                    0xa828b664cc403f46,
                    0x01ab9c88c3c93d6e,
                ])),
                Felt::new(BigInteger384([
                    0x18fe1dd7b45470d1,
                    0x7368402fd6224acb,
                    0xd10b94cdacb38071,
                    0x34f77614003e9c58,
                    0x17001422a67833a8,
                    0x017543110806c1fc,
                ])),
                Felt::new(BigInteger384([
                    0x5c27ed06e87e03a8,
                    0xe8562fd41dc3748c,
                    0xd16fe1acdef29be3,
                    0x3f5f5c1a74ac24f1,
                    0x8967b1e624d2a500,
                    0x00d2e2e19612b478,
                ])),
                Felt::new(BigInteger384([
                    0x552fab8a99271bc6,
                    0x0221ca439eec95d3,
                    0xb6b3a5f164f8773b,
                    0x35268738b36ba9a7,
                    0x20df02f138eafda4,
                    0x013f294871fa7e38,
                ])),
                Felt::new(BigInteger384([
                    0xd396df771d9d7d2c,
                    0x998e6822c2065fee,
                    0x19d1066ecfe27f06,
                    0xca520170c5db05b4,
                    0xaf35a0be643bf7f8,
                    0x003c0a67be19ec93,
                ])),
                Felt::new(BigInteger384([
                    0xcac04ad7579fac38,
                    0x7f2dff6ce22669c1,
                    0xbfd52725a66111c9,
                    0x5b7dc4976087e186,
                    0x1f7b355f1a853f9a,
                    0x00b2f1d989258b58,
                ])),
                Felt::new(BigInteger384([
                    0x0e6737fcb211618f,
                    0x808388ba05f7e34e,
                    0x4a683df768542e8b,
                    0x53977a1554d994d6,
                    0xb3d03afc6a40f31b,
                    0x00c3026f72434d50,
                ])),
                Felt::new(BigInteger384([
                    0xd83f46a4d0185051,
                    0xe538794f693db79f,
                    0x1590f3e7800a26f5,
                    0x1520d320fc65f6b6,
                    0x8c0d7bfb4768fe63,
                    0x0032be8bc718e4d4,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x9ee62cd5235e9b57,
                    0xa92563312108aec5,
                    0x3d0162cedfbd8c8f,
                    0x0a1dad2c50fa1ae2,
                    0x099e3e200eaccc6a,
                    0x00415fd8d825099b,
                ])),
                Felt::new(BigInteger384([
                    0xe3290bd80979173d,
                    0xed6aa73f1ac5f52a,
                    0x304685508e6cbd74,
                    0xe4c988e1077d6b93,
                    0x0c2cf9756ab6af7a,
                    0x016a456c8d085b20,
                ])),
                Felt::new(BigInteger384([
                    0x21200d54566556f2,
                    0x5c057a48867337e8,
                    0x8df096bc57cb551d,
                    0x4b65886554c955ed,
                    0x8cd3813c7645bd60,
                    0x00d7a97b3430b90f,
                ])),
                Felt::new(BigInteger384([
                    0xf1b4e6080596bc97,
                    0x160f5afdf7e8d289,
                    0xc944604e56faa3a0,
                    0xe2d77cf16605b91d,
                    0xe685940df9bffea6,
                    0x00c2e45b03ee3637,
                ])),
                Felt::new(BigInteger384([
                    0x15cc528e9b293915,
                    0x8cd36637504829fd,
                    0x974c0a3833c39593,
                    0x2f74e50ee7dde043,
                    0xa7563988c9fef459,
                    0x01461022781078d8,
                ])),
                Felt::new(BigInteger384([
                    0x16d0655edc62701f,
                    0x025c87edb936350d,
                    0x8f4550092ea4bc2e,
                    0x9f1b94b6b761e2ae,
                    0x5aa32992ab0828f6,
                    0x011fd5b9850fe2bc,
                ])),
                Felt::new(BigInteger384([
                    0x3291c265d153f09e,
                    0x1d2fa74aecb9b301,
                    0x07864d9d2829e2d6,
                    0x4059353f31fd6c99,
                    0x7c561123b2829da2,
                    0x0156c7526bd077d2,
                ])),
                Felt::new(BigInteger384([
                    0x6da2a97d12068627,
                    0x0a804e788289e138,
                    0x64f392c83a4251cc,
                    0x8b7697a6fef1fc86,
                    0x5d1b485a5d49367e,
                    0x007f2cb788328bff,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xaaab43be100f8b1a,
                    0x17bbaf3198aa6afa,
                    0x5a9331898e3f7feb,
                    0x33444001fdbca163,
                    0x97568c4c31e05fd5,
                    0x007d5a2a7df51fba,
                ])),
                Felt::new(BigInteger384([
                    0x6901d7e10c90c39e,
                    0x3a59e0ed65881917,
                    0xb76db97015319562,
                    0x585b340b2d5f8ed5,
                    0x054f4220b1ccac77,
                    0x011beaa27d0d0abf,
                ])),
                Felt::new(BigInteger384([
                    0x4d653730f9020ca4,
                    0xe7e4be47c8d63ece,
                    0x7a6a275ce7993d82,
                    0xc855b0bc4b86e63e,
                    0x757a1ba3675c1ce8,
                    0x017035bfece6dca7,
                ])),
                Felt::new(BigInteger384([
                    0xb9bb14085984951a,
                    0xcd2ff76d4a4ecc19,
                    0xe5ba44eb08372e3d,
                    0xd73460d06bf099f8,
                    0x7263e3dfb055d719,
                    0x01506475f9930637,
                ])),
                Felt::new(BigInteger384([
                    0xd37e27f122147121,
                    0xd85c5759d5cac942,
                    0x5d9a589e8a444647,
                    0xded3222fabb2fe48,
                    0x96dac3dd660ec11a,
                    0x0128337dcc32aec4,
                ])),
                Felt::new(BigInteger384([
                    0x6b4a695ba5b038c2,
                    0xa521c4348201a36d,
                    0xe39126243ef744a4,
                    0xb15849d2b72d58eb,
                    0xbb4b9124375b1c5a,
                    0x017666be828350ea,
                ])),
                Felt::new(BigInteger384([
                    0x9556db06f15bd386,
                    0x5947249d688f06aa,
                    0x52776537f7cf83c4,
                    0x605490d703ca783f,
                    0x4d26af302e70ed22,
                    0x0077365191463426,
                ])),
                Felt::new(BigInteger384([
                    0x606cded52e40bc90,
                    0x0bec1beec773048f,
                    0xc7008bf516784aa9,
                    0xb6a37e00017f33e3,
                    0x4ca513ef55f538f8,
                    0x01116eb546257b4e,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0x80956005a9899b7e,
                    0xe0e76a0cd7c753d3,
                    0x319523a2266018f6,
                    0x11c0a746c4efad32,
                    0xe7add94dfe11f203,
                    0x0085e8292a1cdec1,
                ])),
                Felt::new(BigInteger384([
                    0x13970cb9946ca12a,
                    0x4a4609c050d36f1b,
                    0xd99a0551278f7f36,
                    0x3a6124190ca2d184,
                    0xc3b34813894d70fe,
                    0x00ab659d3417a25a,
                ])),
                Felt::new(BigInteger384([
                    0x19fc4c27e289a0dc,
                    0xe6b1d3da3f44b7e4,
                    0xac6891c78f46d913,
                    0x2ea958a2b9611416,
                    0x55e764fbb17599d8,
                    0x001921c212e46bbf,
                ])),
                Felt::new(BigInteger384([
                    0x140baaa9b036e4bb,
                    0x8a0ace5281f5a753,
                    0xa257991f0acc4f59,
                    0x928e221f791d61e3,
                    0xbadb09ad743683d0,
                    0x01aa1a895390b45f,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe3ad11ec80e01f22,
                    0x561a4a362bacc6d2,
                    0xe7eb4bdf344a1a9d,
                    0x909d23ba34e1a351,
                    0x7571e2ebfe623129,
                    0x0070c9773424843a,
                ])),
                Felt::new(BigInteger384([
                    0x19f4af609aca7bb5,
                    0x247bb419def40a11,
                    0x98529e02c460f0a9,
                    0x10457e9905b2e472,
                    0xe426514a57a40b55,
                    0x000895c7c9c6bcee,
                ])),
                Felt::new(BigInteger384([
                    0x6058d22d7efd0a21,
                    0x8c00d9fdf76fc345,
                    0x93003e5f602a9b64,
                    0xef94e5ff509445ac,
                    0xebcab6abe375b936,
                    0x006e66d5e6c49333,
                ])),
                Felt::new(BigInteger384([
                    0x5ba1df8b23546bbc,
                    0xa2dd301fe36c5217,
                    0xb0005aa0382fff94,
                    0x8e7ba338b6144881,
                    0xb0222641f769c16b,
                    0x0014dddde8ca0e69,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xcfd59cfcddd17db6,
                    0xc91f24c1881f4a31,
                    0xb19bc529a09750db,
                    0xbe49dfc41a538642,
                    0x78ecddd1ab8e126f,
                    0x0125b61b5fd4fa86,
                ])),
                Felt::new(BigInteger384([
                    0x66baa914bff92cf1,
                    0xea3ec0c7c37ec170,
                    0x2e14c546f4bc0820,
                    0xb2d5d9e1c49a9513,
                    0x886d9d77ac7e6564,
                    0x00db4d7575132ddb,
                ])),
                Felt::new(BigInteger384([
                    0xa1ca20eb4325ff17,
                    0x3cb6916f15eb7e2f,
                    0xe7235779dda079b5,
                    0xbd9be817fb7504b1,
                    0xa4300d2873f19de6,
                    0x00bfa8c94a96f40d,
                ])),
                Felt::new(BigInteger384([
                    0xc8f9906792775004,
                    0xde70d93479f5d655,
                    0xbff16b850d7f4a3f,
                    0xdcefdddf4a1ae4c9,
                    0x431d8a5924991334,
                    0x00ee0c0026f3c6fc,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x7ff387a4750b33dc,
                    0xd28789468e2488c0,
                    0x314ccb122ebbea47,
                    0xc8982efaa50d144a,
                    0x5964f87cdf2758bd,
                    0x003d2b6372088b5e,
                ])),
                Felt::new(BigInteger384([
                    0xac3e860ec68ae4c9,
                    0x6a9adbc704ec4be1,
                    0x222e50200d900571,
                    0x31dbcd4f51ed9a10,
                    0x7c97675dbad617fa,
                    0x01947fb838ea2d0f,
                ])),
                Felt::new(BigInteger384([
                    0xc2613c3db2d5f94f,
                    0x95490e0f87835434,
                    0x9385896d091b6afc,
                    0x3794a9f9c67bc619,
                    0x395fa0ab8c516df9,
                    0x00fc29dd21b25ade,
                ])),
                Felt::new(BigInteger384([
                    0xb86fdf4c78b706e6,
                    0xfa00a72d6cc236ed,
                    0x12c004ee2fb60a09,
                    0x44cdfd4fefeeb940,
                    0xd946fb87ec670547,
                    0x015246487d5ac0b5,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xfd354c5c94c96538,
                    0x77f9171e8e4f9851,
                    0x7c10f804a52c06a5,
                    0x57c9b4498048b2ba,
                    0xde18ae93b0325e0e,
                    0x005bd272426396a4,
                ])),
                Felt::new(BigInteger384([
                    0xfcd1a326825cc98a,
                    0x8b35c409ebe322f0,
                    0x92ae075235120f42,
                    0xcb8ef56fba233ddb,
                    0x8c8eb71557317c9d,
                    0x005f4c3e8c8a91f4,
                ])),
                Felt::new(BigInteger384([
                    0xef9c7045d0c31da4,
                    0xe4f558d84951a73a,
                    0x295ecdf951ff4c92,
                    0x54a7e4fce3552f8c,
                    0xa317401ba2d42f35,
                    0x0094564a7847fce9,
                ])),
                Felt::new(BigInteger384([
                    0x734c633f6f53464f,
                    0x89401cffa7a06746,
                    0xa9b540dc0fc81c1d,
                    0x62412b0247282408,
                    0x5bd59028411a72c3,
                    0x00eb58e459fae5e2,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x56651b5d5388b67e,
                    0x19e999d13227c12c,
                    0xf559785c76ce0a73,
                    0x58d1a41220c2500b,
                    0xbc55ce88409f0d0a,
                    0x019028928650d0c9,
                ])),
                Felt::new(BigInteger384([
                    0xb98bcc70890ce3e9,
                    0xf51129904ff55804,
                    0x240e8a6419dd7028,
                    0x2d0fd11b3c5396b1,
                    0xed367a5ddbc4277a,
                    0x00c41882f4c4fe7b,
                ])),
                Felt::new(BigInteger384([
                    0xa7566d45b156a417,
                    0xad019a2e3d38c792,
                    0x8e01cb2a66901b97,
                    0xf3e7f3e0f68917ba,
                    0x1052f31f2c89fc24,
                    0x0069268fb1d28faf,
                ])),
                Felt::new(BigInteger384([
                    0x3bbed51d6fb684ae,
                    0x43382f35c2975187,
                    0x53a41c5680680c1e,
                    0x2b10ede44f318040,
                    0x0acb34daf3907ed1,
                    0x016b5c81231ad536,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x2199fb9de46ecfd4,
                    0xf7647ed66df6df1d,
                    0xfbf526e2bc01b35d,
                    0xfd3da51f5377c25f,
                    0x7341073216d5ffa8,
                    0x00180c66796d4eae,
                ])),
                Felt::new(BigInteger384([
                    0x690df9771976a02a,
                    0x4263d281eb152875,
                    0xe84d40a73814fb3f,
                    0xbcdde0aee500dd6f,
                    0xa90d66031c3a8206,
                    0x00b0483ac02ce414,
                ])),
                Felt::new(BigInteger384([
                    0xe9c525a0c17dee0f,
                    0x75beafb20ac4166d,
                    0x651afd5054245284,
                    0xfe7afecd2584b3f8,
                    0x629bddad094f92ec,
                    0x01a719339444cc18,
                ])),
                Felt::new(BigInteger384([
                    0xd49c42a523e6eb2d,
                    0x84b061110173d9ba,
                    0xc655678bff952073,
                    0xabaae9495f961a01,
                    0x99aeb71607432f2f,
                    0x0197fc062afe6fc1,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xb70e713d80467ba4,
                    0xbe9080896109c0f8,
                    0x93896f1cac2a51f0,
                    0xa803ebafddf46639,
                    0x678f93b85b24895a,
                    0x0191270978844813,
                ])),
                Felt::new(BigInteger384([
                    0x6c2262eb118564ac,
                    0x28e57bd66f0b569e,
                    0x4793b4dd5c6f4f6a,
                    0x6607ec80b01810d3,
                    0x90675339249479b6,
                    0x00033c969289af8b,
                ])),
                Felt::new(BigInteger384([
                    0x41ec311d189c2515,
                    0xea867000cd770c92,
                    0x03a782acacb80856,
                    0x0b8bf2e124d3db86,
                    0x6dc6da7b1381cf7a,
                    0x00e223e874c05aa0,
                ])),
                Felt::new(BigInteger384([
                    0xcee9ab0ce5f8b8c9,
                    0xd802297f59a98284,
                    0x22516d1e25fb77b7,
                    0x114f3f1ca3041802,
                    0x2a499f00bd324728,
                    0x0079896f8b7caf02,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x040f9eb396483db8,
                    0x42fc97ecc2e557bf,
                    0x8efc8c9b7500b970,
                    0x99a61940764caa12,
                    0xc693744e584a53fd,
                    0x003d87049f1d1f17,
                ])),
                Felt::new(BigInteger384([
                    0xb66bba6b6c319a9b,
                    0x2ad8923d4c2ed4cd,
                    0xae1f04cc5e3f6a77,
                    0xdebe22d6025bf3a7,
                    0x0acd35859a777450,
                    0x00df33587cd377d7,
                ])),
                Felt::new(BigInteger384([
                    0x395e914e50558100,
                    0x07189d204c35a594,
                    0xe8f9fb8e8a4ce2f3,
                    0xbf8d74884edff2d1,
                    0x18e5fede24875240,
                    0x013120fc45baaebf,
                ])),
                Felt::new(BigInteger384([
                    0x426fde5977778b31,
                    0xf0a792b897184046,
                    0x27e4eb04d8000601,
                    0x92074cb24b08eca5,
                    0x56a925ea5dfde93b,
                    0x011e788ecb35449e,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x25fc265be2f987dc,
                    0x210e8f7853d08cdb,
                    0xbcdfb037bd1cd3e0,
                    0x773964b8a2a35106,
                    0x852e644902a18925,
                    0x005299188ef0e7c2,
                ])),
                Felt::new(BigInteger384([
                    0x277ca61cbf05f8a4,
                    0xd0f8b0a538e55e28,
                    0x5a663ea07b9d1dd5,
                    0x26ceed73ccbc2143,
                    0xceaf1b75db42daf9,
                    0x00fbd8f3fbfd5efc,
                ])),
                Felt::new(BigInteger384([
                    0xc9d0496e43ab91d0,
                    0x0ddf231eb884ae24,
                    0x7cad04d9d43ce6e6,
                    0xdef8658590309e4e,
                    0x7c37ab85e1d0853e,
                    0x008d9cecda91d0fc,
                ])),
                Felt::new(BigInteger384([
                    0x6bc202707b2988fe,
                    0xc41eeb148a937981,
                    0xd737fed210461085,
                    0xd48fa88576a37e65,
                    0xe86e85b93b353c2e,
                    0x00e893df3ffedae8,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress(input));
        }

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 2));
        }

        let input_data = [
            vec![Felt::zero(); 8],
            vec![Felt::one(); 8],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xca741e2a4a8c4da5,
                    0x09b0ab57dba8a539,
                    0x3af6eb7530575da6,
                    0x830986b8c60504eb,
                    0x3c6b3c7f11c7b23d,
                    0x00d7aa992a4a9e58,
                ])),
                Felt::new(BigInteger384([
                    0x67d8bc82bcfb4b5c,
                    0xfcabda32571a36c4,
                    0xf6b128e1ba6426cb,
                    0x58b4610c651518d5,
                    0x5bf976f920b2efcf,
                    0x008af690feed17ce,
                ])),
                Felt::new(BigInteger384([
                    0xd4f741af6fe70982,
                    0xee580a97c8eb74c3,
                    0x4da63f3c9296d889,
                    0x32a23f85b570c2a4,
                    0xcd5e9e55d404640a,
                    0x00376748703e2fec,
                ])),
                Felt::new(BigInteger384([
                    0xd93f43a7989a5876,
                    0xf97e4b806e95d20c,
                    0x7fe2f5bafbb11bd0,
                    0xaec5c748ded6661e,
                    0x0b29d71df91ad06a,
                    0x00c5714575865e8b,
                ])),
                Felt::new(BigInteger384([
                    0x594c5bbf75ee1705,
                    0x58b3bd7e46720324,
                    0x8e30549669268a34,
                    0xf061bc4421477768,
                    0xb757c6180a58825f,
                    0x005ed082a36450fb,
                ])),
                Felt::new(BigInteger384([
                    0xdbd0f345524a3392,
                    0x1525fa119eaefa6d,
                    0xe460a78a44362c04,
                    0x39b937131ebfe023,
                    0xcf7c68707c81c1f8,
                    0x0034cee03045b801,
                ])),
                Felt::new(BigInteger384([
                    0x8cc77c8e31d5b381,
                    0x08fb5a516d680387,
                    0xe96d9f03d31b33eb,
                    0xb69dee4dc2ff0359,
                    0x39e43928069b0e09,
                    0x0009f114daa65dd9,
                ])),
                Felt::new(BigInteger384([
                    0x0af47133b0b98bdc,
                    0x262bfcf0d2149887,
                    0x000743dd820ef5b3,
                    0x867c177d2a2d7353,
                    0x786dd17ea2a6746b,
                    0x002a16bfaf245c43,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xa1e475fd55d5c8c7,
                    0x9286e593fd6bfe34,
                    0x55d4bb7ebcf97e4c,
                    0xf2cdf7c30a7bc606,
                    0xcbd188f227ff6105,
                    0x00adfa9a51242f89,
                ])),
                Felt::new(BigInteger384([
                    0x99925b7456567433,
                    0x2bd83d04f08a9c58,
                    0xc5f87ecb4b3b54a4,
                    0x154441aac8610c9b,
                    0xe5e8530789bbe685,
                    0x001b075f71cda2ea,
                ])),
                Felt::new(BigInteger384([
                    0x2466b2592fd7069c,
                    0x95a9a1734fa85b06,
                    0x7253fc5ffcf3ba51,
                    0xb6c96934c59b0add,
                    0xd3e3c1e3cfb6dcdc,
                    0x0015d47c3d2916e7,
                ])),
                Felt::new(BigInteger384([
                    0x18c2e6a0f491fc10,
                    0xf55c184e30dfd254,
                    0x5983136e331ffeae,
                    0xc747537b713cc902,
                    0x4380c118819e512a,
                    0x01a8e49b591fa5fc,
                ])),
                Felt::new(BigInteger384([
                    0x28cb41d7ffcd7c44,
                    0x6821d832902acb8e,
                    0xe0759527931cc3b7,
                    0x8b8173697f3aa65c,
                    0xf69c5dc54eaaaa81,
                    0x00ed23a5c5866e4d,
                ])),
                Felt::new(BigInteger384([
                    0xc06e03b6dd9d41c6,
                    0x63b4ba3e9036cf45,
                    0x7a716df6cbba9418,
                    0xa775060e2e71bc21,
                    0x437a14b5cf6c74ce,
                    0x00396d4cd261579d,
                ])),
                Felt::new(BigInteger384([
                    0x80c885659a9f953c,
                    0x990c675a85b93845,
                    0x05afabe944abc740,
                    0x0db3daea1afc8264,
                    0x4c9bee66d149d774,
                    0x00291bb9a9e78cca,
                ])),
                Felt::new(BigInteger384([
                    0x24c72c4766603df0,
                    0xe14d8340b33dad88,
                    0x21a8f3e068a8a481,
                    0x99f1c5629d7d33e1,
                    0x4d709f84b7cb7741,
                    0x007490d48758e160,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x8fd1dd0d01633af2,
                    0x97fc98d31ba104de,
                    0xa65cf684739d48fc,
                    0xb8defd76bd3ab593,
                    0xd071438219e1c7f4,
                    0x005eecf096a64885,
                ])),
                Felt::new(BigInteger384([
                    0x8570208729cb9a43,
                    0xb4ad207e73c5e90f,
                    0x9655c20d2b5877db,
                    0x3e298eed9e05222f,
                    0xce6f9fd6fb2bd4b7,
                    0x00c639ddfdac1a79,
                ])),
                Felt::new(BigInteger384([
                    0x0ce9ad71833d0ed4,
                    0xde16ef254ba80d61,
                    0x3309199b07dbba26,
                    0x1851b64631033358,
                    0xf02273f3ac82d5f3,
                    0x01169228cd0d2ecd,
                ])),
                Felt::new(BigInteger384([
                    0xba5f8ace29ca4acb,
                    0x1f96cd9987baed8b,
                    0xce178188a17aa304,
                    0x7c8953cd1f0c0459,
                    0xdccf55b6053565ba,
                    0x010f0997da21d4aa,
                ])),
                Felt::new(BigInteger384([
                    0x0cffd5240c3dea62,
                    0xa8c8dc6bd4117452,
                    0x4db0723bab4ee57d,
                    0x30038be9847de30e,
                    0x67bba5b3775d5f86,
                    0x01567ed76cd8c056,
                ])),
                Felt::new(BigInteger384([
                    0x7dee059a95919220,
                    0x8212d302a28da2ce,
                    0x67a368f8c926b6bd,
                    0xe2fd1a7b0374cd1b,
                    0x7cf24cc82ffe9913,
                    0x00640f9bd5315b6a,
                ])),
                Felt::new(BigInteger384([
                    0xea6e1a4fa8156d2c,
                    0x0a7abb60303ec6bc,
                    0x72d5e6f8534985e6,
                    0xcb47cbae3d1911df,
                    0xc36568b8814e1344,
                    0x0196d3eeb7aa1ad9,
                ])),
                Felt::new(BigInteger384([
                    0xa5fbc21d85112aea,
                    0xa1f3472e04a52b40,
                    0xfba5b9857913ef08,
                    0x10dfcb104045df31,
                    0x4f9da8508081c169,
                    0x0038d657eaab91f7,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x74557ba69043e675,
                    0x043433d65938580d,
                    0x59bba7483f3678ce,
                    0x2202d7c90de4c0ba,
                    0xade3c8ea6bdda8c9,
                    0x00c1acdfe615645a,
                ])),
                Felt::new(BigInteger384([
                    0xe843269000eca976,
                    0x1b17cf5f5e3d56ff,
                    0x60b44ae516db7654,
                    0x1911ce85dbcb9e20,
                    0x65bc99c6ce011249,
                    0x005946896f77b387,
                ])),
                Felt::new(BigInteger384([
                    0x565feb5f6230e984,
                    0xada7778d2c61cf15,
                    0x703453c4d2857ded,
                    0x378c9267f304a863,
                    0x5430945d4bb48b24,
                    0x010912590f83aaff,
                ])),
                Felt::new(BigInteger384([
                    0xaf603cfdf170c4f3,
                    0x6b746c43bb684873,
                    0xc00c41f1b1328927,
                    0x3c2a330bfac1983e,
                    0xf9d9637a310a26e4,
                    0x0104a157f7940212,
                ])),
                Felt::new(BigInteger384([
                    0x8b721f22b5312e2a,
                    0x135ff71415a79079,
                    0x62926c8c64c69ed9,
                    0xf70ce57f942c8c0c,
                    0xb4f2accbacbc24c6,
                    0x001e744c2ca3bba0,
                ])),
                Felt::new(BigInteger384([
                    0x2c71ba05d1fe7c6e,
                    0xba6e3ce66f5ab2a3,
                    0xec37f490adc3a004,
                    0xd5139479ca5b922f,
                    0xfaed4c4cc2e73105,
                    0x00573a342791be12,
                ])),
                Felt::new(BigInteger384([
                    0x71986a8bcc3efd34,
                    0x02abf03d0a72ef07,
                    0x0712c9a9ec208a60,
                    0x5d7eeb5ad5595cf8,
                    0xa08e2ed488426222,
                    0x006a602b3172fa5e,
                ])),
                Felt::new(BigInteger384([
                    0x9be263804738ed82,
                    0xa81f562aab71aac0,
                    0x6392ab2dd34b5032,
                    0x9d034edddcb81695,
                    0x25ac63d50c16223e,
                    0x00b71a38f6e2b95d,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x047cd224373baf34,
                    0x67cdd837e0599521,
                    0x29f15a14253558d3,
                    0xd03302fbc6771a8c,
                    0xc4ea8286b2e42005,
                    0x00a735eca713c6fb,
                ])),
                Felt::new(BigInteger384([
                    0x47ee8c14e0cea392,
                    0x23fb2e924742507e,
                    0x76ab086793c446e4,
                    0x31bd828b3ca070cb,
                    0x4fb34700ff6362e8,
                    0x0021a8d18750d3e7,
                ])),
                Felt::new(BigInteger384([
                    0x36e0e2070b33fb76,
                    0x8c9ca0a339e05adb,
                    0x296c4c4126d4e177,
                    0x757ac36b85300473,
                    0x60b0146f13c73516,
                    0x00180a65a4881032,
                ])),
                Felt::new(BigInteger384([
                    0xaf4246a62ced1adb,
                    0xbeb874f8abc09c9e,
                    0x52886609c81ad0b7,
                    0x98387528be2af071,
                    0x3f3ad88d0f68c585,
                    0x018d54ab54a21130,
                ])),
                Felt::new(BigInteger384([
                    0xa6b73ac632ce9811,
                    0xd39c2126f107fb4a,
                    0x4dc828c8b013acf4,
                    0xed76850b015a09b3,
                    0xe40590529fa53725,
                    0x00f7487040eff422,
                ])),
                Felt::new(BigInteger384([
                    0xcaa94ed0247335ae,
                    0xbbf050a40aab0493,
                    0x2542af255ec37422,
                    0x486b210d68167b7f,
                    0x7d61fcc52542b78f,
                    0x019403bd3e66edd2,
                ])),
                Felt::new(BigInteger384([
                    0x33475304bacdccb0,
                    0xff1ec10b7f833071,
                    0x5b116f6c74e01f0b,
                    0x790994806da6cf7e,
                    0x6bf8b15336f253e5,
                    0x018cd15e46b6aad4,
                ])),
                Felt::new(BigInteger384([
                    0xcac3da6350d053e8,
                    0xef706065f963c568,
                    0x30fc000ff66ec4a2,
                    0xc274f7cb7210a562,
                    0x49c8d7403c1fe645,
                    0x00ed74fc99d5813f,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x03d3c96845f2c4a8,
                    0xbc3883884d40e2d0,
                    0xa616d6f3de50b0ec,
                    0xa00cec7fb3ec0868,
                    0xae46b116b958c997,
                    0x0181e791bb1e9af2,
                ])),
                Felt::new(BigInteger384([
                    0x501a655d2025e723,
                    0x68de31946a07093c,
                    0xadd26b2d9863c13b,
                    0x406b79c71f453e7d,
                    0x965fdc00f7bba320,
                    0x00489fe0a58731d5,
                ])),
                Felt::new(BigInteger384([
                    0x42bfb015705980dd,
                    0x7b7f6ac3236c0f98,
                    0xf325be14250f49f6,
                    0x7ff38a2ed0a82872,
                    0x3a8605fa47834675,
                    0x01359c45c8029b21,
                ])),
                Felt::new(BigInteger384([
                    0x8734655f366c1054,
                    0x505defe05a83514e,
                    0x8171ccb7003db861,
                    0x1e88b4e3d21f370a,
                    0xcc89c866c57d10d1,
                    0x00ffc33cf758bbc3,
                ])),
                Felt::new(BigInteger384([
                    0x061395108897b020,
                    0xd2e2fcd0478f068e,
                    0x6bd74b46d0db1b4a,
                    0x2703ebd4dd95cd28,
                    0xa0261620b197255f,
                    0x017ac05a5f0a8a04,
                ])),
                Felt::new(BigInteger384([
                    0x70ebfb6b477166e0,
                    0x15a25f8cbd76c66a,
                    0xe4edb71d3716859b,
                    0x9796bda8196ced75,
                    0xac3d65d90d796417,
                    0x00325981a8c677dc,
                ])),
                Felt::new(BigInteger384([
                    0xae862b70569848c8,
                    0x188de7f579f9030e,
                    0x11998ec713dca77b,
                    0x35127eb8597ddd61,
                    0xbe6857d2361d7dac,
                    0x019602d4dbcdd6f0,
                ])),
                Felt::new(BigInteger384([
                    0x32d67447c8c47a60,
                    0xc457636326111471,
                    0xba51e2727d464b0a,
                    0x5233fdcb88585605,
                    0x5db9612c02dcbda7,
                    0x0150e91d65882bc5,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0x9a91ac2d8c133c5a,
                    0xc7993de7170c0bb7,
                    0xddfdb569b5a6f20a,
                    0x4069ffe97e50c148,
                    0x3d953e49af878bdb,
                    0x009f09eb3d014a81,
                ])),
                Felt::new(BigInteger384([
                    0xa299f76344a385e4,
                    0xbd457acea2c9166d,
                    0x5cfe3c407852868f,
                    0xb2cc6c4584cb1fd9,
                    0xb8534c0090e2ab93,
                    0x00a745e06fe345cf,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4405e419ffdd2943,
                    0xe21b2434231c8a18,
                    0x7aeb8a3e9474b601,
                    0x803209b98575e8fe,
                    0x613c9997e1d7ea60,
                    0x00df304d1ae9176e,
                ])),
                Felt::new(BigInteger384([
                    0x75968eebbe1ee771,
                    0xc758e439c2605c28,
                    0x4852f8a2fc90f03d,
                    0x9ec121d1bbc72cf4,
                    0x9448778c4f0dccc0,
                    0x001d73a5b290cb58,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xec96fde820f77ccc,
                    0xeeca58ec6e0ac860,
                    0x79cbba73c42e8290,
                    0x61c2ede914d37765,
                    0x56e1e539b2de671b,
                    0x0037249e92a6dda9,
                ])),
                Felt::new(BigInteger384([
                    0xaaab797c52707cf4,
                    0xb1a43cb80d7497c5,
                    0xcf12ce9c48320a60,
                    0x75a2ddce0dc0664d,
                    0x0550221064762f5e,
                    0x001b1f2f8441e3ed,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4254c3e227e12d2b,
                    0x67d0975615a7dcf5,
                    0xc4d2547f37d75544,
                    0x002cd8f46b88da63,
                    0x92c499286b78c6b7,
                    0x0139554093bae63c,
                ])),
                Felt::new(BigInteger384([
                    0xdfa5a55b3f41ebae,
                    0x4d9025b041ae82ce,
                    0x15faf2de833cc77b,
                    0x5c86f0ac40e73fc1,
                    0x8fa35d253a9bd406,
                    0x01388bba9e7fdcda,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0f8f31b18d9afc6a,
                    0x267b5620cf8292d7,
                    0xb2abf61758abeb0c,
                    0xa8a8c439abf0662e,
                    0x4d8adbddf8b9afec,
                    0x00d2623cf8421b53,
                ])),
                Felt::new(BigInteger384([
                    0xe8500c1b242bca7a,
                    0xc6e5989fc590a511,
                    0x4dd9b6b547cad118,
                    0x1709b28bd965e356,
                    0x4e85f02ef30746c0,
                    0x00b75383279e4f3d,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xcbb38680f2fc29c7,
                    0xba2a76efb9c1b659,
                    0x648eb6d13b6f2364,
                    0x6ea18d10d62d6f36,
                    0xce230725858e86a9,
                    0x0111f186a921982b,
                ])),
                Felt::new(BigInteger384([
                    0x63287c238f84150f,
                    0x1c52ce07cbf9ef56,
                    0x6980ebd93124f68c,
                    0xbe30f6c00cbe2852,
                    0x0f15630316d2b6f2,
                    0x00c4599965aaa796,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8681a0cd396383af,
                    0x03e390bedd52a95a,
                    0x4f91a7f1a25c023e,
                    0x49bf70d7313bc795,
                    0xc99185f91f5ba3b9,
                    0x005d15d9c7ef76d9,
                ])),
                Felt::new(BigInteger384([
                    0xce9e8c63cbb67f50,
                    0x5ee45ddd9d6b4ed4,
                    0x1a83140f2db5e8f5,
                    0x7017feb28d94131b,
                    0x9d7d06d527639f94,
                    0x006a914432fd14a0,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8df1e5c0b2e98a54,
                    0xf1145b5704d768c4,
                    0xad0918e995f7f818,
                    0x9410930c08669582,
                    0x457520c3b9af8c37,
                    0x0145de655433e5bf,
                ])),
                Felt::new(BigInteger384([
                    0x78d0305b22c67e50,
                    0x1203537de853781a,
                    0x6da0a925ea31646d,
                    0x7ae92d9e43043315,
                    0xb6d0232d28270d19,
                    0x01a64571976d54cc,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8d3127e754e13fa1,
                    0xa66b5478b339524d,
                    0x0c660798bb893f51,
                    0xbe6415531c5636d1,
                    0x57d22bcb87ca57e9,
                    0x01195b244b0648b5,
                ])),
                Felt::new(BigInteger384([
                    0x03af192ad1752054,
                    0x59fb3b02f80587ed,
                    0xcbc28f5625722d28,
                    0xcdb20c8d9a43d894,
                    0x77977e77aefe3497,
                    0x0177fa79137627ba,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xbd41953d70d99061,
                    0x9bdcd1918a505a28,
                    0x5133251869e74be3,
                    0x536bb42ff957dd10,
                    0x1b20619bc66980f8,
                    0x01a9ca92fcb28d24,
                ])),
                Felt::new(BigInteger384([
                    0x804cbef2ef22c2f0,
                    0x0565de3896e4beb9,
                    0x27a9ee1c7d97c986,
                    0x47193af7103c94c1,
                    0x74be57553e3724b0,
                    0x00a2274857821d2c,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 4));
        }
    }
}
