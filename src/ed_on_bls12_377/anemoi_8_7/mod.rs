//! Implementation of the Anemoi permutation

use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 8 field elements or 256 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 8;
/// 7 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 7;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 4;

/// 1 element (32-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t -= mul_by_generator(&y2);
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t += mul_by_generator(&y2) + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    apply_mds_internal(&mut state[..NUM_COLUMNS]);
    state[NUM_COLUMNS..].rotate_left(1);
    apply_mds_internal(&mut state[NUM_COLUMNS..]);
}

#[inline(always)]
fn apply_mds_internal(state: &mut [Felt]) {
    state[0] += state[1];
    state[2] += state[3];
    state[3] += mul_by_generator(&state[0]);
    state[1] = mul_by_generator(&(state[1] + state[2]));
    state[0] += state[1];
    state[2] += mul_by_generator(&state[3]);
    state[1] += state[2];
    state[3] += state[0];
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies an Anemoi permutation to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Applies an Anemoi round to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/vesselinux/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x715e9dad363c61be,
                    0x438adae543721d81,
                    0x57e6beb377dd46f4,
                    0x085a9649f11dadd1,
                ])),
                Felt::new(BigInteger256([
                    0xc44da3c4103b632e,
                    0x4e681c5df5e37006,
                    0x8212d46f47f82aee,
                    0x08d33102e2dde76b,
                ])),
                Felt::new(BigInteger256([
                    0x7c233decbb03f74e,
                    0xbb1be3f5f05a9e68,
                    0x3b07b9adc9e087f6,
                    0x02d1a1b680c0f33d,
                ])),
                Felt::new(BigInteger256([
                    0x1deba05fa9b579cd,
                    0xae47b40abd61e134,
                    0xb7e5315b68a90398,
                    0x0f23210711463b42,
                ])),
                Felt::new(BigInteger256([
                    0x152f6fe8527201dc,
                    0x842e7d280fd692a3,
                    0x78e622f3bad065e4,
                    0x0f624d3315cdbd9e,
                ])),
                Felt::new(BigInteger256([
                    0xebded5ab524a5d2a,
                    0x3f9f433c4ca6b7e8,
                    0x701e57db3d23dea5,
                    0x112624133a09594b,
                ])),
                Felt::new(BigInteger256([
                    0x2154234c61047070,
                    0xd4984cc51a71f7d4,
                    0x198c7e063d9cc65f,
                    0x071f5427f6e3f863,
                ])),
                Felt::new(BigInteger256([
                    0x655d263d47faec59,
                    0x5883270e896893a6,
                    0xa9e57128f12f6ce7,
                    0x0cbb6463f6a231de,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x49570f17229f351a,
                    0x982a8972d18fe46b,
                    0x1fa3a34e40d447b9,
                    0x0fd858fab67a806c,
                ])),
                Felt::new(BigInteger256([
                    0x83bc870d3c9360dd,
                    0x53888dac6ae361c9,
                    0x30afe0b2c5fb239b,
                    0x0e547845422ad10d,
                ])),
                Felt::new(BigInteger256([
                    0x229228dc9f21fd30,
                    0x0e03d7ab9fb9a8b1,
                    0xf97e8badab1294e1,
                    0x096baf7b01408bc2,
                ])),
                Felt::new(BigInteger256([
                    0xad637a3bb2cf4eb7,
                    0x296144064da22ad0,
                    0x04aa7d1a25b0b864,
                    0x107df78fd53d92fd,
                ])),
                Felt::new(BigInteger256([
                    0x64efa74c6ee08985,
                    0x1ea370bdc8f05c99,
                    0x8c0a4f96673578d7,
                    0x0cf880f103242213,
                ])),
                Felt::new(BigInteger256([
                    0xde566772a5bdd982,
                    0x89801e3fafa56b12,
                    0x830b3b5ec7085120,
                    0x0f1578bd1cb859a4,
                ])),
                Felt::new(BigInteger256([
                    0x54cee47a7174c5b0,
                    0xc856f3d0b015838b,
                    0x7142b7f629685217,
                    0x01a2a94452f495eb,
                ])),
                Felt::new(BigInteger256([
                    0x451ec857cda1db78,
                    0x363dc5b8e38abad7,
                    0xb047cb790a6a09cb,
                    0x0b920259924cb036,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc85ded3dd155d70c,
                    0xe7f72ea1f1e8d6dc,
                    0xc940ea6437040d30,
                    0x0e2ecc9ef443f266,
                ])),
                Felt::new(BigInteger256([
                    0xca0b60bdf9dba1e0,
                    0x44610df6ee2e4cd1,
                    0x30a9c534f9b79510,
                    0x0f01c8ead35b6ce4,
                ])),
                Felt::new(BigInteger256([
                    0x93e9b6db10c8978e,
                    0x9ced8a1759437dc8,
                    0x36f6066216f03412,
                    0x0737472c2cfce0e6,
                ])),
                Felt::new(BigInteger256([
                    0x044c3ec4e2ed4431,
                    0x859f7555aded433c,
                    0xa15dd23c5a87a617,
                    0x0e0e4c9bb23c2574,
                ])),
                Felt::new(BigInteger256([
                    0x7abe6aee37c808be,
                    0x311eed70a805e846,
                    0xe8308f219fa55ba0,
                    0x11b3a9fc3c01b0d7,
                ])),
                Felt::new(BigInteger256([
                    0xd465d0f1f1a096a0,
                    0xe31be514bb10e762,
                    0xf5a8de4889fdc3e2,
                    0x07885f9df19e14e8,
                ])),
                Felt::new(BigInteger256([
                    0x1987c6474ddd2642,
                    0x44cd8cdc8c924077,
                    0xceb43a83232af611,
                    0x1193d70b04e8a60a,
                ])),
                Felt::new(BigInteger256([
                    0xfb4c71324cd1ad86,
                    0x0f87374e37711b90,
                    0x773d4d0538cf2f93,
                    0x0eb8f8607906d3c4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc7a85fc11c855eb6,
                    0xeab033c3ac4a9fce,
                    0xed8ff4f6e5c4ee17,
                    0x0302fce77a70bf59,
                ])),
                Felt::new(BigInteger256([
                    0x78195345d69f3d35,
                    0x13829c5f0e1147e2,
                    0xdece64aeadd7bf1b,
                    0x03dad339f8f5b537,
                ])),
                Felt::new(BigInteger256([
                    0x8655a2e7c120b137,
                    0x505de17d4214be12,
                    0xc0bcb374b80700d6,
                    0x03a8b5fc0aa6228c,
                ])),
                Felt::new(BigInteger256([
                    0xba2497b297ed8fa6,
                    0xd188a9050dd20ae1,
                    0xb79bb357dff37c87,
                    0x0350036deb285bb2,
                ])),
                Felt::new(BigInteger256([
                    0x1694b4923c73719e,
                    0x59a77d49961bf5ae,
                    0x165da7606f6ea5a0,
                    0x0d1dc143da16af96,
                ])),
                Felt::new(BigInteger256([
                    0x3050469ea59bc132,
                    0xc110d6a6a56df89f,
                    0xb74bb76f684da918,
                    0x0347937e19b0c422,
                ])),
                Felt::new(BigInteger256([
                    0xe8fd0cdd6804385b,
                    0xe65a00df44b75e67,
                    0x62daaef739f6bd2b,
                    0x0947c47bec67a7d4,
                ])),
                Felt::new(BigInteger256([
                    0x91ab823d77940e0f,
                    0xa545fa9474251dd2,
                    0xd33dfbb2ad9dd754,
                    0x05397eb135ec7143,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x2eff66f6be1e2d72,
                    0xba47691b793605e9,
                    0xf6cbe72026aa85d3,
                    0x0b1f9f7e2de23699,
                ])),
                Felt::new(BigInteger256([
                    0xaa876ec3fed6e46e,
                    0x1f30bc30003c57a5,
                    0x53b3754f1c476c6c,
                    0x00000140b45771b1,
                ])),
                Felt::new(BigInteger256([
                    0x9bcf4c6080c191e5,
                    0xfb8555c6ed502dca,
                    0xbe3ef119f6a411ab,
                    0x0a93bc8b1105ff12,
                ])),
                Felt::new(BigInteger256([
                    0xa0d435492992a1ed,
                    0x8d3d4ae73fe344bc,
                    0x1adab1f6d3e749dc,
                    0x0f378872518e0115,
                ])),
                Felt::new(BigInteger256([
                    0x01cf0de7d66681e8,
                    0x3897cb56e1dd4978,
                    0xbf37ba5e74e448db,
                    0x0e141f5373be0f02,
                ])),
                Felt::new(BigInteger256([
                    0xffc3691ce56188fd,
                    0x5177f52ecd730419,
                    0xdcdd44290d6991b2,
                    0x0247cdc94af952b2,
                ])),
                Felt::new(BigInteger256([
                    0x2aad960d896b6c86,
                    0x624efecd81aa9b34,
                    0x851f506f0b4f7b6c,
                    0x0ad8150050a65092,
                ])),
                Felt::new(BigInteger256([
                    0x1cc38c863ec4f8be,
                    0xb7a933dae7ae56c2,
                    0x5e710d8027f6d1a4,
                    0x011ceb9132debd86,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdf51d8d7118a3b4c,
                    0x3f27ea7311b96982,
                    0x4560f86a2933b361,
                    0x0f8d01167b493127,
                ])),
                Felt::new(BigInteger256([
                    0x6f68d98dc5d7260e,
                    0xc66fc614f65ddf27,
                    0x6cb67ef9464ac6c6,
                    0x0f7855ce0db06d35,
                ])),
                Felt::new(BigInteger256([
                    0xbf771a16294d75b0,
                    0xf39340fc6c8589d8,
                    0x69c0a42755142280,
                    0x023f672568d72711,
                ])),
                Felt::new(BigInteger256([
                    0xe1155245319c84dc,
                    0xe30cbff6b57517b5,
                    0x3e45989d1acd851f,
                    0x09906358ed2128a9,
                ])),
                Felt::new(BigInteger256([
                    0x48f899fa4b4cee1c,
                    0x74928b269d2f482c,
                    0x54aae4f0a39a145a,
                    0x0485bedfaa0193bb,
                ])),
                Felt::new(BigInteger256([
                    0x37b090e7126d9bf7,
                    0xcbb776b441cc12a5,
                    0x10d498364fe434b6,
                    0x06eaf551383e1c80,
                ])),
                Felt::new(BigInteger256([
                    0x73981438f4b1fd4a,
                    0x83c85bb0dbf4edf0,
                    0x19a2bc527cedaf44,
                    0x086c8a5f842443af,
                ])),
                Felt::new(BigInteger256([
                    0x26e0e17bed5dcbf7,
                    0xe60d98d41ceb27d9,
                    0x2da6ba15d4e2b569,
                    0x059abf89efddd8fb,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0b7804bcf16eed23,
                    0x8676406e9d9bed8d,
                    0x9689252b76d1996b,
                    0x0fa62131007d80bb,
                ])),
                Felt::new(BigInteger256([
                    0xc73a57163d59894c,
                    0x629ab5d5e2f598c6,
                    0xadf16a49ddd1835a,
                    0x0652ac2604ade965,
                ])),
                Felt::new(BigInteger256([
                    0x1a26d5d587a9419f,
                    0x9ea1937da23d3a72,
                    0xef620b00985ee8ec,
                    0x0bb0436eb83d339e,
                ])),
                Felt::new(BigInteger256([
                    0x896c824caa235552,
                    0x33a4286a8d1292a0,
                    0x99126b7a85916ab5,
                    0x01c300cf622edcc9,
                ])),
                Felt::new(BigInteger256([
                    0x0ed1addfb2813d0d,
                    0xd7ea5458793fad29,
                    0x1c519a61ae1a8e7d,
                    0x11d75f5b154aaf39,
                ])),
                Felt::new(BigInteger256([
                    0x85c1af338871ac94,
                    0x33c1edc8bc2f1ce5,
                    0xe89a29fb80e730a3,
                    0x0d329a53f91165fc,
                ])),
                Felt::new(BigInteger256([
                    0x23c3750462ed6301,
                    0x6629076ecf08016c,
                    0x15ae3a35be50bddb,
                    0x109479572658a7f3,
                ])),
                Felt::new(BigInteger256([
                    0x01217887642f0c86,
                    0xffc434731693800f,
                    0x124aa4954532a83b,
                    0x087e9a7d36cb7726,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdf33dda0058a910c,
                    0xe9c9ba314e8b887a,
                    0x8c34a6968ea3bfd6,
                    0x0d8edfb8c67f4b88,
                ])),
                Felt::new(BigInteger256([
                    0xe4aafcd30ef2963b,
                    0xdd248d2d9988bcdd,
                    0x5cea831cdea68919,
                    0x1153e8ebbe783c82,
                ])),
                Felt::new(BigInteger256([
                    0xc3fd9820933914f9,
                    0xb80ef82161a5d402,
                    0xc086ccf42e09f7bd,
                    0x06077f2e5bdd6e54,
                ])),
                Felt::new(BigInteger256([
                    0xc4ac3b0ae409e0df,
                    0xacbda9f7f0f20a1c,
                    0xff549463ea78ba90,
                    0x066b202eab7c36e7,
                ])),
                Felt::new(BigInteger256([
                    0x79da2555e1b236e2,
                    0x36725cb83ad8aae3,
                    0x12cc73eeffdb6c07,
                    0x0f1e33ed55ee5f7c,
                ])),
                Felt::new(BigInteger256([
                    0xa5e56e999706833f,
                    0xc3a99518f02bb655,
                    0x9ec02f7608700d01,
                    0x0e2f73e8963b004b,
                ])),
                Felt::new(BigInteger256([
                    0x29af5a3895f2f0fa,
                    0x6a565af785b0453a,
                    0x212dde664d85b3cc,
                    0x03c0493e4cefa837,
                ])),
                Felt::new(BigInteger256([
                    0x5cec9f43e25f3b8e,
                    0x1f92f6d512d6a85a,
                    0x22785c496891f98b,
                    0x078e7ab0d1c3613e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe9ffaee0120a1128,
                    0x0c9fbae096483b96,
                    0xd12b3711b018ed79,
                    0x0568ea1096e65a3b,
                ])),
                Felt::new(BigInteger256([
                    0xb82143b14b3927d5,
                    0xe4d94081bc97c62d,
                    0xdace8351007830ae,
                    0x074153e409412802,
                ])),
                Felt::new(BigInteger256([
                    0x4edfd4ce76659cfa,
                    0xbd48a1a6e72b2e4a,
                    0x8c8c464ee8f09a62,
                    0x04b0dec5443a6814,
                ])),
                Felt::new(BigInteger256([
                    0x91c85bccd8549de6,
                    0x65cf550ea3956206,
                    0x8e5a2ed78dbe894d,
                    0x037f939dc33fea6e,
                ])),
                Felt::new(BigInteger256([
                    0x0c9b3a9f94ac6246,
                    0x8a8d7e6816b1ed0b,
                    0xd4311e8d8b6bfc75,
                    0x0b9c09effeaed924,
                ])),
                Felt::new(BigInteger256([
                    0x6d17cdc14dd70e4a,
                    0xacc7016a1430ee90,
                    0xf965c2ae009c0dc7,
                    0x067fe24528fa68b3,
                ])),
                Felt::new(BigInteger256([
                    0xa37476ff3ed77a08,
                    0x756c93af28626fdf,
                    0x19771899733a4aa5,
                    0x0244b18420acccb2,
                ])),
                Felt::new(BigInteger256([
                    0x8ee45772cd339206,
                    0x285046c4988273fb,
                    0x380306690cbdf165,
                    0x0b35070685d77f73,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5e29b2618388ec75,
                    0x697cf91dd16bb53d,
                    0xa0717cd0c4694d24,
                    0x04da7a725ba1a77e,
                ])),
                Felt::new(BigInteger256([
                    0x07f39425adfef2f3,
                    0xa5105efa7c0c05e4,
                    0xe1ccfdfa6590b3fe,
                    0x0dd648ee9e11a64d,
                ])),
                Felt::new(BigInteger256([
                    0xd7ba8a125c0bfddb,
                    0xcec99aabd8cbc035,
                    0x426be19f754ae4f3,
                    0x0e5d0c68ce3a6859,
                ])),
                Felt::new(BigInteger256([
                    0xb1f4d7b2203f4804,
                    0xbaf4ffecbf01e2e0,
                    0x9c9e7a8d796a0033,
                    0x0b200401e2fd425c,
                ])),
                Felt::new(BigInteger256([
                    0x5ed75b11dd2c940a,
                    0x7372cd8a5b03b6c7,
                    0xb5178ad1623dcac8,
                    0x04efce2db39b1c95,
                ])),
                Felt::new(BigInteger256([
                    0xda14ec17aba5186f,
                    0x9cf54734099b410c,
                    0x09b5be32751590a9,
                    0x0a0dbbf9c7eb075c,
                ])),
                Felt::new(BigInteger256([
                    0x39386e6e8077e68e,
                    0x6bd498411dadd581,
                    0x4ab9b459eda93a77,
                    0x0100713198ddfe60,
                ])),
                Felt::new(BigInteger256([
                    0x92ee6e541a74f9bc,
                    0x194c46b43e03043e,
                    0x2c77e1c6a515cb7b,
                    0x0b677db9475df372,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x87038d66de11fc45,
                    0x7770f5b0e114ebaa,
                    0x014c1fa06f649778,
                    0x127dbc6c39832ae9,
                ])),
                Felt::new(BigInteger256([
                    0x5b042cb5896b43de,
                    0xee1fb62783805a23,
                    0xa121763cf16dec9f,
                    0x024c77a2552ee615,
                ])),
                Felt::new(BigInteger256([
                    0xd19de7c9c04c80be,
                    0x25f0e975dd2c9141,
                    0x6be48df7a1e091b3,
                    0x068b9a789b83f0be,
                ])),
                Felt::new(BigInteger256([
                    0x366547dd4253ebfd,
                    0x583dfe844c4a2e3e,
                    0x747eff3905e3b187,
                    0x050cd01dc02e1861,
                ])),
                Felt::new(BigInteger256([
                    0x6a5618cd49cca0a7,
                    0x8551a382610a369c,
                    0x203f4d2c84a7ea0e,
                    0x00e2c12f801a5f91,
                ])),
                Felt::new(BigInteger256([
                    0xe4ff56662e63d4bc,
                    0xc0f412a28b0bffe8,
                    0xe8e17d882d744bf6,
                    0x018315ff63c91bd7,
                ])),
                Felt::new(BigInteger256([
                    0xb267d9f7de8b8f90,
                    0x71165953695878a1,
                    0x55f2de37ddb98d6f,
                    0x11c4337222f43326,
                ])),
                Felt::new(BigInteger256([
                    0xb7d851a312410e9d,
                    0x124fc64af4e34068,
                    0x22148ab1b1835276,
                    0x0eaaeafae191d453,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x6fdd481f27bf0e78,
                    0x1de714198cc5ca07,
                    0x097e18e3158e375a,
                    0x079e7ad1b8ecea22,
                ])),
                Felt::new(BigInteger256([
                    0xb0366b8b732e32f6,
                    0x3ce1a610eee12074,
                    0xb506d2419a357bb4,
                    0x046c27ac69916690,
                ])),
                Felt::new(BigInteger256([
                    0xe4fb8d6376b1421e,
                    0x53ccaca389a0148a,
                    0x38ad99b3eaf2c716,
                    0x0f68479f953b631d,
                ])),
                Felt::new(BigInteger256([
                    0x9d8952ac336f924e,
                    0x3dd959ea36bc0b67,
                    0xaaaced93fc8e74cf,
                    0x07dcbab4a143b426,
                ])),
                Felt::new(BigInteger256([
                    0xf399b17559aa5435,
                    0xc3f871f7bea46785,
                    0x129c474fef3b7e39,
                    0x052db7e147b6cea9,
                ])),
                Felt::new(BigInteger256([
                    0xf90988c48a673742,
                    0x3b91495f85784004,
                    0xdfe76d3788b37564,
                    0x05128e3ae3b7cc69,
                ])),
                Felt::new(BigInteger256([
                    0x610ab272a2c67afc,
                    0xe904296df7db7c3f,
                    0xe69df956cec9e3f0,
                    0x0e394db0df707921,
                ])),
                Felt::new(BigInteger256([
                    0xbbd78f186d99d892,
                    0xb683f8de9fcf2cf5,
                    0xb9298cce921e582a,
                    0x106ea29871b8216a,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/vesselinux/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xa28633a513b79500,
                    0x0696edf9f8e74a6e,
                    0x6d9eea1fe7f1b055,
                    0x0f7bbd8bfe223728,
                ])),
                Felt::new(BigInteger256([
                    0x23f30b814701b647,
                    0x45c1dd4d1bfde4c8,
                    0xfc445eb18082b4ce,
                    0x012151fce4614dc3,
                ])),
                Felt::new(BigInteger256([
                    0x87adcb704f921b3a,
                    0x639f854d3db24821,
                    0xba52da0d8c272eba,
                    0x077f3f9267942865,
                ])),
                Felt::new(BigInteger256([
                    0x8fbe0e15946e4b9c,
                    0xb21dc80232379ab5,
                    0x03e118ff0d926d6d,
                    0x126fd051ffce4993,
                ])),
                Felt::new(BigInteger256([
                    0x22105bf390d13e07,
                    0xa0e0652abe15f1aa,
                    0x7f9418fd724f6951,
                    0x0ecfe297528776cb,
                ])),
                Felt::new(BigInteger256([
                    0x2c5ccee3178fda91,
                    0xf1c69cc55ba98627,
                    0x8b57d6c8a5bb897f,
                    0x01886748c0cb1edf,
                ])),
                Felt::new(BigInteger256([
                    0x12c905700eaa4ed6,
                    0xcba95f766fd88517,
                    0x445d97f2ea4fd741,
                    0x1215a4bf2ae01ba5,
                ])),
                Felt::new(BigInteger256([
                    0x3f1bc762e971d64b,
                    0x171e15c2d8d3b846,
                    0xd4a4036e555bf278,
                    0x10ca69c8e6add82d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x1c0f1a5752d96e48,
                    0x2d5d23b812cc0c00,
                    0xc20916fe19ff0665,
                    0x014f4bf9e78c802a,
                ])),
                Felt::new(BigInteger256([
                    0x04e9ad02b4fb049a,
                    0x9b6ea6ba4bf411cb,
                    0x4090d2f0f7b12e9a,
                    0x01980c9af44ef08a,
                ])),
                Felt::new(BigInteger256([
                    0x4b7d6af19c3ad553,
                    0x99946ec745dd20c6,
                    0x0b2b547e7d7fbec7,
                    0x052e7ba1b9f29f77,
                ])),
                Felt::new(BigInteger256([
                    0xc3f32812d03f2411,
                    0xcd4bd791949b559e,
                    0x539525b3c1ab3e41,
                    0x0ea723b421579bfb,
                ])),
                Felt::new(BigInteger256([
                    0xd5b9f7ba5ce61606,
                    0x452efcc35087ec89,
                    0xe9e4441aa3a6bed3,
                    0x107b1184f18db85c,
                ])),
                Felt::new(BigInteger256([
                    0xdf09092c28226e76,
                    0xe422b14154286797,
                    0xc37a3d86f238a6cc,
                    0x068cd07350568720,
                ])),
                Felt::new(BigInteger256([
                    0x735c04c6eebed2df,
                    0xd82fa58f1163a827,
                    0x0893c7de543a1751,
                    0x0d32dead28989eed,
                ])),
                Felt::new(BigInteger256([
                    0xaf68ef33030e63e4,
                    0x4945bcdb4060b4ee,
                    0xde78f951c53cf032,
                    0x018490ba8d089b19,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x527e3e4ebaa59fbb,
                    0x7f6f44beb396cd61,
                    0xacb9aada27561268,
                    0x093a816cc99bb787,
                ])),
                Felt::new(BigInteger256([
                    0x841765dc9b702848,
                    0x4e822bc59d83c502,
                    0xb5c2460627eb1e1a,
                    0x022faf01fc298364,
                ])),
                Felt::new(BigInteger256([
                    0x436b774d9dacacf4,
                    0xee19128a6680f900,
                    0x5e3659a35c848db8,
                    0x035192fc41f44344,
                ])),
                Felt::new(BigInteger256([
                    0x546da972a2be4ba0,
                    0x8b988769bc20c07c,
                    0x6b0ff82b714a4775,
                    0x079e9f2083a45e7c,
                ])),
                Felt::new(BigInteger256([
                    0x05a320887d4922ba,
                    0xffe453e15a450ddb,
                    0xca50d41354afd676,
                    0x0408e8e5c3d46ef1,
                ])),
                Felt::new(BigInteger256([
                    0x4662a2d6337401c7,
                    0x209b9e05fd2490fc,
                    0xf7b1a0e4e66fd784,
                    0x0b22a2a2e0c41ee4,
                ])),
                Felt::new(BigInteger256([
                    0x483dfc255f8f2720,
                    0xcc78197252e045f3,
                    0xaf4d7aa1f895d3ab,
                    0x00bc18de9eb26614,
                ])),
                Felt::new(BigInteger256([
                    0x39ef117f2b4b027a,
                    0xafdcffc36b650211,
                    0xca8bae7eec9aeae2,
                    0x0489288ba2d8af5c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdf2957b10fe053a0,
                    0x7402920522570627,
                    0x95dd3dede24d43e3,
                    0x10be022e829ee2a6,
                ])),
                Felt::new(BigInteger256([
                    0xd497f57d32cc49fa,
                    0x72d71fa58df57cf2,
                    0x72a6d7af39ed8634,
                    0x0bb742ccae3b6b7a,
                ])),
                Felt::new(BigInteger256([
                    0x0e671a3180a60805,
                    0x1fb2fa59f1aecd07,
                    0x7a52caf8f648d618,
                    0x103c0bf832554823,
                ])),
                Felt::new(BigInteger256([
                    0x3b91a9877c2a7862,
                    0xd6fcc48107caaeb5,
                    0xd6360a632bf68df3,
                    0x10f81a203636dae8,
                ])),
                Felt::new(BigInteger256([
                    0x23b5c6b79d99bc39,
                    0x3636cf3d397240d5,
                    0x9f4e69e829b7c557,
                    0x11078b098515e171,
                ])),
                Felt::new(BigInteger256([
                    0x5424a3531b061cf0,
                    0xe9894c02dd0dfe58,
                    0xc2a554b8b34c991c,
                    0x00b0334e9567052c,
                ])),
                Felt::new(BigInteger256([
                    0xe3119dcfb74918f8,
                    0x6744f1322821abef,
                    0xc4da4eb02b245afb,
                    0x0b3fffaecfc907fa,
                ])),
                Felt::new(BigInteger256([
                    0x3a5ea79628d6aebe,
                    0x808d68ca88aac787,
                    0x7630d632e0c16c5f,
                    0x0d9cc953decaa10e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x2fe1863410ea4284,
                    0x25de9ae6eba8a340,
                    0x8cacb09627fdfe12,
                    0x0b7f26c19db39a9d,
                ])),
                Felt::new(BigInteger256([
                    0x5a7f9cd44a9b5129,
                    0x3a220c1062cfcb2e,
                    0x2cb23b639604c7c0,
                    0x01c6122064ab6cf7,
                ])),
                Felt::new(BigInteger256([
                    0xa3520b662e2bf159,
                    0x13f22477b97cf331,
                    0x83d2136593178b90,
                    0x08910e3b28e5160d,
                ])),
                Felt::new(BigInteger256([
                    0xbd7e1b455a4ac1ca,
                    0x62328184db462964,
                    0x04e010a9e652c63c,
                    0x004ce34ae627330e,
                ])),
                Felt::new(BigInteger256([
                    0xefba1df15b348aaa,
                    0xc10aef0ee935c194,
                    0x22ab6794b58e528e,
                    0x033ad4dbf72e4620,
                ])),
                Felt::new(BigInteger256([
                    0x3030df0bd1b3ee81,
                    0x3641e39958b55f0c,
                    0x1ad077776c3aa400,
                    0x063c0cf65d69e769,
                ])),
                Felt::new(BigInteger256([
                    0x5f399eb0c122d0c0,
                    0x00e176212a35ecd8,
                    0x489d6a1851372288,
                    0x06eefaed82f4d051,
                ])),
                Felt::new(BigInteger256([
                    0xed2c15fe250e7c1e,
                    0x9364d33aba38fb3b,
                    0x073fc3c6a32cd8be,
                    0x0a8e89958614f982,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xce1ee5d7287e800a,
                    0x7f9901d876b3d568,
                    0xe962a68413b39398,
                    0x032a25c52f1c0379,
                ])),
                Felt::new(BigInteger256([
                    0xf746fbfd85212717,
                    0xda108fe367600267,
                    0xab1e8421611f3f2b,
                    0x0b558da222422762,
                ])),
                Felt::new(BigInteger256([
                    0x49b1d614f0a2cd9d,
                    0x59ddb4ab4b7c7201,
                    0xf33eeba871a11d43,
                    0x0c8f762e0bcda1fb,
                ])),
                Felt::new(BigInteger256([
                    0xebe2038220e19f5e,
                    0x4b4cedde3f91b3b1,
                    0x6e8268eee079ab8a,
                    0x097c5a1a4da41799,
                ])),
                Felt::new(BigInteger256([
                    0x8f7d75b227348b32,
                    0x09bc7e41347abc81,
                    0x4b75698d8b235545,
                    0x0df9eefd3e4c1f7b,
                ])),
                Felt::new(BigInteger256([
                    0x9ddaff7da9fb37be,
                    0xc9d2695b22058118,
                    0xbcc321ca007fc80d,
                    0x06895fe5bdff18ec,
                ])),
                Felt::new(BigInteger256([
                    0xa4dc3f3dceb10cba,
                    0xa27b2214de99e29c,
                    0xe2c1a2526997d20f,
                    0x0904719844247a87,
                ])),
                Felt::new(BigInteger256([
                    0x53ad565526be90be,
                    0xbd5f9eb2d9341a46,
                    0x65a76767722ec91d,
                    0x015a08712e7a6330,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 8],
            [
                Felt::new(BigInteger256([
                    0x5849fffffffffc5c,
                    0x8f66c852bffffc37,
                    0xef973d7845433b15,
                    0x0802f396b5761187,
                ])),
                Felt::new(BigInteger256([
                    0x724f7fffffffc755,
                    0xd11ac64b0fffc51a,
                    0xf6b1d88c384d237b,
                    0x095698154002aa25,
                ])),
                Felt::new(BigInteger256([
                    0x0a2cffffffffcade,
                    0xccb971185fffc8c7,
                    0xd41678e0392a5841,
                    0x093ff38447d72881,
                ])),
                Felt::new(BigInteger256([
                    0x141c7ffffffff9f3,
                    0x738dfc2f6ffff9b6,
                    0xdd095f4c030c07d4,
                    0x08eba2951fdb9458,
                ])),
                Felt::new(BigInteger256([
                    0x5849fffffffffc5c,
                    0x8f66c852bffffc37,
                    0xef973d7845433b15,
                    0x0802f396b5761187,
                ])),
                Felt::new(BigInteger256([
                    0x724f7fffffffc755,
                    0xd11ac64b0fffc51a,
                    0xf6b1d88c384d237b,
                    0x095698154002aa25,
                ])),
                Felt::new(BigInteger256([
                    0x0a2cffffffffcade,
                    0xccb971185fffc8c7,
                    0xd41678e0392a5841,
                    0x093ff38447d72881,
                ])),
                Felt::new(BigInteger256([
                    0x141c7ffffffff9f3,
                    0x738dfc2f6ffff9b6,
                    0xdd095f4c030c07d4,
                    0x08eba2951fdb9458,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0x5849fffffffffc5c,
                    0x8f66c852bffffc37,
                    0xef973d7845433b15,
                    0x0802f396b5761187,
                ])),
                Felt::new(BigInteger256([
                    0x724f7fffffffc755,
                    0xd11ac64b0fffc51a,
                    0xf6b1d88c384d237b,
                    0x095698154002aa25,
                ])),
                Felt::new(BigInteger256([
                    0x0a2cffffffffcade,
                    0xccb971185fffc8c7,
                    0xd41678e0392a5841,
                    0x093ff38447d72881,
                ])),
                Felt::new(BigInteger256([
                    0x141c7ffffffff9f3,
                    0x738dfc2f6ffff9b6,
                    0xdd095f4c030c07d4,
                    0x08eba2951fdb9458,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x5849fffffffffc5c,
                    0x8f66c852bffffc37,
                    0xef973d7845433b15,
                    0x0802f396b5761187,
                ])),
                Felt::new(BigInteger256([
                    0x724f7fffffffc755,
                    0xd11ac64b0fffc51a,
                    0xf6b1d88c384d237b,
                    0x095698154002aa25,
                ])),
                Felt::new(BigInteger256([
                    0x0a2cffffffffcade,
                    0xccb971185fffc8c7,
                    0xd41678e0392a5841,
                    0x093ff38447d72881,
                ])),
                Felt::new(BigInteger256([
                    0x141c7ffffffff9f3,
                    0x738dfc2f6ffff9b6,
                    0xdd095f4c030c07d4,
                    0x08eba2951fdb9458,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x9e70edc40ce7cba5,
                    0xf3f794e11ad056c4,
                    0x59b0ab5c22ad5a23,
                    0x0e98cd121fc15458,
                ])),
                Felt::new(BigInteger256([
                    0xb5fca281ddfbb713,
                    0xb927089737e997b7,
                    0x1602b0b2cc0cbcee,
                    0x0d2db2df10015126,
                ])),
                Felt::new(BigInteger256([
                    0xde04f3e42bcd36b5,
                    0x11883efd31fe7029,
                    0x26354e2811d3c7ee,
                    0x0f31f555d2c381ba,
                ])),
                Felt::new(BigInteger256([
                    0x692ae9256d428f46,
                    0xdabb121808ba0019,
                    0x884fb2dc99af087d,
                    0x0678a264f1337a26,
                ])),
                Felt::new(BigInteger256([
                    0xe42ed562eaa0ae9c,
                    0x6393541a703215a4,
                    0xa30528df9acc336f,
                    0x0b3c67ecfd38493d,
                ])),
                Felt::new(BigInteger256([
                    0x9d1bf888f69b32ce,
                    0xc3386ef72359b881,
                    0xbe1c9574241ed6fd,
                    0x050f32809038d976,
                ])),
                Felt::new(BigInteger256([
                    0xf812f7793234ad99,
                    0x1d1517187ea9ae1a,
                    0xeaccdb50195e0450,
                    0x0d70d69b7eabcabd,
                ])),
                Felt::new(BigInteger256([
                    0x81db707bc4717b65,
                    0xe4183e852b74fe8f,
                    0xeb498b22c8dd6d46,
                    0x098fd2541c474759,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xe504c7f6e7e2469d,
                    0x39ee8b355c13d1d2,
                    0x41fb02fec72bc4f6,
                    0x07973909a4a912fb,
                ])),
                Felt::new(BigInteger256([
                    0x585f6b75ff9e1980,
                    0x8ae51348305dd9bb,
                    0x967114aa8a4729c1,
                    0x100237572a484b29,
                ])),
                Felt::new(BigInteger256([
                    0x94536ad91f9045c5,
                    0x19c25285330a25b3,
                    0x570ffb9ad4cb99cb,
                    0x0b5256e2617aa8e3,
                ])),
                Felt::new(BigInteger256([
                    0x561311c664634a16,
                    0xe213ec9fd531b6e2,
                    0x4bf90ec49d1cd12d,
                    0x0b72640e4229c92b,
                ])),
                Felt::new(BigInteger256([
                    0x38c5cf71da49da76,
                    0x98cf51e8481a6358,
                    0xc6b5546e32f5596f,
                    0x0f511cca8e841525,
                ])),
                Felt::new(BigInteger256([
                    0xa42f520761027a2f,
                    0x126845f71bf30c78,
                    0xb0745720f2f05fcc,
                    0x025d022295b5751f,
                ])),
                Felt::new(BigInteger256([
                    0xbdce90889d99e10e,
                    0x35eb4adf3964b8df,
                    0xb5cd0818066dc47b,
                    0x06cb947880208607,
                ])),
                Felt::new(BigInteger256([
                    0x318afa102e8b8db2,
                    0xa5169cb0d2abaa3a,
                    0x28e6d4643f3feec6,
                    0x1233ba3b706f9299,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x9c2935a63aea9adb,
                    0x67bcfe8dd453713f,
                    0x41f42b47a9c118ae,
                    0x01713329c9aa16bf,
                ])),
                Felt::new(BigInteger256([
                    0x5cfba403e2c86fa8,
                    0xf4a436a626e7e68d,
                    0x3855b3fa39cf9726,
                    0x11d412b9ed7cac9c,
                ])),
                Felt::new(BigInteger256([
                    0x8d569288fdf39ccf,
                    0x012e319dd3af07b0,
                    0xf8292c748317fefa,
                    0x0921aaa04f6b2b72,
                ])),
                Felt::new(BigInteger256([
                    0xde8f7ad2438816b0,
                    0x186d2665f8bcc642,
                    0x3a82ec2f3bd19b50,
                    0x117bd60177fd2029,
                ])),
                Felt::new(BigInteger256([
                    0xcbc416da460bb814,
                    0xbfaffa817be83819,
                    0x5adb8db5e1ede999,
                    0x0b39035155c0cacb,
                ])),
                Felt::new(BigInteger256([
                    0x5b13094311df03e1,
                    0x7182a4f57ca2fd8e,
                    0x8a3d3c67ce2892f4,
                    0x10e7528926e2d3a1,
                ])),
                Felt::new(BigInteger256([
                    0x1def91645ed674b4,
                    0x9ee661ec50bf9c64,
                    0xd660ca38cb40548a,
                    0x118d0ab950988dcf,
                ])),
                Felt::new(BigInteger256([
                    0x863fe101659a5e9a,
                    0x37f390ca5697be7c,
                    0x353c87b7560ed61c,
                    0x0f067e2b9f539c78,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x348037d65a2601ba,
                    0x0e7bb6f673d5e1ef,
                    0x6894b02f9457cb58,
                    0x0888e6b6a095ad7d,
                ])),
                Felt::new(BigInteger256([
                    0xf2e12b7bce4a3125,
                    0x8ce23776d915b98b,
                    0xdd1ad998b3cf8971,
                    0x08d24b645d887b1c,
                ])),
                Felt::new(BigInteger256([
                    0x6810c0d3b6d0cd04,
                    0x0b95bb2c458c5ab6,
                    0x1c55f1e7df7ad830,
                    0x0a13444a53a0766a,
                ])),
                Felt::new(BigInteger256([
                    0x8c5b835791260536,
                    0xd389f24b0233d4cc,
                    0x2232580aedf6572b,
                    0x10d177dc8fa149c4,
                ])),
                Felt::new(BigInteger256([
                    0xd9104baba0408c40,
                    0x624c8a6a869328a1,
                    0x67fad8f1771aab23,
                    0x00159f8fb909a8d7,
                ])),
                Felt::new(BigInteger256([
                    0x7991b273bd59d78b,
                    0xa126a845e1700838,
                    0x2b9d18b8e6b27a7b,
                    0x0a9f6ee1b8e73b57,
                ])),
                Felt::new(BigInteger256([
                    0xcda627eaef688132,
                    0x35fde411900c89dd,
                    0xea6d9611f1d1136f,
                    0x03ce9cf0cae0fa50,
                ])),
                Felt::new(BigInteger256([
                    0x2e7aab6150a8ea5b,
                    0xa2ea1a46d21e0b9d,
                    0x62651633b37bca7e,
                    0x1262013381cfa0f5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x205870047f11f228,
                    0xf86be92405185949,
                    0x66d7355262bb07d7,
                    0x04a963621fe447cd,
                ])),
                Felt::new(BigInteger256([
                    0x57c0076a76faeab6,
                    0x8312cebcff1b5db1,
                    0x269a5f613ba91cef,
                    0x076cf8a3439c15a5,
                ])),
                Felt::new(BigInteger256([
                    0xc1c8ba6e536e8c3b,
                    0xeaa78c90487b72d6,
                    0x7922160896f0dae9,
                    0x1008ce232616d56c,
                ])),
                Felt::new(BigInteger256([
                    0x2b290e01b6d764c1,
                    0x59afcafb6eb8001e,
                    0xaf4f08ab36077e14,
                    0x10de398e31987193,
                ])),
                Felt::new(BigInteger256([
                    0xbe711782319744d8,
                    0xca789405df11e055,
                    0xc98f318956d446bb,
                    0x0245cfd0d6d3f136,
                ])),
                Felt::new(BigInteger256([
                    0x39ab98f893890c86,
                    0xe6d0cf163f0f6ec7,
                    0x3389e7f47067eb7b,
                    0x0651bf9c1e9b0add,
                ])),
                Felt::new(BigInteger256([
                    0x0aa4ff32f4c886ef,
                    0x537b94cae2e8da56,
                    0xcd6897fad7056b48,
                    0x1136f7af2825d160,
                ])),
                Felt::new(BigInteger256([
                    0x6a4b83a82b403f09,
                    0x0790402dd880277f,
                    0xcd1b76b0ece658eb,
                    0x0f2861b70d88514b,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0d783c999fda6085,
                    0x461d4f48338b49fd,
                    0x9391bdc6731c01ff,
                    0x0215eec5dbd9aaae,
                ])),
                Felt::new(BigInteger256([
                    0xbf3cf7a318fad154,
                    0x0220752ac48f0e4c,
                    0x73aaf82b11401f1a,
                    0x0aa6bb3c5492580b,
                ])),
                Felt::new(BigInteger256([
                    0x6d191cde26c017ef,
                    0xbc02409f9f179c1f,
                    0x13e617ebb6bf3fdd,
                    0x04651a7f2fea32e3,
                ])),
                Felt::new(BigInteger256([
                    0x44f22862ac745ca8,
                    0x51aadc5fb8d1898e,
                    0x5934b1e93e011a52,
                    0x0d29f878ea9e7680,
                ])),
                Felt::new(BigInteger256([
                    0xcf56b6abeec7c2f7,
                    0x56fd7b56bedf523a,
                    0x6035efcecfe353cb,
                    0x09bc5c59bf469b1a,
                ])),
                Felt::new(BigInteger256([
                    0x624efbb7484401f7,
                    0x2eef4c293bd3796d,
                    0xdd194ebaa169c969,
                    0x03eacf149e77c5b0,
                ])),
                Felt::new(BigInteger256([
                    0xd5af83c6d2288378,
                    0x443f5c427d938ae7,
                    0x1c6823083b9e0fbb,
                    0x09bc4438e154be0b,
                ])),
                Felt::new(BigInteger256([
                    0x5b47107a74ca3066,
                    0x07bd204e910ca03c,
                    0x33b27a8ca0ebd77e,
                    0x0b2dc625bb512132,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
