//! Implementation of the Anemoi permutation

use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 10 field elements or 320 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 10;
/// 9 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 9;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 5;

/// 1 element (32-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t -= mul_by_generator(&y2);
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t += mul_by_generator(&y2) + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3], state[4]];
    let y: [Felt; NUM_COLUMNS] = [state[6], state[7], state[8], state[9], state[5]];

    let sum_coeffs = x[0] + x[1] + x[2] + x[3] + x[4];
    state[0] = sum_coeffs + x[3] + (x[2] + x[3] + x[4].double()).double();
    state[1] = sum_coeffs + x[4] + (x[3] + x[4] + x[0].double()).double();
    state[2] = sum_coeffs + x[0] + (x[4] + x[0] + x[1].double()).double();
    state[3] = sum_coeffs + x[1] + (x[0] + x[1] + x[2].double()).double();
    state[4] = sum_coeffs + x[2] + (x[1] + x[2] + x[3].double()).double();

    let sum_coeffs = y[0] + y[1] + y[2] + y[3] + y[4];
    state[5] = sum_coeffs + y[3] + (y[2] + y[3] + y[4].double()).double();
    state[6] = sum_coeffs + y[4] + (y[3] + y[4] + y[0].double()).double();
    state[7] = sum_coeffs + y[0] + (y[4] + y[0] + y[1].double()).double();
    state[8] = sum_coeffs + y[1] + (y[0] + y[1] + y[2].double()).double();
    state[9] = sum_coeffs + y[2] + (y[1] + y[2] + y[3].double()).double();
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies an Anemoi permutation to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Applies an Anemoi round to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/vesselinux/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xe4aa6e2925b18cc9,
                    0x9dcac8cec22138a8,
                    0xa3e2fc2892417656,
                    0x0c12b0421160139e,
                ])),
                Felt::new(BigInteger256([
                    0x5840ac5d137f9c5b,
                    0x9f199f50ea81cb9c,
                    0x5c2c975bf791774d,
                    0x116036d899d800d8,
                ])),
                Felt::new(BigInteger256([
                    0x38f99427aff877fd,
                    0xdedcf1ea887ea709,
                    0x6ec568852a5aa017,
                    0x009278a11ce35ed8,
                ])),
                Felt::new(BigInteger256([
                    0x510102a4d3ce4b9a,
                    0x2a6b58c8c72cccfe,
                    0x9d923b777fa5a8c9,
                    0x0ed378fbb7762094,
                ])),
                Felt::new(BigInteger256([
                    0xb9fb45a0b055d246,
                    0x5bf016b02f36eefb,
                    0x46e986fd6fc54f5f,
                    0x0db297b25f35620b,
                ])),
                Felt::new(BigInteger256([
                    0x9beac08a3333a30e,
                    0xe378767f9a96812c,
                    0x4a5ff9bb16dd7950,
                    0x0213709bc090f43d,
                ])),
                Felt::new(BigInteger256([
                    0x32b8bbb91125c5fa,
                    0x997040dbd33e9525,
                    0x88067f4aa6400254,
                    0x029f688d5c3117f5,
                ])),
                Felt::new(BigInteger256([
                    0xe43a63682dd8f7e4,
                    0x51d295540f0791b1,
                    0x71a2bee3ed2ab989,
                    0x0eb8443295af6cf6,
                ])),
                Felt::new(BigInteger256([
                    0x9e6f66c192a8b88f,
                    0xe10d822cf80c7c61,
                    0xa6a5d164c4a60ddb,
                    0x112e8510e44d6cb3,
                ])),
                Felt::new(BigInteger256([
                    0xde734c0d8da52a92,
                    0x5e1995832e0aed29,
                    0x978ceca13c44a1dc,
                    0x05fee478b78e3e92,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x75105f6ab26d812d,
                    0x4a678a418cd6b874,
                    0xab2d2327529343f1,
                    0x03964fcd9f491f8a,
                ])),
                Felt::new(BigInteger256([
                    0x94196c392a6c689d,
                    0xcecc5bcb259b57e4,
                    0xd6f01860a602e277,
                    0x06044fba19546bf0,
                ])),
                Felt::new(BigInteger256([
                    0xd16a154a13ad6802,
                    0xbd28acb057fdb235,
                    0x48912e2f40e10b70,
                    0x02166a0cf33857b1,
                ])),
                Felt::new(BigInteger256([
                    0xa88e5ceebba4ea32,
                    0x05f4999496499dbc,
                    0x47326b5cb0718208,
                    0x094a598a18cfeac9,
                ])),
                Felt::new(BigInteger256([
                    0x3eeba2d5eaea55db,
                    0xa578ca2c7de26ab3,
                    0x0a6b30ac31b1dd44,
                    0x00c687bf04c97a10,
                ])),
                Felt::new(BigInteger256([
                    0xe328a40b133393bb,
                    0xe89ca6dcf2830103,
                    0xe1df79215bb26806,
                    0x09609303ee1dd72a,
                ])),
                Felt::new(BigInteger256([
                    0x07d5589b52f11c17,
                    0x93aacae2845cde0f,
                    0x70bdd92b1e92667f,
                    0x0ce8d11ed2141dae,
                ])),
                Felt::new(BigInteger256([
                    0xb7e01f730186ceed,
                    0x491f8c3001735ef6,
                    0xf44ca5dc2b8830a4,
                    0x04dd6fe518a34f6b,
                ])),
                Felt::new(BigInteger256([
                    0x7f8a342027bdfe8c,
                    0x73b22b290d445125,
                    0xd332ce8264aa8fd2,
                    0x0786e6f42ee06932,
                ])),
                Felt::new(BigInteger256([
                    0xaf570ed94990b864,
                    0x3868d17acaf9c1f6,
                    0x738b1a1e07196b21,
                    0x11c279a03f6bff78,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x1801cfe06c4711d9,
                    0xa7015bf31023eeca,
                    0x3b5e229882f983f9,
                    0x0eafc71b8a21afa8,
                ])),
                Felt::new(BigInteger256([
                    0xd2797092db2ce56f,
                    0x1247ce257d2d98df,
                    0xcb6e24722facbed9,
                    0x0712212ed2435e1e,
                ])),
                Felt::new(BigInteger256([
                    0x090332f4e7c4cca2,
                    0xbca80d7223d1a6fa,
                    0xc4b2a734707c830e,
                    0x077e27343cacb991,
                ])),
                Felt::new(BigInteger256([
                    0xa69915162532abb0,
                    0xe04cfe86e2288a87,
                    0x881e57944f1e92c0,
                    0x07c8084e8706d049,
                ])),
                Felt::new(BigInteger256([
                    0xd02bdd17ccc71913,
                    0x6e7153304a7c6f31,
                    0xdc62ae26ddd64633,
                    0x0deda1bf19e495b5,
                ])),
                Felt::new(BigInteger256([
                    0x53dd595b6acbe219,
                    0xbdc1c84d1a5bb022,
                    0xcb46c7c6eb9c5652,
                    0x095e2323cbc5341b,
                ])),
                Felt::new(BigInteger256([
                    0x7b9aa6a80ec44fa1,
                    0xbfc7cc5b530355a2,
                    0xb2dd505d0bf9266a,
                    0x1176e693340cca54,
                ])),
                Felt::new(BigInteger256([
                    0x6393964fc9b2d0ed,
                    0x9d1b56dbc80478cc,
                    0x43193d9283714574,
                    0x01d9a2ba8fbd18a4,
                ])),
                Felt::new(BigInteger256([
                    0xa19691ac15386e69,
                    0x10e534a71aa37289,
                    0x2c4a4c1adbe6aafa,
                    0x102bcde25db989d3,
                ])),
                Felt::new(BigInteger256([
                    0x57a261c74c7c2490,
                    0xd623353c49f95034,
                    0x5ea206351f7ef019,
                    0x013a6cd91a7ecb97,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x824c044e09b6013d,
                    0xd1a1861febabe658,
                    0xe871b4c9865eae23,
                    0x099a253fd54451d5,
                ])),
                Felt::new(BigInteger256([
                    0x8d14c196fe01a748,
                    0x21f36a19906d5c39,
                    0xd45b4e42e690ffeb,
                    0x125ecc1b5fc057bc,
                ])),
                Felt::new(BigInteger256([
                    0x810a4d954798f020,
                    0xc37ceaa60383e5d1,
                    0x099b33724bb5e216,
                    0x079a7d55ee66f936,
                ])),
                Felt::new(BigInteger256([
                    0xae29496f1c30a4d6,
                    0x890e4b4e34700b50,
                    0x8a62418b9a0935c4,
                    0x04d9f41aab0925bc,
                ])),
                Felt::new(BigInteger256([
                    0x69c9f73ebf685fec,
                    0xb7daf1171fe78ef7,
                    0xd981e80cc9691c9c,
                    0x043ec20febbe2586,
                ])),
                Felt::new(BigInteger256([
                    0xf741f4d63be3f49b,
                    0x444ba96fc56c9a07,
                    0x9a2b282d7dc8f4f6,
                    0x0ab91de59d91e945,
                ])),
                Felt::new(BigInteger256([
                    0x28c956a7798064a0,
                    0x51e3262199d4954a,
                    0x36c05c883b4d13d7,
                    0x0e38683ff58a0877,
                ])),
                Felt::new(BigInteger256([
                    0x53f03dea11aee62f,
                    0x3b828856750ad693,
                    0xa4d95d412c850912,
                    0x03704c9be50d6469,
                ])),
                Felt::new(BigInteger256([
                    0x162aa2ded0926f15,
                    0xca03e59cf2874c58,
                    0x4717e429c83cc36d,
                    0x101612fd60012fc2,
                ])),
                Felt::new(BigInteger256([
                    0x0dd2973214e6c32d,
                    0xb016014bd7430dbe,
                    0x867f6b76324f6710,
                    0x09dcb3c0e40121d4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x8b539fda69a3b84a,
                    0x831fbda3dca40c64,
                    0x360ee5b1ceb1a3c5,
                    0x098be6f86dd67347,
                ])),
                Felt::new(BigInteger256([
                    0x72200df1d1b74950,
                    0xa6e52c9a8b8b3606,
                    0xf473ff7e7cd857a9,
                    0x096e33cf2a1ee5c1,
                ])),
                Felt::new(BigInteger256([
                    0xbe561c41134c6730,
                    0xf2819d07d8558a6a,
                    0x696d1912b9ab34e1,
                    0x0ced1adc504606b5,
                ])),
                Felt::new(BigInteger256([
                    0x7319a3c258a237f1,
                    0x74ef4e861b0486b9,
                    0x2f2dca6cbbd85532,
                    0x0ac269d0b6a809f0,
                ])),
                Felt::new(BigInteger256([
                    0x65636e07e49af0e4,
                    0x62f143247119ae1d,
                    0xf60afe5d3d675ddb,
                    0x033796c961b9f1ed,
                ])),
                Felt::new(BigInteger256([
                    0x5b740ad766ea40b5,
                    0x6741e0984844b328,
                    0x683881befb614817,
                    0x03b6e498a7749811,
                ])),
                Felt::new(BigInteger256([
                    0x9f176160598375a0,
                    0x1e78018a945b3041,
                    0xb52b38f06327e7c7,
                    0x0ee3c29d42427389,
                ])),
                Felt::new(BigInteger256([
                    0x38e0b8fc10c3ae2d,
                    0xb627703e5de2c0cc,
                    0x87d5ec98a9f6ca84,
                    0x098419cf93a6d6f1,
                ])),
                Felt::new(BigInteger256([
                    0x924caf7394b47ce8,
                    0xeb7881f47bd502de,
                    0xe09d9063bf35edea,
                    0x03816200ed6c6e9c,
                ])),
                Felt::new(BigInteger256([
                    0x9ded6660987005c1,
                    0xc61d53346b5f1e3c,
                    0x53de86640ed37d7c,
                    0x0d6c1cdca838e6af,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x35ae7560e775f425,
                    0xccee3ef9094a494c,
                    0xd66a066f643fb2e8,
                    0x0f3bae5d67ee2d5f,
                ])),
                Felt::new(BigInteger256([
                    0x7f49e1b8bc23ff88,
                    0xee531fda0a0015f5,
                    0xfc0427d049762054,
                    0x1191990a7e96a302,
                ])),
                Felt::new(BigInteger256([
                    0x9a25fe3c89983f0a,
                    0x1e7a8685b8e46216,
                    0xf564011a3252af8f,
                    0x0630e38b5892355f,
                ])),
                Felt::new(BigInteger256([
                    0x64f5abf908d28845,
                    0xe2dee9b627db86e4,
                    0x28c06421f19388d9,
                    0x05e0125811d125e8,
                ])),
                Felt::new(BigInteger256([
                    0x058e86b0df38ac4a,
                    0x0ce11093235807c9,
                    0x90141283875af548,
                    0x03cbcbce55316184,
                ])),
                Felt::new(BigInteger256([
                    0xead8e0648516e3d6,
                    0xd494b5b02594b977,
                    0xf9a3bc0b7ac3d43a,
                    0x006070b3d0203bbe,
                ])),
                Felt::new(BigInteger256([
                    0x55d4cff3f3c7ff3a,
                    0x1fd1b002d9c84e8f,
                    0x0890cbfb0d78e679,
                    0x0c2e880306bfc159,
                ])),
                Felt::new(BigInteger256([
                    0xe9daef32c8530af1,
                    0xe875166bfdd6699d,
                    0x6e7460b9149a7725,
                    0x108d7938d38e67fb,
                ])),
                Felt::new(BigInteger256([
                    0xffbee202c9fc0e09,
                    0xf1752412e3da00fb,
                    0x34a5488d3b659860,
                    0x0223524b48cf13e8,
                ])),
                Felt::new(BigInteger256([
                    0x8cdc0d9668b04256,
                    0xa27266922113f40d,
                    0xa8ed8a8b761f995a,
                    0x03c6996413777801,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::new(BigInteger256([
                    0xb76f9745d1745d17,
                    0xfed18274afffffff,
                    0xfce619835b36a173,
                    0x068b6ffd78dc8d16,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0x547eaa4fe92c17b5,
                    0xdbdc56d3eeee3424,
                    0xd4e029a17d9b9417,
                    0x0e71b0e9185f0412,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
                Felt::new(BigInteger256([
                    0xd66a1b1b52ed0c94,
                    0x7350e41fff172b46,
                    0xdee8ec7bf3d076d4,
                    0x08092cd96d87788d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0xbc9fbddce41f262d,
                    0xdd9574526d0633f2,
                    0x74ab4b549cae7cc8,
                    0x00f4b6647a675f0c,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
                Felt::new(BigInteger256([
                    0x86ef9156cec705ed,
                    0x31911e672304df9a,
                    0xdb1cd013ebe897a2,
                    0x110866f6f86e425d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x53e71745d1745bdc,
                    0xaa1116eabffffeb8,
                    0xff0b3527e2b10fca,
                    0x0da5b495c3ed1bcd,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
                Felt::new(BigInteger256([
                    0x8cf500000000000e,
                    0xe75281ef6000000e,
                    0x49dc37a90b0ba012,
                    0x055f8b2c6e710ab9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa11489d8d3fe0292,
                    0x0a0835bceaf03761,
                    0x12dee15de90a5fb1,
                    0x0f6e33969969a16a,
                ])),
                Felt::new(BigInteger256([
                    0x2fe030db5a4108e5,
                    0xfd01377273dc915a,
                    0x94d1bfd7d5bb79ef,
                    0x0adab8322139ee88,
                ])),
                Felt::new(BigInteger256([
                    0xd81371892088556b,
                    0xc3262a4b458e9931,
                    0xd112397af3020632,
                    0x056fd5f948e6e030,
                ])),
                Felt::new(BigInteger256([
                    0xf8afaa17321e2b6a,
                    0x2d1f561855afcb2b,
                    0xfbc25e57dd7cd7af,
                    0x11af284904500ba9,
                ])),
                Felt::new(BigInteger256([
                    0x6207c408afe6c1ef,
                    0x7eae56c490c35610,
                    0xddc4bce98372b1b5,
                    0x043cc7c35d29926d,
                ])),
                Felt::new(BigInteger256([
                    0x16927fb0609d5d3e,
                    0xcdfed7ac211d6010,
                    0x7699542e7eb8b58e,
                    0x09c79fa5b5e3e97c,
                ])),
                Felt::new(BigInteger256([
                    0xf29301170035154d,
                    0x4e0eb23691682fca,
                    0x8aecae85bd364fa7,
                    0x0acfbc17180a8868,
                ])),
                Felt::new(BigInteger256([
                    0x9ec909391b4111f3,
                    0xa8a481e0bd55b65b,
                    0x0a036f1e7e6fcb00,
                    0x027a22e2e1468f1a,
                ])),
                Felt::new(BigInteger256([
                    0xaeb0b7ab43529591,
                    0x6ecf27e48484426a,
                    0xac6643f72894a85c,
                    0x121a9f9a422bd84d,
                ])),
                Felt::new(BigInteger256([
                    0xb1f99b643cf89c39,
                    0x089ee25e1840ce6e,
                    0x751624ce7b7df0c3,
                    0x04722c362201aa96,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xdc95f05b3601ce63,
                    0xe81f144f7968e683,
                    0x7133e705c0f77a22,
                    0x071b6dc652bb1905,
                ])),
                Felt::new(BigInteger256([
                    0x5f2253e176230762,
                    0x46f72db70f24aded,
                    0xdb42d0c4a61a4072,
                    0x0151da82d70c6014,
                ])),
                Felt::new(BigInteger256([
                    0x4f551a1e21906d97,
                    0x5fecb14402918b44,
                    0x0adbe3d264ddecde,
                    0x0efcc182fa567341,
                ])),
                Felt::new(BigInteger256([
                    0x02a757b9597351dd,
                    0x4f2d84ec5965c2e9,
                    0x9b11187717690e79,
                    0x10d5b3cca3859bc3,
                ])),
                Felt::new(BigInteger256([
                    0x18450076045d9212,
                    0x5ce55d212df1876f,
                    0xc0fdfcacd2705bab,
                    0x0c57d9a5d5a035ba,
                ])),
                Felt::new(BigInteger256([
                    0x196c20cb5573bb40,
                    0xda43aa8dd4607d67,
                    0xd82596a718f9ba59,
                    0x07a492889b250f2d,
                ])),
                Felt::new(BigInteger256([
                    0x48d19fd3e1fec31e,
                    0x92c41a5a8b7ea96d,
                    0x8719c0e57935eb8e,
                    0x10ecf1f66960a09e,
                ])),
                Felt::new(BigInteger256([
                    0xb9f836dd50d89b99,
                    0x5cd0ef8f50ff7961,
                    0x44f764b15afb0518,
                    0x0d145355011440d9,
                ])),
                Felt::new(BigInteger256([
                    0xd385ed5a420d728b,
                    0x887b3d8ec2577478,
                    0xc8bc056373ebeba1,
                    0x028ca7d43bff55f6,
                ])),
                Felt::new(BigInteger256([
                    0x48c0b2d3c6041ad4,
                    0x9d91ee844d456519,
                    0x7a57aad436d95af3,
                    0x06e82afbff2c0879,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xfd66312bc5e175cb,
                    0xbd889f186fa2da68,
                    0x8d24def8b4b3ac58,
                    0x11919a1629b76fc4,
                ])),
                Felt::new(BigInteger256([
                    0xd5428cf1172c1df2,
                    0xcac0f8835cc16d5b,
                    0xbe6986d13b7c0e49,
                    0x0e58fa91e74fc35d,
                ])),
                Felt::new(BigInteger256([
                    0x3b120649d76218e0,
                    0xd9d4e9ab2cf49b3a,
                    0xcc32b229e3437d99,
                    0x05c410745a82c878,
                ])),
                Felt::new(BigInteger256([
                    0x95e99fdc00c38acf,
                    0xf9c744ec1eee44ab,
                    0xb8ace1d46464af75,
                    0x05cf54c336ba0c7b,
                ])),
                Felt::new(BigInteger256([
                    0x16b0137d9594146c,
                    0x81484610ec73ea3f,
                    0x2134230de4161a7c,
                    0x12402b83593e2921,
                ])),
                Felt::new(BigInteger256([
                    0x758c458a5caa15bc,
                    0xb7a2aec3fdd18d60,
                    0x2d994eb0488dfc43,
                    0x0500e05d7fa37c8f,
                ])),
                Felt::new(BigInteger256([
                    0xf54f64702d2b2a02,
                    0x9813305246010c64,
                    0xcba0d563b2375e7c,
                    0x09e0119a479a03f4,
                ])),
                Felt::new(BigInteger256([
                    0x4a55e2c70a2dd8f7,
                    0xb995977aeb31c19a,
                    0x6d5cb5fd65e4634a,
                    0x027812d484081dbc,
                ])),
                Felt::new(BigInteger256([
                    0xff9d34cc4aaa9da8,
                    0x84c4354e1b998452,
                    0x9102069d41c824e2,
                    0x04fd15f7070e065f,
                ])),
                Felt::new(BigInteger256([
                    0xe65c5d9fd543aa2f,
                    0x887d6ae52f3e252f,
                    0x9b820183c2a3f3d4,
                    0x036de4c9c964d048,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc47900a76c697c42,
                    0x161323ae6bab6f8a,
                    0xb5b1887953846a01,
                    0x0eded0e7498053b5,
                ])),
                Felt::new(BigInteger256([
                    0x8055ebaff4d68c23,
                    0xfe069a3758616da2,
                    0x405dc43c5c1798b3,
                    0x1159911698aa9b08,
                ])),
                Felt::new(BigInteger256([
                    0x9cd6261d7fd75ae5,
                    0xc6b06cce88a9da9a,
                    0x991b36611f759df7,
                    0x0c4fc35b058d6925,
                ])),
                Felt::new(BigInteger256([
                    0x24d2e6d5c7c0c1ff,
                    0xa1666f15149a154b,
                    0x539d2351eef204f5,
                    0x0d836c6e70781e47,
                ])),
                Felt::new(BigInteger256([
                    0x523f9a7e712b851e,
                    0x4b5ba1a3cf02aefc,
                    0xf9a2cf3fe618a6dd,
                    0x05b0048a2c147461,
                ])),
                Felt::new(BigInteger256([
                    0xc0df6e11a9f58e14,
                    0xb9f6c4f14744a8b4,
                    0xd139b9c166a4cc43,
                    0x07d16cb6ebd2ed11,
                ])),
                Felt::new(BigInteger256([
                    0xd1bc11945d0d11ce,
                    0x2c1c4cf2e3e4fb08,
                    0x492d2516ddf2ab3c,
                    0x0c2f83310fe79254,
                ])),
                Felt::new(BigInteger256([
                    0xfc7a27fe8aedf4a4,
                    0x4b976dd59d8ea52a,
                    0xa16ff81ad4b90941,
                    0x00f990d8c24d2f7f,
                ])),
                Felt::new(BigInteger256([
                    0x933ddf1bf97d9872,
                    0x69e13f63a9c52fb9,
                    0xdb1160bede182379,
                    0x021575cf04f8d033,
                ])),
                Felt::new(BigInteger256([
                    0x32a3a965229eccb2,
                    0xcb5d25dd11935042,
                    0x477761bbd054b46b,
                    0x0242fee1203319c2,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x76ddb70256febd34,
                    0x00041ef120489d45,
                    0x1216d9a9d28577ce,
                    0x0cff03065e21ed6f,
                ])),
                Felt::new(BigInteger256([
                    0x5876009b9dce62ce,
                    0xf112896bf6a04e9c,
                    0x4d57fc0e9da562d9,
                    0x05799f5574124f45,
                ])),
                Felt::new(BigInteger256([
                    0x90be099ac630a494,
                    0x1faa49b659a10323,
                    0xc71eb175d328f41e,
                    0x12a1e2672bd7aac1,
                ])),
                Felt::new(BigInteger256([
                    0x690f4cb204775a28,
                    0x86c21db84149c85d,
                    0xe087c64c7a507a0a,
                    0x0d452015a1541884,
                ])),
                Felt::new(BigInteger256([
                    0xdd5d5577edfeb1f5,
                    0x9566312c258bb092,
                    0x68930f1a5f77b2e2,
                    0x0f055d7efed21859,
                ])),
                Felt::new(BigInteger256([
                    0xcb7a68d9eabfe7b2,
                    0xc86dc40e572a6600,
                    0x06695ad682dfe4a3,
                    0x12a9949fa2cee798,
                ])),
                Felt::new(BigInteger256([
                    0x50ea2d4113515ef3,
                    0xb345c53fb9d9dc1a,
                    0x422e23e97417e010,
                    0x0a35a238337c7403,
                ])),
                Felt::new(BigInteger256([
                    0x361b39f2d70d7779,
                    0xd3fe42309d9269c2,
                    0x36749dd2a2ff82ab,
                    0x07f09fb942f1908e,
                ])),
                Felt::new(BigInteger256([
                    0x7fb1c8e61171ab77,
                    0x2268b04b887ade5d,
                    0xf6933d1438e710b0,
                    0x03a13052c89554a5,
                ])),
                Felt::new(BigInteger256([
                    0x382d350f47822d58,
                    0x46a766dd016f5fcc,
                    0x912e8ba19563a4e0,
                    0x01348effad2445c3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x306d68084fbc3cc8,
                    0xc2ce46b2f6175486,
                    0x3e4e2bb19c7b38f3,
                    0x0f8079df8a1ddfeb,
                ])),
                Felt::new(BigInteger256([
                    0x98c48018fadfee7f,
                    0x9e5f3fbba0cb300b,
                    0xb9d3b222e4363a7e,
                    0x0ab6a825169bbc82,
                ])),
                Felt::new(BigInteger256([
                    0x0e66e91bec575798,
                    0x076d58f9db8dc34e,
                    0x336a9ef7a8c3a755,
                    0x09ab8c22cf51ada8,
                ])),
                Felt::new(BigInteger256([
                    0x6a37e07f64d56183,
                    0x7b14ac93cb9a9519,
                    0x1a1c199227d2a368,
                    0x0e8d6154306a22fc,
                ])),
                Felt::new(BigInteger256([
                    0x1c6f4d6d7dd46ccc,
                    0x1534fa8021eab9c9,
                    0x35fc9e75e2daa0f8,
                    0x116d32d5d0f44371,
                ])),
                Felt::new(BigInteger256([
                    0xe1a73fba0e66bbba,
                    0x64bd9d618c60cb17,
                    0xcc604e919ca827bc,
                    0x11ed76b398765046,
                ])),
                Felt::new(BigInteger256([
                    0xe4a672caeb082daa,
                    0x610f591828618736,
                    0x5d3041a183cd27eb,
                    0x119d9d2b5e316a1f,
                ])),
                Felt::new(BigInteger256([
                    0x5dc1df6c92f28a4b,
                    0xa5e476e6629f74b0,
                    0x49f8dff5d71e8216,
                    0x1086daa171fbd148,
                ])),
                Felt::new(BigInteger256([
                    0xd7cf20390a70f376,
                    0x8f8e6d30aab70954,
                    0x88509d47c222e432,
                    0x06e9bbb7f8516be5,
                ])),
                Felt::new(BigInteger256([
                    0x50803284e0d2b885,
                    0x177bfeb6e78d7ad1,
                    0x76f971a1eede3176,
                    0x0d5c982aa4d99b99,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/vesselinux/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x1d72899bfa18ba95,
                    0xc00733e826e21328,
                    0x239b8c8ebd6f2e3f,
                    0x0d6f77368c80d75e,
                ])),
                Felt::new(BigInteger256([
                    0xd67d086afad2cdf2,
                    0xdc69c83cd5437cbf,
                    0xe248951f7b8896c2,
                    0x0128e2d203a44505,
                ])),
                Felt::new(BigInteger256([
                    0x69f7d7292d6aac8c,
                    0xda284383effd76e9,
                    0xccee2e40aa9ee0ef,
                    0x0f6e1ca6f912d28b,
                ])),
                Felt::new(BigInteger256([
                    0xf790b97f1cccd516,
                    0x90357b464edbc6e9,
                    0x022d055a4cc3e8f3,
                    0x1163854bf20de855,
                ])),
                Felt::new(BigInteger256([
                    0xad543c8e1cd8800d,
                    0x22d708c97b3380d6,
                    0x0274f14af21a0cb8,
                    0x0b5801594ee1851b,
                ])),
                Felt::new(BigInteger256([
                    0x3e47ad9a8a48d537,
                    0x9642f42da5bf0821,
                    0x5d47bb767dfd9962,
                    0x0456e0fcb9377bce,
                ])),
                Felt::new(BigInteger256([
                    0x0c876a08900662bc,
                    0x3ec454894db7f7b4,
                    0x2276169c133f52af,
                    0x0d62c5975e986055,
                ])),
                Felt::new(BigInteger256([
                    0x68f46fad26ee87bb,
                    0x378acbceb95d47f7,
                    0xe865d4fb8d1d44e2,
                    0x0b35d7ef8ce60083,
                ])),
                Felt::new(BigInteger256([
                    0xbd50b5060c2f695d,
                    0x3432af6f60392dd7,
                    0x26bb43284c81597b,
                    0x080b4b542ebac4c8,
                ])),
                Felt::new(BigInteger256([
                    0x4ad3f5bcab5e68f0,
                    0xa90fa514a9fe5579,
                    0xdbee332f9c00b505,
                    0x1281eac69821a7f4,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x06ccdb89799aec9d,
                    0xef03dee420111c82,
                    0x924a518027e62f48,
                    0x0a228e75cfae1c20,
                ])),
                Felt::new(BigInteger256([
                    0xb58750dc9725277c,
                    0x17f189f8a6be1d93,
                    0x0611fde6f868e6f9,
                    0x034be9a1fb8683a6,
                ])),
                Felt::new(BigInteger256([
                    0x7247011ccaf2098f,
                    0xc7eba48bcaa48c50,
                    0xe891c4dd3b36fcf2,
                    0x0294c3a198470ccd,
                ])),
                Felt::new(BigInteger256([
                    0x1af89d32bf5918cd,
                    0x44c573c59ef7f429,
                    0x515077097f13e279,
                    0x0f0769f489b6feaf,
                ])),
                Felt::new(BigInteger256([
                    0x2da3587fd645fdf2,
                    0xc2f892c029951cb1,
                    0xdff85767af1e1b40,
                    0x0a0a4a691b1d4dcb,
                ])),
                Felt::new(BigInteger256([
                    0xff43d819ddafaf89,
                    0xa1765baf110bc4da,
                    0xa421a89a5afae4ea,
                    0x0d13602ad75f8578,
                ])),
                Felt::new(BigInteger256([
                    0x5c603857150174f1,
                    0xc084bf935d34cfbb,
                    0xd61314cac4fce33d,
                    0x1033b8ee614450da,
                ])),
                Felt::new(BigInteger256([
                    0x6340341c0b5266c9,
                    0x686493aba45473a4,
                    0x503cd251f0f00c86,
                    0x10dc029a8fef6773,
                ])),
                Felt::new(BigInteger256([
                    0xfda3ac0dc6656fe3,
                    0x8eebc847999939c8,
                    0x13ae842c6f2a7dfd,
                    0x01b61d6776660828,
                ])),
                Felt::new(BigInteger256([
                    0x97e2c8d039d41d4b,
                    0xe651bc5077993fb0,
                    0xb0c35dea53cf4a0a,
                    0x02491df0ff38d5ee,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xce075e6ef1d6fffc,
                    0x9318b624891f3b9b,
                    0xb2b1d7a6b0127a1c,
                    0x0996c4afb1aeebcd,
                ])),
                Felt::new(BigInteger256([
                    0x1d9228c4db2d0005,
                    0x0d214ca91d9f2825,
                    0xff28d29cb5c29ea3,
                    0x04f13a881f60f19e,
                ])),
                Felt::new(BigInteger256([
                    0x7b7226964a96289a,
                    0xd7b9c7b6472b8d7e,
                    0x0bddc0542615defd,
                    0x04df94b0cffa73d0,
                ])),
                Felt::new(BigInteger256([
                    0xd93337a4848f2c26,
                    0x73c90bf4200de47d,
                    0x886fdb59861cd719,
                    0x120399c39131e505,
                ])),
                Felt::new(BigInteger256([
                    0xab6b4fcd1bf75192,
                    0xe3a1c19cb56767fd,
                    0xc6b12d4304265baa,
                    0x121ed3448f68685b,
                ])),
                Felt::new(BigInteger256([
                    0xc82b95cebd02e7ff,
                    0xf05b7c3d9691f3b7,
                    0x8b0a45cfbaf38624,
                    0x03dee1e0d33f626f,
                ])),
                Felt::new(BigInteger256([
                    0xef7a9304489c93de,
                    0xfb02321be12f52e6,
                    0xfee20f55c98411e3,
                    0x0cf6cbe6d300edee,
                ])),
                Felt::new(BigInteger256([
                    0xa5c3e24d210faa56,
                    0x7188c33607cbb776,
                    0xf5bd4c176fce2db9,
                    0x012371822736f5a1,
                ])),
                Felt::new(BigInteger256([
                    0xefaa7b29cb437c85,
                    0x69c3ae0e0c90e8e5,
                    0xe1a1b45fb50a33ae,
                    0x04a3170d8e0612d1,
                ])),
                Felt::new(BigInteger256([
                    0x119487ad067a30e5,
                    0x4f09fabebbfe0a93,
                    0x466543a9d57cf516,
                    0x0a19eeca91afab3f,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x15115b419d4b8ee7,
                    0xb749aad44d243318,
                    0x7df2a0c1d980c1b5,
                    0x09ab7ee4ae371398,
                ])),
                Felt::new(BigInteger256([
                    0x35f23d4c109aef10,
                    0x26566e949165de18,
                    0x05dedc585f3493b9,
                    0x0815182dbedaa282,
                ])),
                Felt::new(BigInteger256([
                    0x6de2c40cd6fa2e9c,
                    0xe96af5c9367b22be,
                    0xcb429e46854e0317,
                    0x07657cef2f261e9e,
                ])),
                Felt::new(BigInteger256([
                    0xb362c74d411e67a6,
                    0xc0ad3c9a221350b3,
                    0xb995990ff4e7fc0a,
                    0x021fcdcd09d90be3,
                ])),
                Felt::new(BigInteger256([
                    0xce074955b96527fb,
                    0x39aa406bd3a05038,
                    0xbb6e46bb6a3c4267,
                    0x0a330b45434142f7,
                ])),
                Felt::new(BigInteger256([
                    0x9083dc52c143ff44,
                    0xd3682fc26afae59a,
                    0x072d219dab5e0ae4,
                    0x0ce87186bc18c60d,
                ])),
                Felt::new(BigInteger256([
                    0x37706178de40f052,
                    0xe9576dfe87a1aa22,
                    0x2cf360451b61e151,
                    0x04d22fad3b4267ad,
                ])),
                Felt::new(BigInteger256([
                    0x73262a764a663aa1,
                    0xccf0f5194ceec5c9,
                    0x6f2205933ceab959,
                    0x0c51bfeef15b0ac2,
                ])),
                Felt::new(BigInteger256([
                    0x5873eda098ab4bcd,
                    0xd84380f264ed736e,
                    0xfab3b7e11c4b2fb2,
                    0x000f1b1564143c38,
                ])),
                Felt::new(BigInteger256([
                    0x1febe0eddf311c4c,
                    0xa06c8480dec48f74,
                    0xf0a9c592f2f9df5e,
                    0x0df19d752d17d493,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb41bc0901bd1c5ec,
                    0xbe26830427d339d9,
                    0xce58713529de4523,
                    0x0d3731e105baaa7c,
                ])),
                Felt::new(BigInteger256([
                    0x9c9d8b552469881b,
                    0xb02b97c136d70673,
                    0xf2744ad90dd8f8d6,
                    0x097d047a3eeed61b,
                ])),
                Felt::new(BigInteger256([
                    0xf879577ef78a9433,
                    0x5354579ad38163a1,
                    0x1a18ede3a72e9c4e,
                    0x0c61412b8abc46bb,
                ])),
                Felt::new(BigInteger256([
                    0x52a33ddfa8c83171,
                    0x00f48a8095b547e5,
                    0xa746ce301a0cddef,
                    0x0e7fbaa900e74aa6,
                ])),
                Felt::new(BigInteger256([
                    0x4255638da6fd079c,
                    0xe9db59b1e4d11ea9,
                    0xefdefad4231d12de,
                    0x024f4a1f8c2c449f,
                ])),
                Felt::new(BigInteger256([
                    0xcaa23f0dc8c827d0,
                    0x2ff28e7af23b63fe,
                    0xfdc475b07e126268,
                    0x0eb4f829f1c55580,
                ])),
                Felt::new(BigInteger256([
                    0x4a7c755211939eee,
                    0x95b2ae896d70ce64,
                    0x910089d1e555b742,
                    0x07b518553d19c2b2,
                ])),
                Felt::new(BigInteger256([
                    0x85e3d7102ba6cf06,
                    0xa16e1175217be81d,
                    0x05beb7239c992d43,
                    0x119d7e832f21dc90,
                ])),
                Felt::new(BigInteger256([
                    0xf96c9613debd2182,
                    0xba82d8f706418975,
                    0x50713d7f21012b71,
                    0x000f1373170b320a,
                ])),
                Felt::new(BigInteger256([
                    0x51d28bc5fe3d3efe,
                    0x3cb05c3ca81091c5,
                    0x3543da3aa0e18daf,
                    0x0045fc982deedc77,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3852fa1af58aa633,
                    0x3441d9462767b274,
                    0xfc3171e1bd0efe02,
                    0x07863df3a774771b,
                ])),
                Felt::new(BigInteger256([
                    0xabc403f824a99ff1,
                    0xd5b4d3547b8b1504,
                    0x6f703474bd8a31a9,
                    0x029d1862ce41c9ed,
                ])),
                Felt::new(BigInteger256([
                    0xde9e320ab874b0f7,
                    0x1ca7ce18d999b290,
                    0x8300cb92eac0287a,
                    0x0e066f239bda0111,
                ])),
                Felt::new(BigInteger256([
                    0x2c867333907d44c1,
                    0x9ecb45b9820b410e,
                    0x403a65d5a495cf8f,
                    0x0a0139b760183a66,
                ])),
                Felt::new(BigInteger256([
                    0x900d40a544efcc29,
                    0x18ac2092caff23d1,
                    0xc5e1fd4c8472a768,
                    0x1241b921dfc6b1f6,
                ])),
                Felt::new(BigInteger256([
                    0xab5d8e8abcd5116a,
                    0x0a526cd3d03aafa9,
                    0x25cc349ddc757e77,
                    0x033c2308d20d8c3b,
                ])),
                Felt::new(BigInteger256([
                    0x10d9fc9c5edaff1c,
                    0x85858d744046e8c0,
                    0x927c91220742cc9f,
                    0x03b378d6c9abd22f,
                ])),
                Felt::new(BigInteger256([
                    0x59e2c6d753179d03,
                    0xa5cd2ce9dec25769,
                    0x78bac81c35d3d39d,
                    0x110bd4cadd9b09f3,
                ])),
                Felt::new(BigInteger256([
                    0x208c14e8e90e141b,
                    0xb9cc4c2b2e111c17,
                    0x45d66031528e440c,
                    0x101ed9e6c4eb7797,
                ])),
                Felt::new(BigInteger256([
                    0xd0a7ea358553e94f,
                    0x5cdd607b0fd9f7bb,
                    0xd3c1c50e52e7bf66,
                    0x09d10c3cb1a60b16,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 10],
            [
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::new(BigInteger256([
                    0x7cf17fffffffff41,
                    0x19d137e2cfffff39,
                    0xd97a76593273aefe,
                    0x121f5e6af8b0a48d,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x0e102c45809962ba,
                    0x994a39c54f8e9473,
                    0xbaa075208c396b2b,
                    0x0076d639c83e5982,
                ])),
                Felt::new(BigInteger256([
                    0x15172e55d4819ed4,
                    0x8bb4754d110cab81,
                    0x0b44a1534a121ca0,
                    0x0d48587f615949ca,
                ])),
                Felt::new(BigInteger256([
                    0xd35796d96f41f1d1,
                    0x0711c7fe964d7cb0,
                    0x8c19549e03ca7ad1,
                    0x0e5f90bb7ef220c1,
                ])),
                Felt::new(BigInteger256([
                    0x187be85af6501b5e,
                    0xda3eda58c3b6c6bf,
                    0xf39b6f1fd8aac01a,
                    0x0178dbdf00fbf9a9,
                ])),
                Felt::new(BigInteger256([
                    0x71535b8b4d14800d,
                    0x8ac9dce21c20c86c,
                    0xa52d5aed0e7cdfb5,
                    0x08e59dca194e2f59,
                ])),
                Felt::new(BigInteger256([
                    0xc9a9b3bf3c68f45a,
                    0x32cb46e55c7547b6,
                    0x1c3f0f4ae651a6fd,
                    0x0dc4c9f73f1234b0,
                ])),
                Felt::new(BigInteger256([
                    0xedf8ce7e2e7c6e68,
                    0x2c7a29eab3256d3b,
                    0xbeb6a7a62416405a,
                    0x09b5188a7078635a,
                ])),
                Felt::new(BigInteger256([
                    0xbb650a16592a8382,
                    0x3d293d442126e252,
                    0x89681040eb84adc7,
                    0x127a6185f629deb3,
                ])),
                Felt::new(BigInteger256([
                    0xbe9ca943be619411,
                    0x6b1ef24e4f7849c3,
                    0x5ee9ba5d8132495d,
                    0x11612f565327995e,
                ])),
                Felt::new(BigInteger256([
                    0x9675877218b0813f,
                    0x72c27452a26b3a6f,
                    0xb92ca78338a879b5,
                    0x080b61410683688e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x1cc1df069e5889ad,
                    0xccffc25fc2863f1a,
                    0x523f1356b4544f39,
                    0x00ce19460b3fc08c,
                ])),
                Felt::new(BigInteger256([
                    0x0acb554059411244,
                    0xf179ee52e4f487a7,
                    0x98fc012baf4d14bd,
                    0x0b1d177c7495caf7,
                ])),
                Felt::new(BigInteger256([
                    0x8aaa2a43e742940d,
                    0xc90dab039856dc72,
                    0x5dc8fc0974340128,
                    0x0b67dbf998cfbcf1,
                ])),
                Felt::new(BigInteger256([
                    0x463cd15155beaa4d,
                    0xb58025d478ef9a3d,
                    0x08775e663ebc5831,
                    0x06e342f492a95a21,
                ])),
                Felt::new(BigInteger256([
                    0x68943d0ffdd6033a,
                    0x575c1aa0a34a87f7,
                    0x79183a8aff303f96,
                    0x038455da5202417c,
                ])),
                Felt::new(BigInteger256([
                    0xd800cc5eaf430e36,
                    0x7c449dca21f4c7bd,
                    0x14d76798f041ea75,
                    0x00b30c21e91ae3d6,
                ])),
                Felt::new(BigInteger256([
                    0xa2f0b4b55efa355e,
                    0x2563058b3af08e8b,
                    0x2f7911a9bea6ec79,
                    0x09626c33766e70dd,
                ])),
                Felt::new(BigInteger256([
                    0x9064e31425ea7170,
                    0xe501d258cecf4923,
                    0xd348477b02616251,
                    0x05a256e54abd41cc,
                ])),
                Felt::new(BigInteger256([
                    0xe6fff6a463ccf633,
                    0xc1da4dd681936334,
                    0xd58c073667cfb0b2,
                    0x094680c052e88f30,
                ])),
                Felt::new(BigInteger256([
                    0x4109c90d4f62aad3,
                    0x961c51fc07a11515,
                    0x49f099088567e7e1,
                    0x04c83162bb472047,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xb726688a4ad7c237,
                    0xe80babdc677da61d,
                    0x119e37c56b1cfc67,
                    0x051d4efd4d12615e,
                ])),
                Felt::new(BigInteger256([
                    0x7dd28da7dc80f33c,
                    0x873a9e6ff82e2d15,
                    0xd63d5a39b12fa41b,
                    0x104230b0ed6b80e9,
                ])),
                Felt::new(BigInteger256([
                    0xdc65133632484978,
                    0x10c82f6890086116,
                    0x0a06834c8036fab0,
                    0x09a11a133bcd73de,
                ])),
                Felt::new(BigInteger256([
                    0x9be086c157ae48bd,
                    0xbb86b6383b296356,
                    0xbba91a1062dc0694,
                    0x0fb091d2c02fdfa6,
                ])),
                Felt::new(BigInteger256([
                    0xad65d91a6079d0bb,
                    0x729f0063d457c86f,
                    0x4ae15ddd2aaae11c,
                    0x02be702ce3b846af,
                ])),
                Felt::new(BigInteger256([
                    0x6b23f28c966dff4e,
                    0x311d7bafaf7fb1ee,
                    0xe77bafc8e4478db5,
                    0x0d1811a5a2931fd7,
                ])),
                Felt::new(BigInteger256([
                    0x5bd62ace5edc3cd6,
                    0x56e48309288b2d71,
                    0x8ce860aa576392aa,
                    0x045d77bd39425994,
                ])),
                Felt::new(BigInteger256([
                    0x2c397bd5d0870889,
                    0x46eada07f7fcaf89,
                    0x0e8f4ecb9f9a275d,
                    0x09387d2640d7d3ec,
                ])),
                Felt::new(BigInteger256([
                    0xc54dc78e19e2ec6b,
                    0xa0b7a47314216153,
                    0x8a62393dc489aa2f,
                    0x05ecd831d83976c3,
                ])),
                Felt::new(BigInteger256([
                    0x973c62c2b63f6168,
                    0x0b8eb9f22d5e4575,
                    0xced428c2629cf959,
                    0x0ea072fec3b93f6e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3603f095d6487045,
                    0xfc94dc4e1c6a4d51,
                    0x91919c3ee2562ade,
                    0x061682956f4f55ac,
                ])),
                Felt::new(BigInteger256([
                    0x2d19c4dfa2febf08,
                    0x0c8e1f06ee513348,
                    0x7dd302edde98ed14,
                    0x11a6ab377cc517f5,
                ])),
                Felt::new(BigInteger256([
                    0xb0f306de0c7cf519,
                    0xd9eefde5fefd86ef,
                    0x880e0d93d1a68fc4,
                    0x073180cbd8d88e4f,
                ])),
                Felt::new(BigInteger256([
                    0x8b7d6bd847b4e19d,
                    0x8850b1c9231f6048,
                    0x1b1ec93b35e871e8,
                    0x114c2c4a3c097217,
                ])),
                Felt::new(BigInteger256([
                    0x952251312a0244bc,
                    0x665b612a19433c11,
                    0x9522be76ce3bf7d8,
                    0x09a535f6b32b5eaa,
                ])),
                Felt::new(BigInteger256([
                    0xbfbaa62635c17bd7,
                    0x6e24a5c6e5518404,
                    0xcdcb30074c660dad,
                    0x06f228bc827cd24e,
                ])),
                Felt::new(BigInteger256([
                    0x46361387dcf989f6,
                    0x48d11e97c03dd0a3,
                    0xf50ea7473f36f94d,
                    0x11ee07a9585a0346,
                ])),
                Felt::new(BigInteger256([
                    0x00f13db9a8ab4c4b,
                    0x2551d53b73d33923,
                    0x3b6e636d29f683bf,
                    0x02ebc5e8320eb218,
                ])),
                Felt::new(BigInteger256([
                    0xb5572fa760295207,
                    0x36467b64cd02cbbe,
                    0x9dea813900c1a219,
                    0x10358fafec169475,
                ])),
                Felt::new(BigInteger256([
                    0xe668d8563d5a5c23,
                    0x8cc04d61e6f57c10,
                    0xdb6c7f49844013e0,
                    0x0ca00068a02885c2,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x93f43ba50cecf66a,
                    0xe36b4218c8192410,
                    0x1753d5e81bb9c8f3,
                    0x115ef6e8084cf67e,
                ])),
                Felt::new(BigInteger256([
                    0xd4666d7a3d59aca6,
                    0xf0e243c275dcdda3,
                    0x24a9a8d2db740416,
                    0x09fed1ede27ede5e,
                ])),
                Felt::new(BigInteger256([
                    0xab24faf1baa09ca8,
                    0x07a5b110192a0f24,
                    0xe1b5cbcd91c2d391,
                    0x036cf2844a84b263,
                ])),
                Felt::new(BigInteger256([
                    0xad94c5ed0a959034,
                    0xb943ca536ee3200b,
                    0x48da848754543110,
                    0x06f3c7397e471e21,
                ])),
                Felt::new(BigInteger256([
                    0xfad359775a1eadd2,
                    0x3d48fef16bb961d7,
                    0x3cb7a220b3c38960,
                    0x10a60875acc3d6eb,
                ])),
                Felt::new(BigInteger256([
                    0xc6c3f8fabe4f957d,
                    0x88d33142ed1c8ded,
                    0x6e732d3811be199a,
                    0x06c7a18b1f141813,
                ])),
                Felt::new(BigInteger256([
                    0xd7565747801e6762,
                    0xa44ad7c42c10becd,
                    0x7dd63c77e9e6ffa8,
                    0x03d781d92b83e77a,
                ])),
                Felt::new(BigInteger256([
                    0x21fee79c57e35ebe,
                    0x37a83a1d62330954,
                    0xda1bcad1feb11fab,
                    0x0e00a77928f53deb,
                ])),
                Felt::new(BigInteger256([
                    0xc040f56e040d2735,
                    0x97ad260177d5b0af,
                    0xabb57bd31949341f,
                    0x0f829e3503e1abd3,
                ])),
                Felt::new(BigInteger256([
                    0xfd534cbdcf76f4ca,
                    0x5cc2c673e578e969,
                    0x6948299570c153a3,
                    0x022f335395692f07,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa7b0243bde3668d1,
                    0x2f79a1b3dee89672,
                    0x6ca0dcd32578fc55,
                    0x0f7d97f4bcf4d79f,
                ])),
                Felt::new(BigInteger256([
                    0x193d74b96e0a8ec6,
                    0x69647b4d4c499643,
                    0xb1fcf7307763dc73,
                    0x07f224017d606ae5,
                ])),
                Felt::new(BigInteger256([
                    0xbb036372a53c12ae,
                    0xe9083150e3f891f5,
                    0xee9e28669b4ebe93,
                    0x09f2e5c5a3553f68,
                ])),
                Felt::new(BigInteger256([
                    0x27392c3fe2faf813,
                    0xc6ae04f5416e4d1c,
                    0xa28768a4669931fe,
                    0x00ba745b434cf961,
                ])),
                Felt::new(BigInteger256([
                    0xde4aced55cbc6dc9,
                    0xe6fac7e1a5a724d6,
                    0xb89d1c2fd6881a14,
                    0x090f57cb0aa929c3,
                ])),
                Felt::new(BigInteger256([
                    0x2b6b73ba3295d4b8,
                    0xe5ca76f619c9e1a8,
                    0xa484c66aa55dc247,
                    0x0c885b3d39d94c65,
                ])),
                Felt::new(BigInteger256([
                    0xbbc7439999bcae3a,
                    0x7ac2be20aeaea515,
                    0xc9f09e024a26ded0,
                    0x00b6c0e3ed2ab3f9,
                ])),
                Felt::new(BigInteger256([
                    0xb1a7ff64bfc33f20,
                    0x150fc88c59827ad7,
                    0x8ba6d459df7f0361,
                    0x04fd94f930381c82,
                ])),
                Felt::new(BigInteger256([
                    0x5e3d727f385ed097,
                    0x08f47735b2484bb5,
                    0x8ac7f8687b471666,
                    0x04ea9e23c42abb99,
                ])),
                Felt::new(BigInteger256([
                    0x04ba465c53d2c67d,
                    0x11c56524644ee5a4,
                    0xf644c2102ffe6316,
                    0x039d2eb754e4c20a,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
