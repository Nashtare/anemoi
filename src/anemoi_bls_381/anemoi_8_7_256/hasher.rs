//! Sponge trait implementation for Anemoi

#[cfg(not(feature = "std"))]
use alloc::vec::Vec;

use super::digest::AnemoiDigest;
use super::{apply_permutation, DIGEST_SIZE, NUM_COLUMNS, RATE_WIDTH, STATE_WIDTH};
use super::{Jive, Sponge};

use super::Felt;
use super::{One, Zero};

use ark_ff::FromBytes;

#[derive(Copy, Clone, Debug, Eq, PartialEq)]
/// An Anemoi hash instantiation
pub struct AnemoiHash {
    state: [Felt; STATE_WIDTH],
    idx: usize,
}

impl Default for AnemoiHash {
    fn default() -> Self {
        Self {
            state: [Felt::zero(); STATE_WIDTH],
            idx: 0,
        }
    }
}

impl Sponge<Felt> for AnemoiHash {
    type Digest = AnemoiDigest;

    fn hash(bytes: &[u8]) -> Self::Digest {
        // Compute the number of field elements required to represent this
        // sequence of bytes.
        let num_elements = if bytes.len() % 47 == 0 {
            bytes.len() / 47
        } else {
            bytes.len() / 47 + 1
        };

        let sigma = if num_elements % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        // Initialize the internal hash state to all zeroes.
        let mut state = [Felt::zero(); STATE_WIDTH];

        // Absorption phase

        // Break the string into 47-byte chunks, then convert each chunk into a field element,
        // and absorb the element into the rate portion of the state. The conversion is
        // guaranteed to succeed as we spare one last byte to ensure this can represent a valid
        // element encoding.
        let mut i = 0;
        let mut num_hashed = 0;
        let mut buf = [0u8; 48];
        for chunk in bytes.chunks(47) {
            if num_hashed + i < num_elements - 1 {
                buf[..47].copy_from_slice(chunk);
            } else {
                // If we are dealing with the last chunk, it may be smaller than 47 bytes long, so
                // we need to handle it slightly differently. We also append a byte set to 1 to the
                // end of the string if needed. This pads the string in such a way that adding
                // trailing zeros results in a different hash.
                let chunk_len = chunk.len();
                buf = [0u8; 48];
                buf[..chunk_len].copy_from_slice(chunk);
                // [Different to paper]: We pad the last chunk with 1 to prevent length extension attack.
                if chunk_len < 47 {
                    buf[chunk_len] = 1;
                }
            }

            // Convert the bytes into a field element and absorb it into the rate portion of the
            // state. An Anemoi permutation is applied to the internal state if all the the rate
            // registers have been filled with additional values. We then reset the insertion index.
            state[i] += Felt::read(&buf[..]).unwrap();
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
                num_hashed += RATE_WIDTH;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        // Finally, return the first DIGEST_SIZE elements of the state.
        AnemoiDigest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }

    fn hash_field(elems: &[Felt]) -> Self::Digest {
        // initialize state to all zeros
        let mut state = [Felt::zero(); STATE_WIDTH];

        let sigma = if elems.len() % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        let mut i = 0;
        for &element in elems.iter() {
            state[i] += element;
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        AnemoiDigest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }
}

impl Jive<Felt> for AnemoiHash {
    fn compress(elems: &[Felt]) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = [Felt::zero(); NUM_COLUMNS];
        for (i, r) in result.iter_mut().enumerate() {
            *r = elems[i] + elems[i + NUM_COLUMNS] + state[i] + state[i + NUM_COLUMNS];
        }

        result.to_vec()
    }

    fn compress_k(elems: &[Felt], k: usize) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);
        assert!(STATE_WIDTH % k == 0);
        // We can output as few as 2 elements while
        // maintaining the targeted security level.
        assert!(k <= NUM_COLUMNS);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = vec![Felt::zero(); STATE_WIDTH / k];
        let c = result.len();
        for (i, r) in result.iter_mut().enumerate() {
            for j in 0..k {
                *r += elems[i + c * j] + state[i + c * j];
            }
        }

        result
    }
}

#[cfg(test)]
mod tests {
    use super::super::BigInteger384;
    use super::*;

    #[test]
    fn test_anemoi_hash() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![Felt::new(BigInteger384([
                0xb9fe6a7ef226a84b,
                0xf788b3a61de71665,
                0x5da4cc0ebb24ec17,
                0xc26444a14114cb02,
                0xeaaf514c30e16a8f,
                0x0eb04560cce8ada1,
            ]))],
            vec![
                Felt::new(BigInteger384([
                    0x04dfd93d8f5ab43e,
                    0x142bb29db6ff9f6e,
                    0xfa044d62799d0522,
                    0x5c4a302c758dacaa,
                    0x956d0421ee10e086,
                    0x08f809b7ab9591cd,
                ])),
                Felt::new(BigInteger384([
                    0x33bb8180c1640b69,
                    0xb1b58fce3edfd447,
                    0x6c596e58506f27fa,
                    0x2cb4be5025a26ef9,
                    0x248f81b9c7e55749,
                    0x195705e8d916b0da,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xe50ebf8109e1f757,
                    0x9e947852ba836034,
                    0xba311825d685bf0e,
                    0x95ca7f32ddc5ab26,
                    0x9ce31d0528b79d8a,
                    0x078432c67bceccb2,
                ])),
                Felt::new(BigInteger384([
                    0x5c859feee0e70db7,
                    0x5166979abd609804,
                    0xa2272ec1273cf640,
                    0x98b07301b77b8cbe,
                    0x88d0094ee43fe44e,
                    0x091105123bcfb621,
                ])),
                Felt::new(BigInteger384([
                    0xa76b0c000660230e,
                    0x1d9041ffc7a1d4b4,
                    0x749542e8ed1ef098,
                    0xb57fe2251e503891,
                    0x272afa9ea639a7d6,
                    0x0da69cf660d4f4d3,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x54179c821585b35d,
                    0x069d40d56c52be7d,
                    0x3d0de8bac4ef0adb,
                    0xb151d6c1591bf377,
                    0x75308b3be8024bfe,
                    0x09d2029ba10e969d,
                ])),
                Felt::new(BigInteger384([
                    0xdbd034e0a824407f,
                    0xe9a01da99a7d56fc,
                    0x3987981327fc0766,
                    0xadf1337016afca0a,
                    0xe5d5df08995966bf,
                    0x004de9532d20c4a6,
                ])),
                Felt::new(BigInteger384([
                    0x70b284bc3ab52ea2,
                    0x0721628b79aa87ce,
                    0x705ec551086fa1ea,
                    0x7016b4039ced6565,
                    0x7347753a46309db1,
                    0x0002337504d6cc42,
                ])),
                Felt::new(BigInteger384([
                    0x4b892e1c10847b62,
                    0x66bf9ebba7cd8cb1,
                    0x3de82e59145b24aa,
                    0xd270f38eca3ab03a,
                    0x9444d650a43abd8b,
                    0x07c5ea4cc0692710,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x580e2366412460eb,
                    0x96b1cb9ba736251e,
                    0x3aaaad81c7ca074c,
                    0x0e2e6fc9fca84de7,
                    0xe00ff46aceefb845,
                    0x01f3067b2e674c5e,
                ])),
                Felt::new(BigInteger384([
                    0x2c6ff66c229f66fd,
                    0xc7e0f1fa59e78b17,
                    0x5f10b32f873298be,
                    0x66e4c80fba98404f,
                    0xc6bba553c00f1d98,
                    0x189ceb4bc4d0daab,
                ])),
                Felt::new(BigInteger384([
                    0x76b87cc089722a99,
                    0xb22e411b63572227,
                    0xc4b4be996f3c7742,
                    0x7c76a2abf630ae8e,
                    0x69d7c8e0ecb239d5,
                    0x009508c52cc01954,
                ])),
                Felt::new(BigInteger384([
                    0xf3a2b7798c866bf4,
                    0x7fec2cb622772e00,
                    0xbbb10c395e8eabe2,
                    0x14ae4f69c09230cb,
                    0x29ece204eae230fe,
                    0x0892a1fb45b0a3cc,
                ])),
                Felt::new(BigInteger384([
                    0xea85491ece71689b,
                    0x268d1ae459f02076,
                    0x832b092b400371c4,
                    0x1283f326332d0131,
                    0x878ce877f471803c,
                    0x0b349305276b94a8,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xc9eef30aa9136190,
                    0x4c08352a3bf36601,
                    0xb0c081e809ca7926,
                    0x1d7217a5294f445d,
                    0xb938479d5d3a8639,
                    0x12a8ad8c44d65369,
                ])),
                Felt::new(BigInteger384([
                    0xec4a961c3c7c7add,
                    0xde790d9995260ec4,
                    0x454be1e9c82b1df5,
                    0x011e857f1d40a3f0,
                    0xbb6b81dd91b683a0,
                    0x15cbd213c64b8184,
                ])),
                Felt::new(BigInteger384([
                    0x1bbbc4627ab9de55,
                    0xd8d53c4b104650c9,
                    0x7c2212aba330ee56,
                    0x62a10c54d3588ab7,
                    0x977644e077a4ae65,
                    0x0d71b8081a8fefae,
                ])),
                Felt::new(BigInteger384([
                    0x0d2b0627e053a8b5,
                    0xf600b6a3f0714d2b,
                    0x2c13172b2e9d1d3c,
                    0xb6dda9d7173eb4db,
                    0x798a069cdec7ad49,
                    0x096292a1fdec589f,
                ])),
                Felt::new(BigInteger384([
                    0x29137e9165b665fe,
                    0x6ba8f68254c38517,
                    0x3da16949cf11c0bb,
                    0xbd7f5b47544d90fe,
                    0x09bf024caa5e7719,
                    0x16b16443c6122885,
                ])),
                Felt::new(BigInteger384([
                    0x4fc82beaacd5084e,
                    0x6be676469d6ce88c,
                    0x58a8f72fc7d4c679,
                    0x69caa01246d70005,
                    0xbca6897c03adcd1c,
                    0x02cafeb8a405d1f0,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0x4b6208cb234eb16f,
                    0x6aba32aab190aeeb,
                    0x9523735bea20bf83,
                    0x655152b8d5c32f68,
                    0x558dc65a9ae304de,
                    0x108ebc897ec9c0ce,
                ])),
                Felt::new(BigInteger384([
                    0xc3cd7f7e9f3ae600,
                    0x8b767ca5842d92b7,
                    0x2f27c5dc9aeabb2d,
                    0x2f1eacbaa9f54b1c,
                    0xc0af7066a384f225,
                    0x08f8f8b5b12f7081,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x57b7bfa4ba6bbe71,
                    0x104571d30aab562d,
                    0x998c423bfa6ee6a8,
                    0x3d33794a4aacb884,
                    0x860f772a9ac56111,
                    0x0aadb54dcb876d02,
                ])),
                Felt::new(BigInteger384([
                    0xa5ee4d6c3a42ddcc,
                    0x3cfe4f744791f004,
                    0x1603ab5d66da1a65,
                    0xb0d0d01c214d869c,
                    0x257b60f61b689bb5,
                    0x100986e4564fbedd,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xd6c7c977707f51d7,
                    0x725f66b6de3a07ce,
                    0x6a02ad587471ad91,
                    0xb30f75ed56375bd2,
                    0x54542c07343d2cd4,
                    0x1602893b47eb34e7,
                ])),
                Felt::new(BigInteger384([
                    0xdd54021f9405042a,
                    0x7ce280012721157d,
                    0x5954a0b0f27981a4,
                    0x43c816a14cfd216f,
                    0x182cb37fcc07cc40,
                    0x0e1ca916ec5c6869,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x5d7c095614b7f49f,
                    0xd5e7ae80977415e6,
                    0xe8268d11ed2ba749,
                    0x695559de24690d1b,
                    0x336aafc56b232497,
                    0x073fb11b4e639a8d,
                ])),
                Felt::new(BigInteger384([
                    0xcb7a2df2341a7135,
                    0xc0fccde32e6dd8ee,
                    0xe7ad31bb81f4821e,
                    0xc94bfeab4e37b8aa,
                    0x523058248a35ef9d,
                    0x05276dd297a850cc,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x68f5daa88dd6534e,
                    0x72cacc3113c98bdd,
                    0x2ce2c55b6b83b87f,
                    0x7b6ec1cfad860869,
                    0xc3b2fae5aefc22a7,
                    0x1318e11262588bb8,
                ])),
                Felt::new(BigInteger384([
                    0x3ff28e82d4253b9c,
                    0x4d8c145cc870478e,
                    0xc946661ff23cf7ba,
                    0x873a54e83863f8c2,
                    0xd1650cda74838e9d,
                    0x09d2474de6d255b4,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x010f5db975f80528,
                    0x8ba916bb18624723,
                    0x15bb2baa5cebce84,
                    0x1c4a6e996c6c3391,
                    0x8f2256a465a39aa6,
                    0x0acaf407acaabd6e,
                ])),
                Felt::new(BigInteger384([
                    0xc821c01c7c940c96,
                    0x6449115ae4900f1c,
                    0x099416e4d72eb5d4,
                    0x2efeb6e1fe09ec1e,
                    0x504c288067080df8,
                    0x1026381802b97e0a,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xbbef008b369a6b11,
                    0xe93f9488b4203e48,
                    0xb0a8e51f500a1041,
                    0x24118f0c350cca68,
                    0x5511c8b11c8ce059,
                    0x01713cf599eae081,
                ])),
                Felt::new(BigInteger384([
                    0xd1abf9b5c07cc5f8,
                    0x7ccdc88faffddcee,
                    0xb29d6bc45807a596,
                    0x3355b1da886e944f,
                    0x2c91c769979c6f7b,
                    0x03c5081e8ea4a17f,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x3af3b2ae2d27204d,
                    0x61adc520e9450663,
                    0xa811500b4786356d,
                    0x64289d6d4efe36e7,
                    0xfd7ab84e5ed0c6c5,
                    0x0050da58cadb9abb,
                ])),
                Felt::new(BigInteger384([
                    0x3f9fdda0e65aa50a,
                    0x6c7f0c6e81d05615,
                    0xe4814a5da3ff7156,
                    0xd77d649bc0e37341,
                    0x0dfb60ca4421d2c3,
                    0x0fcae1d48d2ea200,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8ff55f4708a1b20c,
                    0x653280f21dda7b2c,
                    0x8f9a80df9624af81,
                    0xb74c37b4fcba200b,
                    0x96bc08d8710b9607,
                    0x06f1cd8ecf521213,
                ])),
                Felt::new(BigInteger384([
                    0xdcc69993cac5fde2,
                    0xe9592d92e9e5eb67,
                    0xbed8619e427cd919,
                    0xe03bc072dc934995,
                    0x9e780a9db178bc69,
                    0x027b49d25c541029,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0e1a9c410703caf3,
                    0xdc7cecafaea456d0,
                    0xa314808c33062f36,
                    0x66637a16919ada9e,
                    0x965c219716b69543,
                    0x0b89e02a5ef1a191,
                ])),
                Felt::new(BigInteger384([
                    0xfcb69358b4db9d08,
                    0x99c42d33b700abc4,
                    0x258ae4cf463901e4,
                    0xf06a15788ea74e5f,
                    0x1fcbea8d6811a2c5,
                    0x04d140c88c43c560,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected, AnemoiHash::hash_field(input).to_elements());
        }
    }

    #[test]
    fn test_anemoi_jive() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![Felt::zero(); 8],
            vec![Felt::one(); 8],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x81ddd6d47155757b,
                    0xd46502e2eaa2e35e,
                    0x21232fe882247871,
                    0xb406cb401507c1d5,
                    0x997e549c5a223d28,
                    0x17e557501a50aea7,
                ])),
                Felt::new(BigInteger384([
                    0xd78432d5f6f33b4e,
                    0x79a1376622716bf4,
                    0x0a99fb3859504881,
                    0x96c49e1f95c1089b,
                    0x0ffaf42ba482a16e,
                    0x120c94c68d7f3826,
                ])),
                Felt::new(BigInteger384([
                    0x2e4d823d7320adba,
                    0x8781b46eac26fd91,
                    0xdcbdfb1136cee616,
                    0x22e20c6f2c372beb,
                    0xed43e624f60aa56b,
                    0x19278956b82c3278,
                ])),
                Felt::new(BigInteger384([
                    0x9dac354b690db7a8,
                    0x5605dba67398b0d4,
                    0xf675bd9b1af76ec1,
                    0x964627bfea46be1d,
                    0x2ae71a3b2da1f5c5,
                    0x093e8f19b9ac0d14,
                ])),
                Felt::new(BigInteger384([
                    0xb0c85da1e485d261,
                    0xd7037ae7406ac6a2,
                    0x33c686078070f4ae,
                    0x9175e33c04ac0757,
                    0x947c8501b7db2573,
                    0x10f461bf13ead9cc,
                ])),
                Felt::new(BigInteger384([
                    0xf9381dc3b24e1be3,
                    0xd85381c4a89746fe,
                    0x8327f48fdf313dc6,
                    0xb59e7d647c6f3511,
                    0xc7df47d7fbfbe2df,
                    0x07ddbc1dc7a14caf,
                ])),
                Felt::new(BigInteger384([
                    0xf1ef0bafacbe3215,
                    0xf99b3c0c00b90498,
                    0xaebf54cb7b47ee28,
                    0xcbb2408438d461fa,
                    0x2e6a210a514ff0f4,
                    0x05c220f46c5f5222,
                ])),
                Felt::new(BigInteger384([
                    0xf50da70e111791a7,
                    0xdb9152ebcf9e0530,
                    0x52e8d8a020405110,
                    0xe5b187f7e26574c0,
                    0x7a16fa23ec799160,
                    0x06de71a42d83e926,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xc58e8a8a96323d70,
                    0xd39e889a3201b4de,
                    0xdd91e76f68f49aca,
                    0x847e59128ac9fda3,
                    0x5cb9f9be47b70805,
                    0x16b49e37d8ff006b,
                ])),
                Felt::new(BigInteger384([
                    0x5412170fd37bf354,
                    0x3bec607e84afab22,
                    0xd15883deee18eac2,
                    0xe4bd17ba00009b82,
                    0x5ab4f762a9c62232,
                    0x08f25865d475e6c8,
                ])),
                Felt::new(BigInteger384([
                    0x67378ed1de5d4acb,
                    0xee27bdee51be9030,
                    0xe4cc8061bcb9668d,
                    0xcfa232fb9c41752d,
                    0xdeec4bfe1aba6a72,
                    0x090a7bdd70c28fa0,
                ])),
                Felt::new(BigInteger384([
                    0x990f362a0c44d0ed,
                    0xedcae14faa4d3502,
                    0xc928326db23852a9,
                    0xa3ca42663f4dad84,
                    0xf5908397949dcf8c,
                    0x0fec56dc081c02d8,
                ])),
                Felt::new(BigInteger384([
                    0x9620e5a3a1fa0be0,
                    0xa4df4bffafe201e0,
                    0x391612522ee69b5c,
                    0xcdaf67363ddfd26b,
                    0x4f3e29494363bd31,
                    0x035b2fbf4b4dd4de,
                ])),
                Felt::new(BigInteger384([
                    0x5c0de99763361b0e,
                    0x3b1dddece166362f,
                    0x07b48de1c38c501f,
                    0x8a94208f18c6d777,
                    0x8120cd7531386057,
                    0x0327ddce9da770ed,
                ])),
                Felt::new(BigInteger384([
                    0x155f069ae74095d9,
                    0x4a4dccba678045fa,
                    0x72ca02cbb2a6ee9c,
                    0x60d743e759c85e45,
                    0x035b60da26672a44,
                    0x029e6e8f004d9e4b,
                ])),
                Felt::new(BigInteger384([
                    0xb9a6a53eabb99919,
                    0xc1f82488e6cadd26,
                    0xe209f62b90c5e49c,
                    0x609d8106023309a1,
                    0x7cf3e3de94833099,
                    0x15899d19125e4ac4,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x5446df2c0c7d8df5,
                    0xef16af251303495e,
                    0xa75e7b3ddcd2a985,
                    0xd77c0bcbc14c1493,
                    0xb390bb296566c0ac,
                    0x11ed62a0b5bf9d10,
                ])),
                Felt::new(BigInteger384([
                    0x7c31d03d02b671f0,
                    0xc88f67429d841038,
                    0x89f4c9f1c20234b9,
                    0x2c4d57d054639f8a,
                    0xed6c6bfe838c7660,
                    0x10d3a344580d7163,
                ])),
                Felt::new(BigInteger384([
                    0xfa1e929176af3d85,
                    0xe1c5996de83bfbb4,
                    0xa241f74d361f93a6,
                    0xd9fe5fcc9c880edd,
                    0x279079c2c95c99b4,
                    0x02e56652a3fe8586,
                ])),
                Felt::new(BigInteger384([
                    0x42ebd05ee066c6e3,
                    0xb422219c15dd3a2b,
                    0xf1d3e97f11976fd0,
                    0x597c903ce389a75d,
                    0xfb58d74a351f7786,
                    0x0463dd7194318f15,
                ])),
                Felt::new(BigInteger384([
                    0x8c173f5a6a9b639f,
                    0xc13d90359b911f79,
                    0x933cd9c4003d9ee7,
                    0x2bccb4a925a80bef,
                    0xeaa69d27758c1fe7,
                    0x0927d486897f4356,
                ])),
                Felt::new(BigInteger384([
                    0x24c3c6800fee09dc,
                    0xdcc0e283f86c7b06,
                    0x435bb2bdcabda9c6,
                    0x0061f029ab70a3b2,
                    0x378a97ba19ce2bbc,
                    0x12a0e1e4848a2b46,
                ])),
                Felt::new(BigInteger384([
                    0xa6906a9f2db1aec1,
                    0x3ad901a2212e2584,
                    0x41be9ace444c19ba,
                    0xb7890fc11434e5e5,
                    0x2bed1604076d3c5c,
                    0x118581a4f97ab167,
                ])),
                Felt::new(BigInteger384([
                    0x984213b2ec0cd968,
                    0x8334cb69701c250a,
                    0x48c09988fe6987f2,
                    0x98ad4da6c18b71c0,
                    0xad5e49931c216466,
                    0x06b944893accf002,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x21db81efe9844da2,
                    0xd0da7e18de64e61e,
                    0x50a8db5f23073f53,
                    0x6b5d824d8bddfe44,
                    0x60a606fd5d6e5350,
                    0x081c52a76b90c0d0,
                ])),
                Felt::new(BigInteger384([
                    0x1cfd9fa32bd10e0b,
                    0x9cd5d1057e0b12aa,
                    0x8205d8c8fc7ec499,
                    0x4bb32c3d7d41c96a,
                    0xcafe5a06e9d1cb9c,
                    0x02abbe3b2cd7086c,
                ])),
                Felt::new(BigInteger384([
                    0x46376adfdb6fd8e6,
                    0xf909936133331d4f,
                    0x4e3466d3455fa614,
                    0xcee4e0360d01e6cd,
                    0xc9d46b6265599349,
                    0x140ca80c85b876e7,
                ])),
                Felt::new(BigInteger384([
                    0xbcd0d9e80dd0dcb1,
                    0x208fea62cc1b67b3,
                    0x3df6acf35f43e4e9,
                    0x9f2bdae03f1f6f34,
                    0x712a1a7a0e6c28eb,
                    0x171180a070393ff4,
                ])),
                Felt::new(BigInteger384([
                    0x16dc7f202e1035c6,
                    0x1ba00cf5b07152b6,
                    0x775a1ccb5cad6d6a,
                    0xa085a6d8c1c8e32c,
                    0x3a8fef9842e2c6d7,
                    0x141d85c504002604,
                ])),
                Felt::new(BigInteger384([
                    0x88458b717004f1cf,
                    0x060cd5d215a62513,
                    0xd079705591106e2b,
                    0x453ea70b54727267,
                    0x56de8f388d475ab3,
                    0x0005a252a7fa0d87,
                ])),
                Felt::new(BigInteger384([
                    0x6e777fb778362fbb,
                    0x11fcdf96c5f74593,
                    0x35dba58e6ab924d4,
                    0xa0db635b5e4fb0a0,
                    0xdcfcec7a5ddd929b,
                    0x1322af0816cf5260,
                ])),
                Felt::new(BigInteger384([
                    0xbcfa839ed62bded4,
                    0xe6f05357d241942d,
                    0x57538d305d5a11ae,
                    0x1f59c9b34433e150,
                    0x23c1bdb3ec1d03b0,
                    0x096a2aa115e95ee7,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x4b5aa210d43ce5c4,
                    0x6f96ebbb7c5ae7d0,
                    0xed64bec690ee0ac9,
                    0x3929db93d4e374f9,
                    0xc4c999ddb1862013,
                    0x1496c3f280c1e427,
                ])),
                Felt::new(BigInteger384([
                    0xeab1ec19aeb214b1,
                    0x2fa9d6e486b06217,
                    0xf29d10969964ed64,
                    0x939ea6f55cde0f98,
                    0xe07aebbc7d3b8227,
                    0x1345dbe58b3259cb,
                ])),
                Felt::new(BigInteger384([
                    0xc2da52d6043d8a3e,
                    0x435977fea67c56d2,
                    0x158a93f001af9066,
                    0x2482b4c776877df9,
                    0x7b8da4417acddc5e,
                    0x0dc33f39d30ccad8,
                ])),
                Felt::new(BigInteger384([
                    0xd3f3651cdde5e5ab,
                    0x62725139ceabd209,
                    0x1b1a874131f6ecf0,
                    0x26c99d8dd36b6e8a,
                    0xd02436193d0e61e4,
                    0x0010f30061a13cc1,
                ])),
                Felt::new(BigInteger384([
                    0x775ef58aa068723b,
                    0xc6c55a82f831e84d,
                    0x0086791e057ccfed,
                    0x795e395ca476f3da,
                    0x87605b2b35e9e2da,
                    0x120d260f858d0d6e,
                ])),
                Felt::new(BigInteger384([
                    0x340f86d5335b09fa,
                    0x2f38c8d2d504f6cd,
                    0xec66501f2041616e,
                    0x590f1264d1bc5168,
                    0xb96b56452c59f818,
                    0x103aedd9bdaa55fd,
                ])),
                Felt::new(BigInteger384([
                    0x7e3a04438f934db2,
                    0x91305f964cb95cf1,
                    0x7039288597f4e5c9,
                    0x4e1aa60ecc4e0c9c,
                    0x2a15ae6111ed468d,
                    0x16cfd36c16cde20d,
                ])),
                Felt::new(BigInteger384([
                    0x5e6d39d0058c8658,
                    0x672f0f65881abb51,
                    0xfe68b8917c4f1217,
                    0xc3ecde79eced9c8e,
                    0xf7c828c06049e0c7,
                    0x1756c241261b80e3,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xa9b45fd77607b0b5,
                    0x6358376bc795cd98,
                    0xf499ffa75d739f09,
                    0x3e140117c87b9092,
                    0x40f1026c853d9263,
                    0x028be41d6e0e5cd4,
                ])),
                Felt::new(BigInteger384([
                    0xe488122283884581,
                    0x2513c9f4f4b74192,
                    0x7a40740ac96786bb,
                    0x22ccd95a8f02f4bd,
                    0xf9278a1c8cfcb230,
                    0x10e117414cdbfa0e,
                ])),
                Felt::new(BigInteger384([
                    0xbcb33072e31c8f38,
                    0x3a2086266c2005d9,
                    0xcc252b4bcb6a32fe,
                    0x3087e6f38684306e,
                    0x26a5bd11ec4008b5,
                    0x0831375a0ada77d5,
                ])),
                Felt::new(BigInteger384([
                    0x39669287f8c058b8,
                    0x396d1edad3159819,
                    0xc4cf64e8de88fb6b,
                    0xec9d839acd77f0fa,
                    0xc717129ff6396af2,
                    0x14bce35888beb0b2,
                ])),
                Felt::new(BigInteger384([
                    0x69d41e1b2d61b467,
                    0x2170239f4cae5814,
                    0xd3dea5106a08cb86,
                    0xe4e6d12a42b306f6,
                    0x971c5366d9a99462,
                    0x03be04fc3ced996f,
                ])),
                Felt::new(BigInteger384([
                    0xc2b31dc9e44842ad,
                    0xa9cbf147fea3bd40,
                    0xb66bc7fcb9089e2f,
                    0x637c72399b20b757,
                    0xc42d8ad4231cd06e,
                    0x0294453d6543cc73,
                ])),
                Felt::new(BigInteger384([
                    0x87980277db1de4b5,
                    0xe9c4e5effca6bd60,
                    0x482703b0e9ffb2af,
                    0xb9d9f3d36c2fc1f6,
                    0xefcbabf8a32968ac,
                    0x161b83bbc8396348,
                ])),
                Felt::new(BigInteger384([
                    0xa2b79abdec2d5108,
                    0x5bec084a7607b12d,
                    0xd012a24fe0183678,
                    0xe04dd798f8d0251c,
                    0x03e73b407d3d1493,
                    0x063f0c07649678ab,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0xffca1026655b31fe,
                    0x97cd2e87f1fa0fa7,
                    0xf46db54c39889bd3,
                    0x2974cfcbeeda58c6,
                    0x9f92cfdd2acb1d79,
                    0x01daca78b9daf398,
                ])),
                Felt::new(BigInteger384([
                    0xc23e6c1c571b4d32,
                    0x2954a87c62ca14e5,
                    0x271658e896f15ee4,
                    0x36af31e8676f1e65,
                    0xaa368327180fea87,
                    0x067ca54ec2a5377b,
                ])),
                Felt::new(BigInteger384([
                    0xade4e5a6ee41b350,
                    0x4966837fd150a273,
                    0x08119a7e3962f982,
                    0x4b33cb116c9dffa4,
                    0x09f7b6b431e2a8de,
                    0x07c2aa4a84fdb69e,
                ])),
                Felt::new(BigInteger384([
                    0x8879b2538c26f6b9,
                    0x30497406cd59595b,
                    0xb84e256c2c587fb2,
                    0x72df2289eeb75f11,
                    0x0efa795e5ed032f7,
                    0x1430464850892492,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xc8c5492429007671,
                    0x855064218a58cd35,
                    0xe51f70a541cc41f8,
                    0xa9e52c53e43fa679,
                    0x0743a7264e2daa91,
                    0x055226ca6bf43354,
                ])),
                Felt::new(BigInteger384([
                    0x80d610aab20acf94,
                    0x93443a6f7402bd31,
                    0x27a744a4eeddd4e9,
                    0xf6e1ef8a01ae2778,
                    0xcd24d412a3bf7615,
                    0x0898fcae0e3561d8,
                ])),
                Felt::new(BigInteger384([
                    0xed147226e64483e6,
                    0xbc429e1fe3da3aee,
                    0x4520733d1557e5eb,
                    0x13c42b4680526b38,
                    0x849af55976533a7b,
                    0x04287372782da8b5,
                ])),
                Felt::new(BigInteger384([
                    0x701a4653e1165045,
                    0x05a85166ad6eb487,
                    0xb1769000063729c9,
                    0x5d28399d50146d18,
                    0x2b8e2b055b8f0b11,
                    0x00c720a98b3a03fc,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x46b81610d8015597,
                    0xf3de3cc4ae31f42f,
                    0xe8fb98fee5ac0219,
                    0x25f6e89b8b6aaa44,
                    0x8b92f8c24bc97b89,
                    0x0593ac224a80ebf7,
                ])),
                Felt::new(BigInteger384([
                    0x4842ce30df634017,
                    0xd8a81bfb76a113b9,
                    0xdefd0da0ccd8e0d0,
                    0x5004c31e899bb6a2,
                    0x6242779e735e3bd8,
                    0x132795bc5747edba,
                ])),
                Felt::new(BigInteger384([
                    0xc7884cc7a9b870b0,
                    0xe5375e68c6c416b8,
                    0x4fe008af6599561e,
                    0x13f3c71e8d688192,
                    0xb5dfbc33d2793fed,
                    0x18ac8f2ddf192acc,
                ])),
                Felt::new(BigInteger384([
                    0x8e1f603bea89fe55,
                    0xf2bea92da2c87f7a,
                    0x8c6b0c95b67d32f2,
                    0x4b27d0d4689b1357,
                    0x147aa5b95c7ac6ca,
                    0x0ef8adda52232fb0,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x191c2bebaa73f200,
                    0xf52f27140037b606,
                    0x077f30fdafe8c21e,
                    0xd5c3ecf43a577e6e,
                    0xdd48f595d8217c5d,
                    0x10f60c6e6cb1b38f,
                ])),
                Felt::new(BigInteger384([
                    0xdcc14e3f12bace6a,
                    0x919b7ee7a9a24daf,
                    0x34c9118a507e91fc,
                    0xb40adfe9d8703c03,
                    0x0a77b7c55a5cee6b,
                    0x08420d51e8463043,
                ])),
                Felt::new(BigInteger384([
                    0xbd67204831dd00fc,
                    0x2cbb8cef54a422b5,
                    0xd225de391f932c7a,
                    0x41cd27f10db232d4,
                    0xf053ac36c42121c5,
                    0x194e1e990cee118d,
                ])),
                Felt::new(BigInteger384([
                    0x652d21b39daeec1e,
                    0x5b8a075df79ad322,
                    0x025327aaea50729a,
                    0xb3b835a440544ac2,
                    0x4cfe7e072ed306d0,
                    0x119f582128098331,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x98f2b5518117310e,
                    0x8ab12767f40c720a,
                    0x0420b9717d99aff7,
                    0xb2e6ed88157892e3,
                    0xba5d921b54b67c10,
                    0x02e61c4b14a22495,
                ])),
                Felt::new(BigInteger384([
                    0x296bc636dbee39b1,
                    0x794d4f4bca434408,
                    0xecc87b50bba116f1,
                    0xc9baa0a5d1d50dd8,
                    0xa9eeabcba2535cb2,
                    0x19ce5cf894de2c41,
                ])),
                Felt::new(BigInteger384([
                    0x010edf831b201233,
                    0xf8b46a374488726c,
                    0xea462b8c4db617e7,
                    0xb1001af471de1f94,
                    0xd9d0a62c0a0124d3,
                    0x1454ed3b57e8715a,
                ])),
                Felt::new(BigInteger384([
                    0xd00b5ecc9081ef1c,
                    0x6d648f3f3ff0e458,
                    0xe71f70d0a37a9d29,
                    0x978c9dc34d4e9b4b,
                    0x5e51a889bd978026,
                    0x0ea3352be4832dc2,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x1d60ea03942b2d44,
                    0xdc47e663607f98c6,
                    0x5b39dc8d19dc0333,
                    0x04aac4f5d42a5492,
                    0xbc6b6bc40faf33e9,
                    0x007c125942802f1e,
                ])),
                Felt::new(BigInteger384([
                    0x6cc5363ca506bcbd,
                    0x9a5a7c11f2733e03,
                    0xc702a2a7e9d4dede,
                    0xbcbd29c977327be0,
                    0xfa1dbf9c3a6d4e97,
                    0x04565e15935d9c0d,
                ])),
                Felt::new(BigInteger384([
                    0xfc12bc9165f773ce,
                    0x75cf4f0ccd7c1d1e,
                    0x6b469cef80daff3f,
                    0x8ae84574096152d5,
                    0x5ba3edd0a31c01bc,
                    0x121ada85b7306b37,
                ])),
                Felt::new(BigInteger384([
                    0xe137a29f40c199c9,
                    0x96b3e4ac99a09d45,
                    0x101485bc3e316d81,
                    0x676523d07a2e8ecd,
                    0x6ee026940c186cf8,
                    0x0f1e03e6eb6f10ec,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8e23b6d9f0d2afdf,
                    0x218758db1224e48e,
                    0xe22233297cec33ac,
                    0xdf154c2db3a37627,
                    0x0c70a8b8e9fe51a2,
                    0x0e9ea6b24495e1eb,
                ])),
                Felt::new(BigInteger384([
                    0x3eb7d142a66f86ab,
                    0x4ab63e8adfdffc99,
                    0x31fc8829474a4c71,
                    0x90fcac4284d0e954,
                    0x16687ce49389783b,
                    0x0ed0e13ec2d94f93,
                ])),
                Felt::new(BigInteger384([
                    0xe471ccb045a5342b,
                    0xe92b8e04c64ad90d,
                    0x908ac1004826c98a,
                    0xe6adff0c57105164,
                    0x9c8f7dd7601b696f,
                    0x07ccc1dc727f3a65,
                ])),
                Felt::new(BigInteger384([
                    0x5d1cf9e50a9f431b,
                    0x6c5d59b75ae3ca8d,
                    0xd58ca75cc0719da5,
                    0x85e078c9e35beb3a,
                    0x717717923694a6fc,
                    0x12a7e5966f11bec9,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xc11618d90d2fd12c,
                    0x7b2cebade938d8cf,
                    0x6126acb2466264ad,
                    0xe738d0373aaf0439,
                    0x6d8adaf879642c29,
                    0x14a18ada8d625bcc,
                ])),
                Felt::new(BigInteger384([
                    0x0a33650adf7e81e5,
                    0xa6ff274821a3d784,
                    0x6d1d6abd7a71d03a,
                    0x25ef2519fd017ab1,
                    0x82cd018357d0fd63,
                    0x0cbdebef948ec41f,
                ])),
                Felt::new(BigInteger384([
                    0x3b4e6ecbdb11764d,
                    0xecb567abc678541f,
                    0xbb7928666a40d79c,
                    0x70aa0d0383732aa5,
                    0x12e9611dbc4ec27b,
                    0x0811c8c91b2d468e,
                ])),
                Felt::new(BigInteger384([
                    0xa57bd6eb5ce3b94a,
                    0x0dca5283e494bc43,
                    0x802d9053152c5cf3,
                    0x3f192ab26d5cdf0c,
                    0xed077bff0f9b7edd,
                    0x0ae569d702f3ff1b,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xb9ffccff5e612647,
                    0xd0d02e5216f3a815,
                    0x6193bf35dc0db15b,
                    0xd41dd77e460707e2,
                    0xafd8e4c3fc8fe56c,
                    0x17a0bf2558f4b1ac,
                ])),
                Felt::new(BigInteger384([
                    0xd12ca2d473b768e6,
                    0x46ea78aa4432eaa6,
                    0x171a732e81950083,
                    0xa64b4e2e97415c5a,
                    0xaae48cb511bfad9b,
                    0x0c1d0a1c54d22cbd,
                ])),
                Felt::new(BigInteger384([
                    0x85a7762d7e159ef4,
                    0x83e0641764f72c04,
                    0x4f1475758c9e0652,
                    0x7880e333a5f4826e,
                    0xb4e79fa5b4aeb0ab,
                    0x0bc75dbfeaba883f,
                ])),
                Felt::new(BigInteger384([
                    0x404bf4bcc89ffe96,
                    0x7ee84b60c6d53ee6,
                    0xeb7dabe96aaf1f00,
                    0x3d29e0bbd8739cc0,
                    0x871f470c7f341ae1,
                    0x1574d7abd75bdbff,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x102bae45a74e2de4,
                    0x95dab824111dac45,
                    0x80595aa3c1c47281,
                    0x5268485f04171abd,
                    0x5822e1f845938d09,
                    0x17440b5623baf26b,
                ])),
                Felt::new(BigInteger384([
                    0xcb3299b0c4e47fff,
                    0x5512d30ac4143a2b,
                    0x559d038bdeb88632,
                    0x93ebb57425aa3524,
                    0x38ca52adbb73b326,
                    0x1240eb44639d255d,
                ])),
                Felt::new(BigInteger384([
                    0xad45213dd5ad0f3d,
                    0xbb43e39fc5533712,
                    0x3d8eeb25e64de952,
                    0x1b16af286b7080b4,
                    0x9710852f4673fac2,
                    0x0176d48e42cc4541,
                ])),
                Felt::new(BigInteger384([
                    0xdcd9bcf034c3c577,
                    0x1f154832f1590a05,
                    0xb50c79c1e9a9af66,
                    0xaf9563d38383c406,
                    0x7fdb34d3ee9e52fd,
                    0x065c46cc44bbc3d8,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress(input));
        }

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 2));
        }

        let input_data = [
            vec![Felt::zero(); 8],
            vec![Felt::one(); 8],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x2f98cc71d827dd3a,
                    0x53c874b8955189e3,
                    0x8f113506bc19d0c3,
                    0xaf1f9333cd2e2c73,
                    0xbdd655d9c39d8b95,
                    0x0b0c380e37734e66,
                ])),
                Felt::new(BigInteger384([
                    0xc676d525d77fbfb4,
                    0x988b8087b558a8a5,
                    0x5e987c327baea68a,
                    0x05eddcb07b648daf,
                    0xf4235b283340a021,
                    0x004497865f201890,
                ])),
                Felt::new(BigInteger384([
                    0x1fd4504b26f45701,
                    0x75ca693ed5749e19,
                    0xfe2095c7e26e5adb,
                    0xe39a145592e8b082,
                    0x63ddb80c209fa94a,
                    0x0e65bef281cd4485,
                ])),
                Felt::new(BigInteger384([
                    0xd0ac39029fd27b51,
                    0x896936658e406b94,
                    0xee866ddea3a849ba,
                    0x6375007c63498b2e,
                    0x22b4dbd54724c684,
                    0x19e96cb290b73b94,
                ])),
                Felt::new(BigInteger384([
                    0x670d0f8002fe7131,
                    0x119d19cf1fa823f2,
                    0x4140bebd1d5c7ee8,
                    0xe6f29b1b66337777,
                    0x6687c5cf0820b953,
                    0x132362d70360b768,
                ])),
                Felt::new(BigInteger384([
                    0x0de61eac79390fb7,
                    0xb470b732d9a0fcba,
                    0xca21f1988847ce9d,
                    0xf6b736240f7650ab,
                    0x9f79add9ffb8e15d,
                    0x07e6a185aead098c,
                ])),
                Felt::new(BigInteger384([
                    0x57d8fa88a02b870d,
                    0x750c04fe83c52d75,
                    0xc443a84261516e3c,
                    0xe4fd7ef2032684c7,
                    0xc19e99c5c8d855c4,
                    0x16e41c26ed25b2c7,
                ])),
                Felt::new(BigInteger384([
                    0x8af9b8262c7c277a,
                    0xe3174c6724180568,
                    0xafcb611aad152b5d,
                    0x2bc127dcf8d23363,
                    0x08858e5eafcf5b22,
                    0x060cc9df8ac108a4,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xf0b62f149ec11b5d,
                    0xfa9aa04bbbb52644,
                    0x0d96dd80140fe226,
                    0x0acd0fcae4091591,
                    0xb2b95b1b7a447a99,
                    0x0f3656a93006b169,
                ])),
                Felt::new(BigInteger384([
                    0x6d426f0ad6ded954,
                    0x0b398f853d2ca650,
                    0xfa1e0dc0cbd14f78,
                    0x2bf0c533c015978a,
                    0x4c08e89073f1d8f2,
                    0x07909025d2f345c0,
                ])),
                Felt::new(BigInteger384([
                    0xefdbf7417ca21535,
                    0xf1cd3ac2db8f8838,
                    0x65b4dd07209a9498,
                    0x24442c68bcfa6c4f,
                    0x8f511cede004e407,
                    0x11f2d61c395b7567,
                ])),
                Felt::new(BigInteger384([
                    0x8bc724f3ad4d138a,
                    0x77345d250439d2fe,
                    0x59ef69acb4b5f438,
                    0xf65926f3fde96dad,
                    0xd77050bf4a8c76f0,
                    0x0890b9cb2a73739b,
                ])),
                Felt::new(BigInteger384([
                    0x131bfdc8e3338d64,
                    0xceeea7772bf91330,
                    0x2dd4de933b24305a,
                    0x45465f0d6507aeab,
                    0xb6bd5e7ae86e9951,
                    0x1729e7dce17e25b9,
                ])),
                Felt::new(BigInteger384([
                    0x1bd9dc8d2b4a7644,
                    0x530e00a204c8453a,
                    0x71d4c9526bbcd774,
                    0x1672c91fd6b87f24,
                    0x5e933b70113cfe20,
                    0x17dcd32f3659a599,
                ])),
                Felt::new(BigInteger384([
                    0xf7192ab6ebf1001e,
                    0x42d06059a83f987d,
                    0xb230684fe0d9a33c,
                    0xd6b30368650a608a,
                    0x680dc0fd10374fc6,
                    0x12dda9a83f666095,
                ])),
                Felt::new(BigInteger384([
                    0x8c0060631fe57c27,
                    0xf65dd24730996716,
                    0x64a38058407853d6,
                    0x50be1119f1e7a99d,
                    0xc83cf635e394cfc5,
                    0x15061364268d78f7,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x6b0b60ffdba33624,
                    0xaf787dd29128a8ef,
                    0x0bfdc01f02b05ece,
                    0x391db21bb7b870fb,
                    0xa521bad948573b3f,
                    0x06d0b522f63e4233,
                ])),
                Felt::new(BigInteger384([
                    0xb1aac28d36d69601,
                    0x41de9255de0a195e,
                    0xab911395140712ed,
                    0x77125b09b63ebb75,
                    0xf4b46d4609ca6d6e,
                    0x16aad350f618248e,
                ])),
                Felt::new(BigInteger384([
                    0x29ec2c7736b73ad1,
                    0x85ad7e6190f122b1,
                    0x834cfe2762700212,
                    0x42ef1d55a76efd66,
                    0x159d27b8f0a02dc3,
                    0x00534558c4ad5155,
                ])),
                Felt::new(BigInteger384([
                    0x5141a66693217840,
                    0x2a2f3d7f8ef5af54,
                    0x7657e22e0308dcb3,
                    0x8ea913fac904289a,
                    0x18c329366b6b0b61,
                    0x0deaf3bc4b48393e,
                ])),
                Felt::new(BigInteger384([
                    0x0b212c06729c090a,
                    0x0e905aac1b878684,
                    0x2ec827b3186212f5,
                    0x1d05ae50c7d3532b,
                    0x9c460a36bd821ad5,
                    0x126d1af44bf18f7d,
                ])),
                Felt::new(BigInteger384([
                    0xf7e0c35a136b212e,
                    0x50e380f1d9a24a7e,
                    0xf0656b827ac20f47,
                    0x005de051b3f26dee,
                    0xd574dd396cd30c7a,
                    0x1739e3d5e791e708,
                ])),
                Felt::new(BigInteger384([
                    0x2b3d7933666ff5de,
                    0x23fabaf8ffbf3890,
                    0x7c48fc7c9e90716e,
                    0xf943ef4754bd4d61,
                    0x1ceb76a37a2c664d,
                    0x0e16cb9a8ca7cff0,
                ])),
                Felt::new(BigInteger384([
                    0x0f834038ef9ed99d,
                    0x84352ab57de784e2,
                    0xd8cbbdac5a0efc47,
                    0x7f10b48dc3a512c5,
                    0x1e8e7b241bcfe85a,
                    0x0d88f1ec26be0787,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xfcb94e5d874427dc,
                    0x50d1ea17a721a273,
                    0x90e94ecb887efb07,
                    0xebcbe97c0cea032a,
                    0xf9f55c53ca3e6486,
                    0x0472dbec3be23115,
                ])),
                Felt::new(BigInteger384([
                    0xb0f6b15d78247570,
                    0x29878a7f03c7bde0,
                    0x0a9c42c9b267f866,
                    0x562b2ba007354311,
                    0x4a8e5da130632f46,
                    0x190463a990f008a7,
                ])),
                Felt::new(BigInteger384([
                    0x9ffc5fb23c0b6806,
                    0xfbf14c332b0e5680,
                    0x0f22126e35c488cf,
                    0x85c97051e94117c2,
                    0xf3a1a8d033be73e7,
                    0x120d3608c3805f22,
                ])),
                Felt::new(BigInteger384([
                    0xfd31fa64cea279b8,
                    0xf4f5278d9eb59f03,
                    0x516bb17360254982,
                    0x28c75802e8a3f5c2,
                    0xf75485a38daf42a1,
                    0x04c94a5bb3a5b3b7,
                ])),
                Felt::new(BigInteger384([
                    0x00b6e349e0e15b24,
                    0xa76d5d7ed8ef424a,
                    0x53e5f94859f971e0,
                    0x6771570f80e6e9a1,
                    0x2a86c34319e52d1b,
                    0x00d77b9f140e5c6f,
                ])),
                Felt::new(BigInteger384([
                    0xe52a0ea86670345a,
                    0xf1d44a98ca286d6a,
                    0x79f38aff15d425d3,
                    0x4019bfb9d87ab7d3,
                    0x8241b5c5b3534a88,
                    0x1472d16a47dcdf4a,
                ])),
                Felt::new(BigInteger384([
                    0x6b76d47a7f9cb50e,
                    0xe7bab4f9b57c1e35,
                    0x1495814bb524042d,
                    0x810b7ea2b35aed6f,
                    0xaf3a142e1e708946,
                    0x031e184781f76b25,
                ])),
                Felt::new(BigInteger384([
                    0x59aeb3a11d0d83e4,
                    0xfbda5f5038d854a2,
                    0x156ba96881493da0,
                    0x3a88e46c2784c076,
                    0x6c35a8f8a38841c2,
                    0x025d07cbadc42331,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x0d734be657c7d84e,
                    0xa55d2e6964853cd4,
                    0xf93ed4a0cf16dd44,
                    0x11a8d0da859117e0,
                    0x99113c40f3daac6a,
                    0x08111865a41b2f31,
                ])),
                Felt::new(BigInteger384([
                    0xa1d476b01d59004a,
                    0xe2238f07118b6890,
                    0x8d7ea3a1588bfa61,
                    0x54f875677b116dfc,
                    0xf189307a1d9ea2ad,
                    0x0223817991309e18,
                ])),
                Felt::new(BigInteger384([
                    0x816fcdd8eef7428a,
                    0x7c8ec84b048e4a8d,
                    0x5bddd2a1668e508d,
                    0xe338f3aef06fc345,
                    0x7cdbba7eb24fdeb0,
                    0x07866f537a76b426,
                ])),
                Felt::new(BigInteger384([
                    0x7c6ba2e0ab3a0ecc,
                    0x790c6a06e7bf0c3f,
                    0xdf709f90f249ab13,
                    0xff4669427c8f80e5,
                    0x18eddf8de73ac541,
                    0x09bb5c44a1636b24,
                ])),
                Felt::new(BigInteger384([
                    0xaeaf4c6a57be42ca,
                    0x79f6ae48d0f7eec1,
                    0x2b97cb355e89b985,
                    0x32b87161a69fc7e8,
                    0x473ea9698ba3ad7c,
                    0x14c1ed7be4ce17c8,
                ])),
                Felt::new(BigInteger384([
                    0xaf9838df530b1d3d,
                    0x15ec372e6a91b6d9,
                    0x9a2d76c430591190,
                    0x2e49fb7c2a2628ba,
                    0x0cbf3dc0f09b4000,
                    0x08e5fa552150a390,
                ])),
                Felt::new(BigInteger384([
                    0xb93cde7a7404f4b1,
                    0x676aeea5d86050f1,
                    0x4e3c5642e7ed40d5,
                    0x9e86b37d3af47a10,
                    0x0c8f2dc1e5477309,
                    0x159a7ed6c54ec33f,
                ])),
                Felt::new(BigInteger384([
                    0x33250719bda1a3b3,
                    0xb61bd7d3ac4b69e3,
                    0x73f95db7c8e1d830,
                    0x1e3efd3e78ac89d8,
                    0xa2051d1431aac5b9,
                    0x17901e6b72582b5a,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x34c1505e808725ba,
                    0x24707c66c0ed00b7,
                    0xfafe286ce9b28ff8,
                    0xc7a06a99f468dc25,
                    0x683f2299bc72a70d,
                    0x11fd42b9efeadf0e,
                ])),
                Felt::new(BigInteger384([
                    0xa9976b2fa9752dee,
                    0xbeeefe86c4f78fcb,
                    0x03befe8f0fca0514,
                    0x69ccd28ffd1802d2,
                    0xa13f8591de06a987,
                    0x134e83748a95b4e7,
                ])),
                Felt::new(BigInteger384([
                    0xc2e74854d9199ca8,
                    0xfdbef542845e82bb,
                    0x6a311ec78a4c6c20,
                    0x81cd92c22ec0d6d8,
                    0x09390241c70fe09d,
                    0x0dfe074c7f3a5a15,
                ])),
                Felt::new(BigInteger384([
                    0xa9187bae478d5113,
                    0x40268041f0e56587,
                    0xaca5d4f31a0a37aa,
                    0xfc2debe255cf7c53,
                    0xb043befd70dc2aab,
                    0x0fde8369df7e3edd,
                ])),
                Felt::new(BigInteger384([
                    0x275fc3be7ca5f44c,
                    0x7b3eec6498ba0135,
                    0xf1682ba0f1749e7f,
                    0x17e0ac056cdcf5eb,
                    0xf716b156d446e402,
                    0x0333730a4360ebcb,
                ])),
                Felt::new(BigInteger384([
                    0x2b18c96a3536ad98,
                    0x5c0f5129a87a71f1,
                    0x038751e474540a46,
                    0x0f9c7700877493eb,
                    0xab7e5a31739959ba,
                    0x04cbbf9f90291626,
                ])),
                Felt::new(BigInteger384([
                    0x50338bbe0819094f,
                    0x1d21dda2527f5da9,
                    0x956ccd6ab137e398,
                    0xcdfcfdc1c6819f08,
                    0x44390ebf0a284394,
                    0x0b2be83615cfc773,
                ])),
                Felt::new(BigInteger384([
                    0x40f641503ec18684,
                    0x7b41a4266c193bb8,
                    0x3cc77af88f0f1177,
                    0x3c744c0fac4fcb8b,
                    0x6219e356e785b2ea,
                    0x1518721504601d22,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0xadaef5cd539ce54e,
                    0xe133b207c34ab21b,
                    0xfc7f4fca72eb9555,
                    0x74a89add5b78586a,
                    0xa98a86915cadc657,
                    0x099d74c33ed8aa36,
                ])),
                Felt::new(BigInteger384([
                    0x90b91e6fe3429940,
                    0x3af21c847ecf6e41,
                    0x7833abb3cc98e872,
                    0x451708ed62a16ab7,
                    0x6e1554cf339470a7,
                    0x00abd9acd9ae7573,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xb5d9bb4b0f44fa57,
                    0x419302416e330824,
                    0x2a3fe3e2572427e4,
                    0xbda9579a649211b2,
                    0x8bde9c7fc480e50c,
                    0x097a9a3ce421dc09,
                ])),
                Felt::new(BigInteger384([
                    0xf0f056fe93211fd9,
                    0x98ec8bd6217171b8,
                    0xd91dd4a4f514feb2,
                    0x540a292751c29490,
                    0xf8b2ff17ff4e8127,
                    0x09601d57996f65d4,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x544162d881ba1b9c,
                    0xba699b2ec3a20ae8,
                    0xd1aacf0d54946214,
                    0xd5736435254e1917,
                    0xf6570d3fdaf70e9e,
                    0x043f2965f01a3029,
                ])),
                Felt::new(BigInteger384([
                    0x1c632e6cc9ed93c1,
                    0xacbac52a68159334,
                    0x043747958ca51d9f,
                    0x36b5486dfeb1b73b,
                    0x2ba175a18c8d55cb,
                    0x081f31ac6feb36d0,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x1c844c33dc514851,
                    0x033eb404a387d8bc,
                    0x72743c95d8caf875,
                    0xb319c96054849e83,
                    0x8280fa1658f6f14b,
                    0x1043191d401fde83,
                ])),
                Felt::new(BigInteger384([
                    0x41ee6ff2b069ba88,
                    0xed258645a13d20d2,
                    0x371c39353acf0496,
                    0x67c3158e18c486c5,
                    0x577635cc892ff53c,
                    0x19e16573104fb374,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8b5e5deb405b1e2d,
                    0xfdebdf8536ffc271,
                    0x96955cac26ad9162,
                    0xfcd56df7cd548144,
                    0x96e49ec9d50315e3,
                    0x176437f70b6b0ac2,
                ])),
                Felt::new(BigInteger384([
                    0xbe918cd8fa824b43,
                    0x054490f52fdd27ba,
                    0xb5ea63566f5ac47d,
                    0x72399eeadf52e489,
                    0xf491e52e4e8277c9,
                    0x188754caf030291a,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x1b67c31591897a91,
                    0x4177ced69512ecc9,
                    0x42394847b9395f92,
                    0x5e422e9281c2e4b3,
                    0xba40d31bbd6d0c9e,
                    0x0b86c71a1d2cf5ce,
                ])),
                Felt::new(BigInteger384([
                    0x81c24448878bb571,
                    0x7ac21d72e2624d5e,
                    0x4362b1a1f69dcb88,
                    0x7e9e882f4743421d,
                    0xd5507b79d73f1676,
                    0x1074bad9ac79a23d,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4d9a2692d9112aff,
                    0x62e1558075ea3932,
                    0x273a9b161c88af59,
                    0xd1e5f7b977175fa9,
                    0x51537707f432f424,
                    0x12b277f36efbf03e,
                ])),
                Felt::new(BigInteger384([
                    0x65e967b8a3e5bd5e,
                    0x7e6d14bf6f0f2868,
                    0xa29d90feb04c0cc9,
                    0x8469dce0a4133e5d,
                    0x6d675861d3c1c1ba,
                    0x01f7d539bb84530a,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4c743854ed2dc160,
                    0x42444dbc4b7df124,
                    0xb5237ea6bdf51427,
                    0xf321616848c3bbd5,
                    0x419721cf0fb7417a,
                    0x10cd05d021ea2617,
                ])),
                Felt::new(BigInteger384([
                    0xe1326365714a4616,
                    0xbc14f4627e672526,
                    0x4d55932c9ea4ce99,
                    0x0f34fcfe24ab193a,
                    0x9b9f69ce86854ec4,
                    0x08f7244ccd673965,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x788a3b94018de845,
                    0xfdf9f17d3fe0ed66,
                    0xccc2a1b71a63fe36,
                    0x093ceb6023026c8f,
                    0x784b953e9216f2ee,
                    0x18d2bb66cc15a29e,
                ])),
                Felt::new(BigInteger384([
                    0x8de352055af9b482,
                    0xb00c1dba067d8cb9,
                    0x9e72a061c82eba3d,
                    0x946bbc41c04c76ac,
                    0x3bbd13d268d53c36,
                    0x11daab8fefe0c1d6,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x251fa6861726385c,
                    0xb797600bd768611e,
                    0x8e9d12f55daacef2,
                    0xebc062dd77400164,
                    0x400127f2389de675,
                    0x186ba796d88e0acc,
                ])),
                Felt::new(BigInteger384([
                    0x0c40a6e00cdc33f6,
                    0x63526cdece1330d2,
                    0xa6a0f0527fdcd442,
                    0x9d6ef5f97e00f2d8,
                    0x97927c0bac6877ae,
                    0x14b619523434ff27,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 4));
        }
    }
}
