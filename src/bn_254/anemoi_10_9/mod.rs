//! Implementation of the Anemoi permutation

use super::{mul_by_generator, sbox, BigInteger256, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 10 field elements or 320 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 10;
/// 9 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 9;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 5;

/// 1 element (32-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t -= mul_by_generator(&y2);
    });

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut().enumerate().for_each(|(i, t)| {
        let y2 = y[i].square();
        *t += mul_by_generator(&y2) + sbox::DELTA;
    });

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3], state[4]];
    let y: [Felt; NUM_COLUMNS] = [state[6], state[7], state[8], state[9], state[5]];

    let sum_coeffs = x[0] + x[1] + x[2] + x[3] + x[4];
    state[0] = sum_coeffs + x[3] + (x[2] + x[3] + x[4].double()).double();
    state[1] = sum_coeffs + x[4] + (x[3] + x[4] + x[0].double()).double();
    state[2] = sum_coeffs + x[0] + (x[4] + x[0] + x[1].double()).double();
    state[3] = sum_coeffs + x[1] + (x[0] + x[1] + x[2].double()).double();
    state[4] = sum_coeffs + x[2] + (x[1] + x[2] + x[3].double()).double();

    let sum_coeffs = y[0] + y[1] + y[2] + y[3] + y[4];
    state[5] = sum_coeffs + y[3] + (y[2] + y[3] + y[4].double()).double();
    state[6] = sum_coeffs + y[4] + (y[3] + y[4] + y[0].double()).double();
    state[7] = sum_coeffs + y[0] + (y[4] + y[0] + y[1].double()).double();
    state[8] = sum_coeffs + y[1] + (y[0] + y[1] + y[2].double()).double();
    state[9] = sum_coeffs + y[2] + (y[1] + y[2] + y[3].double()).double();
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies an Anemoi permutation to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Applies an Anemoi round to the provided state
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x7addb2a9a748e8ab,
                    0xf9fa97b621c7ae22,
                    0xcf86f0692dcbfb16,
                    0x25d9a745cec867ca,
                ])),
                Felt::new(BigInteger256([
                    0x8ecd0ba1002f329f,
                    0x42667f86e9c76ea3,
                    0x0aacfb529fa01b91,
                    0x1dc90a3d9ffc330d,
                ])),
                Felt::new(BigInteger256([
                    0xe7b0b3da0f93ee91,
                    0x21491128514a28f2,
                    0xb65021d7bb5182dc,
                    0x1c8ddb0e8eab1f33,
                ])),
                Felt::new(BigInteger256([
                    0xc4cea8a38b34329f,
                    0x73fe6c3ddbdb4d9b,
                    0xc213d99cb35bbbae,
                    0x29ea756b125ef4a7,
                ])),
                Felt::new(BigInteger256([
                    0xbf9a4293113a5ba8,
                    0xe25eeac8b887a8f6,
                    0x5d44a080752b6581,
                    0x122a7220d3e7a936,
                ])),
                Felt::new(BigInteger256([
                    0x74f8ecabb72b856d,
                    0x942403cb23a70cdf,
                    0x7a3cd783c00ceeb2,
                    0x0df0bd1c1a0d84db,
                ])),
                Felt::new(BigInteger256([
                    0x3db4a7065bcade58,
                    0xc22afb7f592e226c,
                    0x7789ff2a6aed22f0,
                    0x1932b293c3820ef2,
                ])),
                Felt::new(BigInteger256([
                    0x6a2286c38c5951b5,
                    0x9f4f03db0a3d131a,
                    0xbafe243d9146fa45,
                    0x23a3df3b98c33fe2,
                ])),
                Felt::new(BigInteger256([
                    0x55d7c91e5ff0fc17,
                    0xe45a500eaa9c2111,
                    0xf6451326594c06c0,
                    0x22dcae46961343a8,
                ])),
                Felt::new(BigInteger256([
                    0x4ba8a20db8a1b9ab,
                    0x785ed298cca674c5,
                    0x65541b34ce231917,
                    0x0906d80ad3625507,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x83096b3d39657e8f,
                    0x39f90246819f7249,
                    0xbb481820a382dc40,
                    0x1595cd635ae4e792,
                ])),
                Felt::new(BigInteger256([
                    0x97c1c26472904a2f,
                    0x8f15c6124bcc3c8c,
                    0x7fb79694bfeef3c1,
                    0x1bb6db672383242b,
                ])),
                Felt::new(BigInteger256([
                    0x726c4098e64a625a,
                    0x63bc53275dc84818,
                    0x6bfa6cc0039fa6cd,
                    0x0469d9386977f683,
                ])),
                Felt::new(BigInteger256([
                    0x3725fd61c74c3c35,
                    0x0217ee7e5c3bc1a4,
                    0xc20bc23eb7d1bc56,
                    0x20dc4e19955a40c8,
                ])),
                Felt::new(BigInteger256([
                    0x482d8ee9eb858915,
                    0xcfeb33b0462ea8e1,
                    0x37ce2013f4420247,
                    0x2659e29d6ee1e43e,
                ])),
                Felt::new(BigInteger256([
                    0x79defdecbf7ada00,
                    0x5951f287e60d002b,
                    0xaf8e0dcc5ff14f59,
                    0x24a57759667839c5,
                ])),
                Felt::new(BigInteger256([
                    0x08635b6eb4b2130a,
                    0x7c267f36e4b67aa9,
                    0x4d1865ef63244463,
                    0x21c41c7976d8bf10,
                ])),
                Felt::new(BigInteger256([
                    0x1fc48e0cdeb24aca,
                    0x3956b32c1f175ca7,
                    0x73f18ada7d4d4816,
                    0x0aab3d8258f3770b,
                ])),
                Felt::new(BigInteger256([
                    0x33b376dfd44ec358,
                    0x7930cb687c39b080,
                    0x112a36c5e77d889a,
                    0x13ff9807d9ef2daf,
                ])),
                Felt::new(BigInteger256([
                    0xb68c8383927fd970,
                    0xafd2bcdbd82bc80a,
                    0x7d6773400f202c05,
                    0x09802a1583718d60,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0ab426f61f5430a5,
                    0x296adde2a9609819,
                    0x6a8c400344eb67e1,
                    0x300022cb9e00e013,
                ])),
                Felt::new(BigInteger256([
                    0xf91b1f979ac7b640,
                    0x2b5b6204dfbba810,
                    0x672df08547270fc6,
                    0x026aad17ac3e27e3,
                ])),
                Felt::new(BigInteger256([
                    0xa887a78f5b98149b,
                    0xbcb82bfcb228e272,
                    0xe9243aca09765ff5,
                    0x198300ea3e8117e3,
                ])),
                Felt::new(BigInteger256([
                    0xbf10113712dcbf67,
                    0x285c72c3a66c2a67,
                    0x8b300d420836d22b,
                    0x1c6aa64e4f4ceb49,
                ])),
                Felt::new(BigInteger256([
                    0x358be5a37273ea03,
                    0xfc9d388333ffb9a9,
                    0x5cb7aaf62f15581a,
                    0x20cd60971adac6b7,
                ])),
                Felt::new(BigInteger256([
                    0xe230fe2e0e71bf3e,
                    0x4557c5ccd72f0bbb,
                    0x1ecbe7641e704631,
                    0x25e61e45f1fadb04,
                ])),
                Felt::new(BigInteger256([
                    0x08e3857322bba43c,
                    0x1b2bf032a0283883,
                    0xc92ce8c117d00599,
                    0x26a982cb1c0452ad,
                ])),
                Felt::new(BigInteger256([
                    0xdea8384f9c8feaad,
                    0xc57189bca3a63bee,
                    0xa1ec1a2fd2526c8c,
                    0x06a4224c7650b06e,
                ])),
                Felt::new(BigInteger256([
                    0x73b04dc1295bbf64,
                    0xd74726d97f292d33,
                    0x1361f868f6a240ab,
                    0x0d28bac1242606e7,
                ])),
                Felt::new(BigInteger256([
                    0x0d846d37e6eb5e32,
                    0x7c1a91fb45be6699,
                    0x7925fed3686b330d,
                    0x1145fa57a066a011,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x16e1035b61acd32d,
                    0x945be9acd952c6aa,
                    0x4194ccd3ad5a400b,
                    0x08ba2a959ab92fb9,
                ])),
                Felt::new(BigInteger256([
                    0x6dbc62b5af72408f,
                    0x256efb27c7f7a3d4,
                    0x2950b13d5ba6b9b9,
                    0x20592f711c94e13a,
                ])),
                Felt::new(BigInteger256([
                    0x8e4a702e13197975,
                    0x966d69ea020c9551,
                    0xf9ec00f993b56deb,
                    0x2d0fe8b9c22519b6,
                ])),
                Felt::new(BigInteger256([
                    0x61d933d7ec250e95,
                    0x2faa993c3cd98e0d,
                    0x0cc4e9941afce669,
                    0x0aa0e5dd86757533,
                ])),
                Felt::new(BigInteger256([
                    0x2890349ea430e300,
                    0x30dc7c6017704bc1,
                    0xcd43970c0d9090e2,
                    0x1b906340a11f20d6,
                ])),
                Felt::new(BigInteger256([
                    0xe88c81a96c4a5229,
                    0x271a465c823104bf,
                    0x730bab9be9312353,
                    0x0c3af7f035435a7a,
                ])),
                Felt::new(BigInteger256([
                    0x38926f3e9708315e,
                    0x18e27c235a53a029,
                    0xb1d042fb02a1a837,
                    0x09594d43d0d385a2,
                ])),
                Felt::new(BigInteger256([
                    0x8f48967194de5aee,
                    0xfe2665b84c3626a7,
                    0x6bda70fb6b0688e1,
                    0x2c075ce478f1ec89,
                ])),
                Felt::new(BigInteger256([
                    0x6ae5e69a5f78c8df,
                    0x7b07a478d4448c3b,
                    0xe705f2d20704a39c,
                    0x2913aa779234f71f,
                ])),
                Felt::new(BigInteger256([
                    0x287f7ec7e7478776,
                    0x6294e5f4bbd230d7,
                    0x8ed13c292d314274,
                    0x1aea7c621deb0275,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x34b901302f552c82,
                    0x79f7777d3f6fc5e2,
                    0x8d3ea6cbd73060a9,
                    0x0780a27abd9ab265,
                ])),
                Felt::new(BigInteger256([
                    0xbc1227b64c062cdc,
                    0xa2bdc4afdfa354f2,
                    0xf154175aa43c09c0,
                    0x2e6c9dd88c3e4a3f,
                ])),
                Felt::new(BigInteger256([
                    0x7abe4c4c0a312bab,
                    0x004f2d18937e1776,
                    0x2ff855fb1936be33,
                    0x305915dfddb94b81,
                ])),
                Felt::new(BigInteger256([
                    0x3c7bb43103faf00f,
                    0x1f23f91e1fc80496,
                    0x9adc3b41dee72fd1,
                    0x10bf55dd11bf3cbb,
                ])),
                Felt::new(BigInteger256([
                    0x84b28f5d8fa9117b,
                    0xf2b7bb7fdf00154f,
                    0x8ca572abe3f6a9f6,
                    0x126fc63fd1246330,
                ])),
                Felt::new(BigInteger256([
                    0x6392859503a1d95e,
                    0x1bb8a9ceeb0f1ed2,
                    0xf33e470f27338b13,
                    0x13dafc644e7da3de,
                ])),
                Felt::new(BigInteger256([
                    0x38c90233ef1fe7b4,
                    0xd77ff5b4a6caf5bc,
                    0x35d9c1ddd32eba1d,
                    0x03deb54581319c50,
                ])),
                Felt::new(BigInteger256([
                    0xba942486a4c48563,
                    0x45a92b92fee3cae3,
                    0x8ae18a392dcc8c46,
                    0x12245663691f40a4,
                ])),
                Felt::new(BigInteger256([
                    0xa1460991b47b09a1,
                    0x30e17e7e093486b9,
                    0x7939558c5949f5d6,
                    0x2117f4dfdde8bb88,
                ])),
                Felt::new(BigInteger256([
                    0xee00c32f0d9c7b37,
                    0xdf0e71facc2a8a53,
                    0x6ec11c21e235210a,
                    0x0a68d76fd2acb3e3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xcb80d98d22edf3d2,
                    0x888c5f820a0a131b,
                    0x9f43e5d1151ce6a8,
                    0x18ed180505630dd3,
                ])),
                Felt::new(BigInteger256([
                    0x5c6357fdaf82fe00,
                    0xbe81318b013d6d23,
                    0xd9ced2ff1d9fb95c,
                    0x085df2e0a9113b83,
                ])),
                Felt::new(BigInteger256([
                    0xfe180d74fca9f1cd,
                    0xf6784e4884b2fadd,
                    0x4fe381bd01172939,
                    0x0817604b8dce9e94,
                ])),
                Felt::new(BigInteger256([
                    0x37e61e920a2ce208,
                    0xb4eef8448ba5276e,
                    0x2bfba80aaec45cb0,
                    0x2b15d6f560f632e8,
                ])),
                Felt::new(BigInteger256([
                    0xf8c7c9852a53f137,
                    0x0807b0b1fe086aaf,
                    0xcaa902310c72cfd5,
                    0x1049c010733a4e9f,
                ])),
                Felt::new(BigInteger256([
                    0xd353e08fa6f6b420,
                    0x06a9a3aeb9035c7b,
                    0x0e138295623af873,
                    0x1fd6ae536a01e329,
                ])),
                Felt::new(BigInteger256([
                    0xb9d93e787e9c949e,
                    0x6fd87e18c8f8d1e6,
                    0xdf3efc3c724c6af5,
                    0x2b5aa46da21a231e,
                ])),
                Felt::new(BigInteger256([
                    0x7741e341040a5158,
                    0xdd59721f299d8191,
                    0x27f7becd617530e5,
                    0x07e4f74667dc5dcb,
                ])),
                Felt::new(BigInteger256([
                    0x9e6a37cb0d3d6ef5,
                    0xebe75c9d066f8ca9,
                    0x6b597119ed1f15e5,
                    0x0a6baaa2520489c0,
                ])),
                Felt::new(BigInteger256([
                    0x780bb6dbda125ee9,
                    0x4d416c476e666f4e,
                    0xb62dd685a2d5b0cd,
                    0x08379469570743ce,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger256([
                    0xafd49a8c34aeae4c,
                    0xe0a8c73e1f684743,
                    0xb4ea4db753538a2d,
                    0x14cf9766d3bdd51d,
                ])),
                Felt::new(BigInteger256([
                    0xafd49a8c34aeae4c,
                    0xe0a8c73e1f684743,
                    0xb4ea4db753538a2d,
                    0x14cf9766d3bdd51d,
                ])),
                Felt::new(BigInteger256([
                    0xafd49a8c34aeae4c,
                    0xe0a8c73e1f684743,
                    0xb4ea4db753538a2d,
                    0x14cf9766d3bdd51d,
                ])),
                Felt::new(BigInteger256([
                    0xafd49a8c34aeae4c,
                    0xe0a8c73e1f684743,
                    0xb4ea4db753538a2d,
                    0x14cf9766d3bdd51d,
                ])),
                Felt::new(BigInteger256([
                    0xafd49a8c34aeae4c,
                    0xe0a8c73e1f684743,
                    0xb4ea4db753538a2d,
                    0x14cf9766d3bdd51d,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xbebb490c2e6f962f,
                    0x465ac2ad04e364b4,
                    0xff4b8beb7ecbd2f7,
                    0x1daa245477c958e5,
                ])),
                Felt::new(BigInteger256([
                    0xbebb490c2e6f962f,
                    0x465ac2ad04e364b4,
                    0xff4b8beb7ecbd2f7,
                    0x1daa245477c958e5,
                ])),
                Felt::new(BigInteger256([
                    0xbebb490c2e6f962f,
                    0x465ac2ad04e364b4,
                    0xff4b8beb7ecbd2f7,
                    0x1daa245477c958e5,
                ])),
                Felt::new(BigInteger256([
                    0xbebb490c2e6f962f,
                    0x465ac2ad04e364b4,
                    0xff4b8beb7ecbd2f7,
                    0x1daa245477c958e5,
                ])),
                Felt::new(BigInteger256([
                    0xbebb490c2e6f962f,
                    0x465ac2ad04e364b4,
                    0xff4b8beb7ecbd2f7,
                    0x1daa245477c958e5,
                ])),
                Felt::new(BigInteger256([
                    0xe07a0c33042f6fc0,
                    0xfbc9e1489023576a,
                    0xd40daa7093c5a810,
                    0x01eb281368a433ca,
                ])),
                Felt::new(BigInteger256([
                    0xe07a0c33042f6fc0,
                    0xfbc9e1489023576a,
                    0xd40daa7093c5a810,
                    0x01eb281368a433ca,
                ])),
                Felt::new(BigInteger256([
                    0xe07a0c33042f6fc0,
                    0xfbc9e1489023576a,
                    0xd40daa7093c5a810,
                    0x01eb281368a433ca,
                ])),
                Felt::new(BigInteger256([
                    0xe07a0c33042f6fc0,
                    0xfbc9e1489023576a,
                    0xd40daa7093c5a810,
                    0x01eb281368a433ca,
                ])),
                Felt::new(BigInteger256([
                    0xe07a0c33042f6fc0,
                    0xfbc9e1489023576a,
                    0xd40daa7093c5a810,
                    0x01eb281368a433ca,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x9221c13bf351088f,
                    0x7ba14974192568d6,
                    0x764d83e12590a30c,
                    0x1efdfa43167d3d99,
                ])),
                Felt::new(BigInteger256([
                    0x9221c13bf351088f,
                    0x7ba14974192568d6,
                    0x764d83e12590a30c,
                    0x1efdfa43167d3d99,
                ])),
                Felt::new(BigInteger256([
                    0x9221c13bf351088f,
                    0x7ba14974192568d6,
                    0x764d83e12590a30c,
                    0x1efdfa43167d3d99,
                ])),
                Felt::new(BigInteger256([
                    0x9221c13bf351088f,
                    0x7ba14974192568d6,
                    0x764d83e12590a30c,
                    0x1efdfa43167d3d99,
                ])),
                Felt::new(BigInteger256([
                    0x9221c13bf351088f,
                    0x7ba14974192568d6,
                    0x764d83e12590a30c,
                    0x1efdfa43167d3d99,
                ])),
                Felt::new(BigInteger256([
                    0xa8fad3571dcabf05,
                    0x20a54df8cdb610bd,
                    0xb562a9b2221bf6a7,
                    0x113c1d95ad2f3ee3,
                ])),
                Felt::new(BigInteger256([
                    0xa8fad3571dcabf05,
                    0x20a54df8cdb610bd,
                    0xb562a9b2221bf6a7,
                    0x113c1d95ad2f3ee3,
                ])),
                Felt::new(BigInteger256([
                    0xa8fad3571dcabf05,
                    0x20a54df8cdb610bd,
                    0xb562a9b2221bf6a7,
                    0x113c1d95ad2f3ee3,
                ])),
                Felt::new(BigInteger256([
                    0xa8fad3571dcabf05,
                    0x20a54df8cdb610bd,
                    0xb562a9b2221bf6a7,
                    0x113c1d95ad2f3ee3,
                ])),
                Felt::new(BigInteger256([
                    0xa8fad3571dcabf05,
                    0x20a54df8cdb610bd,
                    0xb562a9b2221bf6a7,
                    0x113c1d95ad2f3ee3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc1291cac726de779,
                    0x730b09508e12a9ad,
                    0x965495beb3b74a80,
                    0x1c9527fa5aabb1b1,
                ])),
                Felt::new(BigInteger256([
                    0xc1291cac726de779,
                    0x730b09508e12a9ad,
                    0x965495beb3b74a80,
                    0x1c9527fa5aabb1b1,
                ])),
                Felt::new(BigInteger256([
                    0xc1291cac726de779,
                    0x730b09508e12a9ad,
                    0x965495beb3b74a80,
                    0x1c9527fa5aabb1b1,
                ])),
                Felt::new(BigInteger256([
                    0xc1291cac726de779,
                    0x730b09508e12a9ad,
                    0x965495beb3b74a80,
                    0x1c9527fa5aabb1b1,
                ])),
                Felt::new(BigInteger256([
                    0xc1291cac726de779,
                    0x730b09508e12a9ad,
                    0x965495beb3b74a80,
                    0x1c9527fa5aabb1b1,
                ])),
                Felt::new(BigInteger256([
                    0x68c3488912edefaa,
                    0x8d087f6872aabf4f,
                    0x51e1a24709081231,
                    0x2259d6b14729c0fa,
                ])),
                Felt::new(BigInteger256([
                    0x68c3488912edefaa,
                    0x8d087f6872aabf4f,
                    0x51e1a24709081231,
                    0x2259d6b14729c0fa,
                ])),
                Felt::new(BigInteger256([
                    0x68c3488912edefaa,
                    0x8d087f6872aabf4f,
                    0x51e1a24709081231,
                    0x2259d6b14729c0fa,
                ])),
                Felt::new(BigInteger256([
                    0x68c3488912edefaa,
                    0x8d087f6872aabf4f,
                    0x51e1a24709081231,
                    0x2259d6b14729c0fa,
                ])),
                Felt::new(BigInteger256([
                    0x68c3488912edefaa,
                    0x8d087f6872aabf4f,
                    0x51e1a24709081231,
                    0x2259d6b14729c0fa,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc68595af69f51310,
                    0x75fbcc48ad493179,
                    0xad60a09102dd9bf3,
                    0x0f35f9b499114129,
                ])),
                Felt::new(BigInteger256([
                    0x031d59175b7976fd,
                    0x64f68f3f6ac49220,
                    0x4fe287b48d9be55d,
                    0x26229385ede5a4c5,
                ])),
                Felt::new(BigInteger256([
                    0x25863a10be89c075,
                    0xc73cde6d5de495d4,
                    0x6487c00f146ceb9e,
                    0x0db7361f8d22389e,
                ])),
                Felt::new(BigInteger256([
                    0x30adc74167ae61bb,
                    0xf27c94b7732049ab,
                    0x90be11609d975208,
                    0x06319f69ca292d3f,
                ])),
                Felt::new(BigInteger256([
                    0x44dfcebd582ba023,
                    0xac19417ab4f82aac,
                    0xd6d49c07ca655c2e,
                    0x06f58a926bb3d9bf,
                ])),
                Felt::new(BigInteger256([
                    0x9793ba3034a3c1bc,
                    0xa743de7ba0b83bec,
                    0x20b82abd0734582d,
                    0x238af436d95b0605,
                ])),
                Felt::new(BigInteger256([
                    0x17b502745b8853ad,
                    0xef0be39bfd68ed63,
                    0xa1a769ab5690d860,
                    0x06939d73d58dba8c,
                ])),
                Felt::new(BigInteger256([
                    0x3e0ee74aaea0ad46,
                    0x4fe9205a25c5b55d,
                    0xe369b48471424450,
                    0x03d2ae14bf52818a,
                ])),
                Felt::new(BigInteger256([
                    0xab5fbbb78b603d53,
                    0x628da35665a68f20,
                    0x7999b0020b444908,
                    0x28f94ad00cd8147d,
                ])),
                Felt::new(BigInteger256([
                    0xfccd1d4bce77143c,
                    0x2f5b188465719ea4,
                    0x49a1172d2145f44a,
                    0x1aacc00e35189ec9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xbbd4eac97f10e167,
                    0xc31ebf39d5975268,
                    0x4632166fbc8c0bed,
                    0x1edf81ea3f74a8a5,
                ])),
                Felt::new(BigInteger256([
                    0x4f50b10f1c4781b6,
                    0xd374c68626ff2cf3,
                    0x4bb933870c5bdbd6,
                    0x2ffaf417285ea367,
                ])),
                Felt::new(BigInteger256([
                    0x9fa30faf11845d3e,
                    0x4c7cb1dc6db2554e,
                    0xc886147cee537471,
                    0x01aeb79246588c72,
                ])),
                Felt::new(BigInteger256([
                    0xabcfd07f0b8cd4fc,
                    0x652df23354bb2291,
                    0x791992e6400ff211,
                    0x26368487296807e8,
                ])),
                Felt::new(BigInteger256([
                    0x1ff65632a9677900,
                    0xac7dbd13e736d1b7,
                    0xe5b4d7711c0f1500,
                    0x0677bd1abe583ec8,
                ])),
                Felt::new(BigInteger256([
                    0x5e3feae4ee8fd8a5,
                    0xcc9264df865e7f15,
                    0xe998da8a3f218385,
                    0x295c82dfb85dcf1e,
                ])),
                Felt::new(BigInteger256([
                    0x1ecfb884dc630255,
                    0xdc9b249e30dc98aa,
                    0xd874ddcd75ed2a76,
                    0x14157426f9dab2cf,
                ])),
                Felt::new(BigInteger256([
                    0xe893d8a2bea781dd,
                    0xffbbf48e9810ed2d,
                    0x676583c351c448b9,
                    0x01fdc318124b46a0,
                ])),
                Felt::new(BigInteger256([
                    0x1ca56e705768fd50,
                    0x4476fa43a29094c9,
                    0x1b7edb85d479782c,
                    0x2aa39249b7611a49,
                ])),
                Felt::new(BigInteger256([
                    0x0773750dd76d8e93,
                    0x7f7e86ce835f821a,
                    0xa19ae7e250e3479a,
                    0x1e4fc4b7061cc1c9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x48a75cb1004618fa,
                    0xb75516a4e3a06e4c,
                    0x994aa1864376490f,
                    0x1627f1ba8f07c429,
                ])),
                Felt::new(BigInteger256([
                    0xd81e85a47007b7ac,
                    0xdaefccb98f58176f,
                    0xc711b4f1c11b3e0e,
                    0x0d5040efd46b2539,
                ])),
                Felt::new(BigInteger256([
                    0xb6cd74587787f94d,
                    0x56b43aa19061dbbb,
                    0xf447062ee1ac9160,
                    0x16a5eb0580bee081,
                ])),
                Felt::new(BigInteger256([
                    0x34578ccea51b2786,
                    0x8f480fe7876dd171,
                    0xebe3b0857afce7b8,
                    0x303de758b9cfbd0d,
                ])),
                Felt::new(BigInteger256([
                    0xc71bc3b45a117208,
                    0x8618d3469cc26f0a,
                    0x2a4ae7dec4f2cf19,
                    0x0784650ae91f3a10,
                ])),
                Felt::new(BigInteger256([
                    0x17b1cd55d4f52a36,
                    0x3c35b43351eba4d5,
                    0xec145794d740addd,
                    0x1ace92620049663c,
                ])),
                Felt::new(BigInteger256([
                    0x3194d36264a1e679,
                    0x8a3b17e8fd75dc15,
                    0x3c330102a2b6b34d,
                    0x0b6b63459c903ef0,
                ])),
                Felt::new(BigInteger256([
                    0xc67fd75f72c79952,
                    0x9c6e07d2ae28b07d,
                    0x83b976ffb6e8cd53,
                    0x07436710625cd887,
                ])),
                Felt::new(BigInteger256([
                    0xcbd975919977627c,
                    0x545dedf37ceb4914,
                    0x1164cfdc643a6886,
                    0x213d91984ce1c2bd,
                ])),
                Felt::new(BigInteger256([
                    0x2275f55bdf1b159f,
                    0x6856d96a5f409349,
                    0xd64001da2073521d,
                    0x0cd46e23355e1d99,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xc306934f49701315,
                    0x20cfb7206f75dba2,
                    0xc24ed62a3cb3bf59,
                    0x1c388ce5ca7ef94e,
                ])),
                Felt::new(BigInteger256([
                    0xe60a3f34778acf2a,
                    0xd5cff36edc5df686,
                    0x9aef8a2304a3e791,
                    0x13c03c80421c6d40,
                ])),
                Felt::new(BigInteger256([
                    0xda3c8f7a6d6bb743,
                    0xdf5d8a1d1a6055c3,
                    0x274001b58c7fd26c,
                    0x06406d7f5daf73df,
                ])),
                Felt::new(BigInteger256([
                    0x0e7c955ca39dcab9,
                    0xbf93be32c56a0cda,
                    0xc53d23596ed48633,
                    0x27badf0d1290195f,
                ])),
                Felt::new(BigInteger256([
                    0x0aa666c74fdf330e,
                    0x790f68b2788dc791,
                    0xe4abe7c3692bef28,
                    0x192c6fea717a4984,
                ])),
                Felt::new(BigInteger256([
                    0x508cf972337a66c4,
                    0x5bb8d7927960d225,
                    0xdd4c360622162da1,
                    0x0a2a9b7f4739e1b5,
                ])),
                Felt::new(BigInteger256([
                    0xc5e8232214dab0a0,
                    0x6ac0ab191f31f3d6,
                    0x6939ff21e750a6ee,
                    0x0b9028f73913f7b5,
                ])),
                Felt::new(BigInteger256([
                    0x9080d8ff847b3770,
                    0x8816a5abe7d21495,
                    0x247ecfc1c269b7c3,
                    0x2e6b246a542afa7e,
                ])),
                Felt::new(BigInteger256([
                    0xe8c00f70e9e9d6e1,
                    0xc351da4ac7253453,
                    0x8cc05e55835dd4ac,
                    0x068a8e29701dbe04,
                ])),
                Felt::new(BigInteger256([
                    0x5c284ea6dea3c71c,
                    0x2843f57b4bad387b,
                    0xdb09ee5c8a5831b2,
                    0x05c5129245d9dd40,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xd8b6ccb3a8e428cb,
                    0xac34811fb15dcb20,
                    0xba57e6891628c9e9,
                    0x0db6d06ce1c68a79,
                ])),
                Felt::new(BigInteger256([
                    0x8a15d2fa6380be76,
                    0x580243b4d8c88ca0,
                    0x88d73b4253219bd9,
                    0x01d2eed22bfe768b,
                ])),
                Felt::new(BigInteger256([
                    0xce68a00e29620406,
                    0xc33c19ccfc5290ea,
                    0x5b4f5eb0afe2000a,
                    0x1a0e89db92805c6f,
                ])),
                Felt::new(BigInteger256([
                    0x05b15bcfc9ad4e4c,
                    0x032034801b6289ca,
                    0x53711e609a741474,
                    0x2dcb250626159145,
                ])),
                Felt::new(BigInteger256([
                    0xfe22e7fd48073add,
                    0x21857a5ff4271bb7,
                    0x12a59c1313ce8bed,
                    0x221ab492172203fa,
                ])),
                Felt::new(BigInteger256([
                    0x8103b32f9cd8d3a6,
                    0x0e7fa86aacfbb037,
                    0x549824dad6fa425a,
                    0x24077f99c9b99133,
                ])),
                Felt::new(BigInteger256([
                    0xe83e033b651a3883,
                    0xb02e47196beb79ac,
                    0xdd8a134f735bc837,
                    0x0e7849584c77d21f,
                ])),
                Felt::new(BigInteger256([
                    0xf14738a17a411e48,
                    0x75580edae0cfedac,
                    0x390153d8fa9fcbfd,
                    0x0cfcc96fdc8bd96c,
                ])),
                Felt::new(BigInteger256([
                    0x414258becf9eb60f,
                    0x4009947a9bd3fbbf,
                    0x214ff4d869079c1a,
                    0x02f71bac6adff2c5,
                ])),
                Felt::new(BigInteger256([
                    0x68c915a24d363fa4,
                    0x389736cc39f79476,
                    0x87798399412d2afd,
                    0x0049282b05491745,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x92db02118ad32df0,
                    0xe56b1fa85cff803c,
                    0x98202cbd20f1351c,
                    0x2522f08d0fe83d3c,
                ])),
                Felt::new(BigInteger256([
                    0x3c50cd157734725e,
                    0x836758d7c812f411,
                    0x99a309e396c799dc,
                    0x1080e9c41699266e,
                ])),
                Felt::new(BigInteger256([
                    0x4405f8210a608e35,
                    0x4c3ead77cd431251,
                    0xb10dba9410396474,
                    0x24bdb29fa17fcf82,
                ])),
                Felt::new(BigInteger256([
                    0xdecfff1d68b677d7,
                    0xbffa94eee8bc96af,
                    0x2a49959fa3d99ce6,
                    0x16696aa6ac5888aa,
                ])),
                Felt::new(BigInteger256([
                    0x7a52ffd07ee10079,
                    0xfd8e198419562919,
                    0x937cef6cf944a81b,
                    0x0a6fdd1e5955cca7,
                ])),
                Felt::new(BigInteger256([
                    0xe2f48fb499c23fcf,
                    0x3ecae484cd7ece44,
                    0x033a8e9e15739eba,
                    0x1547d3735a11ab86,
                ])),
                Felt::new(BigInteger256([
                    0x71b65c97d990f52a,
                    0xa50456055ff29b68,
                    0x37e2496f627f5338,
                    0x00425dbcc19237fd,
                ])),
                Felt::new(BigInteger256([
                    0xba05fe7e80b0c2b9,
                    0x6a6fac77977cb3bd,
                    0xc3b9f10ff14ba82c,
                    0x21593ee29cbb4f67,
                ])),
                Felt::new(BigInteger256([
                    0x39d34bed6bab7f1a,
                    0x801aa9de7268d2f6,
                    0x640e49b29f869a46,
                    0x225a67dff985cc5d,
                ])),
                Felt::new(BigInteger256([
                    0xdfb59aab2c4d504b,
                    0x562e05413fb3c0ef,
                    0x687d8ead8ae1b7b6,
                    0x22c3308e002179d8,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/anemoi-hash/anemoi-hash/
        let mut input = [
            [Felt::zero(); 10],
            [Felt::one(); 10],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0xbd0bb899907546af,
                    0xd59bd08715f7cec4,
                    0x85b6649232418243,
                    0x13acddc93eea49f7,
                ])),
                Felt::new(BigInteger256([
                    0x17d501bf19421a39,
                    0x67f34e6413b9df6e,
                    0x90a75e568d0d2bed,
                    0x06dfbbff0c774a84,
                ])),
                Felt::new(BigInteger256([
                    0x7ed3446eba79ce16,
                    0x5b2cd63dd1bf1c6a,
                    0x66d2bf3a520b81dd,
                    0x28b599fff424043a,
                ])),
                Felt::new(BigInteger256([
                    0x605951dc5be80304,
                    0x67e66dc49ccff2f2,
                    0x8eb79512dc24dc55,
                    0x166354ac706aeca5,
                ])),
                Felt::new(BigInteger256([
                    0x068c17847a143c0c,
                    0x72a5c19441afa728,
                    0xebc11d034064d770,
                    0x2055880af1862281,
                ])),
                Felt::new(BigInteger256([
                    0x1d5289f5450ec637,
                    0x1320afcd1b1010b6,
                    0xb361c16e5db87679,
                    0x1a16de53115b2a69,
                ])),
                Felt::new(BigInteger256([
                    0x417e1620597e9509,
                    0xf0ec9c9758369e4d,
                    0x33b130d761a36e24,
                    0x243aedbcb66ca9a9,
                ])),
                Felt::new(BigInteger256([
                    0xcf0d4557f8e2ebec,
                    0x5408a703586c0670,
                    0x392d60c89d490d57,
                    0x1ff1ba07e1c05764,
                ])),
                Felt::new(BigInteger256([
                    0xf573c6e5370fee58,
                    0x259aa62d0d29e187,
                    0x16549640de0e3bc4,
                    0x05a3bcb606982adf,
                ])),
                Felt::new(BigInteger256([
                    0xcc13c5add7fc809d,
                    0x22a2a296d9b58605,
                    0xe81750e37dcac553,
                    0x15af8b882228887d,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x0124d65941e73b75,
                    0x0e5eaa1f8ece1603,
                    0xa367a8e2e2172032,
                    0x141176db7461e141,
                ])),
                Felt::new(BigInteger256([
                    0x08218ad3054d132b,
                    0xf2861f82b6cf57d3,
                    0x3b2205d35c4a58a6,
                    0x2030dad8c0448472,
                ])),
                Felt::new(BigInteger256([
                    0x418986c6c2e5877a,
                    0x5c2526c6f7ee4400,
                    0xe5bc92a182e3ba79,
                    0x2f4602a57efcbb4d,
                ])),
                Felt::new(BigInteger256([
                    0x0a21728c881af514,
                    0xec7615b4d13948db,
                    0x269504421b0bbd4e,
                    0x02e819fabf8226bd,
                ])),
                Felt::new(BigInteger256([
                    0xbd3ed11b609c23d3,
                    0x2886437247047f3d,
                    0x505a24f670be061b,
                    0x1a534e58461133e7,
                ])),
                Felt::new(BigInteger256([
                    0x7ced9689c1a2fe08,
                    0x0b6808ff06304ab1,
                    0xc1d0f373b5826fc9,
                    0x27ea5cd261b8ed8a,
                ])),
                Felt::new(BigInteger256([
                    0x2f1324b4bc98e40c,
                    0x04d403cf2611a0d5,
                    0x2eeac56381ada0d6,
                    0x2ba97ce5075c953a,
                ])),
                Felt::new(BigInteger256([
                    0x00fefe6e2a12483b,
                    0x36c80569ca86647c,
                    0x683b250ce1f51745,
                    0x1e61671b0d0efd29,
                ])),
                Felt::new(BigInteger256([
                    0x35cf1e294ddc95b8,
                    0xc464e7de4d1ec890,
                    0x38f46deb5f3e9d29,
                    0x286244d27c345513,
                ])),
                Felt::new(BigInteger256([
                    0xe2878efcfd77f6c5,
                    0xf4dca7e4d0bb9e5b,
                    0xa84962ba2edc427c,
                    0x2fa39f24000bbfc9,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3174a28250cafc11,
                    0xad6b870054953a9e,
                    0x482368f7197d44a1,
                    0x18e3c6b38cadcb7b,
                ])),
                Felt::new(BigInteger256([
                    0x6ed319dc9bc3c964,
                    0x6aedd69f461242a4,
                    0x31e1e9eda42fd44a,
                    0x0f255019c9df15af,
                ])),
                Felt::new(BigInteger256([
                    0xeed00c587612cd95,
                    0xdab4e2a18314f3d0,
                    0x705c64c47b6e36b4,
                    0x0e55059f4c84fe90,
                ])),
                Felt::new(BigInteger256([
                    0x485a6908c06ca5f3,
                    0x7aa1755cb1d81970,
                    0x3400b6214465b279,
                    0x120bc139a256dbd1,
                ])),
                Felt::new(BigInteger256([
                    0x5a63fb6f4a29c2b2,
                    0xf0978f80711f6eac,
                    0x3a7bea2c5dcb75ac,
                    0x277957dbc6f71779,
                ])),
                Felt::new(BigInteger256([
                    0x791ab43e7ed73e40,
                    0x7c02032640e6aa34,
                    0xa298dc72f8ff2953,
                    0x064292af95d755bc,
                ])),
                Felt::new(BigInteger256([
                    0x43d1274d744ee0c7,
                    0x66e5390d64a788f8,
                    0xe6ea01686d75a290,
                    0x06206f8098a55d5b,
                ])),
                Felt::new(BigInteger256([
                    0x30d89e7ccb55489b,
                    0x7c004aebc7d0c31f,
                    0x8e47e0777b23a9ac,
                    0x0ab8aadf3ecbc3f6,
                ])),
                Felt::new(BigInteger256([
                    0xd8443b0254339cac,
                    0xdb850d614bbee693,
                    0xe3dc9eb1db06f18b,
                    0x152bc17c2c187884,
                ])),
                Felt::new(BigInteger256([
                    0x43d83ec0e0b33a34,
                    0x3c6c3b8327e754c3,
                    0xfcde70b7b6fb2445,
                    0x1f743ff60a00aab5,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xda44c6d5ce940317,
                    0x451fa751cc797018,
                    0xf2b4e1bbd39c2c4d,
                    0x1eb1a215bea21e09,
                ])),
                Felt::new(BigInteger256([
                    0x5a2f835cc099ea56,
                    0xf7a6fb0e0a522b6e,
                    0x2e03d236dcb75f87,
                    0x1a974e4a3be025dd,
                ])),
                Felt::new(BigInteger256([
                    0x369f67c10db92891,
                    0x11444fc71f6474f5,
                    0x463f12ba2dcb46ac,
                    0x1220329ba3c17baa,
                ])),
                Felt::new(BigInteger256([
                    0x36c8b1cdc973fa25,
                    0xb4d9a6d82a0b330c,
                    0x501d92d9fee33f38,
                    0x2084cf7c9460a895,
                ])),
                Felt::new(BigInteger256([
                    0xa753cae7cb08fa42,
                    0xc568b49694159952,
                    0x0df2b1ee33e0d47e,
                    0x1ac7bf2493c4331d,
                ])),
                Felt::new(BigInteger256([
                    0x7a1d5d99fff96c27,
                    0xe58ebf3573266f50,
                    0xc948d2c23a820442,
                    0x2cc612a871172d4d,
                ])),
                Felt::new(BigInteger256([
                    0x03b4e3acbe6e3b71,
                    0x5783c84d32610581,
                    0x22f8d2a33ded9491,
                    0x0dfffa020cccc7bb,
                ])),
                Felt::new(BigInteger256([
                    0xd55001506d298f00,
                    0x11453f894a1c8d8e,
                    0xf161b57aac448fbf,
                    0x0a4a536795bbd5e4,
                ])),
                Felt::new(BigInteger256([
                    0x9a4837fd8ea1be32,
                    0xc28fc3daecd61796,
                    0x2caba8d1cfda911f,
                    0x0152fdd3c095e40d,
                ])),
                Felt::new(BigInteger256([
                    0x43a4ed346f728c42,
                    0x8ea8c7d33fc07642,
                    0x23114a3ba4462a70,
                    0x18a728045ed0c47e,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xa6059f1c1d80f386,
                    0x4c57a38533c68af7,
                    0x5f57d24f1417e6f2,
                    0x230e735639ff1481,
                ])),
                Felt::new(BigInteger256([
                    0xa498b87f2f38671f,
                    0x82a122d74b76c3f0,
                    0x1884d726dcc041ca,
                    0x2d61d0bedb5da833,
                ])),
                Felt::new(BigInteger256([
                    0x48b1b21de234bb1c,
                    0x4c68f4f7dd76bbce,
                    0x7793de6b97c25196,
                    0x0a624eb0df7916d3,
                ])),
                Felt::new(BigInteger256([
                    0x0b70b95480e9b467,
                    0x16fc8c0cf082f22c,
                    0x2ec6923828e40bac,
                    0x2c40b50029235995,
                ])),
                Felt::new(BigInteger256([
                    0xcd3fb70bccf07699,
                    0x91b60e1a38f187be,
                    0x9b51b6432dbce321,
                    0x197208b3e74fc23b,
                ])),
                Felt::new(BigInteger256([
                    0xdeaf52ef0e24d271,
                    0x06a655d05f337215,
                    0xe366825437453e84,
                    0x3061c54d1b018a45,
                ])),
                Felt::new(BigInteger256([
                    0x92b026dc61f679d6,
                    0x16682a20100963d0,
                    0xa3948fa05d045f08,
                    0x03772ac0389b512a,
                ])),
                Felt::new(BigInteger256([
                    0xc94dd9189b28435f,
                    0x2668a2c4fdbcc966,
                    0xe7cb243e49d75f2e,
                    0x02b2d8f41718fa17,
                ])),
                Felt::new(BigInteger256([
                    0x40df8a6e7255cdf3,
                    0xa17c2b21fcde8e2d,
                    0x1f9bb93da4247efe,
                    0x08c277b3b0be9693,
                ])),
                Felt::new(BigInteger256([
                    0xafecb35c11b06c01,
                    0xf835f18ab3b80d7c,
                    0x7ef9cec29ceff73d,
                    0x290e3b52ea7b399c,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x647c658c41625da2,
                    0x927b32078575cd4d,
                    0x6e1090e7c04aee23,
                    0x18afe917659e335d,
                ])),
                Felt::new(BigInteger256([
                    0x5d1f553b96a42325,
                    0x7e66b12195eff0e5,
                    0x147b993b46baf423,
                    0x1ad3794b90e39e76,
                ])),
                Felt::new(BigInteger256([
                    0x036812bf34581aa5,
                    0xce893d8c7f857873,
                    0xbf805b21aa5d50d1,
                    0x200fc02c27ababf9,
                ])),
                Felt::new(BigInteger256([
                    0xad33daad5a0d9d26,
                    0x4dc86029538c0706,
                    0x6466c1d15001dc10,
                    0x1d53fe42f15b3701,
                ])),
                Felt::new(BigInteger256([
                    0x9ead699cfa654eb4,
                    0x95a795479c0c044f,
                    0x768eb08398e7fda8,
                    0x2db34ea8f1fdb7b1,
                ])),
                Felt::new(BigInteger256([
                    0x029278e0a20e1025,
                    0x3a4ffb9befffcb53,
                    0xbe90043ae5f63bec,
                    0x1e2e274eaa64828c,
                ])),
                Felt::new(BigInteger256([
                    0x1a9909fa7454db97,
                    0xf83545c591e24103,
                    0x05ce8c28dd9fdc3e,
                    0x2f34e87786b145cf,
                ])),
                Felt::new(BigInteger256([
                    0x718876acc979c56c,
                    0x39407f76305bf0e3,
                    0x2b34d5d2c1662e16,
                    0x01f51c0e3a69d0b9,
                ])),
                Felt::new(BigInteger256([
                    0x8af218d568b7173e,
                    0xcbc962a25e13ccb6,
                    0x7ab44f0694131a27,
                    0x1f2ac4f51f6ede47,
                ])),
                Felt::new(BigInteger256([
                    0x9f8b9a067c053878,
                    0x2dc73175d455c32d,
                    0x019e771fc4ddb583,
                    0x046f96d654fe9065,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 10],
            [
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::new(BigInteger256([
                    0x9e9781656bdec97a,
                    0x349731f7cf1b732c,
                    0xb8cbd93e909c74f2,
                    0x030152cae7a7b3f0,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger256([
                    0x1277e3f5e742193e,
                    0x6fe0cc11170ebe9a,
                    0x5df7b83f5bf21764,
                    0x0cc3ef19978afefd,
                ])),
                Felt::new(BigInteger256([
                    0xde3b6034b6a45605,
                    0xcceb9cea5561f14a,
                    0xe5035fb3e5d8c150,
                    0x03b7a3fa2a2caf68,
                ])),
                Felt::new(BigInteger256([
                    0x31860b880a4d30b4,
                    0x83ad3df8e3e5a84c,
                    0x095ab8bff2200f62,
                    0x1f3621af0d26d40a,
                ])),
                Felt::new(BigInteger256([
                    0xd2991bb3a55a957e,
                    0x9e831fb9aced8858,
                    0x46252d4cf733090a,
                    0x060c42eaece5cb20,
                ])),
                Felt::new(BigInteger256([
                    0x433eabc420542be1,
                    0xcfc5111c0ec4bac0,
                    0x7e1c9ae3242ac80d,
                    0x08aa840b30219b08,
                ])),
                Felt::new(BigInteger256([
                    0x4b0f30209ddf3dda,
                    0x12eab016539bf5ac,
                    0x7f40bcd15bd48241,
                    0x0bee8cf54435b6b8,
                ])),
                Felt::new(BigInteger256([
                    0x04789306c7b473ec,
                    0x26a1ae92d4797ffb,
                    0x1542b5ee47bfd6c5,
                    0x0103c3bb1ad11464,
                ])),
                Felt::new(BigInteger256([
                    0x49b57cf55cb9c722,
                    0x2d71b90e0f77deaf,
                    0x42b6a50401f29cde,
                    0x1719c8ba95b98ce6,
                ])),
                Felt::new(BigInteger256([
                    0x4c9541550d746dad,
                    0x87a883b02e4033bf,
                    0x390774f7c2d0d43b,
                    0x1616f40db79a22d5,
                ])),
                Felt::new(BigInteger256([
                    0x7187aba562f36912,
                    0x4e37f23de784f1d0,
                    0xdad0a583fcdf1c80,
                    0x2f2e1e69cc3c0f60,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x3fdf8cb2806f7cd3,
                    0x04c3669d62b91a28,
                    0x69f48e2c5de9a9d7,
                    0x2efb7297c6d1751c,
                ])),
                Felt::new(BigInteger256([
                    0xf9ff94e2198a42cc,
                    0x70f7686695d7221a,
                    0xb52ae33c54b4f242,
                    0x0379e06794cc28e2,
                ])),
                Felt::new(BigInteger256([
                    0x0bbea789a38848c1,
                    0x93bd62e4905d8fe3,
                    0xa876de75bb705b95,
                    0x1fa4042e7b3537de,
                ])),
                Felt::new(BigInteger256([
                    0x15dfa713f5b7d5d5,
                    0x835dd856cb8c9e78,
                    0x4f8aa4eba41f0fb0,
                    0x130a8379f3fc1740,
                ])),
                Felt::new(BigInteger256([
                    0x6ab1cb277b1c9324,
                    0xf8d069c414fb8f25,
                    0xf2d157266ff46222,
                    0x07d9bd158c62f044,
                ])),
                Felt::new(BigInteger256([
                    0xfabb19316873df57,
                    0x7b348e91547ecf49,
                    0x087a3bcfb64ba416,
                    0x04a051c0e380b285,
                ])),
                Felt::new(BigInteger256([
                    0xebf44a2b00034f4a,
                    0x05761d2d7b9bd870,
                    0xe8221f591a263ad5,
                    0x0af3bfb9a6c5aff2,
                ])),
                Felt::new(BigInteger256([
                    0xbb00f6c2079d9ddf,
                    0x7e2240ce406e0caf,
                    0x00107af78e935aae,
                    0x020292995306426a,
                ])),
                Felt::new(BigInteger256([
                    0x68501f30d51ecc68,
                    0x3d49c51077f0943c,
                    0xc91a614d3ce637a8,
                    0x09ac083e6bfa293d,
                ])),
                Felt::new(BigInteger256([
                    0x5d79f523d9de0171,
                    0x0be76fbd57169ef5,
                    0x6b3ace76b3c84b81,
                    0x2a23df16d42cabb3,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0xad319a17d7dfa689,
                    0x2169be7f45c75df7,
                    0xb55704978bfe68c2,
                    0x0dd7beb87fef605a,
                ])),
                Felt::new(BigInteger256([
                    0xf2a5a6f8244f92fe,
                    0xb67510606efad8b1,
                    0x86af3e9d58e5e5b8,
                    0x1b37b532b04e9ddc,
                ])),
                Felt::new(BigInteger256([
                    0xcd852a7e500dab2c,
                    0x6667d434c650d1a5,
                    0x1be66ca46b126ffe,
                    0x23bca30a20a9fa2c,
                ])),
                Felt::new(BigInteger256([
                    0x6fd634b97ff393ee,
                    0x6f344cabbe3010db,
                    0xa6ab1e2f61089ee9,
                    0x167941754f74847a,
                ])),
                Felt::new(BigInteger256([
                    0xd0b36da2ce399c9f,
                    0xb9405add133ecaea,
                    0x4428d6142006d48c,
                    0x0f66633ba9104889,
                ])),
                Felt::new(BigInteger256([
                    0x79dac6b1d74c2a5a,
                    0x7529ffa3520c7bb1,
                    0x5ffcb8392c911f20,
                    0x2be9024eec2b61c1,
                ])),
                Felt::new(BigInteger256([
                    0x57c486fa7912f8f1,
                    0x38c7f4fe4cd09e00,
                    0x4cc47902fde0d10f,
                    0x24c0b92637e985de,
                ])),
                Felt::new(BigInteger256([
                    0xd68aa7dff1db87ee,
                    0xcd096d7376b6cdc9,
                    0x02a43b9616046352,
                    0x0457e286f09a8d34,
                ])),
                Felt::new(BigInteger256([
                    0x949bd98b2cda5775,
                    0xc8b2ae218efafd0b,
                    0x1f62d5e126073240,
                    0x0b445a45bcab0252,
                ])),
                Felt::new(BigInteger256([
                    0xd71d205dcf039c29,
                    0xfd926734e947c9e7,
                    0x1a93d10f4f5c8a9e,
                    0x2c8bc04e674d15cd,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x53346a93e9eb460d,
                    0xfa7bca0ce6753b58,
                    0x6f77c932ae1d18a6,
                    0x24e55cb7f1c2f7a8,
                ])),
                Felt::new(BigInteger256([
                    0x34cbad9c9bcf0f99,
                    0xdaae01c5b2ff7ae5,
                    0x976ca02eecb1d06e,
                    0x0fbaa2c39b71fc9f,
                ])),
                Felt::new(BigInteger256([
                    0xea8051cd4a2ec495,
                    0xdc8faef6901483a7,
                    0x66e97562dbcd27ae,
                    0x2ff92a2bf0fc91ec,
                ])),
                Felt::new(BigInteger256([
                    0x41e210cf5bd384e8,
                    0x5a08e2860eaf8950,
                    0x4347a87c7ae50d8c,
                    0x09a185f15df7d674,
                ])),
                Felt::new(BigInteger256([
                    0xd7ac5f3d16285467,
                    0x9a44e46df432d4eb,
                    0x2a114b7bc4b70ba0,
                    0x2199fed252949b2e,
                ])),
                Felt::new(BigInteger256([
                    0x74204129a9bb65e1,
                    0x425b44c5a6a55592,
                    0x0adce14f84db2c31,
                    0x0c001f1c6ca5dd21,
                ])),
                Felt::new(BigInteger256([
                    0xccc1a129ef41dc1f,
                    0x3e94c1cd4c082163,
                    0x095f02f17f9585e1,
                    0x2c511f432ff6e251,
                ])),
                Felt::new(BigInteger256([
                    0x590616d2df18554a,
                    0xc0c7135ab7e3c0d6,
                    0x54d1e4b5f12d2f85,
                    0x19ca5ea12c925c09,
                ])),
                Felt::new(BigInteger256([
                    0x6d286ec59f0ea5e1,
                    0xc62271a7d955429a,
                    0xd134e5c7d463f7e9,
                    0x0e08801b6c963455,
                ])),
                Felt::new(BigInteger256([
                    0xc89996d90bb4158e,
                    0xe6679264d430a0ee,
                    0x412ac56cec00ff4c,
                    0x18a38c7a96bc5cbc,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x73b085cb33c8c45a,
                    0x2ca8c76fb2d69d53,
                    0xdfc8ef353454f8eb,
                    0x1cb1bc14d357315f,
                ])),
                Felt::new(BigInteger256([
                    0x6592a188bf0bf3f3,
                    0x850166dc351d0d1d,
                    0xeb97ed687d0daa5c,
                    0x1e0fdfe50abc99c3,
                ])),
                Felt::new(BigInteger256([
                    0x31ae2e9db72bc03b,
                    0xebfdbdeeacc85b44,
                    0x3d24574adaf077bc,
                    0x0e30ee63236c107f,
                ])),
                Felt::new(BigInteger256([
                    0xe79849900a5e5f62,
                    0x5a3f846002668131,
                    0xdd944669f0aa7fd1,
                    0x152e708f7fb76af4,
                ])),
                Felt::new(BigInteger256([
                    0x9fe4f9f5e9192a70,
                    0xb6f6eb28cb85e9a6,
                    0x9195ef637606f4de,
                    0x17ebf001143e4916,
                ])),
                Felt::new(BigInteger256([
                    0x1a971e8e45350bc8,
                    0xcfd0026b03432928,
                    0xdc4832dc8dd73573,
                    0x030c7092a8260753,
                ])),
                Felt::new(BigInteger256([
                    0xcd3db70579881356,
                    0x169ee26f07a3b197,
                    0x39a33938e86d2e90,
                    0x06bcc871e5fc9b49,
                ])),
                Felt::new(BigInteger256([
                    0xd59ddf28dc23f45e,
                    0x694b4a31613f45fa,
                    0x7cd1ebdbc6252859,
                    0x1cbfb0e7bd62157c,
                ])),
                Felt::new(BigInteger256([
                    0xfbdfef26648fc75a,
                    0x3c9fe8c4f0fe37d9,
                    0x61645e01c2d24173,
                    0x09404fdadbd6b024,
                ])),
                Felt::new(BigInteger256([
                    0xd7a36712506f7a8b,
                    0x623e4d146bdaeeef,
                    0xe5cacb2c0a097915,
                    0x09e8aba5a9208318,
                ])),
            ],
            [
                Felt::new(BigInteger256([
                    0x40c0f4e74c5dea0c,
                    0xb4d6dd2bdff06fb0,
                    0x704efc3e339fc5a0,
                    0x099814c320f6069c,
                ])),
                Felt::new(BigInteger256([
                    0xbc21ad666d413cb7,
                    0x15c29f516f967336,
                    0x86eb5cfb78a85b30,
                    0x11953a4f65f02d95,
                ])),
                Felt::new(BigInteger256([
                    0x0f2e09e7b06bdff0,
                    0xe32b46c7672e21af,
                    0xe3bd42911bdee02e,
                    0x2c3c39aa505dee85,
                ])),
                Felt::new(BigInteger256([
                    0x1dd7c6e2b4fb2c55,
                    0xe11f2f4111c63ca9,
                    0x721523ed8c7e45dd,
                    0x1d913aa6148f5d36,
                ])),
                Felt::new(BigInteger256([
                    0xa926fe84cf70a7df,
                    0xa65a5d293f9554d0,
                    0x539315065ad794e2,
                    0x269e280b56308811,
                ])),
                Felt::new(BigInteger256([
                    0x4f3f471b7f6129ac,
                    0xe2761d9d6b24de10,
                    0x0e889e6de37d4844,
                    0x14f59c96802ebeb8,
                ])),
                Felt::new(BigInteger256([
                    0x89601245b0392661,
                    0x949e6d3a614d2514,
                    0xff8b2a3c83ffe2c6,
                    0x100d597f9a4fc61f,
                ])),
                Felt::new(BigInteger256([
                    0x6b804e3e78acd9f3,
                    0x1a8f9be8c912eb0b,
                    0x55638e513f49c8a9,
                    0x2268292b6b476032,
                ])),
                Felt::new(BigInteger256([
                    0xc9e1b314c1217857,
                    0x0c1dff6d36b28acb,
                    0xd9c11a43a32256bd,
                    0x01289b69f1ed1d84,
                ])),
                Felt::new(BigInteger256([
                    0xcac51bfc1fd2be34,
                    0x944a97550f2ab789,
                    0x57a58abb2a643526,
                    0x248a3029824104f7,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
