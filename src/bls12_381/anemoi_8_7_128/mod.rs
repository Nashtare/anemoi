use super::{sbox, BigInteger384, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// Function state is set to 8 field elements or 384 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 8;
/// 7 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 7;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 4;

/// 1 element (48-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= y[i].square().double());

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t += y[i].square().double() + sbox::DELTA);

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3]];
    let y: [Felt; NUM_COLUMNS] = [state[5], state[6], state[7], state[4]];

    let sum_coeffs = x[0] + x[1] + x[2] + x[3];
    state[0] = sum_coeffs + x[2] + x[3].double();
    state[1] = sum_coeffs + x[3] + x[0].double();
    state[2] = sum_coeffs + x[0] + x[1].double();
    state[3] = sum_coeffs + x[1] + x[2].double();

    let sum_coeffs = y[0] + y[1] + y[2] + y[3];
    state[4] = sum_coeffs + y[2] + y[3].double();
    state[5] = sum_coeffs + y[3] + y[0].double();
    state[6] = sum_coeffs + y[0] + y[1].double();
    state[7] = sum_coeffs + y[1] + y[2].double();
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies Anemoi permutation to the provided state.
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Anemoi round function;
/// implementation based on algorithm 3 of <https://eprint.iacr.org/2020/1143.pdf>
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0x7b89d1250dffbf98,
                    0x8a950f769042423f,
                    0x206b5139c5115a83,
                    0x9b232c130de73f18,
                    0x0ae9e5f6749b9d14,
                    0x04f765945f0c1b69,
                ])),
                Felt::new(BigInteger384([
                    0x33de77e594a24397,
                    0x4564e6ff8589524f,
                    0x6833c04d2444d8f4,
                    0x312f5c0189f1b559,
                    0x526a0ee13031d5cf,
                    0x13f48c5442a12131,
                ])),
                Felt::new(BigInteger384([
                    0x192ed4424b9673c6,
                    0x5954cf26b6e23106,
                    0xb482729cee2c0664,
                    0x637119a35d55c612,
                    0x5656200f72489121,
                    0x0f1eb2da32645350,
                ])),
                Felt::new(BigInteger384([
                    0x9169215f2273b8c5,
                    0x8cca0d0e4ce324b3,
                    0x84be6ed2bbfdf3fe,
                    0x8cb2789e044ab58f,
                    0x6508e0815ab2a3d9,
                    0x0681b3d2d2f8a38a,
                ])),
                Felt::new(BigInteger384([
                    0x6b650f08ae2ebec7,
                    0xec07a564650de9f0,
                    0xb129d82335a83437,
                    0xd8cd31de0a6a4f83,
                    0xee9002cc7c1e9dca,
                    0x0298d8fedeb058c0,
                ])),
                Felt::new(BigInteger384([
                    0x22bb4d13b1a1b757,
                    0x502871ea697aac6c,
                    0x013b10011e2133e7,
                    0x3239c4bfba4adfad,
                    0xe11860198e808380,
                    0x0e772d371ee65479,
                ])),
                Felt::new(BigInteger384([
                    0xbf4700864885f07a,
                    0x7b6c7dfaaf3b2421,
                    0xc113b5a7440f45ae,
                    0xf43a079cce4d0728,
                    0x6662b78a7dc7b88e,
                    0x16d367503c864e0f,
                ])),
                Felt::new(BigInteger384([
                    0xabb7582fd6c3a63e,
                    0x32dc20dbf67709c5,
                    0x8683013dd5de0590,
                    0xef8c43c944850d2f,
                    0xc9c2cc27be78cef6,
                    0x0e0265990bb85303,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x5d67f3fd70deac96,
                    0xfe0c97f4d37545aa,
                    0x5cf4e23e41540879,
                    0x9cbb87dc2c0ff6fc,
                    0x90f42d51b90947db,
                    0x102f2c3a1138c799,
                ])),
                Felt::new(BigInteger384([
                    0x1911b288c20d73e6,
                    0xc3f9ac91998a2a7c,
                    0x33ffa6b01264bc37,
                    0xee74e00e5bc23b0e,
                    0x31d3a504a8a381f8,
                    0x162df7bf875762f4,
                ])),
                Felt::new(BigInteger384([
                    0x63d663542f79ec3f,
                    0xf9059b07d0fe4132,
                    0xc773ca8e96315eb0,
                    0x29defc9a1a565db6,
                    0x4f0861cfc1215130,
                    0x162caf8842b36204,
                ])),
                Felt::new(BigInteger384([
                    0x14e7de69883a3cf2,
                    0x0576f53dd52cebed,
                    0xd4c6e15c869afbc2,
                    0x1b3492f489109d65,
                    0x43ca55327a63eb9a,
                    0x0f82d441feed179b,
                ])),
                Felt::new(BigInteger384([
                    0x07e1072754d78a5c,
                    0x23f9dfea771114e2,
                    0x6650833acc834e09,
                    0xaad550c6b6b88835,
                    0x3d0b320b681d1d4f,
                    0x10427543799aea2a,
                ])),
                Felt::new(BigInteger384([
                    0xa8e04bb23f634fc4,
                    0xbc0da6d2e2823816,
                    0x903957491d0d6534,
                    0x239b218110792e9e,
                    0x7c3be47be487118d,
                    0x14d3d92352602306,
                ])),
                Felt::new(BigInteger384([
                    0xde8a370961be55fe,
                    0x18a720744ffd5ab2,
                    0x82c1ccc5f535f78b,
                    0x7f4053babed81475,
                    0x4e18e40fe9c347a3,
                    0x17f989c7489f863c,
                ])),
                Felt::new(BigInteger384([
                    0x69a964b4733ac320,
                    0x553521587e1e676e,
                    0x29519d16f2a1d7e5,
                    0x8ef540824e280539,
                    0x517cc1305acde3f5,
                    0x0ee095fad9ce7c99,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x96b941f162871f6a,
                    0xd705b05239aa83c6,
                    0x049ff5f1a5edc7b8,
                    0x69a8373edd970e62,
                    0x9020fd60a5244c05,
                    0x014101d36f640fe6,
                ])),
                Felt::new(BigInteger384([
                    0x738fb0c610cef1a0,
                    0x8a26156a0095979c,
                    0x06ec4c9b61289d9d,
                    0x3fb957628877f704,
                    0xcaf8283189f39e64,
                    0x0a5c15f619ddba17,
                ])),
                Felt::new(BigInteger384([
                    0x1fd84102f9397bf5,
                    0x9f531f5ebf11838e,
                    0xd7839ba3d8c92ba3,
                    0x1d80602a5f105bd3,
                    0xf971357da38f91f5,
                    0x079eb3d3c950a10a,
                ])),
                Felt::new(BigInteger384([
                    0xc08f71eea153da32,
                    0xaf47e27cfcbbd353,
                    0x2472a715c1c72baf,
                    0xb6637216410a4fb9,
                    0x67f2ad1ee974a28f,
                    0x17408673612eb644,
                ])),
                Felt::new(BigInteger384([
                    0x647e68e344eca24c,
                    0x15089d5d91fc782b,
                    0x0dc95124820475a2,
                    0xf6c8acae90348a14,
                    0xf5ad36472f8ca5a1,
                    0x10aabb37d2cf044b,
                ])),
                Felt::new(BigInteger384([
                    0xcfdf31ceef854ea2,
                    0xcd183df7b1b406e1,
                    0xd52dca9af160c1f5,
                    0x2326c6f565367673,
                    0x63acfaefc99196c4,
                    0x0280e676f2279e98,
                ])),
                Felt::new(BigInteger384([
                    0x3de272541c964f35,
                    0x895f52cc223d06e3,
                    0x8b0b295522dc653c,
                    0x7147c8cfd19637a1,
                    0x1e87e374b20c41f2,
                    0x061d064f9d40695d,
                ])),
                Felt::new(BigInteger384([
                    0x323fc5c764c38541,
                    0x6d6d96386144e948,
                    0xf62e29714c9c6a90,
                    0xd915643e5c6c55f9,
                    0x73f6f4815257e2ff,
                    0x03e2ca97c0e2ecc1,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xac55d017330d748d,
                    0xb176f7508a914e16,
                    0x4e7fae5bbd01dfdc,
                    0x2d1ec2bb87fb1857,
                    0x96044e514a159358,
                    0x00c36a397050c228,
                ])),
                Felt::new(BigInteger384([
                    0xe5bb3a332c54a394,
                    0x37d1a6c992f59a4f,
                    0xf4e92df4fb1f6e33,
                    0x8eb1d8955f5b51ae,
                    0xa5736c530a39c2a2,
                    0x001ac62fc6a53338,
                ])),
                Felt::new(BigInteger384([
                    0xf9e70d4b6fcdef65,
                    0x1b4a63a1dd9d5997,
                    0x336ef4be960f986b,
                    0x000ff6d7b68ace8a,
                    0x5fe53b631bc3106e,
                    0x03fdd991b08823e4,
                ])),
                Felt::new(BigInteger384([
                    0xbfb3180cf26c1e8d,
                    0x66436a8bf5b6a986,
                    0xe538549fbc6bc3a6,
                    0x22b589753eba79fc,
                    0x8ddb62a25cddfb70,
                    0x08a55300e4dd7905,
                ])),
                Felt::new(BigInteger384([
                    0x3c9718264a9d7abe,
                    0x15f71e6b8e06482d,
                    0x91b82835c251ce21,
                    0xdeba1c2ba4db608b,
                    0xff2eb11975e36341,
                    0x0bd6916fb2d11f72,
                ])),
                Felt::new(BigInteger384([
                    0x4f78676da60be794,
                    0x509fd3bbbcb92046,
                    0xbe4ae88ce05534a5,
                    0x5632b6ea64af8886,
                    0x0cc45bdeb4a955b3,
                    0x109ff6eeaa8e1ff1,
                ])),
                Felt::new(BigInteger384([
                    0xaf72451e6930b8a1,
                    0xa75d77913a225b07,
                    0x4e2cca3eae1ad33f,
                    0x03f82e7d85dbfcb0,
                    0xdbdfbf7beebcc009,
                    0x17e11d9b19013d86,
                ])),
                Felt::new(BigInteger384([
                    0xc7263baae1b813d7,
                    0x323753622f5b1de1,
                    0x85e3b034ed344307,
                    0x23fc4ce827ceac8e,
                    0xaffaeecda43c0a8f,
                    0x0a17210238136fea,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0d3d5322dc7a1746,
                    0x9fcec1963b9f1228,
                    0x67288b2f4527ddd7,
                    0xd5707e5d69a94e48,
                    0xcd3b2e47ebd4a37c,
                    0x03b1af8185c84876,
                ])),
                Felt::new(BigInteger384([
                    0x49e553ee22d81152,
                    0x4c256a0072f12f53,
                    0x3506bcde62be6d54,
                    0x9ea4e3b4ebb36ee6,
                    0x4373324688c1392f,
                    0x01425a91f702b98e,
                ])),
                Felt::new(BigInteger384([
                    0xe92dd6ee6108ec4a,
                    0x6635ead04cb7cf57,
                    0x4dbe4c55470b6018,
                    0x26880105f691cd66,
                    0xdc312abe309b63da,
                    0x16077d548116bf7a,
                ])),
                Felt::new(BigInteger384([
                    0x06aee3882a698e49,
                    0x940467b67d8c8eda,
                    0xe114fedad5acda06,
                    0x571c1652cc0730b0,
                    0x8094fcd0d315deaa,
                    0x046c6cf6d5a06f9d,
                ])),
                Felt::new(BigInteger384([
                    0x2e96f1e952f8d691,
                    0x00d297c726ca75ef,
                    0x9d2f598a703cb51c,
                    0x88d8eec5f9ded0fb,
                    0x5c9104b3fe37af85,
                    0x167091cc9225ec95,
                ])),
                Felt::new(BigInteger384([
                    0x1e904716844602be,
                    0xd39bc7aa06ff8e26,
                    0xb865f26b36ef4078,
                    0x91e86ec51fdcaa44,
                    0x45bfda688c129dbf,
                    0x10b3649d5f967385,
                ])),
                Felt::new(BigInteger384([
                    0xd4302414c4e7aa22,
                    0x260792863e4bb5e1,
                    0x0f4355038efe050c,
                    0x73a1abff01e54c77,
                    0x98d2d51195339f20,
                    0x1622da4baba6639b,
                ])),
                Felt::new(BigInteger384([
                    0x79b771fc22f7a701,
                    0xe83db435e4229e07,
                    0xcf0f614696115334,
                    0xd54232b618a8a007,
                    0xe9a0f8e8014a5e91,
                    0x0ee0e8dc4367d847,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0f4ec20f25f8c56b,
                    0x4aa69252ea7b3d2e,
                    0xeaa4d65eb6702c00,
                    0xa4b200ec234aaff5,
                    0xecebe3a1c4bd45d5,
                    0x0eb124ce1787414f,
                ])),
                Felt::new(BigInteger384([
                    0x22995a32f1fa855e,
                    0x43b22f64ed39d8a0,
                    0xf4d846b47d754019,
                    0xae52bbf4c1f119bc,
                    0xc09b5e5fb5c0665f,
                    0x12690e6f719a583e,
                ])),
                Felt::new(BigInteger384([
                    0x9def96c2665512a8,
                    0x75f3451a36f10d16,
                    0xbca14b16455cb8f3,
                    0x83485cf2f8e5f2c8,
                    0x8f86206519ae4970,
                    0x0e1b1aed9d6d0838,
                ])),
                Felt::new(BigInteger384([
                    0x70d0059674f6ff94,
                    0xc106d446f5cd931b,
                    0x0250c643d243e9ab,
                    0x821b71346aaf839b,
                    0x6c06dc39c4aa3926,
                    0x0ac0a5e6645cbc05,
                ])),
                Felt::new(BigInteger384([
                    0x03ab9d6090aae2a8,
                    0x373a040a006500f1,
                    0xbcac74d81a41ee0e,
                    0x7e72a5c925d7d787,
                    0x8f71b68e9d7efd78,
                    0x14ab61e8891e54e3,
                ])),
                Felt::new(BigInteger384([
                    0x6f15ae6ec284d0a2,
                    0xeb965cce6e6b0e83,
                    0x9b4a13563f1acdac,
                    0xf6980de0828f693d,
                    0x5cb0eb35bf108b16,
                    0x1496d56001dea969,
                ])),
                Felt::new(BigInteger384([
                    0x5f42402de5069370,
                    0x0878128efb04db32,
                    0x8328af432e54a932,
                    0x0fed5b9956af960c,
                    0x7dec64f65356cf5a,
                    0x0930ca06fde18392,
                ])),
                Felt::new(BigInteger384([
                    0x403c334b030bda40,
                    0xcea2c4761f62efb9,
                    0x3e7889cf3c89aae0,
                    0xb4c9cd03e8bdf428,
                    0x10a19527cea98956,
                    0x1931641fbfd72330,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x7ce70faa0b8909b2,
                    0x69496370e8e1b2a2,
                    0xb161890b2ea5855a,
                    0xb521dd21c4141d01,
                    0x5a796db65cb7c703,
                    0x0ec5791a451114ae,
                ])),
                Felt::new(BigInteger384([
                    0x45c9a413d8046445,
                    0x3e811846dfb2c7e0,
                    0xa0b87b3177f57f0f,
                    0x2794c4066c2e0a9b,
                    0xfffa81cf67c6a42a,
                    0x0812d3c54e137366,
                ])),
                Felt::new(BigInteger384([
                    0x74af4be16269cb8b,
                    0x182eeb253f911717,
                    0x4e70437385c987ea,
                    0xc7ef9cd204722ef7,
                    0xd308f787be22c0d9,
                    0x066890c039c6f07f,
                ])),
                Felt::new(BigInteger384([
                    0xc57e86a4f16b0cdc,
                    0x9ce39e6a520a913c,
                    0x518d6aa96302fcc6,
                    0xeb14d69a45c4d5c4,
                    0x899cf1447f92a263,
                    0x0276bdd9f9cc41fd,
                ])),
                Felt::new(BigInteger384([
                    0xe52b106c99a58540,
                    0x2935829aebff0fb7,
                    0x58d48f94328f4d8b,
                    0x0d8c4037f70d8bdc,
                    0xec642802575289af,
                    0x06b72bccd106ba77,
                ])),
                Felt::new(BigInteger384([
                    0xa6843979d3635590,
                    0xe1bac3877b22168c,
                    0x2fe4b719e1af97bb,
                    0xe0ecf60f484ab161,
                    0xc6e31eed788697eb,
                    0x0c721e0e74e3bfac,
                ])),
                Felt::new(BigInteger384([
                    0xb2135d223037eed8,
                    0xfe1cc717aee1fadd,
                    0x149934b4448dc32c,
                    0x04147d3652dd8d38,
                    0xa3c644356e65f1dd,
                    0x0f53208aa51d0acc,
                ])),
                Felt::new(BigInteger384([
                    0x21cb3992eb6c637a,
                    0x69fbf125c2516735,
                    0x195dcf1f20c9ec1e,
                    0x1ebd4bd7cb64bafb,
                    0x1a03ca83b1d249bc,
                    0x1131ed58394ab71a,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe85b045e17527949,
                    0x67552dff1da7c7d3,
                    0x51889e852bfe1d7e,
                    0x5c993f7baf3bf9d1,
                    0x1f56a9594c048594,
                    0x0f450fd0106339e6,
                ])),
                Felt::new(BigInteger384([
                    0x2a2b8d64b47727a7,
                    0xd4744abb03a91597,
                    0xbcf639e486091051,
                    0x767073e7d656d3c1,
                    0x1453c922b9d494cc,
                    0x0a260835471d0c84,
                ])),
                Felt::new(BigInteger384([
                    0xde8e89daf6e69633,
                    0xace37c1f1320204b,
                    0x9c5b28e9010436d7,
                    0x5643070a7ad02462,
                    0x4552241c5f5465f3,
                    0x066131b9729021cc,
                ])),
                Felt::new(BigInteger384([
                    0x3114d1f554a74c50,
                    0x9d8ae8322a18e746,
                    0xed5ce5d5f3709aec,
                    0x819afac0dd9cc71e,
                    0x380eb6b6e7da9d47,
                    0x09735157ad3208de,
                ])),
                Felt::new(BigInteger384([
                    0x2185268c4418ec78,
                    0x719a4b5594f23af6,
                    0xe0fda83475079351,
                    0x1deb2d32eccf58bc,
                    0xdc14f6a520bd5918,
                    0x1683d3845f731ace,
                ])),
                Felt::new(BigInteger384([
                    0xb6e871a1f74c21b5,
                    0xb156103e85c304c4,
                    0xb133dbae54221671,
                    0x30da55973df778ea,
                    0xab54992a59acbee0,
                    0x1210000f3de9617d,
                ])),
                Felt::new(BigInteger384([
                    0xdbefad204d0f5891,
                    0x826cf15d9b270b8a,
                    0x1527c7403d32b451,
                    0x77e257268cb13010,
                    0xfb7583a9785aaf52,
                    0x130c655d614e775c,
                ])),
                Felt::new(BigInteger384([
                    0x609da72d7c755b00,
                    0x289c7cbe499a99f3,
                    0xad1329f6a779faf1,
                    0x9716fbadae7d020c,
                    0xbcba817d70c2347a,
                    0x0428771df38742aa,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xfd9c51d834847088,
                    0x4faae36887470d05,
                    0xd4b6b4bbb6b780d2,
                    0x3a3c6ae7e572a4e0,
                    0x8065f366569adc63,
                    0x0528071c93a3362a,
                ])),
                Felt::new(BigInteger384([
                    0xe46c5c632a980d7d,
                    0x40cb96cf292f8ceb,
                    0x71e8a777ec412c72,
                    0x7c958ee396083ed3,
                    0x294e8a81911ca231,
                    0x0214f354075fc9c1,
                ])),
                Felt::new(BigInteger384([
                    0xc1231a042c0a3c2b,
                    0x0da940c655469b86,
                    0x30f6c8684137b67b,
                    0x707416011d046509,
                    0x734d6ed42794cb31,
                    0x112e4035a347ba89,
                ])),
                Felt::new(BigInteger384([
                    0xf447f243b5657485,
                    0x7bd1d9c8e6b1e1bb,
                    0xdb3bb23c78bca06c,
                    0x03c3036a78436814,
                    0xe07f4fe1c2706ab8,
                    0x00652a386889e907,
                ])),
                Felt::new(BigInteger384([
                    0x8d42578e18ee5710,
                    0x023fcd7055eac4cf,
                    0x7f54d29bd8b9566f,
                    0x1ac6ecfd37f77527,
                    0x93dfaafbfe19ce67,
                    0x0f0b37d5dff79fdd,
                ])),
                Felt::new(BigInteger384([
                    0x63c2a2df2dbef600,
                    0xeee77677b25210df,
                    0x897526856a00abea,
                    0x7d94dedb0cce8e94,
                    0xd91c5827020aa05c,
                    0x116fc7e87aa412b4,
                ])),
                Felt::new(BigInteger384([
                    0x6c42e4a72ab66b54,
                    0x513795098c748f95,
                    0x11f1e4e10b82f9cc,
                    0x00673b139d650897,
                    0x08e2c9131b57e6ed,
                    0x14a5cfb69f9ac461,
                ])),
                Felt::new(BigInteger384([
                    0x4e2a9de42a150d3e,
                    0xc1a3d18d895aa34b,
                    0x692594047260613e,
                    0xcb5e22e33bae6f9a,
                    0xdfacc068560f8f52,
                    0x0f70193433c3bc23,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x07751c160c25bbd2,
                    0xe599f6271b9d0838,
                    0xf03ee13d9de2c156,
                    0x21bde4e99b223a32,
                    0xa19e52207c314c66,
                    0x0caab2ee6d30f8fd,
                ])),
                Felt::new(BigInteger384([
                    0x3c6e1ca2e396d94e,
                    0x3e08bcd6a75b2763,
                    0x25f3f0c8f02d7207,
                    0x0ab4c5ad3152d636,
                    0xbc7595907b17d483,
                    0x07d0f1ba76522aff,
                ])),
                Felt::new(BigInteger384([
                    0x08f1fd673eeb0c0e,
                    0xdf997d72a18a9945,
                    0x03dc20c95b66a5fb,
                    0xad8e63e4e0096dae,
                    0xd49c13217baa2f0d,
                    0x04f512dc451edf1b,
                ])),
                Felt::new(BigInteger384([
                    0x720f6a851dad36de,
                    0x5a450008d84d3295,
                    0x2d0fdc597d662dbd,
                    0xfcbcf62d1308799f,
                    0x6c73af4ac5b92ecb,
                    0x175a1850e85cb2d7,
                ])),
                Felt::new(BigInteger384([
                    0x7a6b5fe9e15a958f,
                    0xc09517a3a35f0842,
                    0x44ab95590dbb9b36,
                    0x409532d6652d7328,
                    0x8581626e58a49d52,
                    0x013648dc9d4f99f9,
                ])),
                Felt::new(BigInteger384([
                    0x0f37a33c91e18c81,
                    0x3b3d6c8a08c25d02,
                    0x5320b630958169cd,
                    0x4cf63b34cab0ab71,
                    0xef66900c87f5d5fa,
                    0x0410b3ac20f627b4,
                ])),
                Felt::new(BigInteger384([
                    0xc8ce810a638b6935,
                    0x27012636c9f4958a,
                    0x43834b2807a6ccb5,
                    0x1d145936c85ec9e3,
                    0xdd95f3ab26a9c75f,
                    0x12b929adec22e8de,
                ])),
                Felt::new(BigInteger384([
                    0x7e87eaf135a9b11c,
                    0xf8502f91c002b6cd,
                    0x7592242d2b29dee8,
                    0x3b19fb99c3d5365b,
                    0x1ed7f95fbc736fb9,
                    0x0e6be5e1c0f2aae7,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x5f2f72e792b7fb98,
                    0x32ca8751ba18a187,
                    0x43ab11b90121e325,
                    0x511d683cca811cf6,
                    0xf0e74004c91370d3,
                    0x1815b53ca6d73fce,
                ])),
                Felt::new(BigInteger384([
                    0xe9a77a910ff16e66,
                    0x23de7641de744fb0,
                    0xc11fed1c3898cf69,
                    0x4be3716035f4fc59,
                    0x586f0b43e2180c2c,
                    0x025bef9792340957,
                ])),
                Felt::new(BigInteger384([
                    0x34006404032eb887,
                    0xdff53412b7616bb3,
                    0x2234c51eec8466e9,
                    0xb60039645df84e25,
                    0xb05af0e6255852ed,
                    0x17a0c4839ea63130,
                ])),
                Felt::new(BigInteger384([
                    0xb76d7d0da18c7232,
                    0x420422ca38b70111,
                    0x72534300d38acd76,
                    0x7207fb7b23f0af84,
                    0xb2aa0de062f45af6,
                    0x16ba572cb4054e1c,
                ])),
                Felt::new(BigInteger384([
                    0x701b221e0edc4002,
                    0xf2ac1d48711ec0b0,
                    0x39d3303b418c4e3b,
                    0x9ef9aeefe329588e,
                    0xc2d2e7ad49639878,
                    0x117056cceeeaca7c,
                ])),
                Felt::new(BigInteger384([
                    0xa78c6fbd4bca9135,
                    0x2cafd5e0f722be63,
                    0x1f608ace548af90e,
                    0x7613bacaf134c2ce,
                    0x619c3e5c09a12e42,
                    0x0127763d1d72dc48,
                ])),
                Felt::new(BigInteger384([
                    0x1ca0a2729cf8beb7,
                    0xbd115c1f80a52493,
                    0xd31148cbcd771bd8,
                    0x7b03b10e9ac22748,
                    0x6cfb21bdd0014bbf,
                    0x17a39efa4d91b668,
                ])),
                Felt::new(BigInteger384([
                    0x721b66135ffaa13f,
                    0x68f5e31ad8e0b7b4,
                    0x9fb9482efa4b906b,
                    0x26b9d5c4badeba84,
                    0xbeb1790324e00b62,
                    0x0a956c0376bf4b54,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe73e66134cb7c8f6,
                    0x15ebbb835726449d,
                    0xb21d0dc3e664527d,
                    0x03c7bf54f6e6b43d,
                    0x8ae592bf5d6b165e,
                    0x02535e1366bed428,
                ])),
                Felt::new(BigInteger384([
                    0x23617f369aba531a,
                    0x5be59810f67832c6,
                    0x8e4612eeeed70815,
                    0xdc1c57b582c788aa,
                    0xc3f0a88de5aa8b2b,
                    0x07519d49e500d7c4,
                ])),
                Felt::new(BigInteger384([
                    0xaf487abc106b1b9c,
                    0x0557cb0bce4abb6d,
                    0x538b499a98d668a5,
                    0x8ed4149cab3af432,
                    0xfa2c4b363ce6e60b,
                    0x0fd3922796a58a93,
                ])),
                Felt::new(BigInteger384([
                    0x73fda77c8adf1109,
                    0xb7b6d0dbd9494718,
                    0xdf78873f79c89702,
                    0x25a0b823803281a0,
                    0x544bb6a91d3480bc,
                    0x062132a9ed1f44b9,
                ])),
                Felt::new(BigInteger384([
                    0x5a11ac7cc883cadf,
                    0x4381dde4cc988653,
                    0x392a5358aeb6cb3a,
                    0x8e575a0ec25b5d82,
                    0x2e229387134fcc40,
                    0x178b1d41125fc3d6,
                ])),
                Felt::new(BigInteger384([
                    0x19a83e61d68c50d4,
                    0x7542abd13972b219,
                    0xf88842b646cf82ac,
                    0x1d13dec4baf5fc34,
                    0x520410e924ee1843,
                    0x16535e3430898f08,
                ])),
                Felt::new(BigInteger384([
                    0x8eb75f3eea3aeb58,
                    0xa193867297c34478,
                    0xe7552aa28b7f8cf7,
                    0x10f48979365ca1a5,
                    0x18c131f4aba172d3,
                    0x174a4bf038186cf7,
                ])),
                Felt::new(BigInteger384([
                    0x0e5b430d7f6be058,
                    0xc24cff4c47d28923,
                    0xdb92520e57dcb4bf,
                    0x0eaf4a29aae8916c,
                    0x352a956ec7c93b9e,
                    0x0e2748597bbfa05b,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0x72d07d27093ad779,
                    0x36ce0df3dd7d08a5,
                    0xb50b577988b6fb96,
                    0x2acf0cdd424c04dc,
                    0x8ef3e565534f5985,
                    0x15aaba8db041cfcc,
                ])),
                Felt::new(BigInteger384([
                    0x1f92742f326421c3,
                    0x9f39b316eadff8ff,
                    0x1bf67f8ea151cf25,
                    0xec2addeef3dbb68e,
                    0xee6519711f182e0f,
                    0x0df3a319d988c73a,
                ])),
                Felt::new(BigInteger384([
                    0xbe8f88df2d03a898,
                    0x2b0a5717dc0f2471,
                    0x455966f55ffb3ccd,
                    0x07ea97dd3d4ab01a,
                    0xee4c3dd60a8f279f,
                    0x16a5973913e70ca0,
                ])),
                Felt::new(BigInteger384([
                    0xd3ae7f54379b27ee,
                    0xd90d2c6d40b709b4,
                    0x964289ec5ea60f91,
                    0xacabb934cbecd85a,
                    0x9ffaef943c007561,
                    0x193bad43cd5ecf20,
                ])),
                Felt::new(BigInteger384([
                    0x15f161c06b4551d2,
                    0x8d874e4ce4040c7e,
                    0x21b13fc7aa70e618,
                    0xecfaa94c864809e0,
                    0xadc83b50cbf63327,
                    0x10887d2cdb236bd7,
                ])),
                Felt::new(BigInteger384([
                    0x3313c3c612c30480,
                    0x4ad745ae5b7fcefa,
                    0x60040daa3946c55b,
                    0x6441a7e57588d973,
                    0x386c266c9071c417,
                    0x0c5302ec997a893c,
                ])),
                Felt::new(BigInteger384([
                    0x23901c07908fe3ea,
                    0x900b81ea526b48ab,
                    0x9587e903785a61f3,
                    0xdc4b685bae923067,
                    0x1834eac69c024f48,
                    0x170e66ca822a7492,
                ])),
                Felt::new(BigInteger384([
                    0x2af55a681e686f59,
                    0xa233e598c863d7a2,
                    0x542bc35da9563145,
                    0x504e054928c788c8,
                    0x3f4a4cb2ae63260a,
                    0x05f7e52340f517f5,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xd0f5df83361be0e7,
                    0x6930b6a581f71289,
                    0x6fd91fd1347d3708,
                    0x18cba0bbea300c46,
                    0x1eef3b04ebc71eb7,
                    0x161ea40ad34e7317,
                ])),
                Felt::new(BigInteger384([
                    0x5ccfd94399a62f1c,
                    0xa86026017a3cf65e,
                    0x211a644008574751,
                    0xb863a5b627c5eedd,
                    0x0632d0a36575a852,
                    0x14a9df620c8722dc,
                ])),
                Felt::new(BigInteger384([
                    0xd86a4920c55aa984,
                    0x66319802293428e2,
                    0xe71747c4272eeee9,
                    0xf4735ad1869055e5,
                    0xcfa6e7e51008c550,
                    0x1678a59cea8ff8a1,
                ])),
                Felt::new(BigInteger384([
                    0x86f5d85b026c6e67,
                    0x5bd5e205437b1db7,
                    0x785bdaece187f835,
                    0x6b6722e568945514,
                    0xb296b31904a87f3f,
                    0x0f384634a42dbda3,
                ])),
                Felt::new(BigInteger384([
                    0xe5afea3f04717e4f,
                    0xe63be087f0362a8d,
                    0x4215844baea0c01a,
                    0x991dec5b594b48df,
                    0x9e045e0ac995e7c1,
                    0x07f3e1822d8b90af,
                ])),
                Felt::new(BigInteger384([
                    0xcfbfca217047fc0b,
                    0x3650f4aa4b94e439,
                    0x799cea837b033739,
                    0x787a2a5fe6d1d00a,
                    0x01214d34db98c1ef,
                    0x1903619f5b11196d,
                ])),
                Felt::new(BigInteger384([
                    0xaf1d5f460bbfc36c,
                    0xd53aa8898659f173,
                    0x36f99e2521d99b93,
                    0x26823525cf51335d,
                    0x48850848a120474e,
                    0x0c4283b23155905e,
                ])),
                Felt::new(BigInteger384([
                    0xb3707cab3300be76,
                    0xdaf830ff651d0c6a,
                    0x1d87f78cc87637f7,
                    0xf95a71306baa0854,
                    0xb9c4af73e39426e5,
                    0x0a01d7a938eb7915,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xcb1880332736da6d,
                    0xeb76733239861575,
                    0xb5fd7d475a5ef4fb,
                    0x32b0a393673a1527,
                    0xbb5e4f23300ab6b6,
                    0x0e8e6758543c712f,
                ])),
                Felt::new(BigInteger384([
                    0xf98df7560783efae,
                    0x07846debd31e9876,
                    0x77d79039297f0744,
                    0xe5c5e17b35d8c698,
                    0x911b473c26d203a2,
                    0x06327b01bd3c2fa2,
                ])),
                Felt::new(BigInteger384([
                    0xe3869fa5a16da8d0,
                    0x895ebe96bddee7e1,
                    0x8c6efee09e5ce0e1,
                    0xb1a3ae3b1a150240,
                    0x1a1a71f355d3b606,
                    0x040493b687a7eab8,
                ])),
                Felt::new(BigInteger384([
                    0xcf1ea2290867573f,
                    0xa83eb2d18dad457c,
                    0xecd070fdf92c1c31,
                    0xcbc92acfdc55bfcf,
                    0xca5ff18ffcb9c9de,
                    0x0db6d57a58bfe9bc,
                ])),
                Felt::new(BigInteger384([
                    0x46e9e1b8f8cbe4bb,
                    0x277369ae53dfe367,
                    0xf05a306c5bbbc233,
                    0xad95985383d57986,
                    0xd1c0d0a1f9b767c3,
                    0x13cf171795736596,
                ])),
                Felt::new(BigInteger384([
                    0x08517d8e02544a39,
                    0x764ec09919b50860,
                    0x58d047097b61c0af,
                    0x9ed4b62f15cb99a3,
                    0x9d4a3c232f4a8aa7,
                    0x0961513fc17e5629,
                ])),
                Felt::new(BigInteger384([
                    0x1941b2099bbca12a,
                    0xe45d53bc3c964d5f,
                    0xad258d199919841a,
                    0xc16c96877e574b4c,
                    0x8ef7bf11b02fa1ce,
                    0x13fc08f498f252cb,
                ])),
                Felt::new(BigInteger384([
                    0x094746157d347fd8,
                    0xc73ede1b7ff1ead3,
                    0xe173a8e010493669,
                    0x11280cb6092e0a4b,
                    0x871dc5ce765a654d,
                    0x1731652ef7ef3f09,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xb37ece1a659e85c7,
                    0x7d8fcbd9864cc840,
                    0x0bba52ef7592d1b5,
                    0xab087a3c404f0515,
                    0xa6b0dd8718b0e4bd,
                    0x01c752facdfc592d,
                ])),
                Felt::new(BigInteger384([
                    0x0cca787fafe12a54,
                    0xfc5e162184caa3fd,
                    0xe7741717dc0308ee,
                    0x7293896ee56a2008,
                    0xf7ddddfd608517cf,
                    0x0059bad6cf3d7fc1,
                ])),
                Felt::new(BigInteger384([
                    0x7b731fcb17783b02,
                    0x81b93e58866a5424,
                    0x09a7a35b7499b091,
                    0x879dc9c98b14bc9a,
                    0x31b17c1514c15575,
                    0x0039306a295d8f34,
                ])),
                Felt::new(BigInteger384([
                    0xd3662b0c7dfd9575,
                    0x8db5b571aa697b90,
                    0x4963871e67ed8120,
                    0xe7585ddd705fd515,
                    0xd352a3429bb8f037,
                    0x19f31e4503b105ea,
                ])),
                Felt::new(BigInteger384([
                    0x665b5c02d60b34e5,
                    0xba5d1df579d368e3,
                    0x2390f1719e9fbdcd,
                    0x3baa82e17032f68e,
                    0x55c576b9e671ef1c,
                    0x1925b631f4c8b1de,
                ])),
                Felt::new(BigInteger384([
                    0x28f984efa3b859dd,
                    0x01ec7176fec4cf7f,
                    0x467604acd662cf33,
                    0x9ed57e747804e25e,
                    0x757d64668f45c2a4,
                    0x0d5b03379f12cc5c,
                ])),
                Felt::new(BigInteger384([
                    0xdf768f43f945b214,
                    0x374874109e3dab8d,
                    0xdf87ed00697ea9d2,
                    0x9ca131c157972760,
                    0x69a864d67585dbcc,
                    0x0f2300aa2dc6bbca,
                ])),
                Felt::new(BigInteger384([
                    0x7ddea4f3f60c1069,
                    0xa229e225dd5479fb,
                    0x5a872cccd256763e,
                    0xd8a9c4c3f7d23344,
                    0xd8b008619a201eb5,
                    0x02f916b0ebaab5ee,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xff7c3f6c2b87c7a9,
                    0x85d81fd28b4d706b,
                    0x4e86483d08db48f7,
                    0x9bc415f7ed116ceb,
                    0x941bdb2496e7123a,
                    0x1796970d08b217fd,
                ])),
                Felt::new(BigInteger384([
                    0x201ade1a62d41c7c,
                    0x1cd9ccf1d6950858,
                    0xf3a7fdd458e58a35,
                    0xa31727f6036d737d,
                    0x1cc8f763820adfb3,
                    0x112f6243765d3d32,
                ])),
                Felt::new(BigInteger384([
                    0xcc6d2dd693401e1a,
                    0xbc481a177f2a3316,
                    0x398cc20548c8646a,
                    0x23f5090eb3376a93,
                    0x31fc7b6880a4f98a,
                    0x065c87aa75e8662a,
                ])),
                Felt::new(BigInteger384([
                    0xa2bf3ed5413e3706,
                    0xa08ee29146ff73c1,
                    0x7f3de39d7d1e335a,
                    0x666c3ab7f7710961,
                    0x8a763d76bc96d0f2,
                    0x00c6459592f1958c,
                ])),
                Felt::new(BigInteger384([
                    0xe9ce51939c29f1c1,
                    0x608b4e0cf06bd329,
                    0xfb4883f3d996fb23,
                    0x199e72b96d63bc41,
                    0x324b90e8e895fd1c,
                    0x15256fa2f46caa34,
                ])),
                Felt::new(BigInteger384([
                    0x5b36ab9805da96f4,
                    0x5a3a7689abe7f472,
                    0x1b0f57fdcdac5167,
                    0xfea03b2a6c0cf92b,
                    0x4f9e575f06e7b22b,
                    0x03d867bdb227d99b,
                ])),
                Felt::new(BigInteger384([
                    0xc4ad6e66065e18b4,
                    0x7c6e1a35924ee8d4,
                    0x68283227f5e29832,
                    0xf60fa9fd4258cef0,
                    0xc16af3dd7b3302fb,
                    0x09239a724558ec07,
                ])),
                Felt::new(BigInteger384([
                    0x371165c39d9aa61a,
                    0x9a98586520ed57b5,
                    0xfec643252c5d858c,
                    0x257d58ff2587370c,
                    0x9a57bd81940450bf,
                    0x01d307b53fc61151,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xcf333462f37081f5,
                    0x67533e4ded437cb4,
                    0x8618dc22a4382125,
                    0x0ddc5a93321ce011,
                    0xf649669ef91dafa0,
                    0x01bd03f42be24c60,
                ])),
                Felt::new(BigInteger384([
                    0x7a56edc11dd257d3,
                    0x8c96ba97c0e08aec,
                    0xf9a58a590428ecd4,
                    0x5ea6f0c1dc588210,
                    0x7157b57ef81c7a3e,
                    0x10444979e6292561,
                ])),
                Felt::new(BigInteger384([
                    0xa8bd40fff40b76d9,
                    0x7bc9efd66045d2e8,
                    0xbb5e74d336c613ad,
                    0x80b87411445c6f72,
                    0x9b2930c348ca9414,
                    0x03b7902ca2670ea0,
                ])),
                Felt::new(BigInteger384([
                    0x0c464c78c9f2c9ca,
                    0xed056c9a85bb3be0,
                    0x12fa3b71813e3143,
                    0xbb30da137c4af15f,
                    0x20d0c289fa09ded5,
                    0x162be91cff6dd259,
                ])),
                Felt::new(BigInteger384([
                    0xab3c12105654a613,
                    0x2cb4a6f7dd0805d6,
                    0x2727e6172956c26d,
                    0x7b7337720c04eca7,
                    0x2ff28c61dd71aac3,
                    0x00643cead498f209,
                ])),
                Felt::new(BigInteger384([
                    0x4855ec39c9f77689,
                    0xea9073ecf0d7ebce,
                    0x244e1192d9cf3aba,
                    0x823a75ed26027133,
                    0x3f0cadf534bd515e,
                    0x1168596cc05028bf,
                ])),
                Felt::new(BigInteger384([
                    0x1f0d863bc35c03ef,
                    0x1f1cb2b6a9c81553,
                    0x5006d59d0aa54547,
                    0xa38d7ec5cdf5276d,
                    0x4913310ae52731c2,
                    0x00bb750698139ab7,
                ])),
                Felt::new(BigInteger384([
                    0xb500ab62a5ec4eff,
                    0x6c0154ceb9965cfe,
                    0x4f22eb47d3b15267,
                    0xcb78f8b40682bc00,
                    0x2ffd651ac81a4f33,
                    0x19ac904c97b743f9,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 8],
            [
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::new(BigInteger384([
                    0x984400000016aa94,
                    0xda500058e5b00012,
                    0x97080d3e78fe9e67,
                    0x504ff0af50a70528,
                    0x0ca773961fe616c9,
                    0x17b73dc8ba06bf04,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0x2e9381113c79c234,
                    0xff3bf48a1aa867a8,
                    0xb35752f23dcbae32,
                    0xd20681075f653432,
                    0x773c5af9a7c129eb,
                    0x00962867c0b5b60d,
                ])),
                Felt::new(BigInteger384([
                    0x3bf5732bea504b4b,
                    0x876c8ceb6a304acc,
                    0xa902e3a487494f24,
                    0xd7859534ce4ac836,
                    0x51f8a0104b1beccc,
                    0x160b6af07973607f,
                ])),
                Felt::new(BigInteger384([
                    0x349b5f0f0e428f6a,
                    0xb604b8b821bc2a70,
                    0x95a2015be28fe247,
                    0xd8608b00a7c9581b,
                    0xffd3fdf8f9fc7a05,
                    0x030c4952aee45007,
                ])),
                Felt::new(BigInteger384([
                    0x1f577f772caae75e,
                    0x3611a5dd117d71af,
                    0x4f52f83e787d9126,
                    0xd13bcfeeec36fce5,
                    0x5f137ace9cb341ae,
                    0x0cb91a1d4ce7d242,
                ])),
                Felt::new(BigInteger384([
                    0xc065b9df21f4bc91,
                    0x6bdc7db4d6c2ec64,
                    0xcd64c4dd1f8d59b7,
                    0x7ab3342a2df300cd,
                    0xf73b65682339f266,
                    0x12e775c58279bd70,
                ])),
                Felt::new(BigInteger384([
                    0xe5a68542bdcd0466,
                    0xd1cfd52be15aa638,
                    0x178fdd0c3e53cd0f,
                    0x05edd55f69f5210c,
                    0x7b012a3dc9c42163,
                    0x150d194e99564c1c,
                ])),
                Felt::new(BigInteger384([
                    0x29c297cb60e4cb3d,
                    0xfadc450695595c17,
                    0x59b98f00549fef5e,
                    0x08d1095fd7c38bc8,
                    0x7a1af65762151bde,
                    0x0c4d54dfef8d5992,
                ])),
                Felt::new(BigInteger384([
                    0xe3086ccdfa626c30,
                    0x830d489e2989f3b5,
                    0x73b5f1aeec5c20bf,
                    0xcd574f35f8bca63d,
                    0xf32a263fd5b30169,
                    0x0edcc7598f527248,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xd180d41961be58e9,
                    0x5819b2c1a269b3d5,
                    0xc441873b5e557618,
                    0x05f6eb2c973a486f,
                    0x64a9ae2e2ecd6f35,
                    0x035d47b181ff3f1e,
                ])),
                Felt::new(BigInteger384([
                    0x140c71a4062f02cc,
                    0x6873a60539a8924f,
                    0x4480a42cbe98fd0a,
                    0xd7b3aeed7c75b602,
                    0x204a8939f1aa6812,
                    0x09e9a3f599de6f07,
                ])),
                Felt::new(BigInteger384([
                    0x75c06c4d00f311b6,
                    0xf42d595d68b04eca,
                    0x9e8071eeb9425c6f,
                    0xc44836b8793d3261,
                    0x5b2a3c62cc261ac1,
                    0x0de6787a3b708404,
                ])),
                Felt::new(BigInteger384([
                    0xf8cf45c7bbe654bb,
                    0xaeffacbabee497a7,
                    0xdbbb7d65cacbbbe8,
                    0xdbffa5e97467e309,
                    0xd55600849afade59,
                    0x100f404730badf54,
                ])),
                Felt::new(BigInteger384([
                    0x68d0e17aef5eb74f,
                    0x182ba0ce58cf6e2d,
                    0x7c548cc25598a0a1,
                    0x2fa52469bec9b66f,
                    0xb5e9d762d6c007c8,
                    0x0322036bda609a36,
                ])),
                Felt::new(BigInteger384([
                    0xb5310ed3987cc7f5,
                    0xa4ed789ce951ffa8,
                    0xa8c0134fddd720dc,
                    0x29a9d018d3f2f291,
                    0x1547bc979d7bd028,
                    0x0931fb94f08bdcb1,
                ])),
                Felt::new(BigInteger384([
                    0x5dfc18ff3b42d473,
                    0x32d5f47dba3ad3c8,
                    0x5b00e0caf7e660b0,
                    0x651623a932784062,
                    0x072c21e93a8db513,
                    0x00bfbfd7ca9a5351,
                ])),
                Felt::new(BigInteger384([
                    0xfffee8ee253c3c93,
                    0xfbe6b94763da16ef,
                    0x4cab19dce2a6f3f6,
                    0x1d45f209472e6062,
                    0x7c2ad309c848a679,
                    0x097e9bc2e98a824b,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x85119d4f8acccc22,
                    0xc11c76c2cec24e27,
                    0x3ec2b8f9beba264f,
                    0x162acaea7f33fa32,
                    0x4996ff89721a2a54,
                    0x11ec6661b8086644,
                ])),
                Felt::new(BigInteger384([
                    0xae9e5be72f65d642,
                    0x47bfebc044ee4bb4,
                    0xca4d7108e53e1d10,
                    0x99a7ed8163b84fb1,
                    0x90bd92963c566b03,
                    0x034cb9f746998d94,
                ])),
                Felt::new(BigInteger384([
                    0xc18228370ecf2e9d,
                    0xe1bfa192d54c21af,
                    0x7e5f75d6db62108e,
                    0xcb312d997f5f1aaa,
                    0x78518811a0819e8b,
                    0x0d6d85124d957887,
                ])),
                Felt::new(BigInteger384([
                    0xc3e8eff922efb622,
                    0x01823da244654386,
                    0x69686617943dd612,
                    0x160205011676436b,
                    0x600cd598f54c5040,
                    0x00b5ca254b6cad25,
                ])),
                Felt::new(BigInteger384([
                    0x66e460ed82df43ed,
                    0xc6280d9ddb2ad59c,
                    0x95f79a0376cc2982,
                    0x94fdb5847066085f,
                    0x3835b22868dace26,
                    0x05281045eb29d6c9,
                ])),
                Felt::new(BigInteger384([
                    0xe155343b11871e77,
                    0xe2bf4704ec171821,
                    0xdcfb216af83ba868,
                    0x7860c85e027eca92,
                    0x65073bb49aa9c33c,
                    0x06eb48691a43c516,
                ])),
                Felt::new(BigInteger384([
                    0xc49d39074de031d7,
                    0x0db7c435f7aec718,
                    0xee1bc42853512dbc,
                    0xaecfa6ea658c4e01,
                    0x13ebad12d207146e,
                    0x11b2f1faf536aeed,
                ])),
                Felt::new(BigInteger384([
                    0xfb99959aaa389b79,
                    0x22dd6c18eff346ff,
                    0x43dc6f2468b75fa1,
                    0x0c67281af0406aea,
                    0xaac995c49bf605bb,
                    0x08b7503a51249d70,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x03650755be69e67d,
                    0xca7d7f05032c873a,
                    0xad15ce368e7edcbc,
                    0xb57ace47b272e553,
                    0x9a96a653ac007199,
                    0x026993b64e885549,
                ])),
                Felt::new(BigInteger384([
                    0xd58858b2f430cc3f,
                    0xd4da22ec90464805,
                    0xd8b01c3c93ce4499,
                    0x010ce69e2b21708d,
                    0x2e0fe9c07033a23f,
                    0x05ccfce6f6f25920,
                ])),
                Felt::new(BigInteger384([
                    0x2237508b7056b056,
                    0xe0fccde31a794c2e,
                    0xb9ab42ff6504f9c5,
                    0xb84a6ce738cbe934,
                    0xeee3cca7c01fa9bf,
                    0x04c7133efd3fe025,
                ])),
                Felt::new(BigInteger384([
                    0x58d4498789c7763f,
                    0x6a8168991c368839,
                    0xd9cc1faefca28044,
                    0xa9e9fccf293c3d4a,
                    0xb3b8094d706c581d,
                    0x03186641b2c1259e,
                ])),
                Felt::new(BigInteger384([
                    0x4f4372240b3920c6,
                    0x31f003b8ffd5a9af,
                    0xa8fbd517e5a9c65b,
                    0x0dec944e41c508f4,
                    0x65679f54df32f5d4,
                    0x05dd0c309c896f36,
                ])),
                Felt::new(BigInteger384([
                    0xbcfc7b0c86928f32,
                    0xd941e68ba63765ce,
                    0xb7cfc033217930b4,
                    0x37434991c9c9a3de,
                    0x21ece9067d2c6d4b,
                    0x047445bcfa3ba022,
                ])),
                Felt::new(BigInteger384([
                    0xa693b8a1ff5a0f43,
                    0xaa353f3f1b6e8487,
                    0x740976b67624ed7c,
                    0xfa7cf74384452c73,
                    0x75167f4935cc1ffa,
                    0x163a9f91fb6d8016,
                ])),
                Felt::new(BigInteger384([
                    0x53dfee564e73cecf,
                    0xd4001e01ea68fd71,
                    0x6a4ab143d1a15718,
                    0xd4d11c1a97d29bfc,
                    0x926c6e85a88c6bcc,
                    0x19afdafc3f694a67,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x2cb135b378977015,
                    0xbf96c8a9d28d3a37,
                    0x649fcfb27d4a49c9,
                    0xf11b69295636ac35,
                    0x1e093250c968fe2a,
                    0x03cfb591b0b514f5,
                ])),
                Felt::new(BigInteger384([
                    0x027e47dffb28ff9c,
                    0x4fc40ba771aa7437,
                    0xe1b0e7e8d2694dcf,
                    0x39cb05cd922bff57,
                    0x3eb2880476afab4c,
                    0x11d904817fbf629f,
                ])),
                Felt::new(BigInteger384([
                    0xe67985d3540b8f3a,
                    0x4464a3289b33a0b9,
                    0x940be5160789efc3,
                    0x1951b984c0ff5d47,
                    0x0e96b679e3fbdaaf,
                    0x01d9da7b975648df,
                ])),
                Felt::new(BigInteger384([
                    0xd3bac3f9ec2f3c9f,
                    0x579aea909a4d8e22,
                    0x9358c85124bbd1b4,
                    0xeb4f24be1df97783,
                    0x57e22a2f52eb3583,
                    0x19cf145477178d38,
                ])),
                Felt::new(BigInteger384([
                    0x1d74da401becd11e,
                    0xd1772bb43d590630,
                    0x3d0b2468c4fc03b0,
                    0x5f200cc3671032bd,
                    0xfb4881d79a024774,
                    0x020f2ac4a7d33313,
                ])),
                Felt::new(BigInteger384([
                    0x6d017a18eddd11d6,
                    0xa97472543523c435,
                    0xe04bdfec51111bf3,
                    0x81bc02e49fc44483,
                    0x18fd89e16e830ac8,
                    0x0cc894d21170115f,
                ])),
                Felt::new(BigInteger384([
                    0xb15759b95894ba89,
                    0xe78ae228bd6dce42,
                    0x9a44684a9592ffcd,
                    0x559ca8fb4b052cf7,
                    0x19e98954756b6178,
                    0x0611f255f58d659f,
                ])),
                Felt::new(BigInteger384([
                    0xb9950b42879101c0,
                    0x64bf02327265a065,
                    0x7bca371021701771,
                    0x105ec156db32e5b5,
                    0x88ab60d15ea4faa6,
                    0x16bd117ab718a939,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x91da898e573324d7,
                    0x568a1e65ebe56113,
                    0xf9d78a93b594e6b4,
                    0x7220df23317fdce6,
                    0x1f12ce1fa709e802,
                    0x0df0f35fa8a35240,
                ])),
                Felt::new(BigInteger384([
                    0x353c64db801592c9,
                    0xdb0d3e8f91bf4bb4,
                    0x9ee165353cb1da31,
                    0xb66791a9c8974ef7,
                    0x9ac74fc699bc812f,
                    0x118893e89812f0a2,
                ])),
                Felt::new(BigInteger384([
                    0x9471bf81fe574c05,
                    0x813608d7ef2da8f8,
                    0x91e88fb228dc6b4d,
                    0x4630f301df5b6ee9,
                    0x1b40e9e553823a5f,
                    0x002727e0ff953611,
                ])),
                Felt::new(BigInteger384([
                    0x56611f5dd52b0a9a,
                    0xa38bef9db2e94728,
                    0xf017e57de4b87ad2,
                    0x3f95db544d23fe6b,
                    0x350dd7043728e581,
                    0x0f960cb66bd7c82a,
                ])),
                Felt::new(BigInteger384([
                    0x5f1aff6bdc2ab559,
                    0x2a75c52b423ccca3,
                    0xb9b0cac31a797fd0,
                    0x6624f5673e01b117,
                    0xe1bafeeebbd6c824,
                    0x12a781f8929d544f,
                ])),
                Felt::new(BigInteger384([
                    0xd58b1a6c73d902ae,
                    0x4834b13fdbfa416a,
                    0x24d149e8da5eea4d,
                    0xbf36659683f9d817,
                    0xb4c8c1a63c79c412,
                    0x016655b06d6d8931,
                ])),
                Felt::new(BigInteger384([
                    0xda132899da44989b,
                    0x8dd4fbc712fe7a6b,
                    0xe099d019e3346dd7,
                    0x6d1b0147e161dbd6,
                    0x230b911b37e4d84d,
                    0x0b11bb50422b8a72,
                ])),
                Felt::new(BigInteger384([
                    0x22b20ce998ca1176,
                    0x3d7e7ec23a373348,
                    0xa359ecd8af719c80,
                    0x79cdb27806eaa877,
                    0xafcad49a6ae946bc,
                    0x1245fb8bdfb66853,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
