use super::{sbox, BigInteger384, Felt};
use crate::{Jive, Sponge};
use ark_ff::{Field, One, Zero};
use unroll::unroll_for_loops;

/// Digest for Anemoi
mod digest;
/// Sponge for Anemoi
mod hasher;
/// MDS matrix for Anemoi
mod mds;
/// Round constants for Anemoi
mod round_constants;

pub use digest::AnemoiDigest;
pub use hasher::AnemoiHash;

// ANEMOI CONSTANTS
// ================================================================================================

/// The field multiplicative generator: G = 2
const G: Felt = Felt::new(BigInteger384([
    0x321300000006554f,
    0xb93c0018d6c40005,
    0x57605e0db0ddbb51,
    0x8b256521ed1f9bcb,
    0x6cf28d7901622c03,
    0x11ebab9dbb81e28c,
]));

/// Function state is set to 8 field elements or 384 bytes.
/// 1 element of the state is reserved for capacity.
pub const STATE_WIDTH: usize = 8;
/// 7 elements of the state are reserved for rate.
pub const RATE_WIDTH: usize = 7;

/// The state is divided into two even-length rows.
pub const NUM_COLUMNS: usize = 4;

/// 1 element (48-bytes) is returned as digest.
pub const DIGEST_SIZE: usize = 1;

/// The number of rounds is set to 10 to provide 128-bit security level.
pub const NUM_HASH_ROUNDS: usize = 10;

// HELPER FUNCTIONS
// ================================================================================================

#[inline(always)]
/// Applies exponentiation of the current hash
/// state elements with the Anemoi S-Box.
pub(crate) fn apply_sbox(state: &mut [Felt; STATE_WIDTH]) {
    let mut x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
    let mut y: [Felt; NUM_COLUMNS] = state[NUM_COLUMNS..].try_into().unwrap();

    x.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= y[i].square().double());

    let mut x_alpha_inv = x;
    x_alpha_inv
        .iter_mut()
        .for_each(|t| *t = sbox::exp_inv_alpha(t));

    y.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t -= x_alpha_inv[i]);

    x.iter_mut()
        .enumerate()
        .for_each(|(i, t)| *t += y[i].square().double() + sbox::DELTA);

    state[..NUM_COLUMNS].copy_from_slice(&x);
    state[NUM_COLUMNS..].copy_from_slice(&y);
}

#[inline(always)]
/// Applies matrix-vector multiplication of the current
/// hash state with the Anemoi MDS matrix.
pub(crate) fn apply_mds(state: &mut [Felt; STATE_WIDTH]) {
    let x: [Felt; NUM_COLUMNS] = [state[0], state[1], state[2], state[3]];
    let y: [Felt; NUM_COLUMNS] = [state[5], state[6], state[7], state[4]];

    let g_x0 = G * x[0];
    let g_x1 = G * x[1];
    let g_x2 = G * x[2];
    let g_x3 = G * x[3];
    let g_squared_x0 = G * g_x0;
    let g_squared_x1 = G * g_x1;

    state[0] = x[0] + x[1] + g_x1 + g_x2 + g_x3;
    state[2] = g_squared_x0 + g_squared_x1 + x[2] + x[3] + g_x3;
    state[1] = state[2] + g_x1 + g_x2 + g_x3;
    state[3] = state[0] + g_x0 + g_x1 + x[3];

    let g_y0 = G * y[0];
    let g_y1 = G * y[1];
    let g_y2 = G * y[2];
    let g_y3 = G * y[3];
    let g_squared_y0 = G * g_y0;
    let g_squared_y1 = G * g_y1;

    state[4] = y[0] + y[1] + g_y1 + g_y2 + g_y3;
    state[6] = g_squared_y0 + g_squared_y1 + y[2] + y[3] + g_y3;
    state[5] = state[6] + g_y1 + g_y2 + g_y3;
    state[7] = state[4] + g_y0 + g_y1 + y[3];
}

// ANEMOI PERMUTATION
// ================================================================================================

/// Applies Anemoi permutation to the provided state.
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_permutation(state: &mut [Felt; STATE_WIDTH]) {
    for i in 0..NUM_HASH_ROUNDS {
        apply_round(state, i);
    }

    apply_mds(state)
}

/// Anemoi round function;
/// implementation based on algorithm 3 of <https://eprint.iacr.org/2020/1143.pdf>
#[inline(always)]
#[unroll_for_loops]
pub(crate) fn apply_round(state: &mut [Felt; STATE_WIDTH], step: usize) {
    // determine which round constants to use
    let c = &round_constants::C[step % NUM_HASH_ROUNDS];
    let d = &round_constants::D[step % NUM_HASH_ROUNDS];

    for i in 0..NUM_COLUMNS {
        state[i] += c[i];
        state[NUM_COLUMNS + i] += d[i];
    }

    apply_mds(state);
    apply_sbox(state);
}

#[cfg(test)]
mod tests {
    use super::*;

    fn apply_naive_mds(state: &mut [Felt; STATE_WIDTH]) {
        let x: [Felt; NUM_COLUMNS] = state[..NUM_COLUMNS].try_into().unwrap();
        let mut y: [Felt; NUM_COLUMNS] = [Felt::zero(); NUM_COLUMNS];
        y[0..NUM_COLUMNS - 1].copy_from_slice(&state[NUM_COLUMNS + 1..]);
        y[NUM_COLUMNS - 1] = state[NUM_COLUMNS];

        let mut result = [Felt::zero(); STATE_WIDTH];
        for (i, r) in result.iter_mut().enumerate().take(NUM_COLUMNS) {
            for (j, s) in x.into_iter().enumerate().take(NUM_COLUMNS) {
                *r += s * mds::MDS[i * NUM_COLUMNS + j];
            }
        }
        for (i, r) in result.iter_mut().enumerate().skip(NUM_COLUMNS) {
            for (j, s) in y.into_iter().enumerate() {
                *r += s * mds::MDS[(i - NUM_COLUMNS) * NUM_COLUMNS + j];
            }
        }

        state.copy_from_slice(&result);
    }

    #[test]
    fn test_sbox() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0x7b89d1250dffbf98,
                    0x8a950f769042423f,
                    0x206b5139c5115a83,
                    0x9b232c130de73f18,
                    0x0ae9e5f6749b9d14,
                    0x04f765945f0c1b69,
                ])),
                Felt::new(BigInteger384([
                    0x33de77e594a24397,
                    0x4564e6ff8589524f,
                    0x6833c04d2444d8f4,
                    0x312f5c0189f1b559,
                    0x526a0ee13031d5cf,
                    0x13f48c5442a12131,
                ])),
                Felt::new(BigInteger384([
                    0x192ed4424b9673c6,
                    0x5954cf26b6e23106,
                    0xb482729cee2c0664,
                    0x637119a35d55c612,
                    0x5656200f72489121,
                    0x0f1eb2da32645350,
                ])),
                Felt::new(BigInteger384([
                    0x9169215f2273b8c5,
                    0x8cca0d0e4ce324b3,
                    0x84be6ed2bbfdf3fe,
                    0x8cb2789e044ab58f,
                    0x6508e0815ab2a3d9,
                    0x0681b3d2d2f8a38a,
                ])),
                Felt::new(BigInteger384([
                    0x6b650f08ae2ebec7,
                    0xec07a564650de9f0,
                    0xb129d82335a83437,
                    0xd8cd31de0a6a4f83,
                    0xee9002cc7c1e9dca,
                    0x0298d8fedeb058c0,
                ])),
                Felt::new(BigInteger384([
                    0x22bb4d13b1a1b757,
                    0x502871ea697aac6c,
                    0x013b10011e2133e7,
                    0x3239c4bfba4adfad,
                    0xe11860198e808380,
                    0x0e772d371ee65479,
                ])),
                Felt::new(BigInteger384([
                    0xbf4700864885f07a,
                    0x7b6c7dfaaf3b2421,
                    0xc113b5a7440f45ae,
                    0xf43a079cce4d0728,
                    0x6662b78a7dc7b88e,
                    0x16d367503c864e0f,
                ])),
                Felt::new(BigInteger384([
                    0xabb7582fd6c3a63e,
                    0x32dc20dbf67709c5,
                    0x8683013dd5de0590,
                    0xef8c43c944850d2f,
                    0xc9c2cc27be78cef6,
                    0x0e0265990bb85303,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x5d67f3fd70deac96,
                    0xfe0c97f4d37545aa,
                    0x5cf4e23e41540879,
                    0x9cbb87dc2c0ff6fc,
                    0x90f42d51b90947db,
                    0x102f2c3a1138c799,
                ])),
                Felt::new(BigInteger384([
                    0x1911b288c20d73e6,
                    0xc3f9ac91998a2a7c,
                    0x33ffa6b01264bc37,
                    0xee74e00e5bc23b0e,
                    0x31d3a504a8a381f8,
                    0x162df7bf875762f4,
                ])),
                Felt::new(BigInteger384([
                    0x63d663542f79ec3f,
                    0xf9059b07d0fe4132,
                    0xc773ca8e96315eb0,
                    0x29defc9a1a565db6,
                    0x4f0861cfc1215130,
                    0x162caf8842b36204,
                ])),
                Felt::new(BigInteger384([
                    0x14e7de69883a3cf2,
                    0x0576f53dd52cebed,
                    0xd4c6e15c869afbc2,
                    0x1b3492f489109d65,
                    0x43ca55327a63eb9a,
                    0x0f82d441feed179b,
                ])),
                Felt::new(BigInteger384([
                    0x07e1072754d78a5c,
                    0x23f9dfea771114e2,
                    0x6650833acc834e09,
                    0xaad550c6b6b88835,
                    0x3d0b320b681d1d4f,
                    0x10427543799aea2a,
                ])),
                Felt::new(BigInteger384([
                    0xa8e04bb23f634fc4,
                    0xbc0da6d2e2823816,
                    0x903957491d0d6534,
                    0x239b218110792e9e,
                    0x7c3be47be487118d,
                    0x14d3d92352602306,
                ])),
                Felt::new(BigInteger384([
                    0xde8a370961be55fe,
                    0x18a720744ffd5ab2,
                    0x82c1ccc5f535f78b,
                    0x7f4053babed81475,
                    0x4e18e40fe9c347a3,
                    0x17f989c7489f863c,
                ])),
                Felt::new(BigInteger384([
                    0x69a964b4733ac320,
                    0x553521587e1e676e,
                    0x29519d16f2a1d7e5,
                    0x8ef540824e280539,
                    0x517cc1305acde3f5,
                    0x0ee095fad9ce7c99,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x96b941f162871f6a,
                    0xd705b05239aa83c6,
                    0x049ff5f1a5edc7b8,
                    0x69a8373edd970e62,
                    0x9020fd60a5244c05,
                    0x014101d36f640fe6,
                ])),
                Felt::new(BigInteger384([
                    0x738fb0c610cef1a0,
                    0x8a26156a0095979c,
                    0x06ec4c9b61289d9d,
                    0x3fb957628877f704,
                    0xcaf8283189f39e64,
                    0x0a5c15f619ddba17,
                ])),
                Felt::new(BigInteger384([
                    0x1fd84102f9397bf5,
                    0x9f531f5ebf11838e,
                    0xd7839ba3d8c92ba3,
                    0x1d80602a5f105bd3,
                    0xf971357da38f91f5,
                    0x079eb3d3c950a10a,
                ])),
                Felt::new(BigInteger384([
                    0xc08f71eea153da32,
                    0xaf47e27cfcbbd353,
                    0x2472a715c1c72baf,
                    0xb6637216410a4fb9,
                    0x67f2ad1ee974a28f,
                    0x17408673612eb644,
                ])),
                Felt::new(BigInteger384([
                    0x647e68e344eca24c,
                    0x15089d5d91fc782b,
                    0x0dc95124820475a2,
                    0xf6c8acae90348a14,
                    0xf5ad36472f8ca5a1,
                    0x10aabb37d2cf044b,
                ])),
                Felt::new(BigInteger384([
                    0xcfdf31ceef854ea2,
                    0xcd183df7b1b406e1,
                    0xd52dca9af160c1f5,
                    0x2326c6f565367673,
                    0x63acfaefc99196c4,
                    0x0280e676f2279e98,
                ])),
                Felt::new(BigInteger384([
                    0x3de272541c964f35,
                    0x895f52cc223d06e3,
                    0x8b0b295522dc653c,
                    0x7147c8cfd19637a1,
                    0x1e87e374b20c41f2,
                    0x061d064f9d40695d,
                ])),
                Felt::new(BigInteger384([
                    0x323fc5c764c38541,
                    0x6d6d96386144e948,
                    0xf62e29714c9c6a90,
                    0xd915643e5c6c55f9,
                    0x73f6f4815257e2ff,
                    0x03e2ca97c0e2ecc1,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xac55d017330d748d,
                    0xb176f7508a914e16,
                    0x4e7fae5bbd01dfdc,
                    0x2d1ec2bb87fb1857,
                    0x96044e514a159358,
                    0x00c36a397050c228,
                ])),
                Felt::new(BigInteger384([
                    0xe5bb3a332c54a394,
                    0x37d1a6c992f59a4f,
                    0xf4e92df4fb1f6e33,
                    0x8eb1d8955f5b51ae,
                    0xa5736c530a39c2a2,
                    0x001ac62fc6a53338,
                ])),
                Felt::new(BigInteger384([
                    0xf9e70d4b6fcdef65,
                    0x1b4a63a1dd9d5997,
                    0x336ef4be960f986b,
                    0x000ff6d7b68ace8a,
                    0x5fe53b631bc3106e,
                    0x03fdd991b08823e4,
                ])),
                Felt::new(BigInteger384([
                    0xbfb3180cf26c1e8d,
                    0x66436a8bf5b6a986,
                    0xe538549fbc6bc3a6,
                    0x22b589753eba79fc,
                    0x8ddb62a25cddfb70,
                    0x08a55300e4dd7905,
                ])),
                Felt::new(BigInteger384([
                    0x3c9718264a9d7abe,
                    0x15f71e6b8e06482d,
                    0x91b82835c251ce21,
                    0xdeba1c2ba4db608b,
                    0xff2eb11975e36341,
                    0x0bd6916fb2d11f72,
                ])),
                Felt::new(BigInteger384([
                    0x4f78676da60be794,
                    0x509fd3bbbcb92046,
                    0xbe4ae88ce05534a5,
                    0x5632b6ea64af8886,
                    0x0cc45bdeb4a955b3,
                    0x109ff6eeaa8e1ff1,
                ])),
                Felt::new(BigInteger384([
                    0xaf72451e6930b8a1,
                    0xa75d77913a225b07,
                    0x4e2cca3eae1ad33f,
                    0x03f82e7d85dbfcb0,
                    0xdbdfbf7beebcc009,
                    0x17e11d9b19013d86,
                ])),
                Felt::new(BigInteger384([
                    0xc7263baae1b813d7,
                    0x323753622f5b1de1,
                    0x85e3b034ed344307,
                    0x23fc4ce827ceac8e,
                    0xaffaeecda43c0a8f,
                    0x0a17210238136fea,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0d3d5322dc7a1746,
                    0x9fcec1963b9f1228,
                    0x67288b2f4527ddd7,
                    0xd5707e5d69a94e48,
                    0xcd3b2e47ebd4a37c,
                    0x03b1af8185c84876,
                ])),
                Felt::new(BigInteger384([
                    0x49e553ee22d81152,
                    0x4c256a0072f12f53,
                    0x3506bcde62be6d54,
                    0x9ea4e3b4ebb36ee6,
                    0x4373324688c1392f,
                    0x01425a91f702b98e,
                ])),
                Felt::new(BigInteger384([
                    0xe92dd6ee6108ec4a,
                    0x6635ead04cb7cf57,
                    0x4dbe4c55470b6018,
                    0x26880105f691cd66,
                    0xdc312abe309b63da,
                    0x16077d548116bf7a,
                ])),
                Felt::new(BigInteger384([
                    0x06aee3882a698e49,
                    0x940467b67d8c8eda,
                    0xe114fedad5acda06,
                    0x571c1652cc0730b0,
                    0x8094fcd0d315deaa,
                    0x046c6cf6d5a06f9d,
                ])),
                Felt::new(BigInteger384([
                    0x2e96f1e952f8d691,
                    0x00d297c726ca75ef,
                    0x9d2f598a703cb51c,
                    0x88d8eec5f9ded0fb,
                    0x5c9104b3fe37af85,
                    0x167091cc9225ec95,
                ])),
                Felt::new(BigInteger384([
                    0x1e904716844602be,
                    0xd39bc7aa06ff8e26,
                    0xb865f26b36ef4078,
                    0x91e86ec51fdcaa44,
                    0x45bfda688c129dbf,
                    0x10b3649d5f967385,
                ])),
                Felt::new(BigInteger384([
                    0xd4302414c4e7aa22,
                    0x260792863e4bb5e1,
                    0x0f4355038efe050c,
                    0x73a1abff01e54c77,
                    0x98d2d51195339f20,
                    0x1622da4baba6639b,
                ])),
                Felt::new(BigInteger384([
                    0x79b771fc22f7a701,
                    0xe83db435e4229e07,
                    0xcf0f614696115334,
                    0xd54232b618a8a007,
                    0xe9a0f8e8014a5e91,
                    0x0ee0e8dc4367d847,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0f4ec20f25f8c56b,
                    0x4aa69252ea7b3d2e,
                    0xeaa4d65eb6702c00,
                    0xa4b200ec234aaff5,
                    0xecebe3a1c4bd45d5,
                    0x0eb124ce1787414f,
                ])),
                Felt::new(BigInteger384([
                    0x22995a32f1fa855e,
                    0x43b22f64ed39d8a0,
                    0xf4d846b47d754019,
                    0xae52bbf4c1f119bc,
                    0xc09b5e5fb5c0665f,
                    0x12690e6f719a583e,
                ])),
                Felt::new(BigInteger384([
                    0x9def96c2665512a8,
                    0x75f3451a36f10d16,
                    0xbca14b16455cb8f3,
                    0x83485cf2f8e5f2c8,
                    0x8f86206519ae4970,
                    0x0e1b1aed9d6d0838,
                ])),
                Felt::new(BigInteger384([
                    0x70d0059674f6ff94,
                    0xc106d446f5cd931b,
                    0x0250c643d243e9ab,
                    0x821b71346aaf839b,
                    0x6c06dc39c4aa3926,
                    0x0ac0a5e6645cbc05,
                ])),
                Felt::new(BigInteger384([
                    0x03ab9d6090aae2a8,
                    0x373a040a006500f1,
                    0xbcac74d81a41ee0e,
                    0x7e72a5c925d7d787,
                    0x8f71b68e9d7efd78,
                    0x14ab61e8891e54e3,
                ])),
                Felt::new(BigInteger384([
                    0x6f15ae6ec284d0a2,
                    0xeb965cce6e6b0e83,
                    0x9b4a13563f1acdac,
                    0xf6980de0828f693d,
                    0x5cb0eb35bf108b16,
                    0x1496d56001dea969,
                ])),
                Felt::new(BigInteger384([
                    0x5f42402de5069370,
                    0x0878128efb04db32,
                    0x8328af432e54a932,
                    0x0fed5b9956af960c,
                    0x7dec64f65356cf5a,
                    0x0930ca06fde18392,
                ])),
                Felt::new(BigInteger384([
                    0x403c334b030bda40,
                    0xcea2c4761f62efb9,
                    0x3e7889cf3c89aae0,
                    0xb4c9cd03e8bdf428,
                    0x10a19527cea98956,
                    0x1931641fbfd72330,
                ])),
            ],
        ];

        let output = [
            [
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::new(BigInteger384([
                    0x1804000000015554,
                    0x855000053ab00001,
                    0x633cb57c253c276f,
                    0x6e22d1ec31ebb502,
                    0xd3916126f2d14ca2,
                    0x17fbb8571a006596,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0xf64900000018553d,
                    0x40f4005f6f0c0013,
                    0x9313f019a789cfb3,
                    0x59fb77168f0da76b,
                    0x951d2d06cf6bb694,
                    0x15b1e4359a873e00,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
                Felt::new(BigInteger384([
                    0x321300000006554f,
                    0xb93c0018d6c40005,
                    0x57605e0db0ddbb51,
                    0x8b256521ed1f9bcb,
                    0x6cf28d7901622c03,
                    0x11ebab9dbb81e28c,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x221a96dee879506e,
                    0xf474857d61fd8d8e,
                    0x0cb62c7142732926,
                    0xdab2c2b279e8e05a,
                    0x66bfd291dacd2598,
                    0x14a7b8b22c4d8158,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
                Felt::new(BigInteger384([
                    0x8501827008bb463c,
                    0xe000d5f0f9385e8d,
                    0x651c1aea973d56a5,
                    0xc16f501811680aeb,
                    0xbd0d7da3633e27ed,
                    0x100d54ca211c6624,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x4c220000000b554a,
                    0xed28002c72d80009,
                    0x4b84069f3c7f4f33,
                    0xa827f857a8538294,
                    0x0653b9cb0ff30b64,
                    0x0bdb9ee45d035f82,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
                Felt::new(BigInteger384([
                    0x43f5fffffffcaaae,
                    0x32b7fff2ed47fffd,
                    0x07e83a49a2e99d69,
                    0xeca8f3318332bb7a,
                    0xef148d1ea0f4c069,
                    0x040ab3263eff0206,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x7ce70faa0b8909b2,
                    0x69496370e8e1b2a2,
                    0xb161890b2ea5855a,
                    0xb521dd21c4141d01,
                    0x5a796db65cb7c703,
                    0x0ec5791a451114ae,
                ])),
                Felt::new(BigInteger384([
                    0x45c9a413d8046445,
                    0x3e811846dfb2c7e0,
                    0xa0b87b3177f57f0f,
                    0x2794c4066c2e0a9b,
                    0xfffa81cf67c6a42a,
                    0x0812d3c54e137366,
                ])),
                Felt::new(BigInteger384([
                    0x74af4be16269cb8b,
                    0x182eeb253f911717,
                    0x4e70437385c987ea,
                    0xc7ef9cd204722ef7,
                    0xd308f787be22c0d9,
                    0x066890c039c6f07f,
                ])),
                Felt::new(BigInteger384([
                    0xc57e86a4f16b0cdc,
                    0x9ce39e6a520a913c,
                    0x518d6aa96302fcc6,
                    0xeb14d69a45c4d5c4,
                    0x899cf1447f92a263,
                    0x0276bdd9f9cc41fd,
                ])),
                Felt::new(BigInteger384([
                    0xe52b106c99a58540,
                    0x2935829aebff0fb7,
                    0x58d48f94328f4d8b,
                    0x0d8c4037f70d8bdc,
                    0xec642802575289af,
                    0x06b72bccd106ba77,
                ])),
                Felt::new(BigInteger384([
                    0xa6843979d3635590,
                    0xe1bac3877b22168c,
                    0x2fe4b719e1af97bb,
                    0xe0ecf60f484ab161,
                    0xc6e31eed788697eb,
                    0x0c721e0e74e3bfac,
                ])),
                Felt::new(BigInteger384([
                    0xb2135d223037eed8,
                    0xfe1cc717aee1fadd,
                    0x149934b4448dc32c,
                    0x04147d3652dd8d38,
                    0xa3c644356e65f1dd,
                    0x0f53208aa51d0acc,
                ])),
                Felt::new(BigInteger384([
                    0x21cb3992eb6c637a,
                    0x69fbf125c2516735,
                    0x195dcf1f20c9ec1e,
                    0x1ebd4bd7cb64bafb,
                    0x1a03ca83b1d249bc,
                    0x1131ed58394ab71a,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe85b045e17527949,
                    0x67552dff1da7c7d3,
                    0x51889e852bfe1d7e,
                    0x5c993f7baf3bf9d1,
                    0x1f56a9594c048594,
                    0x0f450fd0106339e6,
                ])),
                Felt::new(BigInteger384([
                    0x2a2b8d64b47727a7,
                    0xd4744abb03a91597,
                    0xbcf639e486091051,
                    0x767073e7d656d3c1,
                    0x1453c922b9d494cc,
                    0x0a260835471d0c84,
                ])),
                Felt::new(BigInteger384([
                    0xde8e89daf6e69633,
                    0xace37c1f1320204b,
                    0x9c5b28e9010436d7,
                    0x5643070a7ad02462,
                    0x4552241c5f5465f3,
                    0x066131b9729021cc,
                ])),
                Felt::new(BigInteger384([
                    0x3114d1f554a74c50,
                    0x9d8ae8322a18e746,
                    0xed5ce5d5f3709aec,
                    0x819afac0dd9cc71e,
                    0x380eb6b6e7da9d47,
                    0x09735157ad3208de,
                ])),
                Felt::new(BigInteger384([
                    0x2185268c4418ec78,
                    0x719a4b5594f23af6,
                    0xe0fda83475079351,
                    0x1deb2d32eccf58bc,
                    0xdc14f6a520bd5918,
                    0x1683d3845f731ace,
                ])),
                Felt::new(BigInteger384([
                    0xb6e871a1f74c21b5,
                    0xb156103e85c304c4,
                    0xb133dbae54221671,
                    0x30da55973df778ea,
                    0xab54992a59acbee0,
                    0x1210000f3de9617d,
                ])),
                Felt::new(BigInteger384([
                    0xdbefad204d0f5891,
                    0x826cf15d9b270b8a,
                    0x1527c7403d32b451,
                    0x77e257268cb13010,
                    0xfb7583a9785aaf52,
                    0x130c655d614e775c,
                ])),
                Felt::new(BigInteger384([
                    0x609da72d7c755b00,
                    0x289c7cbe499a99f3,
                    0xad1329f6a779faf1,
                    0x9716fbadae7d020c,
                    0xbcba817d70c2347a,
                    0x0428771df38742aa,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xfd9c51d834847088,
                    0x4faae36887470d05,
                    0xd4b6b4bbb6b780d2,
                    0x3a3c6ae7e572a4e0,
                    0x8065f366569adc63,
                    0x0528071c93a3362a,
                ])),
                Felt::new(BigInteger384([
                    0xe46c5c632a980d7d,
                    0x40cb96cf292f8ceb,
                    0x71e8a777ec412c72,
                    0x7c958ee396083ed3,
                    0x294e8a81911ca231,
                    0x0214f354075fc9c1,
                ])),
                Felt::new(BigInteger384([
                    0xc1231a042c0a3c2b,
                    0x0da940c655469b86,
                    0x30f6c8684137b67b,
                    0x707416011d046509,
                    0x734d6ed42794cb31,
                    0x112e4035a347ba89,
                ])),
                Felt::new(BigInteger384([
                    0xf447f243b5657485,
                    0x7bd1d9c8e6b1e1bb,
                    0xdb3bb23c78bca06c,
                    0x03c3036a78436814,
                    0xe07f4fe1c2706ab8,
                    0x00652a386889e907,
                ])),
                Felt::new(BigInteger384([
                    0x8d42578e18ee5710,
                    0x023fcd7055eac4cf,
                    0x7f54d29bd8b9566f,
                    0x1ac6ecfd37f77527,
                    0x93dfaafbfe19ce67,
                    0x0f0b37d5dff79fdd,
                ])),
                Felt::new(BigInteger384([
                    0x63c2a2df2dbef600,
                    0xeee77677b25210df,
                    0x897526856a00abea,
                    0x7d94dedb0cce8e94,
                    0xd91c5827020aa05c,
                    0x116fc7e87aa412b4,
                ])),
                Felt::new(BigInteger384([
                    0x6c42e4a72ab66b54,
                    0x513795098c748f95,
                    0x11f1e4e10b82f9cc,
                    0x00673b139d650897,
                    0x08e2c9131b57e6ed,
                    0x14a5cfb69f9ac461,
                ])),
                Felt::new(BigInteger384([
                    0x4e2a9de42a150d3e,
                    0xc1a3d18d895aa34b,
                    0x692594047260613e,
                    0xcb5e22e33bae6f9a,
                    0xdfacc068560f8f52,
                    0x0f70193433c3bc23,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x07751c160c25bbd2,
                    0xe599f6271b9d0838,
                    0xf03ee13d9de2c156,
                    0x21bde4e99b223a32,
                    0xa19e52207c314c66,
                    0x0caab2ee6d30f8fd,
                ])),
                Felt::new(BigInteger384([
                    0x3c6e1ca2e396d94e,
                    0x3e08bcd6a75b2763,
                    0x25f3f0c8f02d7207,
                    0x0ab4c5ad3152d636,
                    0xbc7595907b17d483,
                    0x07d0f1ba76522aff,
                ])),
                Felt::new(BigInteger384([
                    0x08f1fd673eeb0c0e,
                    0xdf997d72a18a9945,
                    0x03dc20c95b66a5fb,
                    0xad8e63e4e0096dae,
                    0xd49c13217baa2f0d,
                    0x04f512dc451edf1b,
                ])),
                Felt::new(BigInteger384([
                    0x720f6a851dad36de,
                    0x5a450008d84d3295,
                    0x2d0fdc597d662dbd,
                    0xfcbcf62d1308799f,
                    0x6c73af4ac5b92ecb,
                    0x175a1850e85cb2d7,
                ])),
                Felt::new(BigInteger384([
                    0x7a6b5fe9e15a958f,
                    0xc09517a3a35f0842,
                    0x44ab95590dbb9b36,
                    0x409532d6652d7328,
                    0x8581626e58a49d52,
                    0x013648dc9d4f99f9,
                ])),
                Felt::new(BigInteger384([
                    0x0f37a33c91e18c81,
                    0x3b3d6c8a08c25d02,
                    0x5320b630958169cd,
                    0x4cf63b34cab0ab71,
                    0xef66900c87f5d5fa,
                    0x0410b3ac20f627b4,
                ])),
                Felt::new(BigInteger384([
                    0xc8ce810a638b6935,
                    0x27012636c9f4958a,
                    0x43834b2807a6ccb5,
                    0x1d145936c85ec9e3,
                    0xdd95f3ab26a9c75f,
                    0x12b929adec22e8de,
                ])),
                Felt::new(BigInteger384([
                    0x7e87eaf135a9b11c,
                    0xf8502f91c002b6cd,
                    0x7592242d2b29dee8,
                    0x3b19fb99c3d5365b,
                    0x1ed7f95fbc736fb9,
                    0x0e6be5e1c0f2aae7,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x5f2f72e792b7fb98,
                    0x32ca8751ba18a187,
                    0x43ab11b90121e325,
                    0x511d683cca811cf6,
                    0xf0e74004c91370d3,
                    0x1815b53ca6d73fce,
                ])),
                Felt::new(BigInteger384([
                    0xe9a77a910ff16e66,
                    0x23de7641de744fb0,
                    0xc11fed1c3898cf69,
                    0x4be3716035f4fc59,
                    0x586f0b43e2180c2c,
                    0x025bef9792340957,
                ])),
                Felt::new(BigInteger384([
                    0x34006404032eb887,
                    0xdff53412b7616bb3,
                    0x2234c51eec8466e9,
                    0xb60039645df84e25,
                    0xb05af0e6255852ed,
                    0x17a0c4839ea63130,
                ])),
                Felt::new(BigInteger384([
                    0xb76d7d0da18c7232,
                    0x420422ca38b70111,
                    0x72534300d38acd76,
                    0x7207fb7b23f0af84,
                    0xb2aa0de062f45af6,
                    0x16ba572cb4054e1c,
                ])),
                Felt::new(BigInteger384([
                    0x701b221e0edc4002,
                    0xf2ac1d48711ec0b0,
                    0x39d3303b418c4e3b,
                    0x9ef9aeefe329588e,
                    0xc2d2e7ad49639878,
                    0x117056cceeeaca7c,
                ])),
                Felt::new(BigInteger384([
                    0xa78c6fbd4bca9135,
                    0x2cafd5e0f722be63,
                    0x1f608ace548af90e,
                    0x7613bacaf134c2ce,
                    0x619c3e5c09a12e42,
                    0x0127763d1d72dc48,
                ])),
                Felt::new(BigInteger384([
                    0x1ca0a2729cf8beb7,
                    0xbd115c1f80a52493,
                    0xd31148cbcd771bd8,
                    0x7b03b10e9ac22748,
                    0x6cfb21bdd0014bbf,
                    0x17a39efa4d91b668,
                ])),
                Felt::new(BigInteger384([
                    0x721b66135ffaa13f,
                    0x68f5e31ad8e0b7b4,
                    0x9fb9482efa4b906b,
                    0x26b9d5c4badeba84,
                    0xbeb1790324e00b62,
                    0x0a956c0376bf4b54,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe73e66134cb7c8f6,
                    0x15ebbb835726449d,
                    0xb21d0dc3e664527d,
                    0x03c7bf54f6e6b43d,
                    0x8ae592bf5d6b165e,
                    0x02535e1366bed428,
                ])),
                Felt::new(BigInteger384([
                    0x23617f369aba531a,
                    0x5be59810f67832c6,
                    0x8e4612eeeed70815,
                    0xdc1c57b582c788aa,
                    0xc3f0a88de5aa8b2b,
                    0x07519d49e500d7c4,
                ])),
                Felt::new(BigInteger384([
                    0xaf487abc106b1b9c,
                    0x0557cb0bce4abb6d,
                    0x538b499a98d668a5,
                    0x8ed4149cab3af432,
                    0xfa2c4b363ce6e60b,
                    0x0fd3922796a58a93,
                ])),
                Felt::new(BigInteger384([
                    0x73fda77c8adf1109,
                    0xb7b6d0dbd9494718,
                    0xdf78873f79c89702,
                    0x25a0b823803281a0,
                    0x544bb6a91d3480bc,
                    0x062132a9ed1f44b9,
                ])),
                Felt::new(BigInteger384([
                    0x5a11ac7cc883cadf,
                    0x4381dde4cc988653,
                    0x392a5358aeb6cb3a,
                    0x8e575a0ec25b5d82,
                    0x2e229387134fcc40,
                    0x178b1d41125fc3d6,
                ])),
                Felt::new(BigInteger384([
                    0x19a83e61d68c50d4,
                    0x7542abd13972b219,
                    0xf88842b646cf82ac,
                    0x1d13dec4baf5fc34,
                    0x520410e924ee1843,
                    0x16535e3430898f08,
                ])),
                Felt::new(BigInteger384([
                    0x8eb75f3eea3aeb58,
                    0xa193867297c34478,
                    0xe7552aa28b7f8cf7,
                    0x10f48979365ca1a5,
                    0x18c131f4aba172d3,
                    0x174a4bf038186cf7,
                ])),
                Felt::new(BigInteger384([
                    0x0e5b430d7f6be058,
                    0xc24cff4c47d28923,
                    0xdb92520e57dcb4bf,
                    0x0eaf4a29aae8916c,
                    0x352a956ec7c93b9e,
                    0x0e2748597bbfa05b,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_sbox(i);
        }

        for (&i, o) in input.iter().zip(output) {
            assert_eq!(i, o);
        }
    }

    #[test]
    fn test_mds() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let mut input = [
            [Felt::zero(); 8],
            [Felt::one(); 8],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            [
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0x9a4dcc62d6e66751,
                    0x905bdfa5a0bd121d,
                    0x55f489d40bc5b07e,
                    0x1b500a845ea67ee8,
                    0x5918c04e5387c257,
                    0x15180cc8ba21cd05,
                ])),
                Felt::new(BigInteger384([
                    0x16d28dd75b6bcfa4,
                    0xf7f29439c3b72c25,
                    0x1e6078fd8f182ee2,
                    0x4384762e48d8dfe0,
                    0xb8879b4f08978fab,
                    0x0b5908e0c4f653c6,
                ])),
                Felt::new(BigInteger384([
                    0x600564b517dd9180,
                    0x20e26c9e8aa2d4c0,
                    0x53944c25b64ef60d,
                    0x425d776656d4c7f9,
                    0x4b69c38985cb19c4,
                    0x0c92dc424bff9661,
                ])),
                Felt::new(BigInteger384([
                    0x80b1e6a58d7ef714,
                    0x67bbc0a3cca158d3,
                    0x13f8d2b88b63b5bb,
                    0x27f2e2078c25726b,
                    0xc51ddaaac450a58c,
                    0x113b95c3f9018a1e,
                ])),
                Felt::new(BigInteger384([
                    0x87229cb9723eb749,
                    0xa1377b9c4534f999,
                    0x2f01160d659dcc1a,
                    0x25423a57cf90432f,
                    0x76ae772d77212778,
                    0x069849cc1b29b60c,
                ])),
                Felt::new(BigInteger384([
                    0xe063e718ba782493,
                    0x248ab9c5c6762c94,
                    0x01327b2fe80816f9,
                    0x9870c3b81fd9e6cf,
                    0x106e403cb311c96b,
                    0x11b6bfa72eaec732,
                ])),
                Felt::new(BigInteger384([
                    0xe590efbd0d2cc53a,
                    0xd39e4f4934bc3a69,
                    0x22a93562d7938f82,
                    0x868a7b94b2c4e1ff,
                    0x447756ed980e9644,
                    0x0ac28345894e9c39,
                ])),
                Felt::new(BigInteger384([
                    0x84a082c1b515dd3c,
                    0x5f6d07244e22571f,
                    0xa9f569f6b60dbdeb,
                    0x302d04ebe0769515,
                    0x116ede4773dddc24,
                    0x1892f12931bd1446,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x3666abadd380183a,
                    0x32254df6831fb19f,
                    0xd70533a4532762bb,
                    0x5735a42de0d7aaee,
                    0xe63f801fa42515db,
                    0x043fb425f84e5d12,
                ])),
                Felt::new(BigInteger384([
                    0xcc14a2f59389ecb2,
                    0x9179e539fb6deb36,
                    0x6d25a2c25080111c,
                    0xb1703f8393fdbcfb,
                    0x2b280bfcaf9be599,
                    0x062a76e15bc0ada8,
                ])),
                Felt::new(BigInteger384([
                    0x1937f061a9eebed3,
                    0x38b06b0ec0a7c2f7,
                    0x02db63d952dba369,
                    0xc3446def5c042563,
                    0x56f57e40745cf638,
                    0x0afd0b55ada893a4,
                ])),
                Felt::new(BigInteger384([
                    0x8d4f44e7b8d298ae,
                    0x09eb156b14663ea3,
                    0x645e96572d30a9f8,
                    0x9a9817eeb231ebef,
                    0x629efe35af475423,
                    0x0392c0aeb8881102,
                ])),
                Felt::new(BigInteger384([
                    0x1e77857d20d74b0c,
                    0x4eed4c65836d34c1,
                    0xebca5c18f5cf3a82,
                    0x1026d28b196f8818,
                    0x8c751acc6786c895,
                    0x14cc6566e8228e72,
                ])),
                Felt::new(BigInteger384([
                    0x89c5bbcaffbe459f,
                    0x102c9ccee81878fa,
                    0xc49bea9148511e8e,
                    0xdbb12c9adcac32e2,
                    0x9a5d5535c213559e,
                    0x0c8461d1523e3be6,
                ])),
                Felt::new(BigInteger384([
                    0x14a901cf4b8ab48c,
                    0x3aeeb3cbef43e86d,
                    0xc96fdc49f23e0bcb,
                    0x4a799e03e0e233af,
                    0x3d6700db638dfc78,
                    0x00f99294eaafa1f3,
                ])),
                Felt::new(BigInteger384([
                    0x6184aed610d03026,
                    0xf664668d0d3c8dd5,
                    0xb7e8d997612de914,
                    0x0c76184648314f5b,
                    0x55c6f4de45178e71,
                    0x10509484f55ce69e,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x6c05c5a7544e70a3,
                    0x708ed32709035ae7,
                    0xcc4a8854f022b53f,
                    0x6e269fda5e134946,
                    0x6c3fca6d9eb9f7f9,
                    0x0d9ab6bd33844ed3,
                ])),
                Felt::new(BigInteger384([
                    0xe1964d82445567fc,
                    0xe747f75e2f2fbfd9,
                    0xa1e9e5ac9f1818fc,
                    0xf4bb4feeb1772035,
                    0x76e60af0c62f3253,
                    0x1581c8325077fcf2,
                ])),
                Felt::new(BigInteger384([
                    0x51de278121b62e1d,
                    0xb6f1a36345280a49,
                    0x478d3904910cddcd,
                    0xaccb30b821623277,
                    0x681c0913905995ed,
                    0x14a654c091319a85,
                ])),
                Felt::new(BigInteger384([
                    0x8f0e34bbca47f461,
                    0x40b41d530e66ed7e,
                    0x667e99140e5378fa,
                    0xd9943afb43fcc4c7,
                    0x6f891fb2185c14e7,
                    0x0018f20a6ae36cbf,
                ])),
                Felt::new(BigInteger384([
                    0x6793ac68b8e899db,
                    0xb5bce2578fcf53fa,
                    0xd2011ebc1133a0e3,
                    0x2bdfb4bea1d2a945,
                    0x18d621a532bfed86,
                    0x0fd45f5d137e46b7,
                ])),
                Felt::new(BigInteger384([
                    0x985a817295570320,
                    0x426db8fef3586d30,
                    0xcbeb0d30b560f690,
                    0x71f326d0c3bc0875,
                    0x77a183892b31345d,
                    0x03b489cc744f84fe,
                ])),
                Felt::new(BigInteger384([
                    0xe3178a2c50d8b4e8,
                    0xed7236a2ecb2fbb7,
                    0xe78bcbe7f106b5a0,
                    0xcd1d43dc8adf2809,
                    0xcab87dcf1c923c3a,
                    0x198d3bfdef40ef02,
                ])),
                Felt::new(BigInteger384([
                    0xaf951dfa39497a57,
                    0x6d202c2826fb41ee,
                    0x17e0c1cbd9a4a4c0,
                    0xd676b92e6465094a,
                    0xed816b69ac2e3455,
                    0x0869902630d416f9,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4e9a78dd449e7e14,
                    0x99914c2c12c49c8a,
                    0x9e98a4a156e45cb4,
                    0xac579d2f56c26d91,
                    0xd3be7bf25ad16129,
                    0x137f366e76e27b68,
                ])),
                Felt::new(BigInteger384([
                    0x248a8d695ce5e090,
                    0x87a165f90b5ed1df,
                    0x519d00889f75a51b,
                    0xcd09641ff0388a18,
                    0x066ec99d800ad4d5,
                    0x0e4c2757a89f63ad,
                ])),
                Felt::new(BigInteger384([
                    0xaac7bfd8f2640be0,
                    0xb28a2a7853f10f42,
                    0x8ec2ce93c21e8e55,
                    0xa4ca6964264bac9e,
                    0xad9d9e54482c9dd1,
                    0x01d0dcd5322da97c,
                ])),
                Felt::new(BigInteger384([
                    0x54dab4f6d1c3b219,
                    0xba7c4567a9aad7a4,
                    0x163365c33e6ea80e,
                    0xd7fe84d5641558d3,
                    0xc959e9a0bc94878d,
                    0x11acad65a26c4755,
                ])),
                Felt::new(BigInteger384([
                    0x89bc94b2458cf54a,
                    0xbbe3c2851eff7a88,
                    0x11de52afa7a7d4e5,
                    0xad45471f4391633d,
                    0x232060c27d32a3d2,
                    0x15a8b1f999928627,
                ])),
                Felt::new(BigInteger384([
                    0x3583c82f05965d8b,
                    0x9ab757c79e251150,
                    0x018ea36b4744cc8a,
                    0x8e68f32713385c5e,
                    0x311e7d6656cfb41b,
                    0x06310dab374a1561,
                ])),
                Felt::new(BigInteger384([
                    0xdef098cb6754f5fa,
                    0x62f3af963bec0dda,
                    0x3c22a8627989eb6e,
                    0x04400e735f325774,
                    0x28065451c2c84881,
                    0x14e09ca592798098,
                ])),
                Felt::new(BigInteger384([
                    0x55ff99ce66360a0a,
                    0x93cc7a322b71d3a4,
                    0x3873fb6c0cd55d12,
                    0xbd5ff6169bb23c02,
                    0x849d5ef7d06690af,
                    0x10d3be4fa94ff984,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x72563d437a183bd9,
                    0x456fb3bca0b361ef,
                    0x41aa4216cb9ad0f6,
                    0xfa53dbfdccc9cf33,
                    0xf898b85cb61b78b2,
                    0x0cf1594125c39e1f,
                ])),
                Felt::new(BigInteger384([
                    0xdc0e5f7f281049c1,
                    0x745ce855e59891fa,
                    0xff335a772ff5243c,
                    0x819c74065ad4cfaf,
                    0xfc89f7d3ee75d322,
                    0x079b6c4bbf4820fc,
                ])),
                Felt::new(BigInteger384([
                    0x991ecaee67a3eb41,
                    0x7ee32070090af1ea,
                    0x0d33ed6d56a1fbc0,
                    0xc0bed4b8f6e966b7,
                    0x32a9634303c9fbfa,
                    0x153b9361ef57164f,
                ])),
                Felt::new(BigInteger384([
                    0x4800f6fbc30db4fe,
                    0x1ffd5f0f6e4a93e2,
                    0x32861d3272f92eaa,
                    0xd2caf2116d909fe0,
                    0x0fb0bd8fdd28c71f,
                    0x177be3a6535fda21,
                ])),
                Felt::new(BigInteger384([
                    0x310ce0e9a31301ef,
                    0x7a4981653f5de2c0,
                    0xe52ee3e9d0d8fa64,
                    0x16d7cc627a7b5968,
                    0x43d86585bc184c83,
                    0x0e8fa81b5defd6b1,
                ])),
                Felt::new(BigInteger384([
                    0x95d4fa77fe550fec,
                    0x8cdde71d052f98a0,
                    0x40e180999c7354f6,
                    0xbbd577a74f47b9d0,
                    0x9ad2b8e1bb28f84e,
                    0x0630e352f906647e,
                ])),
                Felt::new(BigInteger384([
                    0xf39f9c9a6cfa313d,
                    0x34c6600a11b453d9,
                    0xd4f19a4be8d011a0,
                    0x6f49377620f869e1,
                    0x428b939f685cd646,
                    0x1669ce1500582e8f,
                ])),
                Felt::new(BigInteger384([
                    0x8902cfaf4a79f4fd,
                    0x9f08f9121c306e66,
                    0x3240cbe2beb30c6c,
                    0xf3e95158d0e6aa21,
                    0xc26ca2cb6956cc7f,
                    0x17cee98367c41d82,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x7ff2517943c3eaf1,
                    0x541c037e10aa532e,
                    0x2cc9594c3428471f,
                    0xe1b32b740d826b72,
                    0x7216df3598ff7227,
                    0x0771fd0c266651a6,
                ])),
                Felt::new(BigInteger384([
                    0xb07e8684d1f78738,
                    0x9aaf654e943bebc8,
                    0x8fdd84a1f68b028c,
                    0x8a30d873c35fbf63,
                    0x0e9537e6e392dd5f,
                    0x059e77587d7ead74,
                ])),
                Felt::new(BigInteger384([
                    0xef18483bff82337c,
                    0x66b280258a492143,
                    0x4019e2a4d66e9c60,
                    0x7763fe6157680e65,
                    0xe74940612189ffa2,
                    0x0ff74a4691006a55,
                ])),
                Felt::new(BigInteger384([
                    0x66c5e2a45c5efebd,
                    0xcde939d0d0e201a3,
                    0x833eb55d43e0566d,
                    0x7ad3776d3239bb76,
                    0xa6d27d0b816cabfd,
                    0x03aa5b649592e259,
                ])),
                Felt::new(BigInteger384([
                    0x1e2cb132b667501f,
                    0x3d73b78369ec8f9d,
                    0x9222ec0bd888dafc,
                    0x0bb7c657d5ccdd9e,
                    0x23567869ea78c9b9,
                    0x104aafc65f441760,
                ])),
                Felt::new(BigInteger384([
                    0x33ca80ee045255ec,
                    0xc4c75d525fd1c177,
                    0x972de7fbb2cd01e8,
                    0x9b75ee69a9ef22bc,
                    0x8f9838c6efd9b552,
                    0x06978b4a0a7833fe,
                ])),
                Felt::new(BigInteger384([
                    0x31a8941075db7f7f,
                    0xbbc8740d2f948d38,
                    0x7beaa602f43cd50b,
                    0x55152c6115180b2e,
                    0x55cb77d164f14561,
                    0x095b32f8ecc27b74,
                ])),
                Felt::new(BigInteger384([
                    0xa4bfdf3aace3a249,
                    0xd7ebf8b844cedc71,
                    0xaee2813d6352310b,
                    0x557fa3ceecef8212,
                    0x080180a53d2b8045,
                    0x0b4665a4fac1e470,
                ])),
            ],
        ];

        let mut input2 = input;

        let output = [
            [Felt::zero(); 8],
            [
                Felt::new(BigInteger384([
                    0x544e00000019ffe6,
                    0xa7980065f8680015,
                    0x8f1fd2f4d61500fe,
                    0x63a6fd7dcd7449ae,
                    0x1d92e6777ef1565f,
                    0x13ac8aa27b07bcfd,
                ])),
                Felt::new(BigInteger384([
                    0x66b10000003affc5,
                    0xcb1400e764ec0030,
                    0xa73e5eb56fa5d106,
                    0x8984c913a0fe09a9,
                    0x11e10afb78ad7f13,
                    0x05429d0e3e918f52,
                ])),
                Felt::new(BigInteger384([
                    0x447600000027552e,
                    0xdcb8009a43480020,
                    0x6f7ee9ce4a6e8b59,
                    0xb10330b7c0a95bc6,
                    0x6140b1fcfb1e54b7,
                    0x0381be097f0bb4e1,
                ])),
                Felt::new(BigInteger384([
                    0xba7f0000002a552b,
                    0xc8ac00a607540022,
                    0xcec782259e35e414,
                    0x28d1890b30fbb30b,
                    0xbd47cc949d754125,
                    0x19781ccd798c9974,
                ])),
                Felt::new(BigInteger384([
                    0x544e00000019ffe6,
                    0xa7980065f8680015,
                    0x8f1fd2f4d61500fe,
                    0x63a6fd7dcd7449ae,
                    0x1d92e6777ef1565f,
                    0x13ac8aa27b07bcfd,
                ])),
                Felt::new(BigInteger384([
                    0x66b10000003affc5,
                    0xcb1400e764ec0030,
                    0xa73e5eb56fa5d106,
                    0x8984c913a0fe09a9,
                    0x11e10afb78ad7f13,
                    0x05429d0e3e918f52,
                ])),
                Felt::new(BigInteger384([
                    0x447600000027552e,
                    0xdcb8009a43480020,
                    0x6f7ee9ce4a6e8b59,
                    0xb10330b7c0a95bc6,
                    0x6140b1fcfb1e54b7,
                    0x0381be097f0bb4e1,
                ])),
                Felt::new(BigInteger384([
                    0xba7f0000002a552b,
                    0xc8ac00a607540022,
                    0xcec782259e35e414,
                    0x28d1890b30fbb30b,
                    0xbd47cc949d754125,
                    0x19781ccd798c9974,
                ])),
            ],
            [
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::new(BigInteger384([
                    0x544e00000019ffe6,
                    0xa7980065f8680015,
                    0x8f1fd2f4d61500fe,
                    0x63a6fd7dcd7449ae,
                    0x1d92e6777ef1565f,
                    0x13ac8aa27b07bcfd,
                ])),
                Felt::new(BigInteger384([
                    0x66b10000003affc5,
                    0xcb1400e764ec0030,
                    0xa73e5eb56fa5d106,
                    0x8984c913a0fe09a9,
                    0x11e10afb78ad7f13,
                    0x05429d0e3e918f52,
                ])),
                Felt::new(BigInteger384([
                    0x447600000027552e,
                    0xdcb8009a43480020,
                    0x6f7ee9ce4a6e8b59,
                    0xb10330b7c0a95bc6,
                    0x6140b1fcfb1e54b7,
                    0x0381be097f0bb4e1,
                ])),
                Felt::new(BigInteger384([
                    0xba7f0000002a552b,
                    0xc8ac00a607540022,
                    0xcec782259e35e414,
                    0x28d1890b30fbb30b,
                    0xbd47cc949d754125,
                    0x19781ccd798c9974,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x544e00000019ffe6,
                    0xa7980065f8680015,
                    0x8f1fd2f4d61500fe,
                    0x63a6fd7dcd7449ae,
                    0x1d92e6777ef1565f,
                    0x13ac8aa27b07bcfd,
                ])),
                Felt::new(BigInteger384([
                    0x66b10000003affc5,
                    0xcb1400e764ec0030,
                    0xa73e5eb56fa5d106,
                    0x8984c913a0fe09a9,
                    0x11e10afb78ad7f13,
                    0x05429d0e3e918f52,
                ])),
                Felt::new(BigInteger384([
                    0x447600000027552e,
                    0xdcb8009a43480020,
                    0x6f7ee9ce4a6e8b59,
                    0xb10330b7c0a95bc6,
                    0x6140b1fcfb1e54b7,
                    0x0381be097f0bb4e1,
                ])),
                Felt::new(BigInteger384([
                    0xba7f0000002a552b,
                    0xc8ac00a607540022,
                    0xcec782259e35e414,
                    0x28d1890b30fbb30b,
                    0xbd47cc949d754125,
                    0x19781ccd798c9974,
                ])),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            [
                Felt::new(BigInteger384([
                    0xb8380c9e33e43cb9,
                    0x0ebff6dcd51af1b5,
                    0xe36ce80561afbc28,
                    0x28a0f1d731114853,
                    0x77502fcaf4573c9c,
                    0x0abbc3cead076ef0,
                ])),
                Felt::new(BigInteger384([
                    0x51ba33f28b375852,
                    0x47b9010ccb068bba,
                    0x64c5c503c29dacb3,
                    0xa488cc4e6db6136b,
                    0x844ea7e747ac2fff,
                    0x104e36dc08549e74,
                ])),
                Felt::new(BigInteger384([
                    0x90a3818e89a5a7e3,
                    0xa29b7e10a90bd847,
                    0x8e7d0d2f051ad9c8,
                    0x76450fa4f09f1720,
                    0xd3832c036c28988e,
                    0x0c0276cca0e569b5,
                ])),
                Felt::new(BigInteger384([
                    0x6d2da7b82608a1b6,
                    0x2b149f4356a8c70f,
                    0xaa7d487e3ebc4e3a,
                    0xe0d6f2b531a64011,
                    0x7e5bca8da7037fa6,
                    0x0ed64f26f7b986d8,
                ])),
                Felt::new(BigInteger384([
                    0xc0a0f54630a8f29f,
                    0x25fead27c6097d45,
                    0x7e57d0dccb5600fd,
                    0x451186e9ca21f258,
                    0xc1a05116440ce014,
                    0x085077b97e689619,
                ])),
                Felt::new(BigInteger384([
                    0x8a8cd2b5936b5dc6,
                    0xb83142545ebdf62f,
                    0x1cef718f1f9b47f7,
                    0x4ba27f2acf8c4da9,
                    0xbe4113d5ae34f17c,
                    0x0812b57a0a1b75c3,
                ])),
                Felt::new(BigInteger384([
                    0xd5e1b4452a67aa49,
                    0x6baf9e3ce292dfe8,
                    0x5b427ea41d2ff752,
                    0xc114ec08e484115f,
                    0x066ab23371fcc440,
                    0x023a6ec30a305c7b,
                ])),
                Felt::new(BigInteger384([
                    0x5faf3fab3232282c,
                    0x7a303ae49efb44dd,
                    0x26aea2cdc2c92dc7,
                    0xdf5ba8d157e5a1a5,
                    0x4be2a72bcad76d3d,
                    0x13d9238a968d45c8,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x2db3ff2153a0e2a7,
                    0x4d1dfe996e317679,
                    0x85b93dab4e0f3aaf,
                    0xc2c822efc5b7f1c6,
                    0x8fc4f54bb6f5ae89,
                    0x19dd9ee89e71c8be,
                ])),
                Felt::new(BigInteger384([
                    0xc84eaa245d267a47,
                    0x9269437ed3b8cbdd,
                    0x4c9e6fdb2f60551b,
                    0x4260a130bc42da78,
                    0x617b1b5f6a888d06,
                    0x00ce37a1c55ffbcc,
                ])),
                Felt::new(BigInteger384([
                    0x5714f9a6708f4737,
                    0x279678149568f23a,
                    0x7240db377ba98468,
                    0xecb5ad775ee5635b,
                    0x2e3959e64a9f86c8,
                    0x0b5bd5aab47d2463,
                ])),
                Felt::new(BigInteger384([
                    0x05fae14fda87da82,
                    0xbf9b7a66ce5eeec9,
                    0x0b3cae2ecbddd632,
                    0x0a34b6bc6e0f9acb,
                    0xca176403ca734cc0,
                    0x1843a3bbc598089c,
                ])),
                Felt::new(BigInteger384([
                    0x99bc29df45ae59a6,
                    0xef981e1bc33bb76f,
                    0x32bf72ece8f2a6b1,
                    0xc6f1f9ba6805449d,
                    0x35b77ffa7c16f28d,
                    0x0ba7d7a920cc5813,
                ])),
                Felt::new(BigInteger384([
                    0x8ff8a1fb9ae1041a,
                    0x1aba5bb06a3107c0,
                    0x5436983c09c6efa5,
                    0x80086fe57397023e,
                    0x40a080e2182c70ce,
                    0x00d2200265db0293,
                ])),
                Felt::new(BigInteger384([
                    0x94ab35b6a07ba49f,
                    0x763d8e2f7e51b1b8,
                    0xaf82ec2a5b63734c,
                    0xdf4140c9c9202433,
                    0xe2ad56f8c1b6d057,
                    0x02a83cbf81fc8859,
                ])),
                Felt::new(BigInteger384([
                    0x81132a90fd1843b2,
                    0x97640bb992b9af00,
                    0x6c3fb77a667e499e,
                    0x5a7fca791587745c,
                    0xdb7df77ca84905a2,
                    0x076e02080fcad504,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xeaa566a7f94c42e7,
                    0x9b023ab378608a05,
                    0x715c93083167d535,
                    0xc73a38f96f224d67,
                    0x53cd9df235843142,
                    0x0f9a55413716b9cb,
                ])),
                Felt::new(BigInteger384([
                    0x308765d943c782ad,
                    0x823895a61ab2ad10,
                    0x330ec428c9aab9f2,
                    0x33137065c980aced,
                    0x3c6c3fa7ed33249b,
                    0x0bdba35c7567fcdd,
                ])),
                Felt::new(BigInteger384([
                    0xd97f125ae31f6dba,
                    0x2061257929313dcb,
                    0xc8b5cc8130ccbcd5,
                    0x6a43dbb07663b642,
                    0x80a8cf5dd94c70ce,
                    0x055cbb2088cda83d,
                ])),
                Felt::new(BigInteger384([
                    0xe6eec1b6f4dce885,
                    0x2f5fed14e331ad07,
                    0x7eb1903c7a1e083c,
                    0x392c70f7f7a4ace9,
                    0xa84f713e4dcf943f,
                    0x07e90f6bfd730a47,
                ])),
                Felt::new(BigInteger384([
                    0x87f6b4bd6c469f90,
                    0xd5ce79ec61b68c2b,
                    0xb98ee7748361ca2a,
                    0x4c1aa02ca2b49ab5,
                    0xb80b783b31957968,
                    0x18d3d523e4b772ff,
                ])),
                Felt::new(BigInteger384([
                    0x84a2face82db0f8e,
                    0x3bbd1c08b04a04c4,
                    0xf6b2a0f8bbb29151,
                    0x0895f2812344c0d3,
                    0xf4775e57b987bb0d,
                    0x0c79694321b85284,
                ])),
                Felt::new(BigInteger384([
                    0x781e51affcc42806,
                    0x95ce91be2e9ee181,
                    0xf09a929cdeb87357,
                    0xfb8bbd01cf2b569d,
                    0x7ec5e774cfb5b23c,
                    0x10e759e9a0915386,
                ])),
                Felt::new(BigInteger384([
                    0xb8717863f18fa97a,
                    0x8f473b8b9da0b1f7,
                    0xbceb407efd51e104,
                    0xc8b547b7072e6cbc,
                    0x7442a56e29f94198,
                    0x15288a5712d6edea,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8d820ab8e3a09bb5,
                    0xae7e5ddb1c1cdff6,
                    0xa7c99706524cd663,
                    0xdf9fc373619ede7f,
                    0xf3a6f1921a9123e3,
                    0x175b8b2c6d74d445,
                ])),
                Felt::new(BigInteger384([
                    0x344efc4a2fded9ca,
                    0x3c0d6f019f80c164,
                    0xdea2969bea9f9d7d,
                    0x1dbcfa27d3fd0c18,
                    0xc9342f329549ed51,
                    0x178e1e078c6d8967,
                ])),
                Felt::new(BigInteger384([
                    0x5ff2f7d7edc2f20e,
                    0x9015c34cf0334fd7,
                    0xbfddd21e97fbd2c5,
                    0x5306ec7ec5d41283,
                    0x649edb7a12495295,
                    0x07fcdeb704faad9d,
                ])),
                Felt::new(BigInteger384([
                    0xe0aacc3cf86e606a,
                    0x30b007923cbe946e,
                    0x01a4fc99a2aba982,
                    0x18831cd38595dba9,
                    0x44ecc7797faf6413,
                    0x049aac7568e53f5e,
                ])),
                Felt::new(BigInteger384([
                    0xefd2ef92931ce8ca,
                    0xc996dfff7027d73b,
                    0x46a71ba54b682411,
                    0x7a1f1f542dbd437c,
                    0x8122b340e9e0966e,
                    0x0fc66a9b54fc157d,
                ])),
                Felt::new(BigInteger384([
                    0xc46b6a6710bdcd3f,
                    0xd207b7e25ed377fc,
                    0x02a502c3c97b62e7,
                    0x9c7e2a7a36455430,
                    0xb7e9bb62eae0fb5f,
                    0x16c2d24ccf4efbc5,
                ])),
                Felt::new(BigInteger384([
                    0x2f0ddbceea8c8d4f,
                    0xe76fdf421768bfec,
                    0x927e604b483100aa,
                    0x5090c13b876db1c6,
                    0x44d03223d74cb4b6,
                    0x080d00180a9695a7,
                ])),
                Felt::new(BigInteger384([
                    0x747b4639b281851d,
                    0x24ccb1442f4d901b,
                    0x9e558e0d909a867d,
                    0x1f5087197b94d61f,
                    0x7539c050d0602cf4,
                    0x0d8f3b77d59613c8,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe0c4df9547adaeee,
                    0x65976bc27ad8237a,
                    0x21f51c3813ecb9f0,
                    0x145f9791d8280074,
                    0x467c42a53633c4f2,
                    0x152e448c030a478e,
                ])),
                Felt::new(BigInteger384([
                    0xe11a65bedef649f5,
                    0xb9d07da039aeaccc,
                    0x1e2f4720ee045c6e,
                    0x66846d6dd980b2f9,
                    0xc4fa00e42b65ecc0,
                    0x127d680a42a4c1f9,
                ])),
                Felt::new(BigInteger384([
                    0x4eba22ec397120a1,
                    0x0e05adf045227d3c,
                    0x3d17c776d5a797b1,
                    0xce1525e028f75168,
                    0x73a06e6f99c373a3,
                    0x11dbe90b24a63988,
                ])),
                Felt::new(BigInteger384([
                    0x979210164f0d6f1f,
                    0x9d2a02fae1be9f32,
                    0xa0a3faa399f2f093,
                    0xb1a5471cba66a5dc,
                    0x5f1f6973929c1d36,
                    0x07c07d8d7401ec1a,
                ])),
                Felt::new(BigInteger384([
                    0x42d83179205f3c24,
                    0xc479fc307ac5367d,
                    0xeaa191f1a486c8c4,
                    0x28dedfe7875ba0cc,
                    0xf7753dd2eea34cf3,
                    0x1426173c65f75790,
                ])),
                Felt::new(BigInteger384([
                    0x9f65691c9601fa67,
                    0x5f444eef71c31295,
                    0xa2c36a7c9d69334a,
                    0x87dfdea2635651c2,
                    0x5ae0086d630e5daf,
                    0x116da1cc7aa74ab3,
                ])),
                Felt::new(BigInteger384([
                    0xe601ceb5e0f1ff6c,
                    0x5c6e99e60de1c892,
                    0xcdf4f3707e25d11c,
                    0x8a1fadd84c3ad4a7,
                    0x40c9171b97f0df51,
                    0x19e23bf80e0e8630,
                ])),
                Felt::new(BigInteger384([
                    0x58d140879a11c064,
                    0x66080be7d3eef233,
                    0xc5e433c39bd3adea,
                    0x688e27f607c8095b,
                    0x14b7453827e4301a,
                    0x0de7ec690a24a08f,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xc92c3ac8716d8fb5,
                    0x5009a759210c5c57,
                    0x94b171f45f054819,
                    0x9bc6096283db17d5,
                    0x23d6b257030e07d7,
                    0x0b8e8a977909262d,
                ])),
                Felt::new(BigInteger384([
                    0x09eab2ebc73fc08d,
                    0xaf820f59aa063f6c,
                    0xc61a693993ccd87e,
                    0xfe61e2b8fd8cb3a0,
                    0xeb645fc397fda059,
                    0x19b42065437167aa,
                ])),
                Felt::new(BigInteger384([
                    0xb73050216b8df856,
                    0x2f97d0ce7c8c220b,
                    0x86df029268c9e3ed,
                    0x6a0891b9570eb3e1,
                    0xfd1e1cd2ce363b32,
                    0x0134f84834cd59fd,
                ])),
                Felt::new(BigInteger384([
                    0xd6d4cd68f943c819,
                    0xdcddb2c48a66dbe9,
                    0x2a0d108d019b3bba,
                    0x89ea3d1a64541638,
                    0x80e5b5e53a53a60c,
                    0x0f58bcdb1ce62021,
                ])),
                Felt::new(BigInteger384([
                    0x20a05dfa2c7bb938,
                    0xc6dc19f5380a413e,
                    0x57663cb42326b6af,
                    0x2fbe654b9420cb6c,
                    0x06579b36a41312ed,
                    0x0bc8194cd84bea2d,
                ])),
                Felt::new(BigInteger384([
                    0x68438fc86b202173,
                    0x5e22ad5ba381b896,
                    0x5937e18d2a6d24fd,
                    0xe8297e6e7178251e,
                    0xfc18f80991db2d1b,
                    0x0fc28164f08a88ac,
                ])),
                Felt::new(BigInteger384([
                    0xad1646ccb8d23da6,
                    0x17d664c5faddc607,
                    0x14ea32d7ae504542,
                    0xa8f633ed9c5e879d,
                    0xdb250d6b429314e2,
                    0x13ed265b0f794df2,
                ])),
                Felt::new(BigInteger384([
                    0x95b53929d73f5ed7,
                    0xc817743a5e1b6e3a,
                    0x41589f7b5c61534c,
                    0x539dca2f00f1df62,
                    0x5e3e2564b18a785f,
                    0x07f621c4b305933e,
                ])),
            ],
        ];

        for i in input.iter_mut() {
            apply_mds(i);
        }
        for i in input2.iter_mut() {
            apply_naive_mds(i);
        }

        for (index, (&i_1, i_2)) in input.iter().zip(input2).enumerate() {
            assert_eq!(output[index], i_1);
            assert_eq!(output[index], i_2);
        }
    }
}
