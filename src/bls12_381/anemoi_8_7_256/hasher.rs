//! Sponge trait implementation for Anemoi

#[cfg(not(feature = "std"))]
use alloc::vec::Vec;

use super::digest::AnemoiDigest;
use super::{apply_permutation, DIGEST_SIZE, NUM_COLUMNS, RATE_WIDTH, STATE_WIDTH};
use super::{Jive, Sponge};

use super::Felt;
use super::{One, Zero};

use ark_ff::FromBytes;

#[derive(Copy, Clone, Debug, Eq, PartialEq)]
/// An Anemoi hash instantiation
pub struct AnemoiHash {
    state: [Felt; STATE_WIDTH],
    idx: usize,
}

impl Default for AnemoiHash {
    fn default() -> Self {
        Self {
            state: [Felt::zero(); STATE_WIDTH],
            idx: 0,
        }
    }
}

impl Sponge<Felt> for AnemoiHash {
    type Digest = AnemoiDigest;

    fn hash(bytes: &[u8]) -> Self::Digest {
        // Compute the number of field elements required to represent this
        // sequence of bytes.
        let num_elements = if bytes.len() % 47 == 0 {
            bytes.len() / 47
        } else {
            bytes.len() / 47 + 1
        };

        let sigma = if num_elements % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        // Initialize the internal hash state to all zeroes.
        let mut state = [Felt::zero(); STATE_WIDTH];

        // Absorption phase

        // Break the string into 47-byte chunks, then convert each chunk into a field element,
        // and absorb the element into the rate portion of the state. The conversion is
        // guaranteed to succeed as we spare one last byte to ensure this can represent a valid
        // element encoding.
        let mut i = 0;
        let mut num_hashed = 0;
        let mut buf = [0u8; 48];
        for chunk in bytes.chunks(47) {
            if num_hashed + i < num_elements - 1 {
                buf[..47].copy_from_slice(chunk);
            } else {
                // If we are dealing with the last chunk, it may be smaller than 47 bytes long, so
                // we need to handle it slightly differently. We also append a byte set to 1 to the
                // end of the string if needed. This pads the string in such a way that adding
                // trailing zeros results in a different hash.
                let chunk_len = chunk.len();
                buf = [0u8; 48];
                buf[..chunk_len].copy_from_slice(chunk);
                // [Different to paper]: We pad the last chunk with 1 to prevent length extension attack.
                if chunk_len < 47 {
                    buf[chunk_len] = 1;
                }
            }

            // Convert the bytes into a field element and absorb it into the rate portion of the
            // state. An Anemoi permutation is applied to the internal state if all the the rate
            // registers have been filled with additional values. We then reset the insertion index.
            state[i] += Felt::read(&buf[..]).unwrap();
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
                num_hashed += RATE_WIDTH;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        // Finally, return the first DIGEST_SIZE elements of the state.
        Self::Digest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }

    fn hash_field(elems: &[Felt]) -> Self::Digest {
        // initialize state to all zeros
        let mut state = [Felt::zero(); STATE_WIDTH];

        let sigma = if elems.len() % RATE_WIDTH == 0 {
            Felt::one()
        } else {
            Felt::zero()
        };

        let mut i = 0;
        for &element in elems.iter() {
            state[i] += element;
            i += 1;
            if i % RATE_WIDTH == 0 {
                apply_permutation(&mut state);
                i = 0;
            }
        }

        // We then add sigma to the last register of the capacity.
        state[STATE_WIDTH - 1] += sigma;

        // If the message length is not a multiple of RATE_WIDTH, we append 1 to the rate cell
        // next to the one where we previously appended the last message element. This is
        // guaranted to be in the rate registers (i.e. to not require an extra permutation before
        // adding this constant) if sigma is equal to zero. We then apply a final Anemoi permutation
        // to the whole state.
        if sigma.is_zero() {
            state[i] += Felt::one();
            apply_permutation(&mut state);
        }

        // Squeezing phase

        Self::Digest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }

    fn merge(digests: &[Self::Digest; 2]) -> Self::Digest {
        // initialize state to all zeros
        let mut state = [Felt::zero(); STATE_WIDTH];

        // 2*DIGEST_SIZE < RATE_SIZE so we can safely store
        // the digests into the rate registers at once
        state[0..DIGEST_SIZE].copy_from_slice(digests[0].as_elements());
        state[DIGEST_SIZE..2 * DIGEST_SIZE].copy_from_slice(digests[0].as_elements());

        // Apply internal Anemoi permutation
        apply_permutation(&mut state);

        Self::Digest::new(state[..DIGEST_SIZE].try_into().unwrap())
    }
}

impl Jive<Felt> for AnemoiHash {
    fn compress(elems: &[Felt]) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = [Felt::zero(); NUM_COLUMNS];
        for (i, r) in result.iter_mut().enumerate() {
            *r = elems[i] + elems[i + NUM_COLUMNS] + state[i] + state[i + NUM_COLUMNS];
        }

        result.to_vec()
    }

    fn compress_k(elems: &[Felt], k: usize) -> Vec<Felt> {
        assert!(elems.len() == STATE_WIDTH);
        assert!(STATE_WIDTH % k == 0);
        // We can output as few as 2 elements while
        // maintaining the targeted security level.
        assert!(k <= NUM_COLUMNS);

        let mut state = elems.try_into().unwrap();
        apply_permutation(&mut state);

        let mut result = vec![Felt::zero(); STATE_WIDTH / k];
        let c = result.len();
        for (i, r) in result.iter_mut().enumerate() {
            for j in 0..k {
                *r += elems[i + c * j] + state[i + c * j];
            }
        }

        result
    }
}

#[cfg(test)]
mod tests {
    use super::super::BigInteger384;
    use super::*;

    #[test]
    fn test_anemoi_hash() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![Felt::new(BigInteger384([
                0x7687998fca67ede8,
                0x863272e3c8dca0d1,
                0x66e01f4a8a3feb0e,
                0x5f4119e074bb8810,
                0x2f0f831377a6ab9d,
                0x03443c825200c20c,
            ]))],
            vec![
                Felt::new(BigInteger384([
                    0xd94658f7d69e4305,
                    0x60983e6518709e27,
                    0x31cb438a93c55575,
                    0x01484ae809667ee7,
                    0x391237124093bb5f,
                    0x03be94709c6719ff,
                ])),
                Felt::new(BigInteger384([
                    0xaa68d2075017b431,
                    0x1910296e7c909d7d,
                    0x3d4829eadb4cb79c,
                    0x223619958cb800a0,
                    0x50d745ccd0d9e097,
                    0x0ff9d8812d4078a8,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x4aad1f8d8de31644,
                    0x76999975a0ea2cc3,
                    0x7a82113f224ebb1f,
                    0x917ebcb49562ba6f,
                    0x3aa2901e40674dba,
                    0x0d19c700f6419dff,
                ])),
                Felt::new(BigInteger384([
                    0x45872a275cd261ec,
                    0xcdba0f3ba65e0b33,
                    0x558ff7b9cbb926df,
                    0x1e313247917dd1ae,
                    0x3aca8e3f6b0ccf12,
                    0x01538a1d6a1c5231,
                ])),
                Felt::new(BigInteger384([
                    0xa5b2713e7e49002e,
                    0x13d4977ddf92b744,
                    0xf42ecb0e83d74b40,
                    0x48f06a07f15fc8af,
                    0x05a9f2abf45ad612,
                    0x014099d71c79746b,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x7b1c135a6efcd40b,
                    0x731b5b1f1a9aaa21,
                    0x607d4758980a5637,
                    0x8263f30e1aaee2c3,
                    0x6e0939525a7dbbc9,
                    0x0b37e2c0e2cfe378,
                ])),
                Felt::new(BigInteger384([
                    0xfa1a17a697c0534f,
                    0x4085507a8de98f34,
                    0x14674e0b90b0f0dd,
                    0x4c4f911404f333b7,
                    0x0be9c3464392a036,
                    0x168e9403e2f2e22a,
                ])),
                Felt::new(BigInteger384([
                    0xbc3e346f7fe55fd2,
                    0xd006c55e0ad09dd8,
                    0xc8fa8124ee621be5,
                    0x2a39fb9865f73023,
                    0x7ee384b828494ce8,
                    0x1616dd3bcdbf3d1b,
                ])),
                Felt::new(BigInteger384([
                    0x41df4cc9ef6eabd4,
                    0x0390b9ebe93a8cd3,
                    0xeede13128da986c7,
                    0x5a84e5f0ff9d1534,
                    0xb857c13fdd601cb8,
                    0x029a81bc596749f6,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xa7021b98e01dd5b8,
                    0x91d10f6247d2875e,
                    0x85ef18fef02be661,
                    0xfbfe62826f5ee7a2,
                    0x908146a971f9950c,
                    0x19a0ca2afb8afdec,
                ])),
                Felt::new(BigInteger384([
                    0x51e3f6a5ac6cb342,
                    0x14a9a94b734e26f2,
                    0xeb22f71e3b542f90,
                    0xee6f8d9e86784b6f,
                    0x7f26ca2272adc67a,
                    0x106b569d1c01ae02,
                ])),
                Felt::new(BigInteger384([
                    0xd8f233844bdbe63d,
                    0x0e7035d091a64524,
                    0x6d5e815e5d762638,
                    0x36665742f6dd1a8b,
                    0xebbc27abcd76beed,
                    0x161459c9be42fcdc,
                ])),
                Felt::new(BigInteger384([
                    0x3f61058ee2cf4a60,
                    0x83f699bbf6f815d0,
                    0x6468126091dd350a,
                    0x33938dac190bbae6,
                    0x4a597c0beca70c98,
                    0x13ec7a15056c2202,
                ])),
                Felt::new(BigInteger384([
                    0x735b6d7525a4267a,
                    0x148be78bcff7184b,
                    0x71cd59bb72490edd,
                    0x0953d62b23621f75,
                    0x3068e7829a66dc99,
                    0x0c5ad5a9d46f6254,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x6efd0e9e7d38682c,
                    0x4a13c8edfba511c1,
                    0x5b9244c3d79bbdec,
                    0x2d113b504f2181aa,
                    0xb20380d875b0805b,
                    0x13ffe90f78aea9d4,
                ])),
                Felt::new(BigInteger384([
                    0xc5b73cbcb541bc07,
                    0xaef8b61600916e1b,
                    0x14116cc6e0898b2a,
                    0x7991f3cf79e18f54,
                    0x29dea7ddd8f1a91b,
                    0x114b4d53363b6088,
                ])),
                Felt::new(BigInteger384([
                    0x85919b520c442d2a,
                    0xa1dadb85fc20bde3,
                    0x43258670f5b44696,
                    0xaf6c0a83bd40bb2f,
                    0x42c0b47f4fe3342f,
                    0x12353d3f129d5da1,
                ])),
                Felt::new(BigInteger384([
                    0x63731429d2e42a00,
                    0x8c4525ab8e74cea4,
                    0xadc9ca414d4935c8,
                    0xd948dd99bb7eec06,
                    0xdcb852645362bed7,
                    0x150e7d096f1c82ef,
                ])),
                Felt::new(BigInteger384([
                    0xa882f90ef173454b,
                    0xbf0ad036033aed71,
                    0x3ab3b6f6a40cc92b,
                    0x5b1e63e456d294ad,
                    0x10a1441624d6523c,
                    0x12aa7516c8143698,
                ])),
                Felt::new(BigInteger384([
                    0x3fa3734a904f343e,
                    0xb1f23366216d2d0d,
                    0x09e7ba3b952844c1,
                    0x8e9d0ac84592f0e6,
                    0xc879ad6da9606582,
                    0x0da377c615ff4ac4,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0x4bbc601065647037,
                    0x2fc29f0d8b0538cb,
                    0x0716d9244110800a,
                    0x533e9cc2d12e33a1,
                    0x43875851bc37e091,
                    0x19d0e30510efff70,
                ])),
                Felt::new(BigInteger384([
                    0x78da14ca1d0f4c95,
                    0x2e97cc0247cfb2bd,
                    0x0596cb293fb5507f,
                    0x7e09e33d87ad5813,
                    0x52c06c41753c8452,
                    0x0e1c8d92b58c4aeb,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x0d8d7626be404f8b,
                    0xf245cf3ca4a4fd14,
                    0x1b11ebc11b94196d,
                    0x231e00bb09ddfb67,
                    0x91814251a81ac28f,
                    0x143e449779703d8f,
                ])),
                Felt::new(BigInteger384([
                    0xb7525de1dfa76b33,
                    0xe4478da40a302114,
                    0x2519424de9d020f0,
                    0xdd0db1baa496d4d5,
                    0xe30c022da02e3b44,
                    0x038568d887b9594f,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x2d5a720243d73899,
                    0x28c192a76d44e0aa,
                    0xfb06bd1551a581ea,
                    0xfc98ad8515fb758d,
                    0xea498a9b2e26761f,
                    0x1301ac7048623bda,
                ])),
                Felt::new(BigInteger384([
                    0xdde101d80a446712,
                    0x5fa77fd3616f118f,
                    0x3ebe3b0c412c8f7c,
                    0x3ee8bb8e9f956297,
                    0x5be2725e4a3f2ef0,
                    0x139473e7d7f9c39b,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x682cd884a33bec0f,
                    0x8fd459a687abf9a8,
                    0x6e323b697d27f2d1,
                    0x6f593252c7ee9ab5,
                    0xb6c23fba1ace8804,
                    0x16cf9b58a3175503,
                ])),
                Felt::new(BigInteger384([
                    0xc44d4028eea54a09,
                    0x6a1792cf4381a5f8,
                    0x0f4f4d38ba9a48c4,
                    0xb389a0a3ee839eff,
                    0xf5ff67f99ed606af,
                    0x067b917f4be78628,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xf19cca2a7084ac94,
                    0x795ecb97427f536c,
                    0x7ee30123436c0d89,
                    0x2d7531d4386a418c,
                    0x413da83da7d02b6a,
                    0x0512478c3d502ca0,
                ])),
                Felt::new(BigInteger384([
                    0x12b483e01b7d9d7c,
                    0xc046fce44e430068,
                    0x05ffc8598768e916,
                    0x0eff6fa8c13b45b2,
                    0x3af03fed062950e3,
                    0x16d4d5781e2ac732,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x2b9f69d180b28cb2,
                    0xac28082918e38715,
                    0xd3c0758b15078ae3,
                    0x084b1aa5ef3a366b,
                    0x147cc83061efe779,
                    0x16be17d1a94c92a7,
                ])),
                Felt::new(BigInteger384([
                    0xc603c06658908464,
                    0xdbe1ebc36c891847,
                    0x3f3fe21f020e330b,
                    0x6c5eb1fc838fc16e,
                    0xd7562f4a9d6946f1,
                    0x0221d18639c40764,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xb65105fdd448e2a0,
                    0x7cab8f5cd85a36cb,
                    0xc17368f1b8168d2c,
                    0x2426457aa721fa02,
                    0x366c530936ee3c1b,
                    0x19d6466facb7fd55,
                ])),
                Felt::new(BigInteger384([
                    0x74b9617cf930bff4,
                    0x320138540ef014ea,
                    0xd2c2cdb0fda57343,
                    0x8e9d01812ba3dc2e,
                    0xb7c4af0b3798518f,
                    0x0091e7f97fd742f9,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x9681a7165a0e2f00,
                    0xfed63708e59736b8,
                    0x7057185572195fad,
                    0x27804e2c41f85240,
                    0x3ae0cab063d5aa2c,
                    0x10ce7eb1efb644aa,
                ])),
                Felt::new(BigInteger384([
                    0xf84be76ce0aea19f,
                    0x7e2f810466958840,
                    0xdf4cd25ea3877343,
                    0x686ff68bca5df3a6,
                    0x48a97be275fd4f9f,
                    0x0fb3668ea4e624f2,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xc5fb443041bbcdb3,
                    0xd801876a0da1f856,
                    0x71a725aae672d892,
                    0xb7e6901e6fd8b2f6,
                    0xa7e7b16500ec1c80,
                    0x0cf1907853371178,
                ])),
                Felt::new(BigInteger384([
                    0xc06c7f63e530e5b1,
                    0xd6c5914380129f37,
                    0x00e2caa02797fa0a,
                    0x89872dc72b9ab626,
                    0xecbfda00fa75baa2,
                    0x10e984fae14ac49f,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x4987ceef5d260741,
                    0xd0280349a3de642c,
                    0x0a506cacffcd5df4,
                    0x4efcd93d96e8e3d9,
                    0xba4469df7010f9f6,
                    0x0b5f755cbe6632ae,
                ])),
                Felt::new(BigInteger384([
                    0xd37b244cfc81be9b,
                    0xbf966a063f7edcf4,
                    0x615d70aa3ada0a5c,
                    0x78988f206aa8003a,
                    0x32a632f951ffacc0,
                    0x149f42f7504f7efe,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected, AnemoiHash::hash_field(input).to_elements());
        }
    }

    #[test]
    fn test_anemoi_jive() {
        // Generated from https://github.com/Nashtare/anemoi-hash/
        let input_data = [
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x7ef1bc4b682285e0,
                    0x02827099566b094d,
                    0x48a02e9f310e0851,
                    0xc9052c83388a4655,
                    0xf48d0b7cbaa1850d,
                    0x100f34d00cf04784,
                ])),
                Felt::new(BigInteger384([
                    0x4ec5139fc63176cd,
                    0xc49ff7a043f04fd1,
                    0x18f2c3d157b3e0a2,
                    0x558ffa94e52f705f,
                    0x811f86a8a8a1b6ec,
                    0x06dfa571f664f9aa,
                ])),
                Felt::new(BigInteger384([
                    0xfda65fceb7801748,
                    0x1d33f0d4afda8398,
                    0x7d09071297ffb10b,
                    0xe0dc7a8f689ad052,
                    0xb83b4abf4a288a83,
                    0x118ee4cd20d5eb98,
                ])),
                Felt::new(BigInteger384([
                    0xc95f4904faa4dae6,
                    0x0387d848396487eb,
                    0x48b3750c00ec6eed,
                    0xdd18171ffaac8989,
                    0x56f4fbddd825c5cf,
                    0x14ff4896ffb87680,
                ])),
                Felt::new(BigInteger384([
                    0xd7126be3e9485735,
                    0x4e55747cabd9a58f,
                    0x480ea9f0e4014e68,
                    0x5a0a6b945b0fbfc5,
                    0x1623b2d099a39afc,
                    0x12c9c3fc15a14b52,
                ])),
                Felt::new(BigInteger384([
                    0xdcf32bccd884439d,
                    0x11e8174687492021,
                    0x80c8fb3d4990ef9d,
                    0x1776f4bfd76fd3c7,
                    0x6af36aeceffbf6d1,
                    0x028fa6f630cb4d12,
                ])),
                Felt::new(BigInteger384([
                    0xfb8e2ccb501e120e,
                    0xf986987da5563a49,
                    0x40e7dfdfbd3154d0,
                    0x07f6f8f1df438919,
                    0xf1c76d4314fbc74b,
                    0x0b2e2f9c2ba9bc5b,
                ])),
                Felt::new(BigInteger384([
                    0xfbdfe4f85df62026,
                    0xeb369fd91ea63968,
                    0xefbbfd5399d2ed9d,
                    0x20ac92e074362a27,
                    0x7fd2114813001ace,
                    0x11cbbc488211826f,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xa2e12fc7a9cd8029,
                    0x1eb8e5ac4773f38a,
                    0x7c903675c4b1a86c,
                    0x0af9df0b6aeba2fd,
                    0xc422b905e2b6f771,
                    0x1094da2258acd6d4,
                ])),
                Felt::new(BigInteger384([
                    0xa9e222600c13db93,
                    0x4f80a34c20a1aacc,
                    0x152cc4e142914662,
                    0x5556d046735704cc,
                    0x663b2127db2f3da0,
                    0x022b992850f8cd6b,
                ])),
                Felt::new(BigInteger384([
                    0x855bb5b7d0b0abb4,
                    0xa2e2696cdebc001e,
                    0xd6e7da7939bdae96,
                    0x4713f9681d6a138b,
                    0x6694c76d6614dcd0,
                    0x0c057f97836393c8,
                ])),
                Felt::new(BigInteger384([
                    0x193dc2a1f9a24f19,
                    0x0c62dcd2429fa8fc,
                    0x12d7a991bbefd56f,
                    0x5cc7b0bb6a178017,
                    0x19f8983e28de9ae3,
                    0x0dfe58669a155852,
                ])),
                Felt::new(BigInteger384([
                    0x938709d364792e32,
                    0x82c6a980fbbd14f4,
                    0x592825030ca65531,
                    0xa0f75ecab765b49c,
                    0x866f71ffd6ac03f4,
                    0x021d1158fbfd2f81,
                ])),
                Felt::new(BigInteger384([
                    0x95e308250c46228c,
                    0x1c770a4bb20fa7fd,
                    0x79fe4165d171a737,
                    0xe20c2208c944bedb,
                    0x5a18040db7864106,
                    0x08c8928a58a6ecf1,
                ])),
                Felt::new(BigInteger384([
                    0x0b30a044b5e101e2,
                    0xe7116e05a80683d5,
                    0xa8276c63af2f75f1,
                    0xb3aa8f23577cde4c,
                    0xff0da0b23a2d9b6c,
                    0x0b05975489d4d04b,
                ])),
                Felt::new(BigInteger384([
                    0xabbf54deb4d88413,
                    0x20882c7102e2c16b,
                    0xc0f4c4520f10534f,
                    0x521a166531645b68,
                    0x5922eb48f81d3eb4,
                    0x161d6f451dd8ff03,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x16bf239fb10bcf63,
                    0x80e90c52b480b957,
                    0x8a79997eccc50338,
                    0xc0c430b43eb36ba6,
                    0xaa300ac78054c5c0,
                    0x16991449b0c6005b,
                ])),
                Felt::new(BigInteger384([
                    0xd77d0bffff6b6722,
                    0xb05e9c9dcfd0a8a7,
                    0xf5782a6c405c4753,
                    0xfcfd955296aaa6a6,
                    0x2209c82cdaabeaac,
                    0x01a44c712caf55f2,
                ])),
                Felt::new(BigInteger384([
                    0x470d5e6c683ef5ad,
                    0x39888c530ad6b42c,
                    0x07e8612df3c3a715,
                    0x0a01e9502da94279,
                    0x73b597b282dd8933,
                    0x0ec675d0df67fe7b,
                ])),
                Felt::new(BigInteger384([
                    0x077acc87edeb5678,
                    0x963f29b44c3bc160,
                    0x577b968824cc660c,
                    0xdcd9f3d454861862,
                    0x6ee13763b7b6cf7e,
                    0x17f1f2f0ac02a7c8,
                ])),
                Felt::new(BigInteger384([
                    0x07a65876f286e8af,
                    0xfeba24ddedef3c67,
                    0x736aabcf17a45610,
                    0x09b544ecec0650eb,
                    0x8b9f3dbccdb8dd2c,
                    0x13600ba21011c81c,
                ])),
                Felt::new(BigInteger384([
                    0x53bcc78abcf4b251,
                    0xaea48bc1fbc655e1,
                    0x81c929bec5f83119,
                    0x2795502f7a31b757,
                    0x528ecff47355a09f,
                    0x09b1fdd6e7a1d45f,
                ])),
                Felt::new(BigInteger384([
                    0x6095f6b88d5cb986,
                    0xe640d6d612f03df0,
                    0x0b3a390f11385dfc,
                    0x176f2901f15cad70,
                    0x596187d934ddd0d5,
                    0x128412d94d974438,
                ])),
                Felt::new(BigInteger384([
                    0x34335a3439d2ad9a,
                    0x1baf5d113d8faa48,
                    0xe0b059ebcf94f734,
                    0xb25513b467a1b21c,
                    0xbded6b5f29eb4c56,
                    0x13a17413eafe0b48,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xd262cd819836ca43,
                    0x36275f1e38e20189,
                    0x7e33ed024309ab95,
                    0x535f86e36d40f1a2,
                    0x5465396c30f0f4e2,
                    0x06315714fda371ba,
                ])),
                Felt::new(BigInteger384([
                    0xba0a77050a3ac56e,
                    0x7a1924bf306b240f,
                    0x5bcab0ba78b3c440,
                    0x7cff56adc065408e,
                    0x5965f59d068a95d6,
                    0x032ab516c325ed1b,
                ])),
                Felt::new(BigInteger384([
                    0x42c5baa19cd5b246,
                    0x75fc3241fe4995cd,
                    0x80c6325c5ef20549,
                    0x083b3350b510fdfc,
                    0x24e90513f7277123,
                    0x0e28d191fd28b372,
                ])),
                Felt::new(BigInteger384([
                    0x298d4d8b68c532e4,
                    0xcf47e93dc7de4b89,
                    0xf950052cf9b9f736,
                    0x972aec7da1468700,
                    0x71d615cafaddc830,
                    0x01f923cccbe9d7d7,
                ])),
                Felt::new(BigInteger384([
                    0xbd821e8aa6c0f59e,
                    0x675a43013266e9e6,
                    0x3e0879d5e3a6cfe3,
                    0x627347495a7e5f0f,
                    0x81895b1ffd904de7,
                    0x16c218bcc2094ddb,
                ])),
                Felt::new(BigInteger384([
                    0x4ba8b50fe419d576,
                    0xfa1239d61f10dfe6,
                    0xfef411aa4f5b209e,
                    0xd18266c98fb4094e,
                    0x19b68097d6498f55,
                    0x15588d0a539779c1,
                ])),
                Felt::new(BigInteger384([
                    0x62a1e4888d7a87bc,
                    0x3a9a85475d74098e,
                    0x0235b56c1b5fa1b4,
                    0x0c773c2f9831e582,
                    0xa47243cab166d22b,
                    0x0b8eea82275838f7,
                ])),
                Felt::new(BigInteger384([
                    0xf42f8d4be562f40b,
                    0x875c097cdd8727bf,
                    0x4f1701ed53370831,
                    0x152c8ad91cd603c4,
                    0x9662fca1d0b3c348,
                    0x0b00f4623cfdc0ea,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xedffcd2c5463aad5,
                    0x8c8b6f079c157913,
                    0xf3fd79ed8f94f6e8,
                    0x11c62e45d222e2b0,
                    0x47286b69246bd0a1,
                    0x18b52e58d51e8bf7,
                ])),
                Felt::new(BigInteger384([
                    0x8410ff01b43459a1,
                    0x4a4509d526e8779d,
                    0x188a57c7bccd86b2,
                    0x3a94e9db0fedf260,
                    0xae5a242915ac4253,
                    0x01d1cc3e85366d0f,
                ])),
                Felt::new(BigInteger384([
                    0xb0fa15e4c960c5e1,
                    0x65357ef926ecd46e,
                    0x682a4fbf6875f085,
                    0x91eda4e2b2568aa4,
                    0x49969ac9afb34f84,
                    0x0ef03f5bb6cbb99d,
                ])),
                Felt::new(BigInteger384([
                    0xba474c6952725c1f,
                    0x0cc958a69e5bcf01,
                    0x876872f9b55c3ed5,
                    0xe607cce9c6858e34,
                    0xa3066409fd76fa5a,
                    0x0ec91afb683c3ce6,
                ])),
                Felt::new(BigInteger384([
                    0x5ca04963c859f6ea,
                    0x30879f52b627378e,
                    0x76a6a98924c09362,
                    0x17df97e3b0d5875b,
                    0xa9c9768ae087ee75,
                    0x0c3d385127f1dcc4,
                ])),
                Felt::new(BigInteger384([
                    0xb00f66ba6a7a5f24,
                    0x323961dc83a80824,
                    0x7b5d366a7037cdc3,
                    0x9f98c1018b309b7a,
                    0x1a1cff5bb031f6da,
                    0x0a1c3a919f43e7ae,
                ])),
                Felt::new(BigInteger384([
                    0x0109c28aed76aeff,
                    0x92bf90cb078f6021,
                    0x8dc3d11c8f9c86b5,
                    0x32fde71f72b5411b,
                    0x13a76d44c78e8bc8,
                    0x17b5ea37c08b9d24,
                ])),
                Felt::new(BigInteger384([
                    0x12555df4a43dc6c3,
                    0x1ccf8ba13158967c,
                    0x516e7e1e7b386aa7,
                    0x773bbf0d630921c7,
                    0x5421222e6e56cfa7,
                    0x0f4532905704f739,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x2756daedd2c72112,
                    0x95fa4f8b07fe9fe7,
                    0x0649fbcfa71b4ec3,
                    0xe8cd06d89097bcac,
                    0x92b1b5d492ab74e8,
                    0x0e7cc74c06ac929c,
                ])),
                Felt::new(BigInteger384([
                    0xf750a54af33ecf5d,
                    0x1e686661b5c15216,
                    0x8de98f303d9a8f5f,
                    0x312b0e05ff42e467,
                    0x8aaa88c00eb96e34,
                    0x17c777d574320dd6,
                ])),
                Felt::new(BigInteger384([
                    0x00b45b440a86786f,
                    0x7cb37a6d6e5d487a,
                    0xf52a06bb74a4e73e,
                    0x0c89d61130bd2817,
                    0x24de9fc6d668b96e,
                    0x02423415dcd36886,
                ])),
                Felt::new(BigInteger384([
                    0x8ca5d9c13b9a956f,
                    0x013efe23b2efdee6,
                    0x2cdd619700365305,
                    0x0766b0389a13c25d,
                    0x95d82bf72ceb517d,
                    0x0998cdbb05f36ddb,
                ])),
                Felt::new(BigInteger384([
                    0x7b59d6fb765b03f1,
                    0xa12e75c15affb680,
                    0x0c04a413074dd629,
                    0xf01024780a82568d,
                    0xdbb80681ee1531a0,
                    0x0cf0aa3c11d2b2e3,
                ])),
                Felt::new(BigInteger384([
                    0x88695c3314b49e79,
                    0xc8ebfb50c02aa167,
                    0xb6282df491eee690,
                    0xad7db1bdacc26512,
                    0x74f9c314f5cf7ae0,
                    0x03158bb0fb684b50,
                ])),
                Felt::new(BigInteger384([
                    0xe18931b2b17cf180,
                    0x6c8d0994b762012e,
                    0x6546260dd38b2de7,
                    0x70dc3f57921b0500,
                    0xd6a7ba95991af362,
                    0x0743fe3ff3eac311,
                ])),
                Felt::new(BigInteger384([
                    0x07a2e4a0620289b8,
                    0x1cab4bf1a55965fa,
                    0xa0ed947e97356945,
                    0x12183791db710715,
                    0x33583b296ed8a9e7,
                    0x08f27da8d3365538,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0xd0e7b910f85c807e,
                    0x237fd3c991823d3d,
                    0xeeb333bd854c1532,
                    0x03d1a90c87e594ac,
                    0x746715eb2b190de2,
                    0x19bb90a581562c5f,
                ])),
                Felt::new(BigInteger384([
                    0x2702cc489ca6062e,
                    0x50ff4fc0c175cd42,
                    0xf342548a96d28326,
                    0x2d5b1c4a7f2a0073,
                    0xb9212a2469eda709,
                    0x065f8e89104d57d3,
                ])),
                Felt::new(BigInteger384([
                    0x6a6f5e31fa2fb3c6,
                    0xc77c20bb924e2abb,
                    0xb554db69f62e4e04,
                    0x9289065c1e4f92b0,
                    0x1e8a16d04c5922b8,
                    0x0cd49f474fd5325f,
                ])),
                Felt::new(BigInteger384([
                    0xea7e996ec47f18b4,
                    0xbab4999458bf39f5,
                    0x90eb7dea867d7668,
                    0x1757fdea4b753466,
                    0xd9ea1c59156de07f,
                    0x0263c0d9c44bcb02,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x7e706eb526c2ca0f,
                    0x15a7b34eaa402ad7,
                    0xacbab005486108c3,
                    0x864961a52b51e232,
                    0x4c2a538590d2f3a8,
                    0x063adf2025a1d46f,
                ])),
                Felt::new(BigInteger384([
                    0x3565e3fdb96bca16,
                    0xc28eac352a7811a5,
                    0x9385efb0070aab48,
                    0x561e083382dfc98e,
                    0xd297271dd3b56725,
                    0x016d49a297244d84,
                ])),
                Felt::new(BigInteger384([
                    0xd65d29af0c8af207,
                    0xf66e9a0c60b1e7b9,
                    0x070df81037b316bf,
                    0x0a8480c63250dc06,
                    0x25d41da93c85a53e,
                    0x1982a00b67fd5d51,
                ])),
                Felt::new(BigInteger384([
                    0xe87f0152767346e6,
                    0x71297a2b66e7bcb8,
                    0xda4ab3b0af96cd8e,
                    0x007745c3fc24ef41,
                    0xf11ba8a4a15a01ee,
                    0x02935675c765ad65,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xdefa7ab895735ff9,
                    0xdc6f0f28ae858514,
                    0x621aefd2fa1be906,
                    0xfacf9c07ed7a31ab,
                    0x47ecf1e43c4ef729,
                    0x047cfdc07965353c,
                ])),
                Felt::new(BigInteger384([
                    0x6e9a7f3b2b83c83d,
                    0x22fa2b616d6c43a9,
                    0x1fc6fa0ca254ab19,
                    0x96825b6c81f431f5,
                    0xca36e8d5a4239d0e,
                    0x03416c761fb447ea,
                ])),
                Felt::new(BigInteger384([
                    0x248ea2e01ae2ff29,
                    0xcf057f1852f7ffee,
                    0x7be1c8f262e299c7,
                    0xc5b7f499efadab78,
                    0xcb1ed16a64d0aa30,
                    0x0c87b2c3825ed104,
                ])),
                Felt::new(BigInteger384([
                    0xe9f2df2a07c87b04,
                    0x6ee34cc3f69bdf46,
                    0x2bcb2c2e591680d5,
                    0xd6d29b42c97c4547,
                    0x7a3837a346169e99,
                    0x049f9016ec632d8b,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe1eafc045f39d9a1,
                    0xdfe5c10e0cda3484,
                    0xb695b97f513746c6,
                    0xc7a5c4671dfb0074,
                    0xd7eb9aee2872d913,
                    0x03098ad5b1d3f7c6,
                ])),
                Felt::new(BigInteger384([
                    0x779f0b7b479f0d9e,
                    0x384bce04a4832a4e,
                    0x1f3a016b7f6fcbd2,
                    0xe6666d994cff7dd1,
                    0x6adc920b1cc473e1,
                    0x0d43fb05a2040f43,
                ])),
                Felt::new(BigInteger384([
                    0x5f103f24c1e306b0,
                    0x45af2aa5563f5471,
                    0xfb72dba312cebd61,
                    0xdda09384979e2707,
                    0x5a1ca11360dc1ee0,
                    0x067ab1b5fcfd281f,
                ])),
                Felt::new(BigInteger384([
                    0x48b753f0e7eb35e6,
                    0xdca15cbee0d0d034,
                    0x9fc48c2e72975735,
                    0xef0209250b62dcab,
                    0x28763496e314d15f,
                    0x1719b5ddbb826ce9,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xa08cc868491bc7b9,
                    0x59291b247bb2db3c,
                    0x86cb5af23d24f16a,
                    0x747b48ac422b55c9,
                    0x6d54082d7ba9c783,
                    0x0f5cd55dfb8f4239,
                ])),
                Felt::new(BigInteger384([
                    0xe38a5f6a4b866739,
                    0x6e46dbd69835bf08,
                    0x695d5def3ad0516a,
                    0xecda1b70d9c88df7,
                    0x8a7854772efd7de6,
                    0x1693df88ec32d198,
                ])),
                Felt::new(BigInteger384([
                    0xfc73b45cde544813,
                    0x83d5dde360f79c77,
                    0x9709bcae5a69b6eb,
                    0xf135c9f8feaf5f30,
                    0xfca698cbb516dba2,
                    0x13f1967d399427d7,
                ])),
                Felt::new(BigInteger384([
                    0xe04f6ac8e8a37343,
                    0x6a620faea86db6b7,
                    0x6cd32f2747fe1d27,
                    0x104b40b06817d3f1,
                    0x7b4c94d6909ded9e,
                    0x11c12940d0c1d5b5,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x9bd3aa7fd33210e7,
                    0xd19623ff8d146eb8,
                    0x7039465bd3e7db11,
                    0x96d334a7f2f0e6d2,
                    0xddbbf191026dff42,
                    0x01804c6b33dbeb7f,
                ])),
                Felt::new(BigInteger384([
                    0x08e7fd41581aa830,
                    0xc67cb3fc1f9331dc,
                    0x37b7abbd146fd793,
                    0xbe4a17b933c99155,
                    0x985ca12a59d999ed,
                    0x077ceba65773c616,
                ])),
                Felt::new(BigInteger384([
                    0x372347d2f2ce37e8,
                    0x40b48457c1d080a3,
                    0x1cb5e4f184bf6402,
                    0xfdc4c081c26c4d86,
                    0x5da57830d8d97942,
                    0x12528ebf27dc3ae4,
                ])),
                Felt::new(BigInteger384([
                    0x2fa588492d5a5806,
                    0xc82092e4241b5697,
                    0x46e216f6995491ad,
                    0xd17368fa6540e61e,
                    0x275455fb92e0aed1,
                    0x083b35e8f40c34e6,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xa85310131e8f936b,
                    0xb3603da1165d9c41,
                    0xbadcac222ad987ef,
                    0xe5f3cbd75ef8cfab,
                    0x244f1e2d6b503d1d,
                    0x0133bad46f3e284e,
                ])),
                Felt::new(BigInteger384([
                    0x6a83745875d647d8,
                    0x667ca63dc6ffe5c2,
                    0xc5decddb0abd2284,
                    0x9dccddfefd712ecc,
                    0xe4f3ffe6f489c066,
                    0x18138cbede80f40d,
                ])),
                Felt::new(BigInteger384([
                    0x6098a9c620961047,
                    0x5b7a141d3a9f767a,
                    0x8f3a08219770c6f1,
                    0xc16597c0400a58b3,
                    0xee2bc10c3bd181ee,
                    0x061d2d53060469bf,
                ])),
                Felt::new(BigInteger384([
                    0x997a78a2ec0cd97b,
                    0xb335863d02feea6f,
                    0x5603a30680e75deb,
                    0x211e701437f341dd,
                    0xb5aab23049439d71,
                    0x03c53fd64bc9275c,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xad8a0a155afc77f3,
                    0xb04643f798722f95,
                    0x35e79e9db756a612,
                    0x260eb93e17be0902,
                    0xd1e3d58e95b29477,
                    0x027dc6a191c3b6ee,
                ])),
                Felt::new(BigInteger384([
                    0x826b2eed2c2beb6f,
                    0x0adaa296db853eec,
                    0x636474e0a4da2c4a,
                    0x1565245e8414d381,
                    0x372c64d43f307cbd,
                    0x077bb925584f44a3,
                ])),
                Felt::new(BigInteger384([
                    0xef658a61e99d27e4,
                    0x93a71660f61c2028,
                    0x1630a396e1cdb96b,
                    0x9e5bc1b7a2d2caf3,
                    0x817a2e87f792ae6d,
                    0x13d627cc378bd488,
                ])),
                Felt::new(BigInteger384([
                    0x8556b68a4177d313,
                    0x21ee3f5b274e4d3b,
                    0x27392c3b9de91ffb,
                    0x4f50426b3222bdea,
                    0x8403695108c5c2af,
                    0x0ddf0d1bca1c50be,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xf605ed9c973ad1a0,
                    0x0ec5b7740c7433f7,
                    0xf8d954845fc4cefd,
                    0xea404f2b73ab53fd,
                    0x2a607fb473db0f08,
                    0x04b4407f834c2e1a,
                ])),
                Felt::new(BigInteger384([
                    0x0ba6d9afa4893d3d,
                    0x5029033d36b95d2f,
                    0xc3aa1641f8e2aa56,
                    0xc89f653409e7cf82,
                    0x746ca23bdd50aa4a,
                    0x08ff7832371825dd,
                ])),
                Felt::new(BigInteger384([
                    0xba832d89c5767e8c,
                    0x3f743bd73539a136,
                    0xe25a6802f44e6b85,
                    0xe4746161fcf4cf79,
                    0x196b9a429d235681,
                    0x07026878dac1db8c,
                ])),
                Felt::new(BigInteger384([
                    0xf586d598cf0d3945,
                    0xd11dde2df192e49c,
                    0x38c20d7a4bda329d,
                    0x32d09b54bcb10ef0,
                    0xb9fc3117ff2a9d63,
                    0x08727ff1bae5d6e7,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xe4548724c12b645b,
                    0x536d57e0f8f703f2,
                    0x2fc7fc1b9ba0cbd4,
                    0x8d206a82c7f8c2c8,
                    0x63fcb2fb0da85f1d,
                    0x017f464192c320ab,
                ])),
                Felt::new(BigInteger384([
                    0x4c660bb003d7107b,
                    0x2d52a80729a1e9ca,
                    0xc4a7f92de3d31e88,
                    0x76a59b1b10163a26,
                    0x9fc60ded78d86898,
                    0x11f0fa3c8868bcad,
                ])),
                Felt::new(BigInteger384([
                    0xae57c8fb9d55fecc,
                    0x2cfa77e8673c8537,
                    0x063ded58270f40c3,
                    0x6a7d48a29ea1b2b2,
                    0x1f3d51b653d968ac,
                    0x10df1bf2743b182d,
                ])),
                Felt::new(BigInteger384([
                    0x0685a818639a33d9,
                    0x32f5f6dc4378b72d,
                    0x6187ff46bafeb464,
                    0x68456770570ba864,
                    0x9d5b1dd27d1e1195,
                    0x0b336abee11f1129,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress(input));
        }

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 2));
        }

        let input_data = [
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
            ],
            vec![
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::one(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
                Felt::zero(),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xa71d36f6ceac3078,
                    0x2a3d304a047d687b,
                    0x7fb6f19c5ee332be,
                    0x6b380d8b7568e12f,
                    0x49bb2ec9926c5ac2,
                    0x03f943195e671cba,
                ])),
                Felt::new(BigInteger384([
                    0x17d6f957bd943acf,
                    0x8ac2c2de44badaf9,
                    0x76d37470cdcb8838,
                    0xc3f67493566a8c98,
                    0xbf40287ebc2ef73d,
                    0x08125dab1f01f330,
                ])),
                Felt::new(BigInteger384([
                    0x74c0c8f17e3480e4,
                    0xa7357abc107add57,
                    0x6db4f03df3a8fb0d,
                    0x542b05283341c0f0,
                    0x7e570bba9baa6600,
                    0x072c767ecda22ef3,
                ])),
                Felt::new(BigInteger384([
                    0x0d381d46623128c4,
                    0x71a51d5d8075879c,
                    0x363b6a0b14e7993a,
                    0x9b858eedb24390b4,
                    0x1dfa65de72ae14c0,
                    0x161c6d73f7712415,
                ])),
                Felt::new(BigInteger384([
                    0x190bf4cec8f4cf50,
                    0xab755f59a3adeac6,
                    0x48eaeb6f1676f881,
                    0x2cce2a56ff4cc17e,
                    0x74719ebfb7518a8d,
                    0x0f10a797ac6eaef5,
                ])),
                Felt::new(BigInteger384([
                    0x00046b204a318e8d,
                    0xbfff96b47d88de4b,
                    0x2632bdc57b29bee6,
                    0x719f4b9d92682a4c,
                    0x8ab1557e162252f4,
                    0x010d926599b57ed1,
                ])),
                Felt::new(BigInteger384([
                    0x0c16ed9452232221,
                    0xedb58e86a827baa4,
                    0x6bc0f410d9c300c0,
                    0x9e0395262348d686,
                    0x4bca5f9083617ac4,
                    0x0210008d145dcfda,
                ])),
                Felt::new(BigInteger384([
                    0xcb78507b54293e00,
                    0xa31fd48af265fbfd,
                    0x1f686488359f0ec5,
                    0xe0ce0fd9967b6fce,
                    0xe1c24f59067df39a,
                    0x12fb34e6b264f6db,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x7d5e42584f694549,
                    0x639382323f74572c,
                    0x5ad33bf05ed66e78,
                    0x0787a5ac3336c1f7,
                    0x6ded295aa7d62f42,
                    0x0746768bf539e1b0,
                ])),
                Felt::new(BigInteger384([
                    0x3bd32c144db6ae8d,
                    0x2cfc2d45ee9d5095,
                    0xd9461b28c436f338,
                    0xd330e91aa62de147,
                    0x45f4413f67e74419,
                    0x04bb88a0b23743ae,
                ])),
                Felt::new(BigInteger384([
                    0x4fdb1a1cfff9d17d,
                    0xdb26b666d2aa26e4,
                    0x38d52a147d77ebfe,
                    0x47cb75dd316511cc,
                    0xe5cc05125503815b,
                    0x056c07e4b16fb1d3,
                ])),
                Felt::new(BigInteger384([
                    0x3e2995d800004208,
                    0x4415179640a68b30,
                    0xde0384445f1e46e8,
                    0xaa82be4b461e8a64,
                    0x3059ca334e288e74,
                    0x01b74e350bf537a4,
                ])),
                Felt::new(BigInteger384([
                    0x4f2a85660ac36718,
                    0x3a0b5ca6d6bd2ff2,
                    0x710bdcd012a42cba,
                    0x1dc5af56e0b62e4d,
                    0x90055ffb5a45ede1,
                    0x133b67db2df7a04b,
                ])),
                Felt::new(BigInteger384([
                    0x387483e2d5c23e1c,
                    0x64e33b68aeb3fc40,
                    0x840bb4e5898984c6,
                    0xa2ee6b465f4c6a01,
                    0xe60c2b5b4326d291,
                    0x0cacc0e143d7ba61,
                ])),
                Felt::new(BigInteger384([
                    0x21871cd619b12d54,
                    0x09655c266b171886,
                    0x4570af8d3dd69bb6,
                    0x5b4019d8552a021d,
                    0x56cdfa8e7a161de9,
                    0x0b9de656146e4f5d,
                ])),
                Felt::new(BigInteger384([
                    0xe058bbc8589327dd,
                    0xe73355eed741c084,
                    0xc4eaf118073859cb,
                    0x14a313ee24668782,
                    0xc0ebc230703a490a,
                    0x069782868b3a2dfe,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xca0de37acfe081ee,
                    0xb17c9e4788790325,
                    0x515a56da3b6e37ca,
                    0xe5c104a9742579a2,
                    0xc75ef67b025ea411,
                    0x1802371dcbeb7245,
                ])),
                Felt::new(BigInteger384([
                    0xdb6f5038dcde2a84,
                    0x831021df44daac9e,
                    0x62f82a17953a3775,
                    0x7afd1b479baa7d2e,
                    0x8a3275a54facd6c2,
                    0x0e5f42e89acce5d5,
                ])),
                Felt::new(BigInteger384([
                    0x321aa6b5422a27b7,
                    0xbf51c6540dcf94d4,
                    0x1d28d930f9ed96c9,
                    0x6133c44187c3d327,
                    0x70be88d350900d88,
                    0x13d666be561d2a9c,
                ])),
                Felt::new(BigInteger384([
                    0x2cfaf7b507a106ef,
                    0xf6479335c9d0173e,
                    0xd6cbdc6d177c1fe0,
                    0xaef3777a79243ce9,
                    0x4eb6132cfaa235a8,
                    0x0c39f54fd26d9e0f,
                ])),
                Felt::new(BigInteger384([
                    0x3cf9cf89aea3c4c9,
                    0x0d781900e29a060a,
                    0x0b893e0c4774ca7d,
                    0x3f8a8812493c10ee,
                    0x245c78274874a412,
                    0x14ab4076d4219fe6,
                ])),
                Felt::new(BigInteger384([
                    0x6554cf467345746e,
                    0xcb30e14025fd54d5,
                    0x84589035510e43f0,
                    0xb696567477b174f6,
                    0x4ca1767221a2b139,
                    0x0350a8d309bfa90c,
                ])),
                Felt::new(BigInteger384([
                    0xb2eb1a8a4f33f89f,
                    0xc3546736a1433f30,
                    0x49e04674bb84f248,
                    0x461f7421297bbf89,
                    0x2dddb4c891f8e614,
                    0x0cba703d663fe27e,
                ])),
                Felt::new(BigInteger384([
                    0xc350a2c3ca07b7c7,
                    0xd0a2a77baf617425,
                    0xccc34d8497ceda85,
                    0xa10b5b26d815092f,
                    0x05b3a60341a304ee,
                    0x098b4cbdc8d46268,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0xca60b8c4454f5d5d,
                    0x0ab84de9de4a383f,
                    0x739697ba367cb05c,
                    0xf5988be3275d1240,
                    0xba62def23c4a24c0,
                    0x160c959b3f9b5189,
                ])),
                Felt::new(BigInteger384([
                    0x712f94c68b6ff9a9,
                    0x6ed55f144384dbbf,
                    0xc232766b82e38aa1,
                    0x547a87daa5bfdc8e,
                    0x6e93858cfcac9de2,
                    0x10b9d068256c53bb,
                ])),
                Felt::new(BigInteger384([
                    0x181f9a8eb98226a3,
                    0x9de0bd4377010281,
                    0x8bfa51a89a6ee336,
                    0xb3b838761d348940,
                    0x26bc1c78f6ab5e0c,
                    0x10d87c56e1d4d0c2,
                ])),
                Felt::new(BigInteger384([
                    0xbb7e418503c64c78,
                    0xe110254a6ea81f34,
                    0x0892df730f639b19,
                    0x93157d686a0a42ba,
                    0xd09036b1033038bc,
                    0x15a456c6800cfb68,
                ])),
                Felt::new(BigInteger384([
                    0x8012db48332b4050,
                    0x30330ccc3f2e057c,
                    0xf97b68ff295ac27c,
                    0x113a2890bd68dba7,
                    0xde7cecfface7b8b3,
                    0x0f6b6e55d431047e,
                ])),
                Felt::new(BigInteger384([
                    0x3a18cc9fad02d71d,
                    0x6040b26ae0c14601,
                    0xe0e5887b9185c062,
                    0xe1a160ead4906213,
                    0x512c7862c93dab93,
                    0x19c13078b69c739f,
                ])),
                Felt::new(BigInteger384([
                    0x537210642d12b16d,
                    0x565343f95531d5dd,
                    0xa9d094e4af24c58a,
                    0x9b6eeb7d4b142730,
                    0x7cfe3fed7b6ddbd4,
                    0x001b49e1248e8a50,
                ])),
                Felt::new(BigInteger384([
                    0x376d1a4bce577bbb,
                    0xb2120c2488c0e2fc,
                    0x3a5dd3a1a78736c7,
                    0x3b4a13e5eb4f08b6,
                    0x94291bae01876420,
                    0x145bb95457ae3a2d,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x2544499cf04600ca,
                    0x2e287a1ff134d2ef,
                    0xbba9763898c99505,
                    0x11d4400adfb4f899,
                    0xf257b41c2bf4f17c,
                    0x17eff6a394f3049f,
                ])),
                Felt::new(BigInteger384([
                    0x1c5d9f756903df63,
                    0xf9f30d8017b9aa86,
                    0x70a6893cfc8ad409,
                    0xdd942ba6442a252b,
                    0xd8b37c5a9733cd79,
                    0x05f6fb40d7a71889,
                ])),
                Felt::new(BigInteger384([
                    0x2cee46ec320e78ed,
                    0x20e75cfceef7f8d0,
                    0x33a8aa6d121c5f58,
                    0x42158315ee76231d,
                    0xe8118868a8ec46d0,
                    0x1901496531d509b1,
                ])),
                Felt::new(BigInteger384([
                    0x1f592c47fa66a863,
                    0xc56b0995832fb796,
                    0x5c6c18c8a318d80f,
                    0xef7e509fd880ebd6,
                    0x681a050e4b6603da,
                    0x061d1d2ed362041d,
                ])),
                Felt::new(BigInteger384([
                    0x21df565c27a3c709,
                    0x4d6efb76bf732da2,
                    0xafcf5aa899f75579,
                    0xb8ec94c127a8d585,
                    0x549368e87c8f4598,
                    0x009b7fc0384fc7c3,
                ])),
                Felt::new(BigInteger384([
                    0x268bcaf73ce7135e,
                    0xb7e05d0b7fcdd632,
                    0xdfe14356d139c106,
                    0x0433f540d6139e04,
                    0x5472fcf0a2f8a543,
                    0x0e20999e82d048ec,
                ])),
                Felt::new(BigInteger384([
                    0x7d7a1ef93edd73df,
                    0x7228a38af7090fc1,
                    0xc23c1def13addd72,
                    0xb357ccc2cd24301b,
                    0x3b42376f9eaa2e33,
                    0x0006e5980a26710d,
                ])),
                Felt::new(BigInteger384([
                    0xe27967e9b326fb2c,
                    0x006c84bfc8cb7cad,
                    0x31ae27d0d72055a5,
                    0x3f7c9f5002e2cdac,
                    0xdda8a3db47343e96,
                    0x04648ff7892f1420,
                ])),
            ],
            vec![
                Felt::new(BigInteger384([
                    0x7e50537042230106,
                    0x52524fea035676e7,
                    0xc95e1b5f121648a9,
                    0x4d7f91234da96368,
                    0x03b7538cd5f36ad8,
                    0x142212da80ce746f,
                ])),
                Felt::new(BigInteger384([
                    0x059d22ee185cc2bd,
                    0xed77eecf739b999d,
                    0x6458f56a28d53402,
                    0x9a1790715575ac44,
                    0x7ed26cabf20ed1c8,
                    0x115b39fb894a2769,
                ])),
                Felt::new(BigInteger384([
                    0x29d3025180fcb20f,
                    0x18a667e16d05e25f,
                    0xdf0198e0392b32b3,
                    0x52e39773b7f7bbe5,
                    0x6df33811319f0c02,
                    0x04044253924a808b,
                ])),
                Felt::new(BigInteger384([
                    0xa1f472a2bb8fe36e,
                    0xacc2b56b5e3d6896,
                    0x0786337553ff0198,
                    0x469a0edb8497126d,
                    0x6d44d8c122fa29f0,
                    0x11f4c0aeacb44a6c,
                ])),
                Felt::new(BigInteger384([
                    0xc1d5441d353e1684,
                    0xce383855292edb41,
                    0xf59c69e6a93b5023,
                    0x79eec4a8a0a7b7fb,
                    0x29b69adc3fb8091b,
                    0x0c47fcb0250c511f,
                ])),
                Felt::new(BigInteger384([
                    0xa8b45fa2495b0e9c,
                    0xc3f4795d56039d4b,
                    0x8baa6a4faad42c1a,
                    0x2567e78ce5aec651,
                    0x7fda5cc637329dac,
                    0x137ba2c28a74f212,
                ])),
                Felt::new(BigInteger384([
                    0xb818b7122ffe38bd,
                    0xd8848b5a418f175f,
                    0xe0cf20dd80fae4d6,
                    0x477f9bd0be93b01f,
                    0x78fcf66937eeceaf,
                    0x006de34ed57ea494,
                ])),
                Felt::new(BigInteger384([
                    0x70c8bf4498b45ca3,
                    0x0b566fb7066cddfe,
                    0x7babdb4d56299666,
                    0x04a4a6b4bc5dd550,
                    0x181c733f5ac25efa,
                    0x188fe325cb543940,
                ])),
            ],
        ];

        let output_data = [
            [
                Felt::new(BigInteger384([
                    0x81581742f28c8999,
                    0xcc4ff486727c67f9,
                    0x3cd73c8684c96d12,
                    0x31e363e3b2b0149e,
                    0x47d58505342683c3,
                    0x0c8f1e0297ab7824,
                ])),
                Felt::new(BigInteger384([
                    0x118165b761251ee2,
                    0x0bb3e9551a350738,
                    0x842dd2751d4ff98f,
                    0x44b31a34ca9f34da,
                    0x930b467d7f5b8788,
                    0x08c34f62d49922d6,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x9ace9864334e116b,
                    0xed6a4d5c599e1291,
                    0x4c97d5748963295e,
                    0x2c5696e66a1dab79,
                    0x26e2c9788a0cec0f,
                    0x05bc6d41541f4b26,
                ])),
                Felt::new(BigInteger384([
                    0x1de4e5502fdf10fc,
                    0x33b82660915fce5e,
                    0x6dd0a360b6a178d7,
                    0x56954df77f04b8d0,
                    0xc3b2cfc2750f6913,
                    0x0400a0185e89faea,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x03891d98b0565f22,
                    0xab748e41017d8503,
                    0xddfcb8c55cfe82ce,
                    0xc08790a1dd27dd23,
                    0x130bc34ea11fa15a,
                    0x1104b083fbc40641,
                ])),
                Felt::new(BigInteger384([
                    0x588d5e65334c4341,
                    0x91dd7825640822f0,
                    0x4b92263afb6b2bee,
                    0x6d54f6af4b70773c,
                    0x446f2078ea3a3ba8,
                    0x07e0fc8d0c177576,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x40fb3b29211ce051,
                    0x2594ebb3631988f6,
                    0xb208952264060428,
                    0xa54657ebb599277c,
                    0x32083c01894ef7f4,
                    0x09843c8baed11fe6,
                ])),
                Felt::new(BigInteger384([
                    0x06575f6c2f8a98d9,
                    0xf6412ac4d3fffa83,
                    0x57cdbaf8fb562ce3,
                    0x70f12b3964dd47bd,
                    0x48371eebbc8d986a,
                    0x0a5c9ef924069592,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x56b8ac9ac90586f3,
                    0xb8e6d2fb227fcec2,
                    0xc1fd890d145901d5,
                    0x476ebdbc9f6b892c,
                    0x07bd5a007349adc6,
                    0x053bbbcce294c313,
                ])),
                Felt::new(BigInteger384([
                    0x5e4a10064ec2d56c,
                    0xa4826230c526cf13,
                    0xe8201a8ad76daf09,
                    0x645806ab5063b940,
                    0x3aa4e5f218734344,
                    0x07f2eb4c99bd0c94,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xaf6de25e92c95b85,
                    0xaf5c2531cc40a62f,
                    0x6314b8135695b7c8,
                    0xb0bc2a6f391b9b89,
                    0x82f66d7aeed4edd1,
                    0x0a66db471dc9da49,
                ])),
                Felt::new(BigInteger384([
                    0x517979323fb4c0f2,
                    0x5917abffe8252d11,
                    0x5c3e6170f98bbce5,
                    0x56e6165a9ff5c0f7,
                    0xe60983a73a3b353f,
                    0x01a18d1f47f2dd67,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x8e5fb9cf404fef55,
                    0x199116ba0a20925b,
                    0xc2d6d84a82c7cae0,
                    0xdf748fb274d2d38b,
                    0xd9c745ce2304a851,
                    0x01ebadeb93ac5291,
                ])),
                Felt::new(BigInteger384([
                    0x674348ea271663b0,
                    0x67af6666ed5404e9,
                    0xf39ebd5bea7919d3,
                    0x9f9f92770f33907c,
                    0x2f0e35b0611956f9,
                    0x158d0588e173a514,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x18721b57768631c8,
                    0xded5d3c9d77b8e54,
                    0x6457c1efb49dfc02,
                    0xfc6fddd630d20918,
                    0xe510c0c9178eccd9,
                    0x15eb4c4a6c4b28eb,
                ])),
                Felt::new(BigInteger384([
                    0x6ffcfe54e4fc37b4,
                    0xc37d176653f1853a,
                    0x5660dda7e1dabe47,
                    0x191293e0ea27c657,
                    0x2a2b1916bf271f78,
                    0x0d0bc35c03de7fd0,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0x33d6606051644fd0,
                    0x05013e742e53fbe4,
                    0x831e6a13a125f105,
                    0xca6567995d0066e8,
                    0x14ce12d792c4a0fe,
                    0x08dd0713ebab1d2a,
                ])),
                Felt::new(BigInteger384([
                    0x99d032fc4daead61,
                    0xfee5879faaf36828,
                    0x5da69c130ff51fdb,
                    0x2d1e3f2b1cf93426,
                    0x034abf7519b294bb,
                    0x13e1e4b3d0026127,
                ])),
            ],
            [
                Felt::new(BigInteger384([
                    0xb96791c1393092aa,
                    0x0dd63630a6df9c4a,
                    0xab8f3fcabf2569aa,
                    0x7ac1cdb16372e0d9,
                    0xcec2188a494483f0,
                    0x18a0eac7962d12ff,
                ])),
                Felt::new(BigInteger384([
                    0x33ac95875ace3130,
                    0xb398753a3e58b5e8,
                    0xc4d2ce61132dc6a4,
                    0x68a29fcdef6f8a13,
                    0xbd0bb78a414b6e7d,
                    0x01038a47fc05090d,
                ])),
            ],
        ];

        for (input, expected) in input_data.iter().zip(output_data) {
            assert_eq!(expected.to_vec(), AnemoiHash::compress_k(input, 4));
        }
    }
}
